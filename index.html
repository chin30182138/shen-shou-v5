<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>仙人指路專業特效版 V7</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root{
      --brand:#B6822B;
      --ink:#1f2937;
      --bg1:#f6f7fb;
      --bg2:#fff;
    }
    body{margin:0;overflow-x:hidden;background:linear-gradient(135deg,var(--bg1),var(--bg2));transition:background 0.8s ease;}
    canvas.bgfx{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;}
    #gearBtn{position:fixed;top:14px;right:14px;z-index:20;background:var(--brand);color:#fff;border-radius:9999px;padding:10px;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.2);}
    #panel{position:fixed;top:0;right:0;height:100%;width:320px;background:#fff;border-left:1px solid #ddd;box-shadow:-3px 0 12px rgba(0,0,0,0.1);transform:translateX(100%);transition:.4s;padding:18px;overflow-y:auto;z-index:30;}
    #panel.open{transform:translateX(0);}
    #panel label{font-size:13px;color:#555;}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:18px;box-shadow:0 6px 20px rgba(0,0,0,.06);}
    @media print{#gearBtn,#panel,.no-print{display:none!important}}
  </style>
</head>
<body>
<canvas id="bgfx" class="bgfx"></canvas>

<button id="gearBtn">⚙️</button>

<div id="panel">
  <h2 class="text-lg font-bold mb-2">⚙️ 設定面板</h2>
  <div class="space-y-3">
    <div>
      <label>分析師姓名</label>
      <input id="instName" class="w-full border rounded px-2 py-1" value="林蔚青 阿青師">
    </div>
    <div>
      <label>聯絡方式</label>
      <input id="instContact" class="w-full border rounded px-2 py-1" value="LINE：@chin573365">
    </div>
    <div>
      <label>自我介紹</label>
      <textarea id="instBio" rows="2" class="w-full border rounded px-2 py-1">以金錢卦為核心，融合中醫五行，指引人生方向。</textarea>
    </div>
    <div>
      <label>上傳個人 QR 圖片</label>
      <input type="file" id="instQR" accept="image/*" class="w-full border rounded px-2 py-1">
    </div>
    <div>
      <label>背景風格</label>
      <select id="bgStyle" class="w-full border rounded px-2 py-1">
        <option value="A">金棕仙氣</option>
        <option value="B">藍紫夜空</option>
        <option value="C">火鳳光焰</option>
        <option value="D">玄武水流</option>
        <option value="E">白灰禪霧</option>
        <option value="F">自訂雙色</option>
      </select>
    </div>
    <div id="customColorWrap" class="hidden">
      <label>自訂漸層顏色1</label>
      <input type="color" id="color1" value="#B6822B" class="w-full h-8 border rounded">
      <label>自訂漸層顏色2</label>
      <input type="color" id="color2" value="#fff" class="w-full h-8 border rounded">
    </div>
    <div>
      <label>光點特效</label>
      <select id="fxType" class="w-full border rounded px-2 py-1">
        <option value="1">柔和光暈</option>
        <option value="2" selected>道氣流轉</option>
        <option value="3">星空閃爍</option>
        <option value="0">無特效</option>
      </select>
    </div>
    <div>
      <label>背景圖上傳</label>
      <input type="file" id="bgImg" accept="image/*" class="w-full border rounded px-2 py-1">
    </div>
    <div>
      <label>背景透明度</label>
      <input type="range" id="bgOpacity" min="0" max="1" step="0.05" value="0.4" class="w-full">
    </div>
    <button id="saveBtn" class="w-full bg-amber-600 text-white py-2 rounded">儲存設定</button>
  </div>
</div>

<main class="max-w-6xl mx-auto p-4 sm:p-6">
  <header class="flex items-center gap-3 mb-5">
    <img data-logo class="h-10 w-auto rounded" alt="Logo"/>
    <h1 class="text-2xl font-extrabold text-amber-700">神獸七十二型人格分析報表</h1>
  </header>

  <section id="report" class="card p-5">
    <h2 class="text-lg font-bold mb-3">主神獸結果與三欄建議</h2>
    <canvas id="radar" height="240"></canvas>
    <div class="grid md:grid-cols-3 gap-3 mt-4 text-sm">
      <div class="p-3 border rounded"><b>職場建議</b><ul class="list-disc pl-5 mt-1"><li>聚焦落地行動，避免分散能量。</li><li>設定具體目標，每週檢視。</li></ul></div>
      <div class="p-3 border rounded"><b>感情建議</b><ul class="list-disc pl-5 mt-1"><li>主動傾聽，降低誤會。</li><li>維持溫度感交流。</li></ul></div>
      <div class="p-3 border rounded"><b>養生建議</b><ul class="list-disc pl-5 mt-1"><li>保持規律作息。</li><li>動靜平衡，早睡養氣。</li></ul></div>
    </div>
    <hr class="my-4">
    <div class="grid md:grid-cols-3 gap-3 text-sm">
      <div class="md:col-span-2">
        <b>分析師資料</b>
        <div class="mt-1"><span id="vName">林蔚青 阿青師</span>｜<span id="vContact">LINE：@chin573365</span></div>
        <div id="vBio" class="mt-1 text-slate-600 text-sm">以金錢卦為核心，融合中醫五行，指引人生方向。</div>
      </div>
      <div class="flex justify-center items-center">
        <img id="vQR" src="" class="h-28 w-28 border rounded object-contain"/>
      </div>
    </div>
  </section>
</main>

<script>
const gear=document.getElementById('gearBtn');
const panel=document.getElementById('panel');
gear.onclick=()=>panel.classList.toggle('open');
const saveBtn=document.getElementById('saveBtn');
const bg=document.body;
const canvas=document.getElementById('bgfx'),ctx=canvas.getContext('2d');
let bgImgData=null,fxType=2,points=[];
function resize(){canvas.width=innerWidth;canvas.height=innerHeight;}
window.onresize=resize;resize();

// 背景風格表
const STYLES={
  A:['#B6822B','#fff'],B:['#1e3a8a','#4c1d95'],C:['#f97316','#b91c1c'],
  D:['#0f172a','#334155'],E:['#f8fafc','#e2e8f0']
};
function applyBG(){
  const s=localStorage.getItem('bgStyle')||'A';
  const c1=localStorage.getItem('c1')||STYLES[s]?.[0]||'#B6822B';
  const c2=localStorage.getItem('c2')||STYLES[s]?.[1]||'#fff';
  bg.style.background=`linear-gradient(135deg,${c1},${c2})`;
  const op=parseFloat(localStorage.getItem('bgOpacity')||0.4);
  if(bgImgData){bg.style.backgroundImage=`url(${bgImgData})`;bg.style.backgroundSize='cover';bg.style.opacity=op;}
}
function drawFX(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(fxType==0)return;
  const w=canvas.width,h=canvas.height;
  if(fxType==1){ctx.fillStyle='rgba(255,255,255,0.1)';for(let i=0;i<20;i++){ctx.beginPath();ctx.arc(Math.random()*w,Math.random()*h,Math.random()*50,0,2*Math.PI);ctx.fill();}}
  else if(fxType==2){points.forEach(p=>{p.x+=p.vx;p.y+=p.vy;if(p.x<0)p.x=w;if(p.x>w)p.x=0;if(p.y<0)p.y=h;if(p.y>h)p.y=0;ctx.beginPath();ctx.fillStyle=`rgba(255,255,255,${p.a})`;ctx.arc(p.x,p.y,p.r,0,2*Math.PI);ctx.fill();});}
  else if(fxType==3){ctx.fillStyle='rgba(255,255,255,0.8)';for(let i=0;i<50;i++){if(Math.random()<0.05)ctx.fillRect(Math.random()*w,Math.random()*h,1.5,1.5);}}
}
for(let i=0;i<80;i++){points.push({x:Math.random()*innerWidth,y:Math.random()*innerHeight,vx:(Math.random()-0.5)*0.5,vy:(Math.random()-0.5)*0.5,a:Math.random()*0.5+0.2,r:Math.random()*2+1});}
setInterval(drawFX,40);

function saveSettings(){
  const name=instName.value,contact=instContact.value,bio=instBio.value;
  localStorage.setItem('instName',name);
  localStorage.setItem('instContact',contact);
  localStorage.setItem('instBio',bio);
  localStorage.setItem('bgStyle',bgStyle.value);
  localStorage.setItem('fxType',fxTypeSel.value);
  localStorage.setItem('bgOpacity',bgOpacity.value);
  localStorage.setItem('c1',color1.value);
  localStorage.setItem('c2',color2.value);
  applySettings();
}
function applySettings(){
  document.getElementById('vName').textContent=localStorage.getItem('instName')||'';
  document.getElementById('vContact').textContent=localStorage.getItem('instContact')||'';
  document.getElementById('vBio').textContent=localStorage.getItem('instBio')||'';
  const qr=localStorage.getItem('instQR');if(qr)document.getElementById('vQR').src=qr;
  applyBG();
  fxType=parseInt(localStorage.getItem('fxType')||2);
}
saveBtn.onclick=()=>{saveSettings();panel.classList.remove('open');};
bgStyle.onchange=()=>{localStorage.setItem('bgStyle',bgStyle.value);applyBG();customColorWrap.classList.toggle('hidden',bgStyle.value!=='F');};
fxTypeSel=document.getElementById('fxType');fxTypeSel.onchange=()=>{fxType=parseInt(fxTypeSel.value);localStorage.setItem('fxType',fxType);};
bgOpacity.oninput=()=>{localStorage.setItem('bgOpacity',bgOpacity.value);applyBG();};
color1.oninput=color2.oninput=()=>{localStorage.setItem('c1',color1.value);localStorage.setItem('c2',color2.value);applyBG();};
instQR.onchange=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=()=>{localStorage.setItem('instQR',r.result);document.getElementById('vQR').src=r.result;};r.readAsDataURL(f);}};
bgImg.onchange=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=()=>{bgImgData=r.result;applyBG();};r.readAsDataURL(f);}};

(function init(){
  const base=window.location.pathname.split('/')[1];
  document.querySelectorAll('[data-logo]').forEach(img=>img.src=`/${base}/img/logo.png`);
  applySettings();
})();
</script>
</body>
</html>
