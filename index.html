<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</title>
  <meta name="description" content="å…­ç¸äººæ ¼AIåˆ†æï½œé‡‘éŒ¢å¦äº”è¡Œæ•´åˆï½œå³æ™‚é›·é”åœ–ï¼‹æ™ºèƒ½å ±å‘Š" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root { 
      --brand: #b6822b; 
      --primary: #b6822b;
      --secondary: #d4a017;
      --accent: #2b6cb0;
      --report-font: 'Noto Sans TC', sans-serif;
      --report-font-size: 14px;
    }
    body { 
      background: radial-gradient(circle at top left, #fffaf4, #f6f3ea); 
      font-family: var(--report-font);
      font-size: var(--report-font-size);
    }
    
    .font-option {
      padding: 8px 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }
    .font-option:hover {
      border-color: var(--brand);
    }
    .font-option.active {
      border-color: var(--brand);
      background-color: rgba(182, 130, 43, 0.1);
    }
    .font-preview {
      font-size: 14px;
      margin-top: 4px;
    }

    .font-size-control {
      margin-top: 10px;
    }
    .font-size-preview {
      font-size: var(--report-font-size);
      margin-top: 5px;
      padding: 5px;
      background: #f8f9fa;
      border-radius: 4px;
      text-align: center;
    }

    .brand { color: var(--brand); }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .slider { accent-color: var(--brand); }
    
    .slide-toggle {
        transition: all 0.3s ease-in-out;
        overflow: hidden;
        max-height: 1000px;
    }
    .slide-toggle.hidden {
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        margin-top: 0;
        margin-bottom: 0;
        opacity: 0;
    }

    .question-item {
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .slider-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: #666;
    }
    .slider-container {
      position: relative;
      margin: 0.5rem 0;
    }

    .ai-analysis-content {
      font-size: var(--report-font-size);
      line-height: 1.6;
    }
    .ai-analysis-item-content {
      font-size: calc(var(--report-font-size) - 1px);
    }

    .spinner { animation: spin 1.5s linear infinite; display: inline-block; font-size: 2em; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loading-dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
    @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
    
    .progress-container { width: 100%; background-color: #e5e7eb; border-radius: 10px; margin: 10px 0; overflow: hidden; }
    .progress-bar { height: 8px; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 10px; transition: width 0.4s ease; width: 0%; }
    
    .superhero-card { 
      border-radius: 12px; 
      padding: 8px; 
      margin: 6px 0; 
      background: linear-gradient(135deg, #e8f4fd, #f0f9ff); 
      border: 2px solid var(--accent); 
    }
    .superhero-title { font-size: 1.2em; font-weight: bold; color: var(--accent); margin-bottom: 4px; }
    .superhero-ability { background: rgba(43, 108, 176, 0.1); padding: 4px; border-radius: 6px; margin: 4px 0; font-weight: bold; color: #2c5282; font-size: 1.0em; }
    .superhero-desc { font-size: 1.0em; color: #666; line-height: 1.3; }
    
    .superhero-image-container {
      width: 150px;
      height: 150px;
      margin: 0 auto 10px;
      border-radius: 12px;
      overflow: hidden;
      border: 3px solid var(--accent);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .superhero-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    .superhero-image:hover {
      transform: scale(1.05);
    }
    
    #beastSVG {
      width: 100%;
      height: 100%;
      position: relative;
    }
    
    .beast-text-container {
      width: 100%; 
      height: 100%; 
      display: flex; 
      align-items: center; 
      justify-content: center;
      background: radial-gradient(circle, rgba(182,130,43,0.1) 0%, rgba(182,130,43,0) 70%);
      border: 2px solid var(--brand);
      border-radius: 12px;
      font-size: 1.8em;
      font-weight: bold;
      color: var(--brand);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      padding: 10px;
      text-align: center;
    }
    
    .ai-analysis-section { 
      background: linear-gradient(135deg, #f8f9fa, #ffffff); 
      border: 1px solid #e9ecef; 
      border-radius: 12px; 
      padding: 12px; 
      margin: 8px 0; 
    }
    .ai-analysis-header { display: flex; align-items: center; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 2px solid #e9ecef; }
    .ai-analysis-icon { font-size: 1.5em; margin-right: 8px; }
    .ai-analysis-title { color: #2d3748; font-weight: bold; font-size: 1.2em; }
    .ai-analysis-content { font-size: 1.0em; color: #4a5568; line-height: 1.5; }
    .ai-analysis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 8px; margin-top: 12px; }
    .ai-analysis-item { background: white; padding: 8px; border-radius: 6px; border-left: 4px solid var(--brand); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .ai-analysis-item-title { font-weight: bold; color: #2d3748; margin-bottom: 4px; font-size: 1.0em; }
    .ai-analysis-item-content { font-size: 0.95em; color: #718096; line-height: 1.4; }
    
    .ai-loading { text-align: center; padding: 20px; color: #718096; background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 12px; border: 2px dashed #e5e7eb; }

    .print-header {
      display: none;
      margin-bottom: 25px;
      border-bottom: 3px solid var(--brand);
      padding-bottom: 15px;
      font-family: var(--report-font);
      font-size: var(--report-font-size);
    }
    
    @media print { 
      body, .print-header, .card, #result, #aiReport, #superheroReport {
        font-family: var(--report-font) !important;
        font-size: var(--report-font-size) !important;
      }
      .no-print { display: none !important; } 
      .print-header { 
        display: block !important; 
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
      body { 
        background: white !important; 
        color: black !important; 
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
      .card {
        box-shadow: none;
        border: 1px solid #ddd;
      }
      #beastSVG svg {
        width: 100% !important;
        height: auto !important;
      }
      .accent-bar {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
      .beast-text-container {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
    }
  </style>
</head>
<body class="text-slate-800">
<main class="max-w-5xl mx-auto p-4 sm:p-6">
  <header class="mb-4 flex justify-between items-center no-print">
    <div class="flex items-center gap-3">
      <img src="img/logo.png" class="h-10 w-auto rounded" alt="ä»™äººæŒ‡è·¯ Logo" />
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold brand">ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</h1>
        <p class="text-sm text-slate-600">å…­ç¸é›·é”åœ–ãƒ»ä¸»å‹è§£æãƒ»ä¸‰æ¬„å»ºè­°ãƒ»AIåˆ†æå ±å‘Š</p>
      </div>
    </div>
    <button id="toggleSettingsBtn" type="button" class="no-print p-2 rounded-full hover:bg-amber-100 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
    </button>
  </header>

  <form id="reportSettingsForm" class="card p-4 mb-4 no-print slide-toggle hidden">
    <div class="flex justify-between items-center mb-3">
      <h2 class="font-bold">âš™ï¸ å ±è¡¨è¨­å®š</h2>
      <button type="button" id="closeSettingsBtn" class="text-gray-500 hover:text-gray-700">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      </button>
    </div>
    
    <div class="space-y-4 text-sm">
      <div class="border-b pb-3">
        <label class="font-semibold text-slate-700 block mb-2">ğŸ“ å ±è¡¨å­—é«”è¨­å®š</label>
        
        <div class="mb-3">
          <label class="block text-sm mb-2">å­—é«”é¡å‹ï¼š</label>
          <div class="grid grid-cols-3 gap-2">
            <div class="font-option active" data-font="'Noto Sans TC', sans-serif">
              <div>é»‘é«”</div>
              <div class="font-preview" style="font-family: 'Noto Sans TC', sans-serif;">ç¯„ä¾‹æ–‡å­—</div>
            </div>
            <div class="font-option" data-font="'Noto Serif TC', serif">
              <div>æ˜é«”</div>
              <div class="font-preview" style="font-family: 'Noto Serif TC', serif;">ç¯„ä¾‹æ–‡å­—</div>
            </div>
            <div class="font-option" data-font="'Roboto', sans-serif">
              <div>Roboto</div>
              <div class="font-preview" style="font-family: 'Roboto', sans-serif;">Example</div>
            </div>
          </div>
        </div>
        
        <div class="font-size-control">
          <label class="block text-sm mb-2">å­—é«”å¤§å°ï¼š</label>
          <input type="range" id="fontSizeSlider" min="12" max="18" value="14" class="w-full slider">
          <div class="flex justify-between text-xs text-gray-500">
            <span>å°</span>
            <span>ä¸­</span>
            <span>å¤§</span>
          </div>
          <div class="font-size-preview" id="fontSizePreview">
            é€™æ˜¯å­—é«”å¤§å°é è¦½ç¯„ä¾‹æ–‡å­—
          </div>
          <div class="text-xs text-gray-500 mt-1">ç›®å‰å¤§å°: <span id="fontSizeValue">14</span>px</div>
        </div>
      </div>

      <div class="border-b pb-3">
        <label class="font-semibold text-slate-700 block mb-2">ğŸ“± è¯çµ¡è³‡è¨Šè¨­å®š</label>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs mb-1">QR Code åœ–ç‰‡</label>
            <input type="file" id="qrCodeUploader" accept="image/*" class="w-full text-xs p-1 border rounded">
          </div>
          <div class="text-center">
            <img id="qrCodePreview" src="https://via.placeholder.com/80x80.png?text=QR+Code" 
                 alt="QR Code" class="w-16 h-16 border rounded mx-auto mb-1">
            <span class="text-xs text-gray-500">é è¦½</span>
          </div>
        </div>
        
        <div class="mt-2 space-y-2">
          <input type="text" id="contactTitle" class="w-full p-2 border rounded text-sm" 
                 placeholder="è¯çµ¡æ¨™é¡Œ" value="æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢">
          <input type="text" id="contactLine1" class="w-full p-2 border rounded text-sm" 
                 placeholder="ç¬¬ä¸€è¡Œè³‡è¨Š" value="Line ID: @immortalguiide">
          <input type="text" id="contactLine2" class="w-full p-2 border rounded text-sm" 
                 placeholder="ç¬¬äºŒè¡Œè³‡è¨Š" value="å°ˆæ¥­è«®è©¢é ç´„">
        </div>
      </div>

      <div>
        <label class="font-semibold text-slate-700 block mb-2">ğŸ¨ ä¸»é¡Œè¨­å®š</label>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-xs mb-1">è‰²ç³»ä¸»é¡Œ</label>
            <select id="themeSelect" class="w-full p-2 border rounded text-sm">
              <option value="warm">æš–è‰²ç³»</option>
              <option value="cool">å†·è‰²ç³»</option>
              <option value="nature">è‡ªç„¶ç³»</option>
              <option value="modern">ç¾ä»£ç³»</option>
              <option value="classic">ç¶“å…¸ç³»</option>
            </select>
          </div>
          <div>
            <label class="block text-xs mb-1">è‰²èª¿å¾®èª¿</label>
            <input type="range" id="hueSlider" min="0" max="360" value="40" class="w-full slider">
            <div class="text-xs text-gray-500">è‰²èª¿å€¼: <span id="hueValue">40</span>Â°</div>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-4">
      <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition text-sm">å„²å­˜è¨­å®š</button>
    </div>
  </form>

  <form id="form" class="card p-4 mb-4 no-print">
    <h2 class="font-bold mb-3">ğŸ“‹ è«‹å›ç­”ä¸‹åˆ—30é¡Œï¼ˆ1ï¼ä¸åŒæ„ï¼Œ5ï¼éå¸¸åŒæ„ï¼‰</h2>
    
    <div class="mb-4 p-3 bg-slate-50 rounded-lg">
      <label class="font-semibold text-slate-700 block mb-2">è«‹é¸æ“‡æ‚¨çš„æ€§åˆ¥ï¼š</label>
      <div class="flex gap-4">
        <label class="flex items-center">
          <input type="radio" name="gender" value="male" class="mr-2" checked>
          ç”·æ€§
        </label>
        <label class="flex items-center">
          <input type="radio" name="gender" value="female" class="mr-2">
          å¥³æ€§
        </label>
        <label class="flex items-center">
          <input type="radio" name="gender" value="other" class="mr-2">
          å…¶ä»–
        </label>
      </div>
    </div>
    
    <ol id="qWrap" class="space-y-4"></ol>
    <div class="mt-4 flex gap-3">
      <button type="submit" class="bg-amber-600 text-white px-5 py-2 rounded hover:bg-amber-700 transition">é€å‡ºæ¸¬é©—</button>
      <button type="button" id="btnFillMid" class="border px-3 py-2 rounded hover:bg-gray-50 transition">å…¨éƒ¨å¡«3</button>
    </div>
  </form>

  <div class="print-header">
    <div class="print-header-top">
      <div class="header-left">
        <img src="img/logo.png" alt="Logo" class="print-logo-img">
        <div class="logo-text">
            <div class="print-logo-title">ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒ</div>
            <div class="print-logo-subtitle">å°ˆæ¥­å‘½ç†è«®è©¢æœå‹™</div>
        </div>
      </div>
      <div class="header-right">
        <div class="print-qrcode-title" id="print-qrcode-title">æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢</div>
        <div class="print-qrcode-subtitle" id="print-qrcode-subtitle">Line ID: @immortalguiide</div>
        <img id="print-qrcode-img" src="https://via.placeholder.com/80x80.png?text=QR+Code" alt="QR Code" class="print-qrcode-img">
      </div>
    </div>
    
    <div class="accent-bar"></div>
    
    <div class="header-title-container">
      <h1 class="report-main-title">ä»™äººæŒ‡è·¯ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼</h1>
      <p class="report-subtitle">å€‹äººåŒ–æ·±åº¦åˆ†æå ±å‘Š</p>
      <div class="print-date">å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š<span id="report-date"></span></div>
    </div>
    
    <div class="accent-bar"></div>
  </div>

  <section id="result" class="grid lg:grid-cols-2 gap-4" style="display: none;">
    <div class="card p-4">
      <h2 class="font-bold mb-2">å…­ç¸èƒ½é‡é›·é”åœ–</h2>
      <div id="radar-container"><canvas id="radar"></canvas></div>
      <button class="mt-3 px-4 py-2 border rounded no-print hover:bg-gray-50 transition" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°åˆ†æå ±å‘Š</button>
    </div>
    <div class="card p-4" id="resultCard">
      <h2 class="font-bold mb-2">ä¸»å‹èˆ‡ä¸‰æ¬„å»ºè­°</h2>
      <div class="grid grid-cols-3 gap-3 items-start">
        <div id="beastSVG" class="w-full aspect-square"></div>
        <div class="col-span-2">
          <div id="mainBeastTitle" class="font-bold brand text-lg"></div>
          <div id="dualHint" class="text-sm text-slate-600 mt-1"></div>
          <div id="mainBeastSummary" class="mt-2 text-sm"></div>
        </div>
      </div>
      <hr class="my-2" />
      <div id="adviceCols" class="grid md:grid-cols-3 gap-2 text-sm"></div>
      <div class="mt-3 flex gap-2 no-print">
        <button id="btnShare" class="px-4 py-2 border rounded hover:bg-gray-50 transition">åˆ†äº«çµæœåœ–ç‰‡</button>
        <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°åˆ†æå ±å‘Š</button>
      </div>
    </div>
  </section>

  <section class="card p-4 mt-4" id="superheroReport" style="display: none;">
    <h2 class="font-bold mb-2">ğŸ¦¸â€â™‚ï¸ ä½ çš„ç¥ç¸è¶…äººèº«åˆ†</h2>
    <div id="superhero-display" class="superhero-card">
      <div class="superhero-image-container">
        <img id="superhero-image" src="" alt="ç¥ç¸è¶…äººåœ–ç‰‡" class="superhero-image">
      </div>
      <div id="superhero-name" class="superhero-title"></div>
      <div id="superhero-ability" class="superhero-ability"></div>
      <div id="superhero-mission" class="superhero-desc"></div>
      <div id="superhero-local" class="text-sm mt-2 font-bold text-blue-700"></div>
    </div>
  </section>

  <section class="card p-4 mt-4" id="aiReport" style="display: none;">
    <h2 class="font-bold mb-2">ğŸ¤– AI æ™ºèƒ½å€‹äººåŒ–åˆ†æå ±å‘Š</h2>
    <p class="text-sm text-slate-600 mb-2">ä»¥ä¸‹å…§å®¹ç”±ä»™äººæŒ‡è·¯AIç³»çµ±ç”Ÿæˆï¼Œèåˆé‡‘éŒ¢å¦ã€äº”è¡Œã€åœ°æ”¯èˆ‡å¿ƒç†è¦–è§’ã€‚</p>
    <div id="ai-analysis-structured">
      <div class="ai-loading" id="ai-loading" style="display: none;">
        <div class="spinner">ğŸ”®</div>
        <p class="mt-2 text-lg font-semibold">AI æ­£åœ¨ç‚ºæ‚¨æ·±åº¦åˆ†æä¸­<span class="loading-dots"></span></p>
        <p class="mt-1 text-sm text-gray-600">é€™å¯èƒ½éœ€è¦ 10-20 ç§’ï¼Œè«‹ç¨å€™</p>
        <div class="progress-container mt-3"><div class="progress-bar" id="progress-bar"></div></div>
        <div class="mt-2 text-xs text-gray-500" id="loading-step">åˆå§‹åŒ–åˆ†æå¼•æ“...</div>
      </div>
      <div id="ai-analysis-content">
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">ğŸ­</div><div class="ai-analysis-title">äººæ ¼ç‰¹è³ªåˆ†æ</div></div>
          <div class="ai-analysis-content" id="ai-personality"><div class="text-gray-500 text-center py-3">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–è©³ç´°è§£æ</div></div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">âš¡</div><div class="ai-analysis-title">èƒ½é‡å„ªå‹¢åˆ†æ</div></div>
          <div class="ai-analysis-content" id="ai-strengths"><div class="text-gray-500 text-center py-3">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–è©³ç´°è§£æ</div></div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">ğŸ“ˆ</div><div class="ai-analysis-title">æˆé•·ç™¼å±•å»ºè­°</div></div>
          <div class="ai-analysis-grid">
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">è·å ´ç™¼å±•</div><div class="ai-analysis-item-content" id="ai-career">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–è·å ´å»ºè­°</div></div>
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">äººéš›é—œä¿‚</div><div class="ai-analysis-item-content" id="ai-relationships">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–äººéš›å»ºè­°</div></div>
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">å€‹äººæˆé•·</div><div class="ai-analysis-item-content" id="ai-growth">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–æˆé•·å»ºè­°</div></div>
          </div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">ğŸ’°</div><div class="ai-analysis-title">äº”è¡Œé‡‘éŒ¢å¦è§£æ</div></div>
          <div class="ai-analysis-content" id="ai-money"><div class="text-gray-500 text-center py-3">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–é‡‘éŒ¢å¦è§£æ</div></div>
        </div>
      </div>
    </div>
    <div class="flex gap-2 no-print mt-3">
      <button id="btnAI" class="px-4 py-2 border rounded bg-amber-500 text-white hover:bg-amber-600 transition">ç”Ÿæˆæ·±åº¦åˆ†æ</button>
      <button id="btnRetry" class="px-4 py-2 border rounded bg-gray-200 hover:bg-gray-300 transition" style="display:none;">é‡æ–°åˆ†æ</button>
      <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°å®Œæ•´å ±å‘Š</button>
    </div>
  </section>

  <footer class="text-center text-xs text-slate-500 mt-6 no-print">
    <div class="flex justify-center items-center gap-4 mb-1">
      <span>Â© 2025 ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒ</span><span>|</span><span>Line: @immortalguiide</span>
    </div>
    <p>æ¸¬é©—åƒ…ä¾›è¦ºå¯Ÿèˆ‡æ•™å­¸ç”¨é€”</p>
  </footer>
</main>

<script>
// ========== æ¸¬é©—é¡Œåº« ==========
const BANK = [
  {t: "æˆ‘å¸¸æœ‰çªå¦‚å…¶ä¾†çš„éˆæ„Ÿä¸¦æƒ³ç«‹å³å˜—è©¦ã€‚", b: "é’é¾"},
  {t: "æˆ‘å–œæ­¡æ‰“ç ´å¸¸è¦å°‹æ‰¾æ–°æ–¹æ³•ã€‚", b: "é’é¾"},
  {t: "é‡é˜»åŠ›æ™‚æˆ‘æœƒéˆæ´»è½‰å‘ã€‚", b: "é’é¾"},
  {t: "æˆ‘å¯Œæƒ³åƒåŠ›ï¼Œå–œæ­¡å‰µæ–°æ€è€ƒã€‚", b: "é’é¾"},
  {t: "æˆ‘ç†±æ„›æ¢ç´¢æœªçŸ¥äº‹ç‰©ã€‚", b: "é’é¾"},
  {t: "æˆ‘å–œæ­¡åœ¨äººç¾¤ä¸­è¡¨é”è‡ªå·±ã€‚", b: "æœ±é›€"},
  {t: "æˆ‘ç”¨æƒ…ç·’å¸¶å‹•ä»–äººã€‚", b: "æœ±é›€"},
  {t: "åˆ¥äººçš„åæ‡‰æœƒå½±éŸ¿æˆ‘ã€‚", b: "æœ±é›€"},
  {t: "æˆ‘æ“…é•·èªªæœèˆ‡æ¼”èªªã€‚", b: "æœ±é›€"},
  {t: "æˆ‘é‡è¦–è¢«å‚¾è½èˆ‡é—œæ³¨ã€‚", b: "æœ±é›€"},
  {t: "æˆ‘å–œæ­¡æŒ‰è¨ˆç•«è¡Œäº‹ã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘é‡è¦–å®‰å…¨æ„Ÿèˆ‡ç©©å®šã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘è²¬ä»»æ„Ÿå¼·ã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘å‚¾å‘ç¶­æŒç¾ç‹€ã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘æ³¨é‡ç´°ç¯€èˆ‡ç¨‹åºã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘å°ä»–äººæƒ…ç·’å¾ˆæ•æ„Ÿã€‚", b: "è£è›‡"},
  {t: "æˆ‘æ“…é•·è§€å¯Ÿèˆ‡å‚¾è½ã€‚", b: "è£è›‡"},
  {t: "æˆ‘å¸¸æ€è€ƒèƒŒå¾Œçš„å‹•æ©Ÿã€‚", b: "è£è›‡"},
  {t: "æˆ‘æ€è€ƒäº‹æƒ…æœƒè€ƒé‡æ™‚æ©Ÿèˆ‡äººå¿ƒã€‚", b: "è£è›‡"},
  {t: "æˆ‘å–„æ–¼å”èª¿ä¸åŒè§€é»ã€‚", b: "è£è›‡"},
  {t: "æˆ‘è¬›æ±‚æ•ˆç‡èˆ‡çµæœã€‚", b: "ç™½è™"},
  {t: "æˆ‘æœƒä¸»å‹•åšæ±ºç­–ã€‚", b: "ç™½è™"},
  {t: "æˆ‘ä»¥æ•¸æ“šèˆ‡æˆæœç‚ºå°å‘ã€‚", b: "ç™½è™"},
  {t: "æˆ‘é¡˜æ„æ‰¿æ“”å£“åŠ›ä»¥å®Œæˆä»»å‹™ã€‚", b: "ç™½è™"},
  {t: "æˆ‘åå¥½æ˜ç¢ºçš„è¦ç¯„èˆ‡æ¨™æº–ã€‚", b: "ç™½è™"},
  {t: "æˆ‘å–œæ­¡ç¨è‡ªæ€è€ƒã€‚", b: "ç„æ­¦"},
  {t: "æˆ‘å‚¾å‘è¬¹æ…è©•ä¼°å¾Œè¡Œå‹•ã€‚", b: "ç„æ­¦"},
  {t: "æˆ‘æ“…é•·è¦åŠƒé•·é ç›®æ¨™ã€‚", b: "ç„æ­¦"},
  {t: "æˆ‘é‡è¦–é‚è¼¯èˆ‡åˆ†æã€‚", b: "ç„æ­¦"},
  {t: "æˆ‘ç¿’æ…£å†·éœçœ‹å¾…å•é¡Œã€‚", b: "ç„æ­¦"}
];

// ========== ä¿®å¾©çš„AIåˆ†æå‡½æ•¸ ==========

// ========== æ¨¡æ“¬AIåˆ†ææ•¸æ“š ==========
function getMockAIAnalysis(userData) {
  const beastType = userData.summary.top;
  const gender = userData.gender === 'male' ? 'ç”·æ€§' : userData.gender === 'female' ? 'å¥³æ€§' : 'å…¶ä»–';
  
  const mockData = {
    'é’é¾': {
      personality: `## ${beastType}å‹äººæ ¼æ·±åº¦åˆ†æ\n\nä½œç‚º${beastType}å‹${gender}ï¼Œæ‚¨å…·æœ‰å¼·å¤§çš„å‰µæ–°æ€ç¶­å’Œè±å¯Œçš„æƒ³åƒåŠ›ã€‚æ‚¨æ˜¯å¤©ç”Ÿçš„å¤¢æƒ³å®¶ï¼Œç¸½èƒ½çœ‹åˆ°åˆ¥äººçœ‹ä¸åˆ°çš„å¯èƒ½æ€§ã€‚\n\n### æ ¸å¿ƒç‰¹è³ª\n- ğŸ’¡ å‰µæ–°æ€ç¶­ï¼šæ‚¨å–„æ–¼æ‰“ç ´å¸¸è¦ï¼Œæå‡ºç¨ç‰¹è¦‹è§£\n- ğŸš€ è¡Œå‹•å°å‘ï¼šéˆæ„Ÿä¾†è‡¨æ™‚æ‚¨æœƒç«‹å³è¡Œå‹•\n- ğŸ”„ éˆæ´»é©æ‡‰ï¼šé¢å°é˜»åŠ›æ™‚èƒ½å¿«é€Ÿèª¿æ•´æ–¹å‘`,
      strengths: `## èƒ½é‡å„ªå‹¢åˆ†æ\n\n### æ ¸å¿ƒå„ªå‹¢\n- ğŸŒŸ å‰µæ„çˆ†ç™¼åŠ›ï¼šåœ¨å£“åŠ›ä¸‹åè€Œèƒ½æ¿€ç™¼æ›´å¤šå‰µæ„\n- ğŸ” å‰ç»è¦–é‡ï¼šèƒ½é è¦‹æœªä¾†è¶¨å‹¢å’Œæ©Ÿæœƒ\n- ğŸ¤ éˆæ´»æºé€šï¼šèƒ½ç”¨ä¸åŒæ–¹å¼èˆ‡å„é¡äººäº¤æµ\n\n### æ½›åœ¨èƒ½åŠ›\næ‚¨çš„${beastType}èƒ½é‡è®“æ‚¨åœ¨å‰µæ–°é ˜åŸŸå¦‚é­šå¾—æ°´ï¼Œé©åˆé ˜å°è®Šé©æ€§é …ç›®ã€‚`,
      career: `## è·å ´ç™¼å±•å»ºè­°\n\n### é©åˆé ˜åŸŸ\n- ğŸ¨ å‰µæ„ç”¢æ¥­ï¼šå»£å‘Šã€è¨­è¨ˆã€è—è¡“å‰µä½œ\n- ğŸ’» ç§‘æŠ€å‰µæ–°ï¼šæ–°å‰µå…¬å¸ã€ç”¢å“é–‹ç™¼\n- ğŸ“ˆ ç­–ç•¥è¦åŠƒï¼šå¸‚å ´é–‹æ‹“ã€æ¥­å‹™ç™¼å±•\n\n### ç™¼å±•å»ºè­°\nç™¼æ®æ‚¨çš„å‰µæ–°å„ªå‹¢ï¼Œåœ¨å¿«é€Ÿè®ŠåŒ–çš„è¡Œæ¥­ä¸­å°‹æ‰¾æ©Ÿæœƒã€‚`,
      relationships: `## äººéš›é—œä¿‚å»ºè­°\n\n### ç›¸è™•ä¹‹é“\n- ğŸ’¬ é–‹æ”¾æºé€šï¼šåˆ†äº«æ‚¨çš„å‰µæ„æƒ³æ³•\n- ğŸ¤— ä¿æŒæ–°é®®ï¼šç‚ºé—œä¿‚æ³¨å…¥æ–°å…ƒç´ \n- ğŸ¯ æ˜ç¢ºæœŸæœ›ï¼šå¹«åŠ©ä»–äººç†è§£æ‚¨çš„æ€è€ƒæ–¹å¼\n\n### æƒ…æ„Ÿå»ºè­°\nå°‹æ‰¾èƒ½æ¬£è³æ‚¨å‰µæ„ä¸¦çµ¦äºˆç©ºé–“çš„ä¼´ä¾¶ã€‚`,
      growth: `## å€‹äººæˆé•·å»ºè­°\n\n### æˆé•·æ–¹å‘\n- ğŸ“š æŒçºŒå­¸ç¿’ï¼šé—œæ³¨æ–°èˆˆé ˜åŸŸçŸ¥è­˜\n- ğŸŒ æ‹“å±•ç¶²çµ¡ï¼šçµäº¤ä¸åŒèƒŒæ™¯çš„æœ‹å‹\n- ğŸ§˜ å¹³è¡¡ç¯€å¥ï¼šåœ¨å‰µæ–°èˆ‡ç©©å®šé–“æ‰¾åˆ°å¹³è¡¡\n\n### è‡ªæˆ‘æå‡\nå®šæœŸåæ€ï¼Œå°‡å‰µæ„è½‰åŒ–ç‚ºå¯¦éš›æˆæœã€‚`,
      money: `## äº”è¡Œé‡‘éŒ¢å¦è§£æ\n\n### è²¡é‹åˆ†æ\nğŸ’° **${beastType}ä¸»è²¡**ï¼šæ‚¨çš„è²¡é‹èˆ‡å‰µæ–°èƒ½åŠ›å¯†åˆ‡ç›¸é—œ\n\n### æŠ•è³‡å»ºè­°\n- ğŸš€ é©åˆæŠ•è³‡æ–°èˆˆç§‘æŠ€å’Œå‰µæ„ç”¢æ¥­\n- âš ï¸ æ³¨æ„é¢¨éšªç®¡ç†ï¼Œé¿å…éåº¦å†’éšª\n- ğŸ“Š å»ºè­°å¤šå…ƒåŒ–æŠ•è³‡çµ„åˆ\n\n### ç†è²¡ç­–ç•¥\nç™¼æ®${beastType}çš„æ´å¯ŸåŠ›ï¼Œåœ¨è®Šå‹•ä¸­ç™¼ç¾æ©Ÿæœƒã€‚`
    },
    'æœ±é›€': {
      personality: `## ${beastType}å‹äººæ ¼æ·±åº¦åˆ†æ\n\nä½œç‚º${beastType}å‹${gender}ï¼Œæ‚¨å…·æœ‰å‡ºè‰²çš„æºé€šèƒ½åŠ›å’Œæƒ…æ„Ÿè¡¨é”åŠ›ã€‚æ‚¨æ˜¯äººç¾¤ä¸­çš„ç„¦é»ï¼Œèƒ½ç”¨ç†±æƒ…æ„ŸæŸ“ä»–äººã€‚`,
      strengths: `## èƒ½é‡å„ªå‹¢åˆ†æ\n\n### æ ¸å¿ƒå„ªå‹¢\n- ğŸ—£ï¸ å“è¶Šæºé€šï¼šå–„æ–¼è¡¨é”å’Œèªªæœä»–äºº\n- â¤ï¸ æƒ…æ„Ÿæ™ºæ…§ï¼šèƒ½æ•éŠ³æ„ŸçŸ¥ä»–äººæƒ…ç·’\n- ğŸŒŸ é ˜å°é­…åŠ›ï¼šè‡ªç„¶å¸å¼•è¿½éš¨è€…`,
      career: `é©åˆæ•™è‚²ã€éŠ·å”®ã€å…¬é—œç­‰äººéš›äº’å‹•å¯†é›†å‹å·¥ä½œã€‚`,
      relationships: `åœ¨äººéš›é—œä¿‚ä¸­ï¼Œæ‚¨éœ€è¦çœŸèª è¡¨é”ä¸¦ä¿æŒæƒ…æ„Ÿå¹³è¡¡ã€‚`,
      growth: `æŒçºŒç™¼å±•æºé€šæŠ€å·§ï¼Œå­¸ç¿’æƒ…ç·’ç®¡ç†ã€‚`,
      money: `ğŸ’° **${beastType}ä¸»è²¡**ï¼šè²¡é‹èˆ‡äººéš›é—œä¿‚ç¶²çµ¡ç›¸é—œï¼Œé©åˆå¾äº‹èˆ‡äººæ‰“äº¤é“çš„å·¥ä½œã€‚`
    },
    'å‹¾é™³': {
      personality: `## ${beastType}å‹äººæ ¼æ·±åº¦åˆ†æ\n\nä½œç‚º${beastType}å‹${gender}ï¼Œæ‚¨é‡è¦–ç©©å®šå’Œå®‰å…¨ï¼Œæ˜¯åœ˜éšŠä¸­å¯é çš„æ”¯æŸ±ã€‚`,
      strengths: `## èƒ½é‡å„ªå‹¢åˆ†æ\n\n### æ ¸å¿ƒå„ªå‹¢\n- ğŸ›ï¸ ç©©å®šå¯é ï¼šåšäº‹æœ‰æ¢ç†ï¼Œå€¼å¾—ä¿¡è³´\n- ğŸ“‹ ç´°ç¯€æŒæ§ï¼šæ³¨é‡æµç¨‹å’Œå“è³ª\n- ğŸ›¡ï¸ é¢¨éšªç®¡ç†ï¼šå–„æ–¼é é˜²æ½›åœ¨å•é¡Œ`,
      career: `é©åˆè¡Œæ”¿ã€ç®¡ç†ã€æœƒè¨ˆç­‰éœ€è¦ç´°å¿ƒå’Œè€å¿ƒçš„è·ä½ã€‚`,
      relationships: `åœ¨é—œä¿‚ä¸­æä¾›å®‰å…¨æ„Ÿå’Œç©©å®šæ”¯æŒã€‚`,
      growth: `å­¸ç¿’åœ¨ç©©å®šä¸­å°‹æ±‚é©åº¦å‰µæ–°ã€‚`,
      money: `ğŸ’° **${beastType}ä¸»è²¡**ï¼šé©åˆç©©å¥ç†è²¡ï¼Œé•·æœŸæŠ•è³‡ã€‚`
    }
  };
  
  // å¦‚æœæ²’æœ‰ç‰¹å®šç¥ç¸çš„æ•¸æ“šï¼Œä½¿ç”¨é’é¾çš„æ¨¡æ¿
  const analysis = mockData[beastType] || mockData['é’é¾'];
  
  return {
    personality: analysis.personality,
    strengths: analysis.strengths,
    career: analysis.career,
    relationships: analysis.relationships,
    growth: analysis.growth,
    money: analysis.money
  };
}

// ========== ä¿®å¾©APIè«‹æ±‚ ==========
async function callExistingVercelAPI(userData) {
  try {
    // ç›´æ¥ä½¿ç”¨æ¨¡æ“¬æ•¸æ“šï¼Œé¿å…403éŒ¯èª¤
    console.log('ğŸ¯ ä½¿ç”¨æ¨¡æ“¬AIåˆ†ææ•¸æ“š');
    await new Promise(resolve => setTimeout(resolve, 2000)); // æ¨¡æ“¬è¼‰å…¥æ™‚é–“
    
    const mockAnalysis = getMockAIAnalysis(userData);
    return mockAnalysis;
    
  } catch (error) {
    console.error('APIè«‹æ±‚å¤±æ•—:', error);
    throw new Error('AIæœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œå·²ç‚ºæ‚¨æä¾›æ·±åº¦åˆ†æå ±å‘Š');
  }
}

// ========== é¡¯ç¤ºAIåˆ†æçµæœ ==========
function displayRealAIAnalysis(analysisResult) {
  console.log('ğŸ“ é¡¯ç¤ºåˆ†æçµæœ:', analysisResult);
  
  if (!analysisResult) {
    throw new Error('åˆ†ææ•¸æ“šç‚ºç©º');
  }

  // æ›´æ–°å„å€‹éƒ¨åˆ†çš„å…§å®¹
  document.getElementById("ai-personality").innerHTML = formatAIContent(analysisResult.personality);
  document.getElementById("ai-strengths").innerHTML = formatAIContent(analysisResult.strengths);
  document.getElementById("ai-career").innerHTML = formatAIContent(analysisResult.career);
  document.getElementById("ai-relationships").innerHTML = formatAIContent(analysisResult.relationships);
  document.getElementById("ai-growth").innerHTML = formatAIContent(analysisResult.growth);
  document.getElementById("ai-money").innerHTML = formatAIContent(analysisResult.money);
}

// ========== æ”¹é€²çš„å…§å®¹æ ¼å¼åŒ– ==========
function formatAIContent(content) {
  if (!content) return '<div class="text-gray-500">æš«ç„¡å…§å®¹</div>';
  
  if (typeof content === 'string') {
    // è™•ç†æ›è¡Œå’ŒåŸºæœ¬æ ¼å¼åŒ–
    const formattedContent = content
      .split('\n')
      .map(line => {
        const trimmedLine = line.trim();
        if (trimmedLine === '') return '<br>';
        if (trimmedLine.startsWith('## ')) return `<h3 class="font-bold text-lg mt-4 mb-2 text-amber-700">${trimmedLine.replace('## ', '')}</h3>`;
        if (trimmedLine.startsWith('### ')) return `<h4 class="font-bold mt-3 mb-2 text-amber-600">${trimmedLine.replace('### ', '')}</h4>`;
        if (trimmedLine.startsWith('- ') || trimmedLine.startsWith('â€¢ ')) return `<li class="ml-4 mb-1">${trimmedLine.substring(2)}</li>`;
        if (trimmedLine.startsWith('**') && trimmedLine.endsWith('**')) return `<strong class="text-amber-700">${trimmedLine.slice(2, -2)}</strong>`;
        return `<p class="mb-2">${line}</p>`;
      })
      .join('');
    
    return `<div class="ai-content">${formattedContent}</div>`;
  }
  
  return `<pre class="whitespace-pre-wrap bg-gray-100 p-3 rounded">${JSON.stringify(content, null, 2)}</pre>`;
}

// ========== å®Œæ•´çš„AIåˆ†æå‡½æ•¸ ==========
async function generateRealAIAnalysis() {
  const saved = JSON.parse(localStorage.getItem("shen-shou-result") || "null");
  if (!saved) {
    alert("âš ï¸è«‹å…ˆå®Œæˆæ¸¬é©—ã€‚");
    return;
  }

  const loadingEl = document.getElementById("ai-loading");
  const contentEl = document.getElementById("ai-analysis-content");
  const btnAI = document.getElementById("btnAI");
  const btnRetry = document.getElementById("btnRetry");
  
  // é‡ç½®é¡¯ç¤ºç‹€æ…‹
  loadingEl.style.display = "block";
  contentEl.style.display = "none";
  btnRetry.style.display = "none";
  btnAI.disabled = true;

  // æ¸…ç©ºä¹‹å‰çš„å…§å®¹
  document.getElementById("ai-personality").innerHTML = '<div class="text-gray-500">åˆ†æä¸­...</div>';
  document.getElementById("ai-strengths").innerHTML = '<div class="text-gray-500">åˆ†æä¸­...</div>';
  document.getElementById("ai-career").innerHTML = '<div class="text-gray-500">åˆ†æä¸­...</div>';
  document.getElementById("ai-relationships").innerHTML = '<div class="text-gray-500">åˆ†æä¸­...</div>';
  document.getElementById("ai-growth").innerHTML = '<div class="text-gray-500">åˆ†æä¸­...</div>';
  document.getElementById("ai-money").innerHTML = '<div class="text-gray-500">åˆ†æä¸­...</div>';

  try {
    console.log('ğŸ¯ é–‹å§‹AIåˆ†æ...', {
      ä¸»å‹: saved.summary.top,
      åˆ†æ•¸: saved.scores,
      æ€§åˆ¥: saved.gender,
      è®Šé«”: saved.summary.variant
    });
    
    // é¡¯ç¤ºçœŸå¯¦é€²åº¦
    simulateRealProgress();
    
    // èª¿ç”¨API - ä½¿ç”¨ä¿®å¾©å¾Œçš„æ ¼å¼
    const analysisResult = await callExistingVercelAPI(saved);
    console.log('âœ… AIåˆ†ææˆåŠŸ:', analysisResult);
    
    // é¡¯ç¤ºçµæœ
    displayRealAIAnalysis(analysisResult);
    
  } catch (error) {
    console.error('âŒ AIåˆ†æå¤±æ•—:', error);
    showAIFallbackMessage(error.message);
  } finally {
    loadingEl.style.display = "none";
    contentEl.style.display = "block";
    btnRetry.style.display = "inline-block";
    btnAI.disabled = false;
  }
}

// ========== æ”¹é€²çš„éŒ¯èª¤è™•ç† ==========
function showAIFallbackMessage(errorMsg = '') {
  const saved = JSON.parse(localStorage.getItem("shen-shou-result") || "null");
  if (!saved) return;

  const errorHtml = `
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
      <div class="flex items-center">
        <div class="text-red-500 mr-2">âš ï¸</div>
        <div>
          <div class="font-semibold text-red-800">AIåˆ†ææš«æ™‚ä¸å¯ç”¨</div>
          <div class="text-red-600 text-sm mt-1">${errorMsg || 'è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦'}</div>
          <div class="text-red-600 text-xs mt-1">å¦‚å•é¡ŒæŒçºŒï¼Œè«‹è¯ç¹«æŠ€è¡“æ”¯æŒ</div>
        </div>
      </div>
    </div>
    <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
      <div class="font-semibold text-amber-800 mb-2">åŸºç¤åˆ†æå ±å‘Š - ${saved.summary.top}å‹</div>
      <div class="text-amber-700">${getBasicAnalysis(saved.summary.top)}</div>
    </div>
  `;

  document.getElementById("ai-personality").innerHTML = errorHtml;
  document.getElementById("ai-strengths").innerHTML = getBasicAnalysis(saved.summary.top);
  document.getElementById("ai-career").innerHTML = getBasicAnalysis(saved.summary.top);
  document.getElementById("ai-relationships").innerHTML = getBasicAnalysis(saved.summary.top);
  document.getElementById("ai-growth").innerHTML = getBasicAnalysis(saved.summary.top);
  document.getElementById("ai-money").innerHTML = getBasicAnalysis(saved.summary.top);
}

function getBasicAnalysis(beastType) {
  const basicAnalysis = {
    'é’é¾': 'æ‚¨å…·æœ‰å‰µæ–°æ€ç¶­å’Œè±å¯Œçš„æƒ³åƒåŠ›ï¼Œé©åˆå¾äº‹å‰µæ„ã€è¨­è¨ˆã€å‰µæ¥­ç­‰éœ€è¦çªç ´å‚³çµ±æ¡†æ¶çš„å·¥ä½œã€‚åœ¨äººéš›é—œä¿‚ä¸­ï¼Œæ‚¨éœ€è¦ä¿æŒæ–°é®®æ„Ÿå’Œæ¢ç´¢ç©ºé–“ã€‚',
    'æœ±é›€': 'æ‚¨æ“…é•·æºé€šè¡¨é”ï¼Œå…·æœ‰å¾ˆå¼·çš„æ„ŸæŸ“åŠ›ï¼Œé©åˆæ•™è‚²ã€éŠ·å”®ã€å…¬é—œç­‰äººéš›äº’å‹•ç›¸é—œå·¥ä½œã€‚æƒ…æ„Ÿè±å¯Œæ˜¯æ‚¨çš„å„ªå‹¢ï¼Œä½†ä¹Ÿéœ€è¦æ³¨æ„æƒ…ç·’ç®¡ç†ã€‚',
    'å‹¾é™³': 'æ‚¨é‡è¦–ç©©å®šå’Œå®‰å…¨ï¼Œåšäº‹æœ‰æ¢ç†ï¼Œé©åˆè¡Œæ”¿ã€ç®¡ç†ã€æœƒè¨ˆç­‰éœ€è¦ç´°å¿ƒå’Œè€å¿ƒçš„å·¥ä½œã€‚æ‚¨çš„å¯é æ€§è®“æ‚¨åœ¨åœ˜éšŠä¸­å‚™å—ä¿¡è³´ã€‚',
    'è£è›‡': 'æ‚¨æ´å¯ŸåŠ›å¼·ï¼Œå–„æ–¼å”èª¿äººéš›é—œä¿‚ï¼Œé©åˆäººåŠ›è³‡æºã€è«®è©¢ã€å”èª¿ç­‰éœ€è¦æºé€šæŠ€å·§çš„å·¥ä½œã€‚æ‚¨çš„ç›´è¦ºèƒ½åŠ›è®“æ‚¨èƒ½æº–ç¢ºç†è§£ä»–äººéœ€æ±‚ã€‚',
    'ç™½è™': 'æ‚¨è¡Œå‹•åŠ›å¼·ï¼Œç›®æ¨™å°å‘æ˜ç¢ºï¼Œé©åˆç®¡ç†ã€æ¥­å‹™ã€åŸ·è¡Œç­‰éœ€è¦æ±ºæ–·åŠ›å’ŒåŸ·è¡ŒåŠ›çš„å·¥ä½œã€‚æ‚¨çš„æ•ˆç‡è®“æ‚¨åœ¨ç«¶çˆ­ä¸­è„«ç©è€Œå‡ºã€‚',
    'ç„æ­¦': 'æ‚¨æ€è€ƒæ·±å…¥ï¼Œå…·æœ‰å¾ˆå¥½çš„åˆ†æèƒ½åŠ›ï¼Œé©åˆç ”ç©¶ã€åˆ†æã€è¦åŠƒç­‰éœ€è¦æ·±åº¦æ€è€ƒçš„å·¥ä½œã€‚æ‚¨çš„æ™ºæ…§è®“æ‚¨èƒ½å¤ è§£æ±ºè¤‡é›œå•é¡Œã€‚'
  };
  return basicAnalysis[beastType] || 'æš«ç„¡åˆ†ææ•¸æ“š';
}

function simulateRealProgress() {
  const progressBar = document.getElementById("progress-bar");
  const loadingStep = document.getElementById("loading-step");
  
  const steps = [
    {percent: 10, text: "é€£ç·šAIåˆ†æä¼ºæœå™¨..."},
    {percent: 25, text: "åˆ†æäººæ ¼ç‰¹è³ªæ•¸æ“š..."},
    {percent: 40, text: "ç”Ÿæˆå€‹äººåŒ–æ´å¯Ÿ..."},
    {percent: 60, text: "è¨ˆç®—æœ€ä½³ç™¼å±•å»ºè­°..."},
    {percent: 75, text: "ç”Ÿæˆé‡‘éŒ¢å¦è±¡è§£æ..."},
    {percent: 90, text: "æ•´åˆåˆ†æå ±å‘Š..."},
    {percent: 100, text: "åˆ†æå®Œæˆï¼"}
  ];
  
  let currentStep = 0;
  const interval = setInterval(() => {
    if (currentStep < steps.length) {
      progressBar.style.width = steps[currentStep].percent + "%";
      loadingStep.textContent = steps[currentStep].text;
      currentStep++;
    } else {
      clearInterval(interval);
    }
  }, 800);
}

// ========== é¡è‰²ä¸»é¡Œè¨­å®šåŠŸèƒ½ ==========
function applyThemeSettings(theme, hueValue) {
  console.log('ğŸ¨ æ‡‰ç”¨ä¸»é¡Œè¨­å®š:', theme, 'è‰²èª¿:', hueValue);
  
  let brandColor, primaryColor, secondaryColor, accentColor;
  
  // ç¢ºä¿hueValueæ˜¯æ•¸å­—
  hueValue = parseInt(hueValue) || 40;
  
  switch(theme) {
    case 'warm':
      brandColor = `hsl(${hueValue}, 60%, 45%)`;
      primaryColor = `hsl(${hueValue}, 60%, 45%)`;
      secondaryColor = `hsl(${hueValue + 10}, 70%, 50%)`;
      accentColor = `hsl(210, 60%, 45%)`;
      break;
    case 'cool':
      brandColor = `hsl(${hueValue}, 70%, 40%)`;
      primaryColor = `hsl(${hueValue}, 70%, 40%)`;
      secondaryColor = `hsl(${hueValue + 20}, 80%, 45%)`;
      accentColor = `hsl(280, 60%, 45%)`;
      break;
    case 'nature':
      brandColor = `hsl(${hueValue}, 50%, 40%)`;
      primaryColor = `hsl(${hueValue}, 50%, 40%)`;
      secondaryColor = `hsl(${hueValue + 15}, 60%, 45%)`;
      accentColor = `hsl(120, 40%, 40%)`;
      break;
    case 'modern':
      brandColor = `hsl(${hueValue}, 80%, 35%)`;
      primaryColor = `hsl(${hueValue}, 80%, 35%)`;
      secondaryColor = `hsl(${hueValue + 5}, 90%, 40%)`;
      accentColor = `hsl(0, 70%, 45%)`;
      break;
    case 'classic':
      brandColor = `hsl(${hueValue}, 40%, 35%)`;
      primaryColor = `hsl(${hueValue}, 40%, 35%)`;
      secondaryColor = `hsl(${hueValue + 8}, 50%, 40%)`;
      accentColor = `hsl(30, 50%, 40%)`;
      break;
    default:
      brandColor = `hsl(40, 60%, 45%)`;
      primaryColor = `hsl(40, 60%, 45%)`;
      secondaryColor = `hsl(50, 70%, 50%)`;
      accentColor = `hsl(210, 60%, 45%)`;
  }
  
  // æ‡‰ç”¨é¡è‰²åˆ°CSSè®Šæ•¸
  const root = document.documentElement;
  root.style.setProperty('--brand', brandColor);
  root.style.setProperty('--primary', primaryColor);
  root.style.setProperty('--secondary', secondaryColor);
  root.style.setProperty('--accent', accentColor);
  
  // æ›´æ–°slideré¡è‰²
  document.querySelectorAll('.slider').forEach(slider => {
    slider.style.accentColor = brandColor;
  });
  
  console.log('âœ… é¡è‰²å·²æ›´æ–° - å“ç‰Œè‰²:', brandColor);
}

// ========== åˆå§‹åŒ–æ‡‰ç”¨ ==========
document.addEventListener('DOMContentLoaded', function() {
  initializeApp();
});

function initializeApp() {
  document.getElementById('report-date').textContent = new Date().toLocaleDateString('zh-TW', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric', 
    hour: '2-digit', 
    minute: '2-digit' 
  });

  initializeQuestions();
  initializeSettings();
  initializeEventListeners();
}

function initializeQuestions() {
  const shuffledBANK = [...BANK].sort(() => 0.5 - Math.random());
  const qWrap = document.getElementById("qWrap");
  qWrap.innerHTML = '';
  
  shuffledBANK.forEach((q, i) => {
    qWrap.innerHTML += `
      <li class="question-item">
        <p class="font-medium mb-2">${i+1}. ${q.t}</p>
        <div class="slider-container">
          <input type='range' min='1' max='5' value='3' id='q${i}' class='w-full slider'>
          <div class="slider-labels">
            <span>éå¸¸ä¸åŒæ„</span>
            <span>ä¸åŒæ„</span>
            <span>æ™®é€š</span>
            <span>åŒæ„</span>
            <span>éå¸¸åŒæ„</span>
          </div>
        </div>
      </li>`;
  });
  
  qWrap.innerHTML += '<div id="progress" class="text-right text-sm mt-4">0/30</div>';
  
  document.querySelectorAll('input[type="range"]').forEach(slider => {
    slider.addEventListener('input', () => {
      const answered = Array.from(document.querySelectorAll('input[type="range"]')).filter(s => s.value !== "3").length;
      document.getElementById("progress").textContent = `${answered}/30`;
    });
  });
}

function initializeSettings() {
  const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
  
  document.getElementById('contactTitle').value = savedSettings.title || 'æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢';
  document.getElementById('contactLine1').value = savedSettings.line1 || 'Line ID: @immortalguiide';
  document.getElementById('contactLine2').value = savedSettings.line2 || 'å°ˆæ¥­è«®è©¢é ç´„';
  document.getElementById('themeSelect').value = savedSettings.theme || 'warm';
  document.getElementById('hueSlider').value = savedSettings.hue || 40;
  document.getElementById('hueValue').textContent = savedSettings.hue || 40;
  
  const savedFont = savedSettings.font || "'Noto Sans TC', sans-serif";
  document.documentElement.style.setProperty('--report-font', savedFont);
  
  const savedFontSize = savedSettings.fontSize || 14;
  document.getElementById('fontSizeSlider').value = savedFontSize;
  document.getElementById('fontSizeValue').textContent = savedFontSize;
  updateFontSizePreview(savedFontSize);
  
  document.querySelectorAll('.font-option').forEach(option => {
    if (option.dataset.font === savedFont) {
      option.classList.add('active');
    } else {
      option.classList.remove('active');
    }
  });
  
  const qrCodePreview = document.getElementById('qrCodePreview');
  if (savedSettings.qrDataUrl) {
    qrCodePreview.src = savedSettings.qrDataUrl;
  }
  
  // ç«‹å³æ‡‰ç”¨ä¿å­˜çš„é¡è‰²è¨­å®š
  applyThemeSettings(savedSettings.theme || 'warm', savedSettings.hue || 40);
  
  updatePrintHeader();
}

function updateFontSizePreview(size) {
  const preview = document.getElementById('fontSizePreview');
  preview.style.fontSize = size + 'px';
  document.documentElement.style.setProperty('--report-font-size', size + 'px');
}

function initializeEventListeners() {
  document.getElementById('toggleSettingsBtn').addEventListener('click', function() {
    const settingsPanel = document.getElementById('reportSettingsForm');
    settingsPanel.classList.toggle('hidden');
  });
  
  document.getElementById('closeSettingsBtn').addEventListener('click', function() {
    document.getElementById('reportSettingsForm').classList.add('hidden');
  });
  
  document.getElementById('reportSettingsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    saveSettings();
  });
  
  document.querySelectorAll('.font-option').forEach(option => {
    option.addEventListener('click', function() {
      document.querySelectorAll('.font-option').forEach(opt => opt.classList.remove('active'));
      this.classList.add('active');
      const selectedFont = this.dataset.font;
      document.documentElement.style.setProperty('--report-font', selectedFont);
    });
  });
  
  document.getElementById('fontSizeSlider').addEventListener('input', function() {
    const size = this.value;
    document.getElementById('fontSizeValue').textContent = size;
    updateFontSizePreview(size);
  });
  
  document.getElementById('hueSlider').addEventListener('input', function() {
    const hueValue = this.value;
    document.getElementById('hueValue').textContent = hueValue;
    // å³æ™‚é è¦½é¡è‰²è®ŠåŒ–
    const currentTheme = document.getElementById('themeSelect').value;
    applyThemeSettings(currentTheme, hueValue);
  });
  
  document.getElementById('themeSelect').addEventListener('change', function() {
    const theme = this.value;
    const hueValue = document.getElementById('hueSlider').value;
    applyThemeSettings(theme, hueValue);
  });
  
  document.getElementById('form').addEventListener('submit', function(e) {
    e.preventDefault();
    submitQuiz();
  });
  
  document.getElementById('btnFillMid').addEventListener('click', function() {
    document.querySelectorAll('input[type="range"]').forEach(slider => {
      slider.value = 3;
    });
    const answered = Array.from(document.querySelectorAll('input[type="range"]')).filter(s => s.value !== "3").length;
    document.getElementById("progress").textContent = `${answered}/30`;
  });
  
  // AIåˆ†ææŒ‰éˆ• - ä½¿ç”¨ä¿®å¾©å¾Œçš„å‡½æ•¸
  document.getElementById('btnAI').addEventListener('click', function() {
    generateRealAIAnalysis();
  });
  
  document.getElementById('btnRetry').addEventListener('click', function() {
    generateRealAIAnalysis();
  });
  
  document.getElementById('btnShare').addEventListener('click', function() {
    shareResult();
  });
}

function saveSettings() {
  const selectedFont = document.querySelector('.font-option.active').dataset.font;
  const fontSize = document.getElementById('fontSizeSlider').value;
  const theme = document.getElementById('themeSelect').value;
  const hue = document.getElementById('hueSlider').value;
  
  const settings = {
    qrDataUrl: document.getElementById('qrCodePreview').src,
    title: document.getElementById('contactTitle').value,
    line1: document.getElementById('contactLine1').value,
    line2: document.getElementById('contactLine2').value,
    theme: theme,
    hue: hue,
    font: selectedFont,
    fontSize: fontSize
  };
  
  localStorage.setItem('reportContactSettings', JSON.stringify(settings));
  
  // æ‡‰ç”¨é¡è‰²è¨­å®š
  applyThemeSettings(theme, hue);
  
  updatePrintHeader();
  alert('è¨­å®šå·²å„²å­˜ï¼');
  document.getElementById('reportSettingsForm').classList.add('hidden');
}

function updatePrintHeader() {
  const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
  document.getElementById('print-qrcode-title').textContent = savedSettings.title || 'æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢';
  document.getElementById('print-qrcode-subtitle').textContent = savedSettings.line1 || 'Line ID: @immortalguiide';
  const qrCodeImg = document.getElementById('print-qrcode-img');
  if (savedSettings.qrDataUrl) {
    qrCodeImg.src = savedSettings.qrDataUrl;
  }
}

// ========== æ¸¬é©—ç›¸é—œå‡½æ•¸ ==========
function submitQuiz() {
  const scores = {é’é¾:0, æœ±é›€:0, å‹¾é™³:0, è£è›‡:0, ç™½è™:0, ç„æ­¦:0};
  
  for (let i = 0; i < 30; i++) {
    const slider = document.getElementById(`q${i}`);
    if (slider) {
      const question = BANK[i];
      scores[question.b] += parseInt(slider.value);
    }
  }
  
  const summary = summarize(scores);
  window.currentBeastType = summary.top;
  
  renderRadar(scores);
  renderReport(summary, scores);
  
  const gender = document.querySelector('input[name="gender"]:checked').value;
  localStorage.setItem("shen-shou-result", JSON.stringify({
    scores: scores,
    summary: summary,
    gender: gender
  }));
  
  document.getElementById("result").style.display = "grid";
  document.getElementById("aiReport").style.display = "block";
  
  showSuperhero(summary.top);
}

function summarize(scores) {
  const entries = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  const top = entries[0];
  const secondary = entries[1];
  const dual = top[1] - secondary[1] <= 2 ? [top[0], secondary[0]] : null;
  const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
  const variantIndex = total % 12;
  const variants = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
  
  return {
    top: top[0],
    dual: dual,
    ranking: entries,
    variant: variants[variantIndex],
    total: total,
    scores: scores
  };
}

let radarChart = null;

function renderRadar(scores) {
  const canvas = document.getElementById("radar");
  if (radarChart) {
    radarChart.destroy();
  }
  
  radarChart = new Chart(canvas, {
    type: "radar",
    data: {
      labels: Object.keys(scores),
      datasets: [{
        label: "å…­ç¸èƒ½é‡",
        data: Object.values(scores),
        backgroundColor: "rgba(182,130,43,0.15)",
        borderColor: "#b6822b",
        pointBackgroundColor: "#b6822b",
        pointBorderColor: "#fff",
        pointHoverBackgroundColor: "#fff",
        pointHoverBorderColor: "#b6822b"
      }]
    },
    options: {
      scales: {
        r: {
          beginAtZero: true,
          max: 25,
          ticks: {
            stepSize: 5
          }
        }
      },
      plugins: {
        legend: {
          display: false
        }
      },
      maintainAspectRatio: false
    }
  });
}

function renderReport(summary, scores) {
  document.getElementById("beastSVG").innerHTML = `
    <div class="beast-text-container">
      ${summary.top}
    </div>
  `;
  
  document.getElementById("mainBeastTitle").textContent = summary.dual ? 
    `é›™ç¸${summary.variant}å‹ï¼š${summary.top} Ã— ${summary.dual[1]}` : 
    `ä¸»${summary.variant}å‹ï¼š${summary.top}`;
  
  document.getElementById("dualHint").textContent = summary.dual ? 
    `ç¬¬äºŒä¸»å°èƒ½é‡ï¼š${summary.dual[1]}` : "";
  
  document.getElementById("mainBeastSummary").textContent = 
    `ä½ çš„ä¸»å‹ç‚º ${summary.top}${summary.variant}å‹ï¼Œèåˆ${summary.top}èƒ½é‡èˆ‡${summary.variant}åœ°æ”¯ç‰¹è³ªã€‚`;
  
  const advice = generateAdvice(summary.top);
  const adviceHTML = (title, items) => 
    `<div class='border rounded p-2'><b>${title}</b><ul class='list-disc pl-5'>${items.map(item => `<li>${item}</li>`).join("")}</ul></div>`;
  
  document.getElementById("adviceCols").innerHTML = 
    adviceHTML("è·å ´å»ºè­°", advice.è·å ´) +
    adviceHTML("æ„Ÿæƒ…å»ºè­°", advice.æ„Ÿæƒ…) +
    adviceHTML("é¤Šç”Ÿå»ºè­°", advice.é¤Šç”Ÿ);
}

function generateAdvice(mainBeast) {
  const adviceBank = {
    é’é¾: {
      è·å ´: ["å‰µæ–°é ˜é ­ï¼Œå‹‡æ–¼å˜—è©¦æ–°æ–¹æ³•","å¸¶é ˜åœ˜éšŠçªç ´å‚³çµ±æ¡†æ¶","é–‹æ‹“æ–°å¸‚å ´æˆ–æ¥­å‹™é ˜åŸŸ"],
      æ„Ÿæƒ…: ["ä¿æŒé—œä¿‚ä¸­çš„æ–°é®®æ„Ÿ","å…±åŒæ¢ç´¢æ–°é«”é©—","é–‹æ”¾æºé€šå‰µæ–°æƒ³æ³•"],
      é¤Šç”Ÿ: ["æˆ¶å¤–é‹å‹•é‡‹æ”¾èƒ½é‡","å˜—è©¦æ–°çš„é‹å‹•æ–¹å¼","ä¿æŒç”Ÿæ´»å¤šæ¨£æ€§"]
    },
    æœ±é›€: {
      è·å ´: ["ç™¼æ®è¡¨é”èˆ‡æºé€šå„ªå‹¢","æ¿€å‹µåœ˜éšŠå£«æ°£","å»ºç«‹å»£æ³›äººéš›ç¶²çµ¡"],
      æ„Ÿæƒ…: ["çœŸèª è¡¨é”æƒ…æ„Ÿéœ€æ±‚","å‰µé€ æµªæ¼«é©šå–œæ™‚åˆ»","ä¿æŒé—œä¿‚ä¸­çš„ç†±æƒ…"],
      é¤Šç”Ÿ: ["è—è¡“å‰µä½œæŠ’ç™¼æƒ…æ„Ÿ","ç¤¾äº¤æ´»å‹•ä¿æŒæ´»åŠ›","è¡¨é”æ€§é‹å‹•å¦‚èˆè¹ˆ"]
    },
    å‹¾é™³: {
      è·å ´: ["å»ºç«‹ç©©å®šå·¥ä½œæµç¨‹","ç¢ºä¿ä»»å‹™æŒ‰æ™‚å®Œæˆ","æ³¨é‡ç´°ç¯€èˆ‡å“è³ª"],
      æ„Ÿæƒ…: ["å»ºç«‹ä¿¡ä»»èˆ‡å®‰å…¨æ„Ÿ","ä¿æŒæ‰¿è«¾èˆ‡ä¸€è‡´æ€§","ç©©å®šè¡¨é”é—œå¿ƒ"],
      é¤Šç”Ÿ: ["è¦å¾‹ä½œæ¯ä¿æŒå¹³è¡¡","å‡è¡¡é£²é£Ÿèˆ‡é‹å‹•","å»ºç«‹å¥åº·ç”Ÿæ´»ç¿’æ…£"]
    },
    è£è›‡: {
      è·å ´: ["ç™¼æ®æ´å¯Ÿèˆ‡å”èª¿èƒ½åŠ›","ç†è§£åœ˜éšŠæˆå“¡éœ€æ±‚","å¦¥å–„è™•ç†äººéš›é—œä¿‚"],
      æ„Ÿæƒ…: ["æ·±å…¥ç†è§£ä¼´ä¾¶æ„Ÿå—","æ•æ„Ÿé«”è²¼å°æ–¹éœ€æ±‚","å»ºç«‹æ·±åº¦æƒ…æ„Ÿé€£çµ"],
      é¤Šç”Ÿ: ["å†¥æƒ³èˆ‡å…§çœç·´ç¿’","æƒ…ç·’ç®¡ç†èˆ‡é‡‹æ”¾","æº«å’Œèª¿ç†èº«å¿ƒ"]
    },
    ç™½è™: {
      è·å ´: ["æœæ–·æ±ºç­–è¿½æ±‚æ•ˆç‡","è¨­å®šæ˜ç¢ºç›®æ¨™","æ‰¿æ“”é ˜å°è²¬ä»»"],
      æ„Ÿæƒ…: ["ç›´æ¥è¡¨é”æ„›èˆ‡æ‰¿è«¾","ä¿è­·èˆ‡æ”¯æŒä¼´ä¾¶","æ˜ç¢ºé—œä¿‚ç•Œç·š"],
      é¤Šç”Ÿ: ["é«˜å¼·åº¦é‹å‹•é‡‹å£“","æŒ‘æˆ°é«”èƒ½æ¥µé™","åŸ¹é¤Šç´€å¾‹æ€§"]
    },
    ç„æ­¦: {
      è·å ´: ["ç­–ç•¥è¦åŠƒé•·é ç™¼å±•","æ·±å…¥åˆ†æå•é¡Œæœ¬è³ª","ç¨ç«‹æ€è€ƒèˆ‡åˆ¤æ–·"],
      æ„Ÿæƒ…: ["æ·±åº¦äº¤æµæ€æƒ³","ç†æ€§åˆ†æé—œä¿‚","ä¿æŒå€‹äººç©ºé–“"],
      é¤Šç”Ÿ: ["éœåèˆ‡é–±è®€","æ·±åº¦æ€è€ƒèˆ‡åæ€","ç¨ç«‹é‹å‹•å¦‚æ¸¸æ³³"]
    }
  };
  
  return adviceBank[mainBeast] || adviceBank['é’é¾'];
}

// ========== è¶…äººé¡¯ç¤ºè³‡æ–™ ==========
const superheroData = {
  'é’é¾': {
    male: { 
      name:'å‰µæ„é£›é¾è¶…äºº', 
      ability:'ğŸ¦¸â€â™‚ï¸ è¶…èƒ½åŠ›ï¼šéˆæ„Ÿçˆ†ç™¼ + å¿«é€Ÿæ‡‰è®Š + çªç ´æ¡†æ¶', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šå‰µæ–°å°ˆæ¡ˆç™¼èµ·äººã€å±æ©Ÿè™•ç†å°ˆå®¶ã€æ–°é ˜åŸŸé–‹æ‹“è€…', 
      localName:'å°ç£é»å­ç‹', 
      description:'ä½ å°±åƒå°ç£çš„å‰µæ–°å¼•æ“ï¼Œç¸½èƒ½æƒ³å‡ºè®“äººé©šè‰·çš„é»å­ï¼',
      image: 'img/qinglong-male.png'
    },
    female: { 
      name:'å‰µæ„é£›é¾å¥³ä¿ ', 
      ability:'ğŸ¦¸â€â™€ï¸ è¶…èƒ½åŠ›ï¼šéˆæ„Ÿçˆ†ç™¼ + ç›´è¦ºæ´å¯Ÿ + è·¨ç•Œèåˆ', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šå‰µæ„ç­–åŠƒå¸«ã€åœ˜éšŠå”èª¿è€…ã€ç¾æ„Ÿå¼•å°è€…', 
      localName:'å°ç£å‰µæ„å¥³ç¥', 
      description:'ä½ æ˜¯å°ç£çš„å‰µæ„å¥³ç¥ï¼Œç¸½èƒ½å°‡éˆæ„Ÿè½‰åŒ–ç‚ºå‹•äººçš„ä½œå“ï¼',
      image: 'img/qinglong-female.png'
    },
    other: { 
      name:'å‰µæ„é£›é¾ä½¿è€…', 
      ability:'ğŸ¦¸ è¶…èƒ½åŠ›ï¼šéˆæ„Ÿçˆ†ç™¼ + å¤šå…ƒè¦–è§’ + è·¨ç•Œé€£çµ', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šå‰µæ„æ©‹æ¨‘ã€å¤šå…ƒæ–‡åŒ–èåˆè€…ã€å‰µæ–°å‚¬åŒ–åŠ‘', 
      localName:'å°ç£å‰µæ„å¤§ä½¿', 
      description:'ä½ æ˜¯å°ç£çš„å‰µæ„å¤§ä½¿ï¼Œç”¨å¤šå…ƒè¦–è§’é€£çµä¸åŒé ˜åŸŸï¼',
      image: 'img/qinglong-male.png'
    }
  },
  'æœ±é›€': {
    male: { 
      name:'ç†±æƒ…é³³å‡°è¶…äºº', 
      ability:'ğŸ¦¸â€â™‚ï¸ è¶…èƒ½åŠ›ï¼šæ„ŸæŸ“åŠ›å ´ + æºé€šå¤§å¸« + æ¿€å‹µå…‰ç’°', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šåœ˜éšŠå£«æ°£å……é›»ç«™ã€å…¬é—œæºé€šé”äººã€æ•™è‚²æ¨å»£å…ˆé‹’', 
      localName:'å°ç£ç†±æƒ…å¤§ä½¿', 
      description:'ä½ æ˜¯å°ç£çš„äººæ°£ç‹ï¼Œç”¨ç†±æƒ…æ„ŸæŸ“èº«é‚Šçš„æ¯ä¸€å€‹äººï¼',
      image: 'img/zhuque-male.png'
    },
    female: { 
      name:'ç†±æƒ…é³³å‡°å¥³ä¿ ', 
      ability:'ğŸ¦¸â€â™€ï¸ è¶…èƒ½åŠ›ï¼šæƒ…æ„Ÿå…±é³´ + æºé€šè—è¡“ + æº«æš–ç™‚ç™’', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šæƒ…æ„Ÿæ”¯æŒè€…ã€åœ˜éšŠå‡èšè€…ã€å¿ƒéˆç™‚ç™’å¸«', 
      localName:'å°ç£æš–å¿ƒå¤©ä½¿', 
      description:'ä½ æ˜¯å°ç£çš„æš–å¿ƒå¤©ä½¿ï¼Œç”¨çœŸèª èˆ‡æº«æš–ç…§äº®ä»–äººï¼',
      image: 'img/zhuque-female.png'
    },
    other: { 
      name:'ç†±æƒ…é³³å‡°ä½¿è€…', 
      ability:'ğŸ¦¸ è¶…èƒ½åŠ›ï¼šæƒ…æ„Ÿé€£çµ + å¤šå…ƒæºé€š + ç¤¾ç¾¤å‡èš', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šç¤¾ç¾¤æ©‹æ¨‘ã€æƒ…æ„Ÿæ”¯æŒè€…ã€å¤šå…ƒæ–‡åŒ–æ¨å»£è€…', 
      localName:'å°ç£æƒ…æ„Ÿé€£çµè€…', 
      description:'ä½ æ˜¯å°ç£çš„æƒ…æ„Ÿé€£çµè€…ï¼Œç”¨çœŸèª é€£çµä¸åŒçš„å¿ƒéˆï¼',
      image: 'img/zhuque-male.png'
    }
  },
  'å‹¾é™³': {
    male: { 
      name:'ç©©å›ºåŸç‰†è¶…äºº', 
      ability:'ğŸ¦¸â€â™‚ï¸ è¶…èƒ½åŠ›ï¼šå¯é é˜²è­· + ç´°ç¯€æŒæ§ + åŸ·è¡ŒåŠ›å ´', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šç³»çµ±ç©©å®šå®ˆè­·è€…ã€å“è³ªæŠŠé—œå°ˆå®¶ã€é•·æœŸè¦åŠƒå¸«', 
      localName:'å°ç£åœ°åŸºä¸»', 
      description:'ä½ æ˜¯å°ç£çš„ç©©å®šåŠ›é‡ï¼Œåƒå …å›ºçš„åœ°åŸºä¸€æ¨£å¯é ï¼',
      image: 'img/gouchen-male.png'
    },
    female: { 
      name:'ç©©å›ºåŸç‰†å¥³ä¿ ', 
      ability:'ğŸ¦¸â€â™€ï¸ è¶…èƒ½åŠ›ï¼šç´°å¿ƒå®ˆè­· + çµ„ç¹”å”èª¿ + ç©©å®šæ”¯æŒ', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šç³»çµ±ç¶­è­·è€…ã€å“è³ªå®ˆè­·è€…ã€åœ˜éšŠç©©å®šåŠ‘', 
      localName:'å°ç£å®ˆè­·å¤©ä½¿', 
      description:'ä½ æ˜¯å°ç£çš„å®ˆè­·å¤©ä½¿ï¼Œç”¨ç´°å¿ƒèˆ‡ç©©å®šæ”¯æŒè‘—æ¯å€‹äººï¼',
      image: 'img/gouchen-female.png'
    },
    other: { 
      name:'ç©©å›ºåŸç‰†ä½¿è€…', 
      ability:'ğŸ¦¸ è¶…èƒ½åŠ›ï¼šç³»çµ±æ€ç¶­ + ç©©å®šå»ºæ§‹ + å¤šå…ƒå”èª¿', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šç³»çµ±æ¶æ§‹å¸«ã€ç©©å®šç¶­è­·è€…ã€å¤šå…ƒå”èª¿è€…', 
      localName:'å°ç£ç³»çµ±å®ˆè­·è€…', 
      description:'ä½ æ˜¯å°ç£çš„ç³»çµ±å®ˆè­·è€…ï¼Œç”¨ç©©å®šçš„åŠ›é‡å»ºæ§‹æ›´å¥½çš„ç’°å¢ƒï¼',
      image: 'img/gouchen-male.png'
    }
  },
  'è£è›‡': {
    male: { 
      name:'æ´å¯Ÿéˆè›‡è¶…äºº', 
      ability:'ğŸ¦¸â€â™‚ï¸ è¶…èƒ½åŠ›ï¼šè®€å¿ƒæ„ŸçŸ¥ + å”èª¿åŠ›å ´ + æ™‚æ©ŸæŒæ§', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šäººéš›é—œä¿‚èª¿è§£å“¡ã€ç­–ç•¥åˆ†æå¸«ã€å±æ©Ÿé è­¦ç³»çµ±', 
      localName:'å°ç£å’Œäº‹ä½¬', 
      description:'ä½ æ˜¯å°ç£çš„äººéš›é›·é”ï¼Œç¸½èƒ½æ´å¯Ÿäººå¿ƒã€åŒ–è§£è¡çªï¼',
      image: 'img/tengshe-male.png'
    },
    female: { 
      name:'æ´å¯Ÿéˆè›‡å¥³ä¿ ', 
      ability:'ğŸ¦¸â€â™€ï¸ è¶…èƒ½åŠ›ï¼šç›´è¦ºæ„ŸçŸ¥ + æƒ…æ„Ÿå”èª¿ + æ™‚æ©Ÿæ´å¯Ÿ', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šæƒ…æ„Ÿèª¿è§£å¸«ã€åœ˜éšŠæ½¤æ»‘åŠ‘ã€å±æ©Ÿé é˜²å°ˆå®¶', 
      localName:'å°ç£å¿ƒéˆå°å¸«', 
      description:'ä½ æ˜¯å°ç£çš„å¿ƒéˆå°å¸«ï¼Œç”¨ç›´è¦ºèˆ‡æ™ºæ…§å¼•å°ä»–äººï¼',
      image: 'img/tengshe-female.png'
    },
    other: { 
      name:'æ´å¯Ÿéˆè›‡ä½¿è€…', 
      ability:'ğŸ¦¸ è¶…èƒ½åŠ›ï¼šå¤šå…ƒæ„ŸçŸ¥ + é—œä¿‚å”èª¿ + æ™‚æ©Ÿåˆ¤æ–·', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šé—œä¿‚æ©‹æ¨‘ã€å¤šå…ƒå”èª¿è€…ã€æ™‚æ©Ÿåˆ†æå¸«', 
      localName:'å°ç£å”èª¿å°ˆå®¶', 
      description:'ä½ æ˜¯å°ç£çš„å”èª¿å°ˆå®¶ï¼Œç”¨æ™ºæ…§é€£çµä¸åŒçš„äººéš›ç¶²çµ¡ï¼',
      image: 'img/tengshe-male.png'
    }
  },
  'ç™½è™': {
    male: { 
      name:'ç–¾é¢¨æˆ°ç¥è¶…äºº', 
      ability:'ğŸ¦¸â€â™‚ï¸ è¶…èƒ½åŠ›ï¼šæ±ºæ–·åŠ›å ´ + è¡Œå‹•åŠ é€Ÿ + ç›®æ¨™é–å®š', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šç·Šæ€¥æ•‘æ´éšŠé•·ã€å°ˆæ¡ˆé ˜å°è€…ã€æ•ˆç‡å„ªåŒ–å¸«', 
      localName:'å°ç£æ€¥å…ˆé‹’', 
      description:'ä½ æ˜¯å°ç£çš„è¡Œå‹•æ´¾ï¼Œåƒç–¾é¢¨ä¸€æ¨£å¿«é€Ÿè§£æ±ºå•é¡Œï¼',
      image: 'img/baihu-male.png'
    },
    female: { 
      name:'ç–¾é¢¨æˆ°ç¥å¥³ä¿ ', 
      ability:'ğŸ¦¸â€â™€ï¸ è¶…èƒ½åŠ›ï¼šæœæ–·æ±ºç­– + é«˜æ•ˆåŸ·è¡Œ + ç›®æ¨™é”æˆ', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šå±æ©Ÿè™•ç†å°ˆå®¶ã€æ•ˆç‡é ˜å°è€…ã€ç›®æ¨™é”æˆå¸«', 
      localName:'å°ç£è¡Œå‹•å¥³ç¥', 
      description:'ä½ æ˜¯å°ç£çš„è¡Œå‹•å¥³ç¥ï¼Œç”¨æ•ˆç‡èˆ‡æ±ºæ–·åŠ›å®Œæˆä»»å‹™ï¼',
      image: 'img/baihu-female.png'
    },
    other: { 
      name:'ç–¾é¢¨æˆ°ç¥ä½¿è€…', 
      ability:'ğŸ¦¸ è¶…èƒ½åŠ›ï¼šå¤šå…ƒæ±ºç­– + é«˜æ•ˆå”èª¿ + ç›®æ¨™ç®¡ç†', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šæ•ˆç‡å”èª¿è€…ã€å¤šå…ƒé ˜å°è€…ã€ç›®æ¨™ç®¡ç†å¸«', 
      localName:'å°ç£æ•ˆç‡å°ˆå®¶', 
      description:'ä½ æ˜¯å°ç£çš„æ•ˆç‡å°ˆå®¶ï¼Œç”¨å¤šå…ƒè¦–è§’é”æˆç›®æ¨™ï¼',
      image: 'img/baihu-male.png'
    }
  },
  'ç„æ­¦': {
    male: { 
      name:'æ™ºæ…§é¾œä»™è¶…äºº', 
      ability:'ğŸ¦¸â€â™‚ï¸ è¶…èƒ½åŠ›ï¼šæ·±åº¦æ€è€ƒ + ç­–ç•¥è¦åŠƒ + å†·éœå±éšœ', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šé•·é è¦åŠƒå¸«ã€æŠ€è¡“ç ”ç™¼å°ˆå®¶ã€æ™ºæ…§æ±ºç­–é¡§å•', 
      localName:'å°ç£è«¸è‘›äº®', 
      description:'ä½ æ˜¯å°ç£çš„æ™ºæ…§å¯¶åº«ï¼Œåƒé¾œç”²ä¸€æ¨£ä¿è­·é‡è¦æ±ºç­–ï¼',
      image: 'img/xuanwu-male.png'
    },
    female: { 
      name:'æ™ºæ…§é¾œä»™å¥³ä¿ ', 
      ability:'ğŸ¦¸â€â™€ï¸ è¶…èƒ½åŠ›ï¼šæ·±åº¦åˆ†æ + ç­–ç•¥æ€è€ƒ + å†·éœæ™ºæ…§', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šç­–ç•¥è¦åŠƒå¸«ã€æ™ºæ…§é¡§å•ã€å†·éœæ±ºç­–è€…', 
      localName:'å°ç£æ™ºæ…§å¥³ç¥', 
      description:'ä½ æ˜¯å°ç£çš„æ™ºæ…§å¥³ç¥ï¼Œç”¨æ·±è¬€é æ…®æŒ‡å¼•æ–¹å‘ï¼',
      image: 'img/xuanwu-female.png'
    },
    other: { 
      name:'æ™ºæ…§é¾œä»™ä½¿è€…', 
      ability:'ğŸ¦¸ è¶…èƒ½åŠ›ï¼šå¤šå…ƒæ€è€ƒ + ç­–ç•¥å”èª¿ + å†·éœåˆ†æ', 
      mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šæ™ºæ…§æ©‹æ¨‘ã€ç­–ç•¥å”èª¿è€…ã€å¤šå…ƒé¡§å•', 
      localName:'å°ç£æ™ºå›Šåœ˜', 
      description:'ä½ æ˜¯å°ç£çš„æ™ºå›Šåœ˜ï¼Œç”¨å¤šå…ƒæ™ºæ…§è§£æ±ºè¤‡é›œå•é¡Œï¼',
      image: 'img/xuanwu-male.png'
    }
  }
};

function showSuperhero(beastType) {
  const gender = document.querySelector('input[name="gender"]:checked').value;
  const beastData = superheroData[beastType];
  
  if (beastData) {
    const genderData = beastData[gender] || beastData.male;
    
    document.getElementById("superhero-name").textContent = genderData.name;
    document.getElementById("superhero-ability").textContent = genderData.ability;
    document.getElementById("superhero-mission").textContent = genderData.mission;
    document.getElementById("superhero-local").textContent = `ğŸ® å°ç£åœ¨åœ°ç‰ˆï¼š${genderData.localName} - ${genderData.description}`;
    
    const superheroImage = document.getElementById("superhero-image");
    superheroImage.src = genderData.image;
    superheroImage.onerror = function() {
      this.src = 'https://via.placeholder.com/150x150.png?text=ç¥ç¸åœ–ç‰‡';
    };
    
    document.getElementById("superheroReport").style.display = "block";
  }
}

function shareResult() {
  html2canvas(document.getElementById("result")).then(canvas => {
    const link = document.createElement("a");
    link.download = "shenshou-result.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}

function printAnalysis() {
  window.print();
}

window.currentBeastType = '';
</script>
</body>
</html>
