<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ V7</title>
  <meta name="description" content="å…­ç¸äººæ ¼AIåˆ†æï½œé‡‘éŒ¢å¦äº”è¡Œæ•´åˆï½œå³æ™‚é›·é”åœ–ï¼‹æ™ºèƒ½å ±å‘Š" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root {
      --brand: #b6822b;
      --bg1: #fff9f0;
      --bg2: #f5efe0;
      --ink: #1f2937;
    }
    body {
      background: radial-gradient(circle at top left, var(--bg1), var(--bg2));
      overflow-x: hidden;
    }
    .brand { color: var(--brand) }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05) }
    .slider { accent-color: var(--brand) }
    canvas#bgCanvas {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      z-index: -1; pointer-events: none; opacity: 0.35;
    }
    @media print { .no-print {display:none!important;} }
  </style>
</head>
<body class="text-slate-800">

<canvas id="bgCanvas"></canvas>

<main class="max-w-5xl mx-auto p-4 sm:p-6">
  <header class="mb-4 flex justify-between items-center">
    <div class="flex items-center gap-3">
      <img id="logo" src="img/logo.png" class="h-10 w-auto rounded" alt="ä»™äººæŒ‡è·¯ Logo" />
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold brand">ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</h1>
        <p class="text-sm text-slate-600">å…­ç¸é›·é”åœ–ãƒ»ä¸»ç¥ç¸è§£æãƒ»ä¸‰æ¬„å»ºè­°ãƒ»AIåˆ†æå ±å‘Š</p>
      </div>
    </div>
    <button id="btnSetting" class="no-print text-xl">âš™ï¸</button>
  </header>

  <!-- åˆ†æå¸«è¨­å®šé¢æ¿ -->
  <section id="panel" class="card p-4 mb-4 hidden no-print">
    <h2 class="font-bold mb-2">åˆ†æå¸«è¨­å®š</h2>
    <div class="grid sm:grid-cols-3 gap-2">
      <input id="fName" placeholder="å§“å" class="border rounded px-2 py-1" value="æ—è”šé’ é˜¿é’å¸«">
      <input id="fContact" placeholder="è¯çµ¡æ–¹å¼" class="border rounded px-2 py-1" value="LINEï¼š@chin573365">
      <input id="fBio" placeholder="ç°¡ä»‹" class="border rounded px-2 py-1" value="ä»¥é‡‘éŒ¢å¦ç‚ºæ ¸å¿ƒï¼Œèåˆäº”è¡ŒæŒ‡å¼•äººç”Ÿæ–¹å‘ã€‚">
    </div>
    <div class="mt-2">
      <label class="text-xs text-slate-500">ä¸Šå‚³ QR åœ–ç‰‡</label>
      <input type="file" id="fQR" accept="image/*" class="block">
    </div>
    <div class="mt-3 flex gap-2">
      <button id="btnSaveInst" class="border rounded px-3 py-1">ğŸ’¾ å„²å­˜</button>
      <button id="btnBG" class="border rounded px-3 py-1">ğŸ¨ èƒŒæ™¯æ¨£å¼</button>
    </div>
  </section>

  <!-- å•å· -->
  <form id="form" class="card p-4 mb-4">
    <h2 class="font-bold mb-3">ğŸ“‹ è«‹å›ç­”ä¸‹åˆ—30é¡Œï¼ˆ1ï¼ä¸åŒæ„ï¼Œ5ï¼éå¸¸åŒæ„ï¼‰</h2>
    <ol id="qWrap" class="space-y-3"></ol>
    <div class="mt-4 flex gap-3">
      <button type="submit" class="bg-amber-600 text-white px-5 py-2 rounded">é€å‡ºæ¸¬é©—</button>
      <button type="button" id="btnFillMid" class="border px-3 py-2 rounded">å…¨éƒ¨å¡«3</button>
    </div>
  </form>

  <!-- çµæœå€ -->
  <section id="result" class="grid lg:grid-cols-2 gap-4">
    <div class="card p-4">
      <h2 class="font-bold mb-2">å…­ç¸èƒ½é‡é›·é”åœ–</h2>
      <canvas id="radar"></canvas>
    </div>
    <div class="card p-4" id="resultCard">
      <h2 class="font-bold mb-2">ä¸»ç¥ç¸èˆ‡ä¸‰æ¬„å»ºè­°</h2>
      <div class="grid grid-cols-3 gap-3 items-start">
        <div id="beastSVG" class="w-full aspect-square"></div>
        <div class="col-span-2">
          <div id="mainBeastTitle" class="font-bold brand"></div>
          <div id="dualHint" class="text-sm text-slate-600"></div>
          <div id="mainBeastSummary" class="mt-1 text-sm"></div>
        </div>
      </div>
      <hr class="my-2" />
      <div id="adviceCols" class="grid md:grid-cols-3 gap-2 text-sm"></div>
      <hr class="my-2" />
      <div class="text-xs text-right text-slate-500">
        åˆ†æå¸«ï¼š<span id="instName">æ—è”šé’ é˜¿é’å¸«</span>ï½œ<span id="instContact">LINEï¼š@chin573365</span>
      </div>
    </div>
  </section>

  <!-- AI æ™ºèƒ½åˆ†æ -->
  <section class="card p-4 mt-4" id="aiReport">
    <h2 class="font-bold mb-2">ğŸ¤– AI æ™ºèƒ½å€‹äººåŒ–åˆ†æå ±å‘Š</h2>
    <p class="text-sm text-slate-600 mb-3">ä»¥ä¸‹å…§å®¹ç”±ä»™äººæŒ‡è·¯AIç³»çµ±ç”Ÿæˆï¼Œèåˆé‡‘éŒ¢å¦ã€äº”è¡Œèˆ‡å¿ƒç†è¦–è§’ã€‚</p>
    <button id="btnAI" class="px-4 py-2 border rounded no-print">ç”Ÿæˆåˆ†æå ±å‘Š</button>
    <pre id="aiOut" class="mt-3 text-sm bg-slate-50 p-3 rounded-lg whitespace-pre-wrap leading-relaxed"></pre>
  </section>

  <footer class="text-center text-xs text-slate-500 mt-8">
    Â© 2025 ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒï½œæ¸¬é©—åƒ…ä¾›è¦ºå¯Ÿèˆ‡æ•™å­¸ç”¨é€”
  </footer>
</main>

<script>
// ====== é¡Œåº« ======
const BANK=[
{t:"æˆ‘å¸¸æœ‰çªå¦‚å…¶ä¾†çš„éˆæ„Ÿä¸¦æƒ³ç«‹å³å˜—è©¦ã€‚",b:"é’é¾"},
{t:"æˆ‘å–œæ­¡æ‰“ç ´å¸¸è¦å°‹æ‰¾æ–°æ–¹æ³•ã€‚",b:"é’é¾"},
{t:"é‡é˜»åŠ›æ™‚æˆ‘æœƒéˆæ´»è½‰å‘ã€‚",b:"é’é¾"},
{t:"æˆ‘å¯Œæƒ³åƒåŠ›ï¼Œå–œæ­¡å‰µæ–°æ€è€ƒã€‚",b:"é’é¾"},
{t:"æˆ‘ç†±æ„›æ¢ç´¢æœªçŸ¥äº‹ç‰©ã€‚",b:"é’é¾"},
{t:"æˆ‘å–œæ­¡åœ¨äººç¾¤ä¸­è¡¨é”è‡ªå·±ã€‚",b:"æœ±é›€"},
{t:"æˆ‘ç”¨æƒ…ç·’å¸¶å‹•ä»–äººã€‚",b:"æœ±é›€"},
{t:"åˆ¥äººçš„åæ‡‰æœƒå½±éŸ¿æˆ‘ã€‚",b:"æœ±é›€"},
{t:"æˆ‘æ“…é•·èªªæœèˆ‡æ¼”èªªã€‚",b:"æœ±é›€"},
{t:"æˆ‘é‡è¦–è¢«å‚¾è½èˆ‡é—œæ³¨ã€‚",b:"æœ±é›€"},
{t:"æˆ‘å–œæ­¡æŒ‰è¨ˆç•«è¡Œäº‹ã€‚",b:"å‹¾é™³"},
{t:"æˆ‘é‡è¦–å®‰å…¨æ„Ÿèˆ‡ç©©å®šã€‚",b:"å‹¾é™³"},
{t:"æˆ‘è²¬ä»»æ„Ÿå¼·ã€‚",b:"å‹¾é™³"},
{t:"æˆ‘å‚¾å‘ç¶­æŒç¾ç‹€ã€‚",b:"å‹¾é™³"},
{t:"æˆ‘æ³¨é‡ç´°ç¯€èˆ‡ç¨‹åºã€‚",b:"å‹¾é™³"},
{t:"æˆ‘å°ä»–äººæƒ…ç·’å¾ˆæ•æ„Ÿã€‚",b:"è£è›‡"},
{t:"æˆ‘æ“…é•·è§€å¯Ÿèˆ‡å‚¾è½ã€‚",b:"è£è›‡"},
{t:"æˆ‘å¸¸æ€è€ƒèƒŒå¾Œçš„å‹•æ©Ÿã€‚",b:"è£è›‡"},
{t:"æˆ‘æ€è€ƒäº‹æƒ…æœƒè€ƒé‡æ™‚æ©Ÿèˆ‡äººå¿ƒã€‚",b:"è£è›‡"},
{t:"æˆ‘å–„æ–¼å”èª¿ä¸åŒè§€é»ã€‚",b:"è£è›‡"},
{t:"æˆ‘è¬›æ±‚æ•ˆç‡èˆ‡çµæœã€‚",b:"ç™½è™"},
{t:"æˆ‘æœƒä¸»å‹•åšæ±ºç­–ã€‚",b:"ç™½è™"},
{t:"æˆ‘ä»¥æ•¸æ“šèˆ‡æˆæœç‚ºå°å‘ã€‚",b:"ç™½è™"},
{t:"æˆ‘é¡˜æ„æ‰¿æ“”å£“åŠ›ä»¥å®Œæˆä»»å‹™ã€‚",b:"ç™½è™"},
{t:"æˆ‘åå¥½æ˜ç¢ºçš„è¦ç¯„èˆ‡æ¨™æº–ã€‚",b:"ç™½è™"},
{t:"æˆ‘å–œæ­¡ç¨è‡ªæ€è€ƒã€‚",b:"ç„æ­¦"},
{t:"æˆ‘å‚¾å‘è¬¹æ…è©•ä¼°å¾Œè¡Œå‹•ã€‚",b:"ç„æ­¦"},
{t:"æˆ‘æ“…é•·è¦åŠƒé•·é ç›®æ¨™ã€‚",b:"ç„æ­¦"},
{t:"æˆ‘é‡è¦–é‚è¼¯èˆ‡åˆ†æã€‚",b:"ç„æ­¦"},
{t:"æˆ‘ç¿’æ…£å†·éœçœ‹å¾…å•é¡Œã€‚",b:"ç„æ­¦"}];

const qWrap=document.getElementById("qWrap");
BANK.forEach((q,i)=>{
  qWrap.innerHTML+=`<li><p>${i+1}. ${q.t}</p>
  <input type='range' min='1' max='5' value='3' id='q${i}' class='w-full slider'></li>`;
});

// ====== åˆ†æèˆ‡é›·é” ======
function summarize(scores){
  const arr=Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const top=arr[0], second=arr[1];
  const dual=(top[1]-second[1]<=1)?[top[0],second[0]]:null;
  return {top:top[0],dual,ranking:arr};
}

let radarChart=null;
function renderRadar(scores){
  const ctx=document.getElementById("radar");
  if(radarChart) radarChart.destroy();
  radarChart=new Chart(ctx,{type:"radar",
    data:{labels:Object.keys(scores),
    datasets:[{label:"å…­ç¸èƒ½é‡",data:Object.values(scores),
    backgroundColor:"rgba(182,130,43,0.15)",borderColor:"#b6822b"}]},
    options:{scales:{r:{suggestedMin:0,suggestedMax:25,ticks:{stepSize:5}}},
    plugins:{legend:{display:false}}}});
}

function renderReport(summary,scores){
  const info=summary.top;
  document.getElementById("beastSVG").innerHTML=`<div class='p-4 text-center text-6xl'>${info}</div>`;
  document.getElementById("mainBeastTitle").textContent = summary.dual ? `é›™ç¸å‹ï¼š${summary.top} Ã— ${summary.dual[1]}` : `ä¸»ç¥ç¸ï¼š${summary.top}`;
  document.getElementById("dualHint").textContent = summary.dual ? `ç¬¬äºŒä¸»å°èƒ½é‡ï¼š${summary.dual[1]}` : '';
  document.getElementById("mainBeastSummary").textContent = `ä½ çš„ä¸»ç¥ç¸ç‚º ${summary.top}ï¼Œä»£è¡¨ä½ çš„æ ¸å¿ƒç‰¹è³ªæœ€æ˜é¡¯ã€‚`;

  const col=(title,arr)=>`<div class='border rounded p-2'><b>${title}</b><ul class='list-disc pl-5'>${arr.map(x=>`<li>${x}</li>`).join('')}</ul></div>`;
  const advice={
    è·å ´:["é‡è¦–è§’è‰²å®šä½èˆ‡ç¯€å¥ã€‚","å»ºç«‹åœ˜éšŠä¿¡ä»»æ„Ÿã€‚","å­¸æœƒæˆæ¬Šèˆ‡åˆä½œã€‚"],
    æ„Ÿæƒ…:["çœŸèª è¡¨é”éœ€æ±‚ã€‚","å¹³è¡¡ç†æ€§èˆ‡æ„Ÿæ€§ã€‚","å­¸ç¿’å‚¾è½ä»–äººã€‚"],
    é¤Šç”Ÿ:["æ—©ç¡æ—©èµ·ã€ç¯€åˆ¶é£²é£Ÿã€‚","ä¿æŒé‹å‹•ç¿’æ…£ã€‚","ç”¨å‘¼å¸å†¥æƒ³ç©©å®šèƒ½é‡ã€‚"]
  };
  document.getElementById("adviceCols").innerHTML=col("è·å ´å»ºè­°",advice.è·å ´)+col("æ„Ÿæƒ…å»ºè­°",advice.æ„Ÿæƒ…)+col("é¤Šç”Ÿå»ºè­°",advice.é¤Šç”Ÿ);
}

// ====== å•å·é€å‡º ======
document.getElementById("form").addEventListener("submit",e=>{
  e.preventDefault();
  const scores={é’é¾:0,æœ±é›€:0,å‹¾é™³:0,è£è›‡:0,ç™½è™:0,ç„æ­¦:0};
  BANK.forEach((q,i)=>scores[q.b]+=parseInt(document.getElementById(`q${i}`).value));
  const summary=summarize(scores);
  renderRadar(scores); renderReport(summary,scores);
  localStorage.setItem("shen-shou-v7",JSON.stringify({scores,summary}));
});

// ====== å¡«3 ======
document.getElementById("btnFillMid").onclick=()=>document.querySelectorAll(".slider").forEach(s=>s.value=3);

// ====== é½’è¼ªè¨­å®š ======
document.getElementById("btnSetting").onclick=()=>panel.classList.toggle("hidden");

// ====== åˆ†æå¸«å„²å­˜ ======
document.getElementById("btnSaveInst").onclick=()=>{
  const data={
    name:fName.value,contact:fContact.value,bio:fBio.value
  };localStorage.setItem("inst",JSON.stringify(data));
  alert("å·²å„²å­˜åˆ†æå¸«è³‡è¨Š");
};

// ====== èƒŒæ™¯ç‰¹æ•ˆ ======
const c=document.getElementById("bgCanvas"),ctx=c.getContext("2d");
let w,h,particles=[];function resize(){w=c.width=window.innerWidth;h=c.height=window.innerHeight;}
window.addEventListener("resize",resize);resize();
function createParticles(n=40){particles=[];for(let i=0;i<n;i++)particles.push({x:Math.random()*w,y:Math.random()*h,r:Math.random()*3+1,dx:(Math.random()-.5)*0.5,dy:(Math.random()-.5)*0.5});}
function draw(){ctx.clearRect(0,0,w,h);for(const p of particles){ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle="rgba(182,130,43,0.25)";ctx.fill();p.x+=p.dx;p.y+=p.dy;if(p.x<0||p.x>w)p.dx*=-1;if(p.y<0||p.y>h)p.dy*=-1;}requestAnimationFrame(draw);}
createParticles();draw();

// ====== AI æ™ºèƒ½åˆ†æ ======
document.getElementById("btnAI").addEventListener("click",async()=>{
  const saved=JSON.parse(localStorage.getItem("shen-shou-v7")||"null");
  const out=document.getElementById("aiOut");
  if(!saved){out.textContent="âš ï¸è«‹å…ˆå®Œæˆæ¸¬é©—ã€‚";return;}
  out.textContent="ğŸª¶ AI æ­£åœ¨åˆ†æä¸­ï¼Œç´„5~10ç§’...";
  try{
    const resp=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify(saved)});
    if(!resp.ok)throw new Error(await resp.text());
    const data=await resp.json();
    out.textContent=data.text.trim();
  }catch(err){out.textContent="âŒåˆ†æå¤±æ•—ï¼š"+err.message;}
});
</script>
</body>
</html>
