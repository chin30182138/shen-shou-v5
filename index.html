<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</title>
  <meta name="description" content="å…­ç¸äººæ ¼AIåˆ†æï½œé‡‘éŒ¢å¦äº”è¡Œæ•´åˆï½œå³æ™‚é›·é”åœ–ï¼‹æ™ºèƒ½å ±å‘Š" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root { --brand: #b6822b; }
    body { background: radial-gradient(circle at top left, #fffaf4, #f6f3ea); }
    .brand { color: var(--brand); }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .slider { accent-color: var(--brand); }
    .spinner { animation: spin 1s linear infinite; display: inline-block; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* åˆ—å°æ¨£å¼ */
    @media print { 
      .no-print { display: none !important; } 
      #form, header, footer { display: none !important; }
      body { 
        background: white !important; 
        font-size: 12px !important;
        padding: 10px !important;
        margin: 0 !important;
      }
      main {
        max-width: 100% !important;
        padding: 0 !important;
      }
      .card { 
        box-shadow: none !important; 
        border: 1px solid #999 !important;
        margin-bottom: 15px !important;
        break-inside: avoid;
        page-break-inside: avoid;
      }
      #result {
        display: grid !important;
        grid-template-columns: 45% 55% !important;
        gap: 15px !important;
        margin-bottom: 20px !important;
      }
      /* é›·é”åœ–å®¹å™¨ä¿æŒæ­£æ–¹å½¢ */
      #radar-container {
        position: relative;
        width: 100% !important;
        height: 0 !important;
        padding-bottom: 100% !important; /* ä¿æŒ1:1æ¯”ä¾‹ */
      }
      #radar {
        position: absolute !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
      }
      #resultCard {
        font-size: 11px !important;
      }
      #aiReport {
        display: block !important;
        page-break-before: always;
        margin-top: 20px !important;
      }
      #aiOut {
        font-size: 11px !important;
        line-height: 1.3 !important;
        max-height: none !important;
      }
      h1, h2 {
        color: black !important;
        margin-bottom: 8px !important;
      }
      .print-only { display: block !important; }
      .print-header {
        text-align: center;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #b6822b;
      }
      .print-header h1 {
        font-size: 18px !important;
        margin-bottom: 5px !important;
      }
      .print-header p {
        font-size: 12px !important;
        color: #666 !important;
      }
    }
    
    .print-only { display: none; }
    
    /* ç¶²é é¡¯ç¤ºæ™‚çš„é›·é”åœ–æ¨£å¼ */
    #radar {
      width: 100% !important;
      height: 300px !important;
    }
  </style>
</head>
<body class="text-slate-800">
<main class="max-w-5xl mx-auto p-4 sm:p-6">
  <header class="mb-4 flex justify-between items-center no-print">
    <div class="flex items-center gap-3">
      <img src="img/logo.png" class="h-10 w-auto rounded" alt="ä»™äººæŒ‡è·¯ Logo" />
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold brand">ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</h1>
        <p class="text-sm text-slate-600">å…­ç¸é›·é”åœ–ãƒ»ä¸»å‹è§£æãƒ»ä¸‰æ¬„å»ºè­°ãƒ»AIåˆ†æå ±å‘Š</p>
      </div>
    </div>
  </header>

  <!-- å•å· -->
  <form id="form" class="card p-4 mb-4 no-print">
    <h2 class="font-bold mb-3">ğŸ“‹ è«‹å›ç­”ä¸‹åˆ—30é¡Œï¼ˆ1ï¼ä¸åŒæ„ï¼Œ5ï¼éå¸¸åŒæ„ï¼‰</h2>
    <ol id="qWrap" class="space-y-3"></ol>
    <div class="mt-4 flex gap-3">
      <button type="submit" class="bg-amber-600 text-white px-5 py-2 rounded">é€å‡ºæ¸¬é©—</button>
      <button type="button" id="btnFillMid" class="border px-3 py-2 rounded">å…¨éƒ¨å¡«3</button>
    </div>
  </form>

  <!-- åˆ—å°å°ˆç”¨æ¨™é¡Œ -->
  <div class="print-only print-header">
    <h1>ç¥ç¸äººæ ¼åˆ†æå ±å‘Š</h1>
    <p>å€‹äººå°ˆå±¬åˆ†æçµæœ</p>
  </div>

  <!-- çµæœ - åˆå§‹éš±è— -->
  <section id="result" class="grid lg:grid-cols-2 gap-4" style="display: none;">
    <div class="card p-4">
      <h2 class="font-bold mb-2">å…­ç¸èƒ½é‡é›·é”åœ–</h2>
      <div id="radar-container">
        <canvas id="radar"></canvas>
      </div>
      <button class="mt-3 px-4 py-2 border rounded no-print" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°åˆ†æå ±å‘Š</button>
    </div>
    <div class="card p-4" id="resultCard">
      <h2 class="font-bold mb-2">ä¸»å‹èˆ‡ä¸‰æ¬„å»ºè­°</h2>
      <div class="grid grid-cols-3 gap-3 items-start">
        <div id="beastSVG" class="w-full aspect-square"></div>
        <div class="col-span-2">
          <div id="mainBeastTitle" class="font-bold brand"></div>
          <div id="dualHint" class="text-sm text-slate-600"></div>
          <div id="mainBeastSummary" class="mt-1 text-sm"></div>
        </div>
      </div>
      <hr class="my-2" />
      <div id="adviceCols" class="grid md:grid-cols-3 gap-2 text-sm"></div>
      <div class="mt-4 flex gap-2 no-print">
        <button id="btnShare" class="px-4 py-2 border rounded">åˆ†äº«çµæœåœ–ç‰‡</button>
        <button class="px-4 py-2 border rounded" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°åˆ†æå ±å‘Š</button>
      </div>
    </div>
  </section>

  <!-- AI æ™ºèƒ½åˆ†æ - åˆå§‹éš±è— -->
  <section class="card p-4 mt-4" id="aiReport" style="display: none;">
    <h2 class="font-bold mb-2">ğŸ¤– AI æ™ºèƒ½å€‹äººåŒ–åˆ†æå ±å‘Š</h2>
    <p class="text-sm text-slate-600 mb-3">ä»¥ä¸‹å…§å®¹ç”±ä»™äººæŒ‡è·¯AIç³»çµ±ç”Ÿæˆï¼Œèåˆé‡‘éŒ¢å¦ã€äº”è¡Œã€åœ°æ”¯èˆ‡å¿ƒç†è¦–è§’ã€‚</p>
    <div class="flex gap-2 no-print">
      <button id="btnAI" class="px-4 py-2 border rounded">ç”Ÿæˆåˆ†æå ±å‘Š</button>
      <button id="btnRetry" class="px-4 py-2 border rounded bg-gray-200" style="display:none;">é‡è©¦</button>
      <button class="px-4 py-2 border rounded" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°å®Œæ•´å ±å‘Š</button>
    </div>
    <pre id="aiOut" class="mt-3 text-sm bg-slate-50 p-3 rounded-lg whitespace-pre-wrap leading-relaxed"></pre>
  </section>

  <footer class="text-center text-xs text-slate-500 mt-8 no-print">
    Â© 2025 ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒï½œæ¸¬é©—åƒ…ä¾›è¦ºå¯Ÿèˆ‡æ•™å­¸ç”¨é€”
  </footer>
</main>

<script>
// åˆ—å°åŠŸèƒ½
function printAnalysis() {
  window.print();
}

// ========== é¡Œåº« ==========
const BANK = [
  {t:"æˆ‘å¸¸æœ‰çªå¦‚å…¶ä¾†çš„éˆæ„Ÿä¸¦æƒ³ç«‹å³å˜—è©¦ã€‚",b:"é’é¾"},
  {t:"æˆ‘å–œæ­¡æ‰“ç ´å¸¸è¦å°‹æ‰¾æ–°æ–¹æ³•ã€‚",b:"é’é¾"},
  {t:"é‡é˜»åŠ›æ™‚æˆ‘æœƒéˆæ´»è½‰å‘ã€‚",b:"é’é¾"},
  {t:"æˆ‘å¯Œæƒ³åƒåŠ›ï¼Œå–œæ­¡å‰µæ–°æ€è€ƒã€‚",b:"é’é¾"},
  {t:"æˆ‘ç†±æ„›æ¢ç´¢æœªçŸ¥äº‹ç‰©ã€‚",b:"é’é¾"},
  {t:"æˆ‘å–œæ­¡åœ¨äººç¾¤ä¸­è¡¨é”è‡ªå·±ã€‚",b:"æœ±é›€"},
  {t:"æˆ‘ç”¨æƒ…ç·’å¸¶å‹•ä»–äººã€‚",b:"æœ±é›€"},
  {t:"åˆ¥äººçš„åæ‡‰æœƒå½±éŸ¿æˆ‘ã€‚",b:"æœ±é›€"},
  {t:"æˆ‘æ“…é•·èªªæœèˆ‡æ¼”èªªã€‚",b:"æœ±é›€"},
  {t:"æˆ‘é‡è¦–è¢«å‚¾è½èˆ‡é—œæ³¨ã€‚",b:"æœ±é›€"},
  {t:"æˆ‘å–œæ­¡æŒ‰è¨ˆç•«è¡Œäº‹ã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘é‡è¦–å®‰å…¨æ„Ÿèˆ‡ç©©å®šã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘è²¬ä»»æ„Ÿå¼·ã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘å‚¾å‘ç¶­æŒç¾ç‹€ã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘æ³¨é‡ç´°ç¯€èˆ‡ç¨‹åºã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘å°ä»–äººæƒ…ç·’å¾ˆæ•æ„Ÿã€‚",b:"è£è›‡"},
  {t:"æˆ‘æ“…é•·è§€å¯Ÿèˆ‡å‚¾è½ã€‚",b:"è£è›‡"},
  {t:"æˆ‘å¸¸æ€è€ƒèƒŒå¾Œçš„å‹•æ©Ÿã€‚",b:"è£è›‡"},
  {t:"æˆ‘æ€è€ƒäº‹æƒ…æœƒè€ƒé‡æ™‚æ©Ÿèˆ‡äººå¿ƒã€‚",b:"è£è›‡"},
  {t:"æˆ‘å–„æ–¼å”èª¿ä¸åŒè§€é»ã€‚",b:"è£è›‡"},
  {t:"æˆ‘è¬›æ±‚æ•ˆç‡èˆ‡çµæœã€‚",b:"ç™½è™"},
  {t:"æˆ‘æœƒä¸»å‹•åšæ±ºç­–ã€‚",b:"ç™½è™"},
  {t:"æˆ‘ä»¥æ•¸æ“šèˆ‡æˆæœç‚ºå°å‘ã€‚",b:"ç™½è™"},
  {t:"æˆ‘é¡˜æ„æ‰¿æ“”å£“åŠ›ä»¥å®Œæˆä»»å‹™ã€‚",b:"ç™½è™"},
  {t:"æˆ‘åå¥½æ˜ç¢ºçš„è¦ç¯„èˆ‡æ¨™æº–ã€‚",b:"ç™½è™"},
  {t:"æˆ‘å–œæ­¡ç¨è‡ªæ€è€ƒã€‚",b:"ç„æ­¦"},
  {t:"æˆ‘å‚¾å‘è¬¹æ…è©•ä¼°å¾Œè¡Œå‹•ã€‚",b:"ç„æ­¦"},
  {t:"æˆ‘æ“…é•·è¦åŠƒé•·é ç›®æ¨™ã€‚",b:"ç„æ­¦"},
  {t:"æˆ‘é‡è¦–é‚è¼¯èˆ‡åˆ†æã€‚",b:"ç„æ­¦"},
  {t:"æˆ‘ç¿’æ…£å†·éœçœ‹å¾…å•é¡Œã€‚",b:"ç„æ­¦"},
];

// éš¨æ©Ÿé¡Œç›®
BANK.sort(() => Math.random() - 0.5);
const qWrap = document.getElementById("qWrap");
BANK.forEach((q, i) => {
  qWrap.innerHTML += `<li><p>${i+1}. ${q.t}</p><input type='range' min='1' max='5' value='3' id='q${i}' class='w-full slider'></li>`;
});

// é€²åº¦æ¢
qWrap.innerHTML += `<div id="progress" class="text-right text-sm">0/30</div>`;
document.querySelectorAll('input[type="range"]').forEach(s => {
  s.onchange = () => {
    const filled = Array.from(document.querySelectorAll('input[type="range"]')).filter(s => s.value !== '3').length;
    document.getElementById("progress").textContent = `${filled}/30`;
  };
});

// ========== ç¥ç¸SVG ==========
function beastSVG(name) {
  const stroke = '#B6822B', fill = 'none';
  const s = d => `<path d='${d}' fill='${fill}' stroke='${stroke}' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>`;
  const base = d => `<svg viewBox='0 0 100 100' class='w-full h-auto' xmlns='http://www.w3.org/2000/svg'>
    <defs><radialGradient id='g' cx='50%' cy='50%' r='60%'>
      <stop offset='0%' stop-color='rgba(182,130,43,0.25)'/><stop offset='100%' stop-color='rgba(182,130,43,0)'/>
    </radialGradient></defs><rect width='100' height='100' fill='url(#g)'/>${d}</svg>`;
  switch (name) {
    case 'é’é¾': return base(s("M15 60 C25 40, 45 35, 55 45 C65 55, 75 35, 85 45 M45 45 q5 -12 16 -10 m-6 6 l6 4 m-36 20 q10 -6 18 2 m12 -2 q8 -6 18 2") + s("M30 70 q10 8 20 0 q10 -8 20 0"));
    case 'æœ±é›€': return base(s("M20 60 q15 -30 30 -30 q15 0 30 30 M50 30 l0 12 M35 55 q15 -8 30 0 M25 62 q10 8 25 8 q15 0 25 -8"));
    case 'å‹¾é™³': return base(s("M20 70 h60 v-20 h-60 v20 z M30 50 v-10 h40 v10 M35 65 h10 M55 65 h10"));
    case 'è£è›‡': return base(s("M20 70 q20 -30 40 -10 q10 8 20 -2 q-10 20 -30 10 q-10 -6 -30 2 M60 48 q6 -6 12 0"));
    case 'ç™½è™': return base(s("M20 65 q15 -20 30 -20 q15 0 30 20 M30 60 h40 M35 70 h30 M38 52 l4 6 M58 52 l-4 6"));
    case 'ç„æ­¦': return base(s("M30 65 q20 15 40 0 q5 -12 -15 -22 q-20 10 -25 22 M55 50 q10 -8 20 2 M25 55 q-8 -6 -10 6"));
    default: return base('');
  }
}

// ========== å‹•æ…‹å»ºè­°ç”Ÿæˆ ==========
function generateAdvice(mainBeast, secondaryBeast, scores, variant) {
  const adviceTemplates = {
    é’é¾: {
      è·å ´: [
        "å‰µæ–°é ˜é ­ï¼Œå‹‡æ–¼å˜—è©¦æ–°æ–¹æ³•",
        "å¸¶é ˜åœ˜éšŠçªç ´å‚³çµ±æ¡†æ¶",
        "é–‹æ‹“æ–°å¸‚å ´æˆ–æ¥­å‹™é ˜åŸŸ",
        "å°‡å‰µæ„è½‰åŒ–ç‚ºå¯¦éš›è¡Œå‹•"
      ],
      æ„Ÿæƒ…: [
        "ä¿æŒé—œä¿‚ä¸­çš„æ–°é®®æ„Ÿ",
        "å…±åŒæ¢ç´¢æ–°é«”é©—",
        "é–‹æ”¾æºé€šå‰µæ–°æƒ³æ³•",
        "å¹³è¡¡å†’éšªèˆ‡ç©©å®šéœ€æ±‚"
      ],
      é¤Šç”Ÿ: [
        "æˆ¶å¤–é‹å‹•é‡‹æ”¾èƒ½é‡",
        "å˜—è©¦æ–°çš„é‹å‹•æ–¹å¼",
        "ä¿æŒç”Ÿæ´»å¤šæ¨£æ€§",
        "é©ç•¶å†’éšªæŒ‘æˆ°è‡ªæˆ‘"
      ]
    },
    æœ±é›€: {
      è·å ´: [
        "ç™¼æ®è¡¨é”èˆ‡æºé€šå„ªå‹¢",
        "æ¿€å‹µåœ˜éšŠå£«æ°£",
        "å»ºç«‹å»£æ³›äººéš›ç¶²çµ¡",
        "å±•ç¾ç†±æƒ…èˆ‡æ„ŸæŸ“åŠ›"
      ],
      æ„Ÿæƒ…: [
        "çœŸèª è¡¨é”æƒ…æ„Ÿéœ€æ±‚",
        "å‰µé€ æµªæ¼«é©šå–œæ™‚åˆ»",
        "ä¿æŒé—œä¿‚ä¸­çš„ç†±æƒ…",
        "é©åº¦åˆ†äº«å…§å¿ƒæ„Ÿå—"
      ],
      é¤Šç”Ÿ: [
        "è—è¡“å‰µä½œæŠ’ç™¼æƒ…æ„Ÿ",
        "ç¤¾äº¤æ´»å‹•ä¿æŒæ´»åŠ›",
        "è¡¨é”æ€§é‹å‹•å¦‚èˆè¹ˆ",
        "æ³¨æ„æƒ…ç·’æ³¢å‹•ç®¡ç†"
      ]
    },
    å‹¾é™³: {
      è·å ´: [
        "å»ºç«‹ç©©å®šå·¥ä½œæµç¨‹",
        "ç¢ºä¿ä»»å‹™æŒ‰æ™‚å®Œæˆ",
        "æ³¨é‡ç´°ç¯€èˆ‡å“è³ª",
        "æä¾›å¯é æ”¯æŒ"
      ],
      æ„Ÿæƒ…: [
        "å»ºç«‹ä¿¡ä»»èˆ‡å®‰å…¨æ„Ÿ",
        "ä¿æŒæ‰¿è«¾èˆ‡ä¸€è‡´æ€§",
        "ç©©å®šè¡¨é”é—œå¿ƒ",
        "ç‡Ÿé€ æº«é¦¨å®¶åº­æ°›åœ"
      ],
      é¤Šç”Ÿ: [
        "è¦å¾‹ä½œæ¯ä¿æŒå¹³è¡¡",
        "å‡è¡¡é£²é£Ÿèˆ‡é‹å‹•",
        "å»ºç«‹å¥åº·ç”Ÿæ´»ç¿’æ…£",
        "æ³¨é‡å¯¦éš›é¤Šç”Ÿæ–¹æ³•"
      ]
    },
    è£è›‡: {
      è·å ´: [
        "ç™¼æ®æ´å¯Ÿèˆ‡å”èª¿èƒ½åŠ›",
        "ç†è§£åœ˜éšŠæˆå“¡éœ€æ±‚",
        "å¦¥å–„è™•ç†äººéš›é—œä¿‚",
        "æŠŠæ¡æ™‚æ©Ÿæ¡å–è¡Œå‹•"
      ],
      æ„Ÿæƒ…: [
        "æ·±å…¥ç†è§£ä¼´ä¾¶æ„Ÿå—",
        "æ•æ„Ÿé«”è²¼å°æ–¹éœ€æ±‚",
        "å»ºç«‹æ·±åº¦æƒ…æ„Ÿé€£çµ",
        "é©æ™‚è¡¨é”æ”¯æŒ"
      ],
      é¤Šç”Ÿ: [
        "å†¥æƒ³èˆ‡å…§çœç·´ç¿’",
        "æƒ…ç·’ç®¡ç†èˆ‡é‡‹æ”¾",
        "æº«å’Œèª¿ç†èº«å¿ƒ",
        "æ³¨é‡å¿ƒç†å¹³è¡¡"
      ]
    },
    ç™½è™: {
      è·å ´: [
        "æœæ–·æ±ºç­–è¿½æ±‚æ•ˆç‡",
        "è¨­å®šæ˜ç¢ºç›®æ¨™",
        "æ‰¿æ“”é ˜å°è²¬ä»»",
        "æ³¨é‡æˆæœèˆ‡ç¸¾æ•ˆ"
      ],
      æ„Ÿæƒ…: [
        "ç›´æ¥è¡¨é”æ„›èˆ‡æ‰¿è«¾",
        "ä¿è­·èˆ‡æ”¯æŒä¼´ä¾¶",
        "æ˜ç¢ºé—œä¿‚ç•Œç·š",
        "å±•ç¾å …å®šèˆ‡å¿ èª "
      ],
      é¤Šç”Ÿ: [
        "é«˜å¼·åº¦é‹å‹•é‡‹å£“",
        "æŒ‘æˆ°é«”èƒ½æ¥µé™",
        "åŸ¹é¤Šç´€å¾‹æ€§",
        "æ³¨æ„å£“åŠ›ç®¡ç†"
      ]
    },
    ç„æ­¦: {
      è·å ´: [
        "ç­–ç•¥è¦åŠƒé•·é ç™¼å±•",
        "æ·±å…¥åˆ†æå•é¡Œæœ¬è³ª",
        "ç¨ç«‹æ€è€ƒèˆ‡åˆ¤æ–·",
        "ä¿æŒç†æ€§èˆ‡å®¢è§€"
      ],
      æ„Ÿæƒ…: [
        "æ·±åº¦äº¤æµæ€æƒ³",
        "ç†æ€§åˆ†æé—œä¿‚",
        "ä¿æŒå€‹äººç©ºé–“",
        "å»ºç«‹æ™ºæ…§é€£çµ"
      ],
      é¤Šç”Ÿ: [
        "éœåèˆ‡é–±è®€",
        "æ·±åº¦æ€è€ƒèˆ‡åæ€",
        "ç¨ç«‹é‹å‹•å¦‚æ¸¸æ³³",
        "æ³¨é‡ç²¾ç¥é¤Šç”Ÿ"
      ]
    }
  };

  // æ ¹æ“šåˆ†æ•¸é¸æ“‡å»ºè­°å¼·åº¦
  const getAdviceIntensity = (score) => {
    if (score >= 20) return 0; // æœ€å¼·çƒˆçš„å»ºè­°
    if (score >= 15) return 1;
    if (score >= 10) return 2;
    return 3; // æœ€æº«å’Œçš„å»ºè­°
  };

  const mainScore = scores[mainBeast];
  const secondaryScore = secondaryBeast ? scores[secondaryBeast] : 0;
  
  const mainIntensity = getAdviceIntensity(mainScore);
  const secondaryIntensity = getAdviceIntensity(secondaryScore);

  // çµ„åˆä¸»è¦å’Œæ¬¡è¦ç¥ç¸çš„å»ºè­°
  const combineAdvice = (category) => {
    const mainAdvices = adviceTemplates[mainBeast][category];
    const secondaryAdvices = secondaryBeast ? adviceTemplates[secondaryBeast][category] : [];
    
    let combined = [];
    
    // ä¸»è¦ç¥ç¸å»ºè­°
    if (mainAdvices && mainAdvices[mainIntensity]) {
      combined.push(mainAdvices[mainIntensity] + "ã€‚");
    }
    
    // æ¬¡è¦ç¥ç¸å»ºè­°ï¼ˆå¦‚æœå­˜åœ¨ä¸”åˆ†æ•¸è¶³å¤ é«˜ï¼‰
    if (secondaryBeast && secondaryScore >= 10 && secondaryAdvices && secondaryAdvices[secondaryIntensity]) {
      combined.push(secondaryAdvices[secondaryIntensity] + "ã€‚");
    }
    
    // ç¢ºä¿è‡³å°‘æœ‰2æ¢å»ºè­°
    while (combined.length < 2) {
      const randomIndex = Math.floor(Math.random() * mainAdvices.length);
      if (!combined.includes(mainAdvices[randomIndex] + "ã€‚")) {
        combined.push(mainAdvices[randomIndex] + "ã€‚");
      }
    }
    
    return combined;
  };

  return {
    è·å ´: combineAdvice('è·å ´'),
    æ„Ÿæƒ…: combineAdvice('æ„Ÿæƒ…'), 
    é¤Šç”Ÿ: combineAdvice('é¤Šç”Ÿ')
  };
}

// ========== çµæœç”Ÿæˆ ==========
function summarize(scores) {
  const arr = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  const top = arr[0], second = arr[1];
  const dual = (top[1] - second[1] <= 2) ? [top[0], second[0]] : null;
  const total = Object.values(scores).reduce((a, b) => a + b, 0);
  const variantIdx = total % 12;
  const variants = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
  const variant = variants[variantIdx];
  return { top: top[0], dual, ranking: arr, variant, total, scores };
}

let radarChart = null;
function renderRadar(scores) {
  const ctx = document.getElementById("radar");
  if (radarChart) radarChart.destroy();
  radarChart = new Chart(ctx, {
    type: "radar",
    data: { labels: Object.keys(scores), datasets: [{ label: "å…­ç¸èƒ½é‡", data: Object.values(scores), backgroundColor: "rgba(182,130,43,0.15)", borderColor: "#b6822b" }] },
    options: { 
      scales: { r: { suggestedMin: 0, suggestedMax: 25, ticks: { stepSize: 5 } } }, 
      plugins: { legend: { display: false } },
      maintainAspectRatio: true
    }
  });
}

function renderReport(summary, scores) {
  document.getElementById("beastSVG").innerHTML = beastSVG(summary.top);
  const mainType = `${summary.top}${summary.variant}å‹`;
  document.getElementById("mainBeastTitle").textContent = summary.dual ? `é›™ç¸${summary.variant}å‹ï¼š${summary.top} Ã— ${summary.dual[1]}` : `ä¸»${summary.variant}å‹ï¼š${summary.top}`;
  document.getElementById("dualHint").textContent = summary.dual ? `ç¬¬äºŒä¸»å°èƒ½é‡ï¼š${summary.dual[1]}` : '';
  document.getElementById("mainBeastSummary").textContent = `ä½ çš„ä¸»å‹ç‚º ${mainType}ï¼Œèåˆ${summary.top}èƒ½é‡èˆ‡${summary.variant}åœ°æ”¯ç‰¹è³ªã€‚`;

  // ç”Ÿæˆå‹•æ…‹å»ºè­°
  const advice = generateAdvice(summary.top, summary.dual ? summary.dual[1] : null, scores, summary.variant);
  
  const col = (t, a) => `<div class='border rounded p-2'><b>${t}</b><ul class='list-disc pl-5'>${a.map(x => `<li>${x}</li>`).join('')}</ul></div>`;
  document.getElementById("adviceCols").innerHTML = col("è·å ´å»ºè­°", advice.è·å ´) + col("æ„Ÿæƒ…å»ºè­°", advice.æ„Ÿæƒ…) + col("é¤Šç”Ÿå»ºè­°", advice.é¤Šç”Ÿ);
}

document.getElementById("form").addEventListener("submit", e => {
  e.preventDefault();
  const scores = { é’é¾: 0, æœ±é›€: 0, å‹¾é™³: 0, è£è›‡: 0, ç™½è™: 0, ç„æ­¦: 0 };
  BANK.forEach((q, i) => scores[q.b] += parseInt(document.getElementById(`q${i}`).value));
  const summary = summarize(scores);
  renderRadar(scores);
  renderReport(summary, scores);
  localStorage.setItem("shen-shou-v7", JSON.stringify({ scores, summary }));
  
  // é¡¯ç¤ºçµæœå€åŸŸ
  document.getElementById("result").style.display = "grid";
  document.getElementById("aiReport").style.display = "block";
});

document.getElementById("btnFillMid").onclick = () => document.querySelectorAll(".slider").forEach(s => s.value = 3);

// åˆ†äº«çµæœ
document.getElementById("btnShare").addEventListener("click", () => {
  html2canvas(document.getElementById("result")).then(canvas => {
    const link = document.createElement('a');
    link.download = 'shenshou-result.png';
    link.href = canvas.toDataURL();
    link.click();
  });
});

// ========== AIæ™ºèƒ½åˆ†æ ==========
document.getElementById("btnAI").addEventListener("click", async () => {
  const saved = JSON.parse(localStorage.getItem("shen-shou-v7") || "null");
  const out = document.getElementById("aiOut");
  if (!saved) { out.textContent = "âš ï¸è«‹å…ˆå®Œæˆæ¸¬é©—ã€‚"; return; }
  out.innerHTML = "ğŸª¶ AI æ­£åœ¨åˆ†æä¸­ï¼Œç´„5~10ç§’... <span class='spinner'>â³</span>";
  document.getElementById("btnRetry").style.display = "none";
  try {
    const resp = await fetch("/api/ai", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(saved) });
    if (!resp.ok) throw new Error(await resp.text());
    const data = await resp.json();
    out.textContent = data.text.trim();
  } catch (err) {
    out.textContent = `âŒåˆ†æå¤±æ•—ï¼šå¾Œç«¯æœå‹™æš«æ™‚ä¸å¯ç”¨\n\nğŸ’¡ è«‹ç¢ºèªï¼š\n1. å¾Œç«¯æœå‹™æ˜¯å¦é‹è¡Œ\n2. API Key æ˜¯å¦æ­£ç¢ºè¨­å®š\n3. æˆ–ç¨å¾Œå†è©¦`;
    document.getElementById("btnRetry").style.display = "inline-block";
  }
});

document.getElementById("btnRetry").addEventListener("click", () => {
  document.getElementById("btnAI").click();
});
</script>
</body>
</html>
