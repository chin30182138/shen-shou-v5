<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>神獸七十二型人格 測驗＋AI智能分析</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #b6822b;
            --secondary: #d4a017;
            --accent: #2b6cb0;
        }
        
        .brand { color: var(--primary); }
        .card { 
            background: #fff; 
            border: 1px solid #e5e7eb; 
            border-radius: 16px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
        }
        
        .option-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 15px 10px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
            font-size: 14px;
            position: relative;
        }
        
        .option-card:hover {
            background-color: #f8f9fa;
            border-color: #b6822b;
            transform: translateY(-2px);
        }
        
        .option-card.selected {
            background-color: #e7f3ff;
            border-color: #2b6cb0;
            transform: scale(1.02);
        }
        
        .option-card::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
            transition: all 0.3s ease;
        }
        
        .option-card.selected::before {
            background-color: #2b6cb0;
            border-color: #2b6cb0;
            transform: scale(1.2);
        }
        
        .option-card.selected::after {
            content: '✓';
            position: absolute;
            color: white;
            font-size: 12px;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .question-page {
            display: none;
        }
        
        .question-page.active {
            display: block;
        }
        
        .page-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .page-controls-bottom {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px 0 10px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            position: sticky;
            bottom: 10px;
            z-index: 10;
        }
        
        .superhero-card { 
            border-radius: 12px; 
            padding: 8px; 
            margin: 6px 0; 
            background: linear-gradient(135deg, #e8f4fd, #f0f9ff); 
            border: 2px solid var(--accent); 
        }
        
        .superhero-title { font-size: 1.2em; font-weight: bold; color: var(--accent); margin-bottom: 4px; }
        .superhero-ability { background: rgba(43, 108, 176, 0.1); padding: 4px; border-radius: 6px; margin: 4px 0; font-weight: bold; color: #2c5282; font-size: 1.0em; }
        .superhero-desc { font-size: 1.0em; color: #666; line-height: 1.3; }
        
        .superhero-image-container {
            width: 150px;
            height: 150px;
            margin: 0 auto 10px;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid var(--accent);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .superhero-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .superhero-image:hover {
            transform: scale(1.05);
        }
        
        .beast-simple {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: bold;
            color: #b6822b;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            padding: 10px;
            text-align: center;
            background: linear-gradient(135deg, rgba(182,130,43,0.1) 0%, rgba(182,130,43,0.05) 100%);
            border: 3px solid #b6822b;
            border-radius: 12px;
        }
        
        .ai-analysis-section { background: linear-gradient(135deg, #f8f9fa, #ffffff); border: 1px solid #e9ecef; border-radius: 12px; padding: 12px; margin: 8px 0; }
        .ai-analysis-header { display: flex; align-items: center; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 2px solid #e9ecef; }
        .ai-analysis-icon { font-size: 1.5em; margin-right: 8px; }
        .ai-analysis-title { color: #2d3748; font-weight: bold; font-size: 1.2em; }
        .ai-analysis-content { font-size: 1.0em; color: #4a5568; line-height: 1.5; }
        .ai-analysis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 8px; margin-top: 12px; }
        .ai-analysis-item { background: white; padding: 8px; border-radius: 6px; border-left: 4px solid var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .ai-analysis-item-title { font-weight: bold; color: #2d3748; margin-bottom: 4px; font-size: 1.0em; }
        .ai-analysis-item-content { font-size: 0.95em; color: #718096; line-height: 1.4; }
        
        .ai-loading { text-align: center; padding: 20px; color: #718096; background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 12px; border: 2px dashed #e5e7eb; }
        
        .progress-container { width: 100%; background-color: #e5e7eb; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .progress-bar { height: 8px; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 10px; transition: width 0.4s ease; width: 0%; }
        
        .slide-toggle {
            transition: all 0.3s ease-in-out;
            overflow: hidden;
            max-height: 1000px;
        }
        
        .slide-toggle.hidden {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            margin-top: 0;
            margin-bottom: 0;
            opacity: 0;
        }
        
        .spinner { animation: spin 1.5s linear infinite; display: inline-block; font-size: 2em; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .loading-dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
        @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
        
        .print-header {
            display: none;
            margin-bottom: 20px;
            border-bottom: 3px solid #b6822b;
            padding-bottom: 15px;
            page-break-before: always;
        }
        
        @media print {
            .no-print { display: none !important; }
            .print-header { 
                display: block !important; 
            }
            body { 
                background: white !important; 
                font-size: 14px !important; 
                color: black !important; 
            }
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
        
        @media screen {
            #radar { width: 100% !important; height: 300px !important; }
        }
    </style>
</head>
<body class="text-slate-800 bg-gradient-to-br from-amber-50 to-amber-100">
    <main class="max-w-5xl mx-auto p-4 sm:p-6">
        <!-- 頁首 -->
        <header class="mb-4 flex justify-between items-center no-print">
            <div class="flex items-center gap-3">
                <div class="h-10 w-10 rounded bg-amber-500 flex items-center justify-center text-white font-bold">仙</div>
                <div>
                    <h1 class="text-2xl sm:text-3xl font-extrabold brand">神獸七十二型人格 測驗＋AI智能分析</h1>
                    <p class="text-sm text-slate-600">六獸雷達圖・主型解析・三欄建議・AI分析報告</p>
                </div>
            </div>
            <button id="toggleSettingsBtn" type="button" class="no-print p-2 rounded-full hover:bg-amber-100 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>
        </header>

        <!-- 設定表單 -->
        <form id="reportSettingsForm" class="card p-4 mb-4 no-print slide-toggle hidden">
            <h2 class="font-bold mb-3">⚙️ 報表資訊設定</h2>
            <div class="space-y-4 text-sm">
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm mb-1">題目顯示：</label>
                        <select id="pageMode" class="w-full p-2 border rounded">
                            <option value="single">單題模式</option>
                            <option value="multi10" selected>10題模式</option>
                            <option value="all">全部顯示</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm mb-1">報表字體大小：</label>
                        <select id="reportFontSize" class="w-full p-2 border rounded">
                            <option value="small">小</option>
                            <option value="medium" selected>中</option>
                            <option value="large">大</option>
                            <option value="xlarge">特大</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="mt-4">
                <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition text-sm">儲存設定</button>
            </div>
        </form>

        <!-- 測驗表單 -->
        <form id="form" class="card p-4 mb-4 no-print">
            <h2 class="font-bold mb-3">📋 請回答下列30題（1＝不同意，5＝非常同意）</h2>
            
            <!-- 分頁控制 - 上方 -->
            <div class="page-controls no-print">
                <div class="font-controls">
                    <label for="pageModeSelect" class="text-sm font-medium">顯示模式：</label>
                    <select id="pageModeSelect" class="text-sm border rounded p-1">
                        <option value="single">單題模式</option>
                        <option value="multi10" selected>10題模式</option>
                        <option value="all">全部顯示</option>
                    </select>
                </div>
                <div class="pagination-buttons flex gap-2">
                    <button type="button" id="prevPage" class="px-3 py-1 border rounded text-sm hover:bg-gray-50 transition" disabled>上一頁</button>
                    <span id="pageIndicator" class="px-3 py-1 text-sm">1/3</span>
                    <button type="button" id="nextPage" class="px-3 py-1 border rounded text-sm hover:bg-gray-50 transition">下一頁</button>
                </div>
            </div>
            
            <div class="mb-4 p-3 bg-slate-50 rounded-lg">
                <label class="font-semibold text-slate-700 block mb-2">請選擇您的性別：</label>
                <div class="flex gap-4">
                    <label class="flex items-center">
                        <input type="radio" name="gender" value="male" class="mr-2" checked>
                        男性
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="gender" value="female" class="mr-2">
                        女性
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="gender" value="other" class="mr-2">
                        其他
                    </label>
                </div>
            </div>
            
            <!-- 分頁容器 -->
            <div id="questionPages" class="space-y-3">
                <!-- 題目將通過JavaScript動態生成 -->
            </div>
            
            <!-- 分頁控制 - 下方 -->
            <div class="page-controls-bottom no-print">
                <div class="pagination-buttons flex gap-2">
                    <button type="button" id="prevPageBottom" class="px-4 py-2 border rounded hover:bg-gray-50 transition" disabled>上一頁</button>
                    <span id="pageIndicatorBottom" class="px-4 py-2 text-sm font-medium">第 1 頁，共 3 頁</span>
                    <button type="button" id="nextPageBottom" class="px-4 py-2 border rounded hover:bg-gray-50 transition">下一頁</button>
                </div>
            </div>
            
            <!-- 進度顯示 -->
            <div id="progress" class="text-right text-sm mt-4">0/30</div>
            
            <div class="mt-4 flex gap-3">
                <button type="submit" class="bg-amber-600 text-white px-5 py-2 rounded hover:bg-amber-700 transition">送出測驗</button>
                <button type="button" id="btnFillMid" class="border px-3 py-2 rounded hover:bg-gray-50 transition">全部填3</button>
            </div>
        </form>

        <!-- 報表字體大小控制 -->
        <div class="report-font-controls no-print">
            <span class="text-sm font-medium">報表字體大小：</span>
            <select id="reportFontSizeSelect" class="text-sm border rounded p-1">
                <option value="small">小</option>
                <option value="medium" selected>中</option>
                <option value="large">大</option>
                <option value="xlarge">特大</option>
            </select>
            <button type="button" id="applyFontSize" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition">套用</button>
        </div>

        <!-- 列印標頭 -->
        <div class="print-header">
            <div class="header-title-container">
                <h1 class="report-main-title">仙人指路神獸七十二型人格</h1>
                <p class="report-subtitle">個人化深度分析報告</p>
                <div class="print-date">報告生成時間：<span id="report-date"></span></div>
            </div>
        </div>

        <!-- 測驗結果 -->
        <section id="result" class="grid lg:grid-cols-2 gap-4 print-section" style="display: none;">
            <div class="card p-4">
                <h2 class="font-bold mb-2">六獸能量雷達圖</h2>
                <div id="radar-container"><canvas id="radar"></canvas></div>
                <button class="mt-3 px-4 py-2 border rounded no-print hover:bg-gray-50 transition" onclick="printAnalysis()">🖨️ 列印分析報告</button>
            </div>
            <div class="card p-4" id="resultCard">
                <h2 class="font-bold mb-2">主型與三欄建議</h2>
                <div class="grid grid-cols-3 gap-3 items-start">
                    <!-- 神獸顯示 -->
                    <div id="beastSVG" class="w-full aspect-square">
                        <div class="beast-simple" id="beastSimple">
                            <!-- 神獸名稱將通過JavaScript動態生成 -->
                        </div>
                    </div>
                    <div class="col-span-2">
                        <div id="mainBeastTitle" class="font-bold brand text-lg"></div>
                        <div id="dualHint" class="text-sm text-slate-600 mt-1"></div>
                        <div id="mainBeastSummary" class="mt-2 text-sm"></div>
                    </div>
                </div>
                <hr class="my-2" />
                <div id="adviceCols" class="grid md:grid-cols-3 gap-2 text-sm"></div>
                <div class="mt-3 flex gap-2 no-print">
                    <button id="btnShare" class="px-4 py-2 border rounded hover:bg-gray-50 transition">分享結果圖片</button>
                    <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">🖨️ 列印分析報告</button>
                </div>
            </div>
        </section>

        <!-- 超人報告 -->
        <section class="card p-4 mt-4 print-section" id="superheroReport" style="display: none;">
            <h2 class="font-bold mb-2">🦸‍♂️ 你的神獸超人身分</h2>
            <div id="superhero-display" class="superhero-card">
                <div class="superhero-image-container">
                    <div class="beast-simple" id="superhero-beast">
                        <!-- 神獸名稱將通過JavaScript動態生成 -->
                    </div>
                </div>
                <div id="superhero-name" class="superhero-title"></div>
                <div id="superhero-ability" class="superhero-ability"></div>
                <div id="superhero-mission" class="superhero-desc"></div>
                <div id="superhero-local" class="text-sm mt-2 font-bold text-blue-700"></div>
            </div>
        </section>

        <!-- AI報告 -->
        <section class="card p-4 mt-4 print-section" id="aiReport" style="display: none;">
            <h2 class="font-bold mb-2">🤖 AI 智能個人化分析報告</h2>
            <p class="text-sm text-slate-600 mb-2">以下內容由仙人指路AI系統生成，融合金錢卦、五行、地支與心理視角。</p>
            <div id="ai-analysis-structured">
                <div class="ai-loading" id="ai-loading" style="display: none;">
                    <div class="spinner">🔮</div>
                    <p class="mt-2 text-lg font-semibold">AI 正在為您深度分析中<span class="loading-dots"></span></p>
                    <p class="mt-1 text-sm text-gray-600">這可能需要 10-20 秒，請稍候</p>
                    <div class="progress-container mt-3"><div class="progress-bar" id="progress-bar"></div></div>
                    <div class="mt-2 text-xs text-gray-500" id="loading-step">初始化分析引擎...</div>
                </div>
                <div id="ai-analysis-content">
                    <div class="ai-analysis-section">
                        <div class="ai-analysis-header"><div class="ai-analysis-icon">🎭</div><div class="ai-analysis-title">人格特質分析</div></div>
                        <div class="ai-analysis-content" id="ai-personality"><div class="text-gray-500 text-center py-3">點擊「生成深度分析」獲取詳細解析</div></div>
                    </div>
                    <div class="ai-analysis-section">
                        <div class="ai-analysis-header"><div class="ai-analysis-icon">⚡</div><div class="ai-analysis-title">能量優勢分析</div></div>
                        <div class="ai-analysis-content" id="ai-strengths"><div class="text-gray-500 text-center py-3">點擊「生成深度分析」獲取詳細解析</div></div>
                    </div>
                    <div class="ai-analysis-section">
                        <div class="ai-analysis-header"><div class="ai-analysis-icon">📈</div><div class="ai-analysis-title">成長發展建議</div></div>
                        <div class="ai-analysis-grid">
                            <div class="ai-analysis-item"><div class="ai-analysis-item-title">職場發展</div><div class="ai-analysis-item-content" id="ai-career">點擊「生成深度分析」獲取職場建議</div></div>
                            <div class="ai-analysis-item"><div class="ai-analysis-item-title">人際關係</div><div class="ai-analysis-item-content" id="ai-relationships">點擊「生成深度分析」獲取人際建議</div></div>
                            <div class="ai-analysis-item"><div class="ai-analysis-item-title">個人成長</div><div class="ai-analysis-item-content" id="ai-growth">點擊「生成深度分析」獲取成長建議</div></div>
                        </div>
                    </div>
                    <div class="ai-analysis-section">
                        <div class="ai-analysis-header"><div class="ai-analysis-icon">💰</div><div class="ai-analysis-title">五行金錢卦解析</div></div>
                        <div class="ai-analysis-content" id="ai-money"><div class="text-gray-500 text-center py-3">點擊「生成深度分析」獲取金錢卦解析</div></div>
                    </div>
                </div>
            </div>
            <div class="flex gap-2 no-print mt-3">
                <button id="btnAI" class="px-4 py-2 border rounded bg-amber-500 text-white hover:bg-amber-600 transition">生成深度分析</button>
                <button id="btnRetry" class="px-4 py-2 border rounded bg-gray-200 hover:bg-gray-300 transition" style="display:none;">重新分析</button>
                <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">🖨️ 列印完整報告</button>
            </div>
        </section>

        <footer class="text-center text-xs text-slate-500 mt-6 no-print">
            <div class="flex justify-center items-center gap-4 mb-1">
                <span>© 2025 仙人指路占卜研究學會</span><span>|</span><span>測驗僅供覺察與教學用途</span>
            </div>
        </footer>
    </main>

    <script>
        // ========== 初始化設定 ==========
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // ========== 測驗題庫 ==========
        const BANK = [
            {t: "我常有突如其來的靈感並想立即嘗試。", b: "青龍"},
            {t: "我喜歡打破常規尋找新方法。", b: "青龍"},
            {t: "遇阻力時我會靈活轉向。", b: "青龍"},
            {t: "我富想像力，喜歡創新思考。", b: "青龍"},
            {t: "我熱愛探索未知事物。", b: "青龍"},
            {t: "我喜歡在人群中表達自己。", b: "朱雀"},
            {t: "我用情緒帶動他人。", b: "朱雀"},
            {t: "別人的反應會影響我。", b: "朱雀"},
            {t: "我擅長說服與演說。", b: "朱雀"},
            {t: "我重視被傾聽與關注。", b: "朱雀"},
            {t: "我喜歡按計畫行事。", b: "勾陳"},
            {t: "我重視安全感與穩定。", b: "勾陳"},
            {t: "我責任感強。", b: "勾陳"},
            {t: "我傾向維持現狀。", b: "勾陳"},
            {t: "我注重細節與程序。", b: "勾陳"},
            {t: "我對他人情緒很敏感。", b: "螣蛇"},
            {t: "我擅長觀察與傾聽。", b: "螣蛇"},
            {t: "我常思考背後的動機。", b: "螣蛇"},
            {t: "我思考事情會考量時機與人心。", b: "螣蛇"},
            {t: "我善於協調不同觀點。", b: "螣蛇"},
            {t: "我講求效率與結果。", b: "白虎"},
            {t: "我會主動做決策。", b: "白虎"},
            {t: "我以數據與成果為導向。", b: "白虎"},
            {t: "我願意承擔壓力以完成任務。", b: "白虎"},
            {t: "我偏好明確的規範與標準。", b: "白虎"},
            {t: "我喜歡獨自思考。", b: "玄武"},
            {t: "我傾向謹慎評估後行動。", b: "玄武"},
            {t: "我擅長規劃長遠目標。", b: "玄武"},
            {t: "我重視邏輯與分析。", b: "玄武"},
            {t: "我習慣冷靜看待問題。", b: "玄武"}
        ];

        // ========== 超人顯示資料 ==========
        const superheroData = {
            '青龍': {
                male: { 
                    name:'創意飛龍超人', 
                    ability:'🦸‍♂️ 超能力：靈感爆發 + 快速應變 + 突破框架', 
                    mission:'🎯 專屬任務：創新專案發起人、危機處理專家、新領域開拓者', 
                    localName:'台灣點子王', 
                    description:'你就像台灣的創新引擎，總能想出讓人驚艷的點子！'
                },
                female: { 
                    name:'創意飛龍女俠', 
                    ability:'🦸‍♀️ 超能力：靈感爆發 + 直覺洞察 + 跨界融合', 
                    mission:'🎯 專屬任務：創意策劃師、團隊協調者、美感引導者', 
                    localName:'台灣創意女神', 
                    description:'你是台灣的創意女神，總能將靈感轉化為動人的作品！'
                },
                other: { 
                    name:'創意飛龍使者', 
                    ability:'🦸 超能力：靈感爆發 + 多元視角 + 跨界連結', 
                    mission:'🎯 專屬任務：創意橋樑、多元文化融合者、創新催化劑', 
                    localName:'台灣創意大使', 
                    description:'你是台灣的創意大使，用多元視角連結不同領域！'
                }
            },
            '朱雀': {
                male: { 
                    name:'熱情鳳凰超人', 
                    ability:'🦸‍♂️ 超能力：感染力場 + 溝通大師 + 激勵光環', 
                    mission:'🎯 專屬任務：團隊士氣充電站、公關溝通達人、教育推廣先鋒', 
                    localName:'台灣熱情大使', 
                    description:'你是台灣的人氣王，用熱情感染身邊的每一個人！'
                },
                female: { 
                    name:'熱情鳳凰女俠', 
                    ability:'🦸‍♀️ 超能力：情感共鳴 + 溝通藝術 + 溫暖療癒', 
                    mission:'🎯 專屬任務：情感支持者、團隊凝聚者、心靈療癒師', 
                    localName:'台灣暖心天使', 
                    description:'你是台灣的暖心天使，用真誠與溫暖照亮他人！'
                },
                other: { 
                    name:'熱情鳳凰使者', 
                    ability:'🦸 超能力：情感連結 + 多元溝通 + 社群凝聚', 
                    mission:'🎯 專屬任務：社群橋樑、情感支持者、多元文化推廣者', 
                    localName:'台灣情感連結者', 
                    description:'你是台灣的情感連結者，用真誠連結不同的心靈！'
                }
            },
            '勾陳': {
                male: { 
                    name:'穩固城牆超人', 
                    ability:'🦸‍♂️ 超能力：可靠防護 + 細節掌控 + 執行力場', 
                    mission:'🎯 專屬任務：系統穩定守護者、品質把關專家、長期規劃師', 
                    localName:'台灣地基主', 
                    description:'你是台灣的穩定力量，像堅固的地基一樣可靠！'
                },
                female: { 
                    name:'穩固城牆女俠', 
                    ability:'🦸‍♀️ 超能力：細心守護 + 組織協調 + 穩定支持', 
                    mission:'🎯 專屬任務：系統維護者、品質守護者、團隊穩定劑', 
                    localName:'台灣守護天使', 
                    description:'你是台灣的守護天使，用細心與穩定支持著每個人！'
                },
                other: { 
                    name:'穩固城牆使者', 
                    ability:'🦸 超能力：系統思維 + 穩定建構 + 多元協調', 
                    mission:'🎯 專屬任務：系統架構師、穩定維護者、多元協調者', 
                    localName:'台灣系統守護者', 
                    description:'你是台灣的系統守護者，用穩定的力量建構更好的環境！'
                }
            },
            '螣蛇': {
                male: { 
                    name:'洞察靈蛇超人', 
                    ability:'🦸‍♂️ 超能力：讀心感知 + 協調力場 + 時機掌控', 
                    mission:'🎯 專屬任務：人際關係調解員、策略分析師、危機預警系統', 
                    localName:'台灣和事佬', 
                    description:'你是台灣的人際雷達，總能洞察人心、化解衝突！'
                },
                female: { 
                    name:'洞察靈蛇女俠', 
                    ability:'🦸‍♀️ 超能力：直覺感知 + 情感協調 + 時機洞察', 
                    mission:'🎯 專屬任務：情感調解師、團隊潤滑劑、危機預防專家', 
                    localName:'台灣心靈導師', 
                    description:'你是台灣的心靈導師，用直覺與智慧引導他人！'
                },
                other: { 
                    name:'洞察靈蛇使者', 
                    ability:'🦸 超能力：多元感知 + 關係協調 + 時機判斷', 
                    mission:'🎯 專屬任務：關係橋樑、多元協調者、時機分析師', 
                    localName:'台灣協調專家', 
                    description:'你是台灣的協調專家，用智慧連結不同的人際網絡！'
                }
            },
            '白虎': {
                male: { 
                    name:'疾風戰神超人', 
                    ability:'🦸‍♂️ 超能力：決斷力場 + 行動加速 + 目標鎖定', 
                    mission:'🎯 專屬任務：緊急救援隊長、專案領導者、效率優化師', 
                    localName:'台灣急先鋒', 
                    description:'你是台灣的行動派，像疾風一樣快速解決問題！'
                },
                female: { 
                    name:'疾風戰神女俠', 
                    ability:'🦸‍♀️ 超能力：果斷決策 + 高效執行 + 目標達成', 
                    mission:'🎯 專屬任務：危機處理專家、效率領導者、目標達成師', 
                    localName:'台灣行動女神', 
                    description:'你是台灣的行動女神，用效率與決斷力完成任務！'
                },
                other: { 
                    name:'疾風戰神使者', 
                    ability:'🦸 超能力：多元決策 + 高效協調 + 目標管理', 
                    mission:'🎯 專屬任務：效率協調者、多元領導者、目標管理師', 
                    localName:'台灣效率專家', 
                    description:'你是台灣的效率專家，用多元視角達成目標！'
                }
            },
            '玄武': {
                male: { 
                    name:'智慧龜仙超人', 
                    ability:'🦸‍♂️ 超能力：深度思考 + 策略規劃 + 冷靜屏障', 
                    mission:'🎯 專屬任務：長遠規劃師、技術研發專家、智慧決策顧問', 
                    localName:'台灣諸葛亮', 
                    description:'你是台灣的智慧寶庫，像龜甲一樣保護重要決策！'
                },
                female: { 
                    name:'智慧龜仙女俠', 
                    ability:'🦸‍♀️ 超能力：深度分析 + 策略思考 + 冷靜智慧', 
                    mission:'🎯 專屬任務：策略規劃師、智慧顧問、冷靜決策者', 
                    localName:'台灣智慧女神', 
                    description:'你是台灣的智慧女神，用深謀遠慮指引方向！'
                },
                other: { 
                    name:'智慧龜仙使者', 
                    ability:'🦸 超能力：多元思考 + 策略協調 + 冷靜分析', 
                    mission:'🎯 專屬任務：智慧橋樑、策略協調者、多元顧問', 
                    localName:'台灣智囊團', 
                    description:'你是台灣的智囊團，用多元智慧解決複雜問題！'
                }
            }
        };

        // ========== 分頁模式變數 ==========
        let currentPage = 0;
        let questionsPerPage = 10; // 預設10題一頁
        let totalPages = 0;
        let shuffledBANK = [];
        let radarChart = null;

        function initializeApp() {
            // 設定報告日期
            document.getElementById('report-date').textContent = new Date().toLocaleDateString('zh-TW', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit' 
            });

            // 初始化測驗題目（使用分頁模式）
            initializeQuestionsWithPagination();
            
            // 初始化設定面板
            initializeSettings();
            
            // 初始化事件監聽器
            initializeEventListeners();
        }

        // ========== 分頁模式初始化 ==========
        function initializeQuestionsWithPagination() {
            const questionPages = document.getElementById("questionPages");
            questionPages.innerHTML = '';
            
            // 隨機排序題目
            shuffledBANK = [...BANK].sort(() => 0.5 - Math.random());
            
            // 根據選擇的模式設定每頁題數
            const pageMode = document.getElementById('pageModeSelect').value;
            if (pageMode === 'single') {
                questionsPerPage = 1;
            } else if (pageMode === 'multi10') {
                questionsPerPage = 10;
            } else {
                questionsPerPage = shuffledBANK.length; // 全部顯示
            }
            
            totalPages = Math.ceil(shuffledBANK.length / questionsPerPage);
            
            // 建立分頁
            for (let pageIndex = 0; pageIndex < totalPages; pageIndex++) {
                const pageDiv = document.createElement('div');
                pageDiv.className = `question-page ${pageIndex === 0 ? 'active' : ''}`;
                pageDiv.id = `page-${pageIndex}`;
                
                let pageHTML = '';
                const startIndex = pageIndex * questionsPerPage;
                const endIndex = Math.min(startIndex + questionsPerPage, shuffledBANK.length);
                
                for (let i = startIndex; i < endIndex; i++) {
                    const question = shuffledBANK[i];
                    const questionNumber = i + 1;
                    pageHTML += `
                        <div class="mb-4 p-3 border rounded question-item" data-question-index="${i}">
                            <p class="font-medium mb-2">${questionNumber}. ${question.t}</p>
                            <div class="options grid grid-cols-5 gap-2">
                                <div class="option-card" data-value="1">1<br><span class="text-xs">不同意</span></div>
                                <div class="option-card" data-value="2">2<br><span class="text-xs">有點不同意</span></div>
                                <div class="option-card" data-value="3">3<br><span class="text-xs">普通</span></div>
                                <div class="option-card" data-value="4">4<br><span class="text-xs">有點同意</span></div>
                                <div class="option-card" data-value="5">5<br><span class="text-xs">非常同意</span></div>
                            </div>
                        </div>
                    `;
                }
                
                pageDiv.innerHTML = pageHTML;
                questionPages.appendChild(pageDiv);
            }
            
            // 更新分頁指示器
            updatePageIndicator();
            
            // 為選項卡片添加事件監聽
            initializeOptionCards();
            
            // 更新進度
            updateProgress();
        }

        // ========== 初始化選項卡片事件 ==========
        function initializeOptionCards() {
            document.querySelectorAll('.option-card').forEach(card => {
                card.addEventListener('click', function() {
                    // 移除同一問題中所有選項的選中狀態
                    const parent = this.closest('.options');
                    parent.querySelectorAll('.option-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    
                    // 設定當前選項為選中狀態
                    this.classList.add('selected');
                    
                    // 更新進度
                    updateProgress();
                });
            });
        }

        // ========== 更新分頁指示器 ==========
        function updatePageIndicator() {
            const pageMode = document.getElementById('pageModeSelect').value;
            
            // 更新上方指示器
            document.getElementById('pageIndicator').textContent = `${currentPage + 1}/${totalPages}`;
            
            // 更新下方指示器
            document.getElementById('pageIndicatorBottom').textContent = `第 ${currentPage + 1} 頁，共 ${totalPages} 頁`;
            
            // 更新按鈕狀態
            document.getElementById('prevPage').disabled = currentPage === 0;
            document.getElementById('nextPage').disabled = currentPage === totalPages - 1;
            document.getElementById('prevPageBottom').disabled = currentPage === 0;
            document.getElementById('nextPageBottom').disabled = currentPage === totalPages - 1;
            
            // 如果是全部顯示模式，隱藏分頁控制
            if (pageMode === 'all') {
                document.querySelector('.pagination-buttons').style.display = 'none';
                document.querySelector('.page-controls-bottom').style.display = 'none';
            } else {
                document.querySelector('.pagination-buttons').style.display = 'flex';
                document.querySelector('.page-controls-bottom').style.display = 'flex';
            }
        }

        // ========== 更新進度顯示 ==========
        function updateProgress() {
            const answered = document.querySelectorAll('.option-card.selected').length;
            const total = BANK.length;
            document.getElementById("progress").textContent = `${answered}/${total}`;
        }

        // ========== 設定面板初始化 ==========
        function initializeSettings() {
            const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
            
            // 設定表單值
            document.getElementById('pageMode').value = savedSettings.pageMode || 'multi10';
            document.getElementById('reportFontSize').value = savedSettings.reportFontSize || 'medium';
            
            // 同步分頁模式選擇器
            document.getElementById('pageModeSelect').value = savedSettings.pageMode || 'multi10';
            document.getElementById('reportFontSizeSelect').value = savedSettings.reportFontSize || 'medium';
            
            // 應用字體大小
            applyReportFontSize(savedSettings.reportFontSize || 'medium');
        }

        // ========== 事件監聽器初始化 ==========
        function initializeEventListeners() {
            // 設定面板開關
            document.getElementById('toggleSettingsBtn').addEventListener('click', function() {
                const settingsPanel = document.getElementById('reportSettingsForm');
                settingsPanel.classList.toggle('hidden');
            });
            
            // 設定表單提交
            document.getElementById('reportSettingsForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveSettings();
            });
            
            // 分頁模式選擇 - 修正：立即重新初始化題目
            document.getElementById('pageModeSelect').addEventListener('change', function() {
                currentPage = 0;
                initializeQuestionsWithPagination();
            });
            
            // 報表字體大小選擇
            document.getElementById('reportFontSizeSelect').addEventListener('change', function() {
                applyReportFontSize(this.value);
            });
            
            // 套用字體大小按鈕
            document.getElementById('applyFontSize').addEventListener('click', function() {
                applyReportFontSize(document.getElementById('reportFontSizeSelect').value);
            });
            
            // 上一頁按鈕 (上方)
            document.getElementById('prevPage').addEventListener('click', function() {
                goToPreviousPage();
            });
            
            // 下一頁按鈕 (上方)
            document.getElementById('nextPage').addEventListener('click', function() {
                goToNextPage();
            });
            
            // 上一頁按鈕 (下方)
            document.getElementById('prevPageBottom').addEventListener('click', function() {
                goToPreviousPage();
            });
            
            // 下一頁按鈕 (下方)
            document.getElementById('nextPageBottom').addEventListener('click', function() {
                goToNextPage();
            });
            
            // 測驗表單提交
            document.getElementById('form').addEventListener('submit', function(e) {
                e.preventDefault();
                submitQuiz();
            });
            
            // 全部填3按鈕
            document.getElementById('btnFillMid').addEventListener('click', function() {
                document.querySelectorAll('.question-item').forEach(questionItem => {
                    const options = questionItem.querySelector('.options');
                    const option3 = options.querySelector('.option-card[data-value="3"]');
                    if (option3) {
                        options.querySelectorAll('.option-card').forEach(card => {
                            card.classList.remove('selected');
                        });
                        option3.classList.add('selected');
                    }
                });
                updateProgress();
            });
            
            // AI分析按鈕
            document.getElementById('btnAI').addEventListener('click', function() {
                generateAIAnalysis();
            });
            
            // 分享按鈕
            document.getElementById('btnShare').addEventListener('click', function() {
                shareResult();
            });
        }

        // ========== 分頁導航函數 ==========
        function goToPreviousPage() {
            if (currentPage > 0) {
                document.getElementById(`page-${currentPage}`).classList.remove('active');
                currentPage--;
                document.getElementById(`page-${currentPage}`).classList.add('active');
                updatePageIndicator();
                // 滾動到頂部
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function goToNextPage() {
            if (currentPage < totalPages - 1) {
                document.getElementById(`page-${currentPage}`).classList.remove('active');
                currentPage++;
                document.getElementById(`page-${currentPage}`).classList.add('active');
                updatePageIndicator();
                // 滾動到頂部
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // ========== 報表字體大小應用 ==========
        function applyReportFontSize(size) {
            const sizes = {
                'small': { body: '14px', h1: '2em', h2: '1.5em', card: '13px' },
                'medium': { body: '16px', h1: '2.5em', h2: '1.8em', card: '14px' },
                'large': { body: '18px', h1: '2.8em', h2: '2em', card: '15px' },
                'xlarge': { body: '20px', h1: '3em', h2: '2.2em', card: '16px' }
            };
            
            const selectedSize = sizes[size] || sizes.medium;
            
            // 應用字體大小到結果區域
            const resultSection = document.getElementById('result');
            if (resultSection) {
                resultSection.style.fontSize = selectedSize.body;
            }
            
            const aiReport = document.getElementById('aiReport');
            if (aiReport) {
                aiReport.style.fontSize = selectedSize.body;
            }
            
            const superheroReport = document.getElementById('superheroReport');
            if (superheroReport) {
                superheroReport.style.fontSize = selectedSize.body;
            }
            
            // 儲存設定
            const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
            savedSettings.reportFontSize = size;
            localStorage.setItem('reportContactSettings', JSON.stringify(savedSettings));
        }

        // ========== 設定相關函數 ==========
        function saveSettings() {
            const settings = {
                pageMode: document.getElementById('pageMode').value,
                reportFontSize: document.getElementById('reportFontSize').value
            };
            
            localStorage.setItem('reportContactSettings', JSON.stringify(settings));
            
            // 同步更新分頁模式選擇器
            document.getElementById('pageModeSelect').value = settings.pageMode;
            document.getElementById('reportFontSizeSelect').value = settings.reportFontSize;
            
            // 重新初始化題目分頁
            currentPage = 0;
            initializeQuestionsWithPagination();
            
            // 應用字體大小
            applyReportFontSize(settings.reportFontSize);
            
            alert('設定已儲存！');
        }

        // ========== 測驗相關函數 ==========
        function submitQuiz() {
            const scores = {青龍:0, 朱雀:0, 勾陳:0, 螣蛇:0, 白虎:0, 玄武:0};
            
            // 收集所有已回答的问题
            const answeredQuestions = document.querySelectorAll('.option-card.selected');
            
            if (answeredQuestions.length < BANK.length) {
                alert(`請完成所有題目！目前已完成 ${answeredQuestions.length}/${BANK.length} 題`);
                return;
            }
            
            // 計算分數 - 根據問題索引對應到原始BANK
            document.querySelectorAll('.question-item').forEach(questionItem => {
                const questionIndex = parseInt(questionItem.getAttribute('data-question-index'));
                const selectedOption = questionItem.querySelector('.option-card.selected');
                
                if (selectedOption && questionIndex < shuffledBANK.length) {
                    const scoreValue = parseInt(selectedOption.getAttribute('data-value'));
                    const question = shuffledBANK[questionIndex];
                    scores[question.b] += scoreValue;
                }
            });
            
            const summary = summarize(scores);
            window.currentBeastType = summary.top;
            
            // 顯示結果
            renderRadar(scores);
            renderReport(summary, scores);
            
            // 儲存結果
            const gender = document.querySelector('input[name="gender"]:checked').value;
            localStorage.setItem("shen-shou-result", JSON.stringify({
                scores: scores,
                summary: summary,
                gender: gender
            }));
            
            document.getElementById("result").style.display = "grid";
            document.getElementById("aiReport").style.display = "block";
            document.getElementById("superheroReport").style.display = "block";
            
            showSuperhero(summary.top);
        }

        // ========== 超人顯示函數 ==========
        function showSuperhero(beastType) {
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const beastData = superheroData[beastType];
            
            if (beastData) {
                const genderData = beastData[gender] || beastData.male;
                
                document.getElementById("superhero-name").textContent = genderData.name;
                document.getElementById("superhero-ability").textContent = genderData.ability;
                document.getElementById("superhero-mission").textContent = genderData.mission;
                document.getElementById("superhero-local").textContent = `🏮 台灣在地版：${genderData.localName} - ${genderData.description}`;
                
                // 設置神獸顯示
                const superheroBeast = document.getElementById("superhero-beast");
                superheroBeast.textContent = beastType;
                
                // 顯示超人報告區塊
                document.getElementById("superheroReport").style.display = "block";
            }
        }

        // ========== AI分析功能 ==========
        async function generateAIAnalysis() {
            const saved = JSON.parse(localStorage.getItem("shen-shou-result") || "null");
            if (!saved) {
                alert("⚠️請先完成測驗。");
                return;
            }

            const loadingEl = document.getElementById("ai-loading");
            const contentEl = document.getElementById("ai-analysis-content");
            const btnAI = document.getElementById("btnAI");
            const btnRetry = document.getElementById("btnRetry");
            
            loadingEl.style.display = "block";
            contentEl.style.display = "none";
            btnRetry.style.display = "none";
            btnAI.disabled = true;

            try {
                // 顯示分析進度
                simulateProgress();
                
                // 準備請求資料
                const requestData = {
                    scores: saved.scores,
                    summary: saved.summary,
                    gender: saved.gender,
                    questions: BANK // 傳送題庫資料供分析使用
                };
                
                // 呼叫後端 API
                const analysis = await callBackendAPI(requestData);
                
                // 顯示分析結果
                displayAIAnalysis(analysis);
                
            } catch (error) {
                console.error('AI分析錯誤:', error);
                alert('AI分析失敗：' + error.message);
                
                // 如果API失敗，提供模擬分析作為備用
                const fallbackAnalysis = await simulateAIAnalysis(saved);
                displayAIAnalysis(fallbackAnalysis);
                alert('使用備用分析模式，部分功能可能受限');
            } finally {
                loadingEl.style.display = "none";
                contentEl.style.display = "block";
                btnRetry.style.display = "inline-block";
                btnAI.disabled = false;
            }
        }

        // ========== 呼叫後端 API ==========
        async function callBackendAPI(requestData) {
            const response = await fetch('/api/ai', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || 'API請求失敗');
            }

            const data = await response.json();
            return data.analysis;
        }

        // ========== 備用模擬分析（API失敗時使用）==========
        async function simulateAIAnalysis(saved) {
            return new Promise((resolve) => {
                setTimeout(() => {
                    const beastType = saved.summary.top;
                    const gender = saved.gender;
                    
                    // 根據神獸類型和性別生成分析內容
                    const analysis = {
                        personality: generatePersonalityAnalysis(beastType, gender),
                        strengths: generateStrengthsAnalysis(beastType),
                        career: generateCareerAnalysis(beastType),
                        relationships: generateRelationshipsAnalysis(beastType),
                        growth: generateGrowthAnalysis(beastType),
                        money: generateMoneyAnalysis(beastType)
                    };
                    
                    resolve(analysis);
                }, 2000);
            });
        }

        // ========== 生成各類分析內容 ==========
        function generatePersonalityAnalysis(beastType, gender) {
            const personalities = {
                '青龍': '你具有豐富的創造力和靈感，思維活躍且善於創新。你的大腦就像一個永不枯竭的創意源泉，總能想出讓人驚艷的點子。',
                '朱雀': '你充滿熱情與感染力，是天生的溝通者和激勵者。你的情緒豐富且真誠，能夠輕易打動他人並建立深厚的情感連結。',
                '勾陳': '你重視穩定和秩序，做事可靠有條理。你是團隊中堅實的基礎力量，總能提供穩定可靠的支持。',
                '螣蛇': '你具有敏銳的觀察力和洞察力，善於理解他人心思。你能夠巧妙協調不同立場，是人際關係的潤滑劑。',
                '白虎': '你行動力強且果斷，注重效率和結果。在壓力下仍能保持清晰決策，是解決問題的能手。',
                '玄武': '你思慮周密且深謀遠慮，擅長分析和規劃。具有冷靜的智慧與耐心，是團隊的智囊團。'
            };
            
            return personalities[beastType] || '你具有獨特的人格特質，需要進一步探索。';
        }

        function generateStrengthsAnalysis(beastType) {
            const strengths = {
                '青龍': '創意發想、快速適應、突破框架、靈感豐富、多元思考',
                '朱雀': '情感表達、人際溝通、團隊激勵、公開演說、熱情感染',
                '勾陳': '穩定可靠、細節掌控、執行力強、責任感重、系統維護',
                '螣蛇': '洞察人心、協調能力、時機判斷、情感理解、關係維護',
                '白虎': '決策果斷、行動迅速、目標導向、壓力承受、效率優化',
                '玄武': '深度思考、策略規劃、邏輯分析、冷靜判斷、長遠視野'
            };
            
            return `你的核心能量優勢包括：${strengths[beastType] || '獨特的個人優勢'}。這些能力讓你在特定領域表現出色。`;
        }

        function generateCareerAnalysis(beastType) {
            const careers = {
                '青龍': '創意產業、新創公司、行銷策劃、產品開發、藝術創作',
                '朱雀': '教育培訓、公關行銷、客戶服務、人力資源、表演藝術',
                '勾陳': '行政管理、財務會計、品質管控、專案管理、系統維護',
                '螣蛇': '心理諮商、人力資源、協調溝通、策略分析、危機處理',
                '白虎': '業務銷售、專案領導、緊急應變、效率優化、決策管理',
                '玄武': '研究開發、數據分析、策略規劃、技術顧問、學術研究'
            };
            
            return `適合你的職場方向：${careers[beastType] || '多元發展領域'}。在這些領域中，你的天賦將得到充分發揮。`;
        }

        function generateRelationshipsAnalysis(beastType) {
            const relationships = {
                '青龍': '在人際關係中，你帶給他人新鮮感和創意啟發，但需要注意適時傾聽他人的想法。',
                '朱雀': '你擅長建立溫暖的情感連結，但要避免過度情緒化影響理性判斷。',
                '勾陳': '你給人可靠穩定的感覺，但有時需要展現更多彈性和變通性。',
                '螣蛇': '你能敏銳察覺他人需求，但要小心不要過度解讀或承擔過多情緒負擔。',
                '白虎': '你的直接和效率受人欣賞，但需要注意表達方式，避免給人壓迫感。',
                '玄武': '你的冷靜和智慧讓人信賴，但要適時表達情感，避免顯得過於疏離。'
            };
            
            return relationships[beastType] || '在人際互動中保持平衡，發揮優勢的同時注意潛在盲點。';
        }

        function generateGrowthAnalysis(beastType) {
            const growth = {
                '青龍': '學習將創意落實為具體行動，建立持續執行的習慣，避免想法太多而缺乏深度。',
                '朱雀': '發展理性分析能力，在情感表達的同時保持客觀判斷，學習情緒管理技巧。',
                '勾陳': '嘗試接受更多不確定性，培養創新思維，在穩定中尋求適度突破。',
                '螣蛇': '建立個人界限，避免過度承擔他人情緒，學習適時表達自己的需求。',
                '白虎': '培養耐心和細心，在追求效率的同時注重過程品質，學習團隊協作技巧。',
                '玄武': '加強行動力和決斷力，在深思熟慮後勇敢實踐，學習更直接的情感表達。'
            };
            
            return growth[beastType] || '持續自我覺察，在優勢基礎上發展互補能力，實現更全面的成長。';
        }

        function generateMoneyAnalysis(beastType) {
            const money = {
                '青龍': '金錢卦象顯示你有創新求財的潛力，適合投資新興領域，但需注意風險控制。',
                '朱雀': '你的人際網絡是重要財源，透過合作與分享可創造更多價值，注意理性消費。',
                '勾陳': '穩定積累是你的財富之道，長期投資和儲蓄計劃最適合你，避免投機心態。',
                '螣蛇': '你擅長發現隱藏機會，時機判斷精準，但需避免過度猶豫錯失良機。',
                '白虎': '行動力帶來財富增長，快速決策和執行是你的優勢，注意避免衝動投資。',
                '玄武': '深度分析和長遠規劃是你的致富關鍵，知識變現潛力大，需加強行動落實。'
            };
            
            return money[beastType] || '根據五行金錢卦解析，你的財富能量需要平衡發展，注重長期穩定與適度冒險的結合。';
        }

        // ========== 顯示AI分析結果 ==========
        function displayAIAnalysis(analysis) {
            const {
                personality = '',
                strengths = '',
                career = '',
                relationships = '',
                growth = '',
                money = ''
            } = analysis;

            // 顯示到對應的區塊
            document.getElementById("ai-personality").innerHTML = formatAIContent(personality);
            document.getElementById("ai-strengths").innerHTML = formatAIContent(strengths);
            document.getElementById("ai-career").innerHTML = formatAIContent(career);
            document.getElementById("ai-relationships").innerHTML = formatAIContent(relationships);
            document.getElementById("ai-growth").innerHTML = formatAIContent(growth);
            document.getElementById("ai-money").innerHTML = formatAIContent(money);
        }

        // ========== 格式化AI內容 ==========
        function formatAIContent(content) {
            if (!content) return '<div class="text-gray-500 text-center py-3">暫無分析內容</div>';
            
            // 簡單的格式化處理
            return content.split('\n')
                .filter(line => line.trim())
                .map(line => {
                    if (line.match(/^[•\-]/)) {
                        return `<div style="margin: 8px 0; padding-left: 10px;">${line}</div>`;
                    }
                    return `<p style="margin: 12px 0; line-height: 1.6;">${line}</p>`;
                })
                .join('');
        }

        function simulateProgress() {
            const progressBar = document.getElementById("progress-bar");
            const loadingStep = document.getElementById("loading-step");
            const steps = [
                {percent: 20, text: "分析人格特質..."},
                {percent: 40, text: "解析能量分布..."},
                {percent: 60, text: "生成發展建議..."},
                {percent: 80, text: "計算五行金錢卦..."},
                {percent: 95, text: "最終整合報告..."},
                {percent: 100, text: "分析完成！"}
            ];
            
            let currentStep = 0;
            const interval = setInterval(() => {
                if (currentStep < steps.length) {
                    progressBar.style.width = steps[currentStep].percent + "%";
                    loadingStep.textContent = steps[currentStep].text;
                    currentStep++;
                } else {
                    clearInterval(interval);
                }
            }, 500);
        }

        // ========== 其餘函數 ==========
        function summarize(scores) {
            const entries = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            const top = entries[0];
            const secondary = entries[1];
            const dual = top[1] - secondary[1] <= 2 ? [top[0], secondary[0]] : null;
            
            const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
            const variantIndex = total % 12;
            const variants = ["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];
            
            return {
                top: top[0],
                dual: dual,
                ranking: entries,
                variant: variants[variantIndex],
                total: total,
                scores: scores
            };
        }

        function renderRadar(scores) {
            const canvas = document.getElementById("radar");
            if (radarChart) {
                radarChart.destroy();
            }
            
            radarChart = new Chart(canvas, {
                type: "radar",
                data: {
                    labels: Object.keys(scores),
                    datasets: [{
                        label: "六獸能量",
                        data: Object.values(scores),
                        backgroundColor: "rgba(182,130,43,0.15)",
                        borderColor: "#b6822b",
                        pointBackgroundColor: "#b6822b",
                        pointBorderColor: "#fff",
                        pointHoverBackgroundColor: "#fff",
                        pointHoverBorderColor: "#b6822b"
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 25,
                            ticks: {
                                stepSize: 5
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    elements: {
                        line: {
                            borderWidth: 2
                        }
                    }
                }
            });
        }

        function renderReport(summary, scores) {
            const beastTitles = {
                '青龍': '創意靈感型',
                '朱雀': '熱情表達型', 
                '勾陳': '穩固可靠型',
                '螣蛇': '洞察協調型',
                '白虎': '行動決斷型',
                '玄武': '智慧規劃型'
            };
            
            const beastDescriptions = {
                '青龍': '你擁有豐富的創造力和靈感，善於突破傳統框架，在變動中尋找機會。',
                '朱雀': '你充滿熱情與感染力，擅長表達和溝通，能夠激勵他人並建立良好關係。',
                '勾陳': '你重視穩定和秩序，做事可靠有條理，是團隊中堅實的基礎力量。',
                '螣蛇': '你具有敏銳的觀察力，善於理解他人心思，能夠巧妙協調不同立場。',
                '白虎': '你行動力強且果斷，注重效率和結果，在壓力下仍能保持清晰決策。',
                '玄武': '你思慮周密且深謀遠慮，擅長分析和規劃，具有冷靜的智慧與耐心。'
            };
            
            const adviceData = {
                '青龍': {
                    '優勢': '發揮創意，提出新點子',
                    '注意': '避免想法太多缺乏執行',
                    '發展': '學習將靈感落實為具體計劃'
                },
                '朱雀': {
                    '優勢': '運用熱情感染團隊',
                    '注意': '避免情緒波動影響判斷',
                    '發展': '學習理性分析平衡情感'
                },
                '勾陳': {
                    '優勢': '建立穩定可靠系統',
                    '注意': '避免過度保守缺乏彈性',
                    '發展': '嘗試適度創新與改變'
                },
                '螣蛇': {
                    '優勢': '洞察人心協調關係',
                    '注意': '避免過度解讀他人意圖',
                    '發展': '建立清晰個人界限'
                },
                '白虎': {
                    '優勢': '快速決策高效執行',
                    '注意': '避免衝動忽略細節',
                    '發展': '培養耐心與團隊協作'
                },
                '玄武': {
                    '優勢': '深度思考長遠規劃',
                    '注意': '避免過度分析延誤行動',
                    '發展': '加強決斷力與執行力'
                }
            };
            
            // 顯示主型
            document.getElementById("beastSimple").textContent = summary.top;
            document.getElementById("mainBeastTitle").textContent = 
                `${summary.top}・${beastTitles[summary.top]}・${summary.variant}型`;
            document.getElementById("mainBeastSummary").textContent = beastDescriptions[summary.top];
            
            // 顯示雙重提示
            if (summary.dual) {
                document.getElementById("dualHint").textContent = 
                    `※ 注意：您有${summary.dual[0]}+${summary.dual[1]}雙重特質傾向`;
            } else {
                document.getElementById("dualHint").textContent = "";
            }
            
            // 顯示三欄建議
            const advice = adviceData[summary.top];
            const adviceCols = document.getElementById("adviceCols");
            adviceCols.innerHTML = `
                <div class="p-3 bg-green-50 rounded-lg">
                    <div class="font-bold text-green-700 mb-1">優勢發揮</div>
                    <div class="text-sm">${advice.優勢}</div>
                </div>
                <div class="p-3 bg-amber-50 rounded-lg">
                    <div class="font-bold text-amber-700 mb-1">注意提醒</div>
                    <div class="text-sm">${advice.注意}</div>
                </div>
                <div class="p-3 bg-blue-50 rounded-lg">
                    <div class="font-bold text-blue-700 mb-1">發展方向</div>
                    <div class="text-sm">${advice.發展}</div>
                </div>
            `;
        }

        // ========== 分享功能 ==========
        function shareResult() {
            alert('分享功能即將推出！目前請使用列印功能保存您的測驗結果。');
        }

        // ========== 列印功能 ==========
        function printAnalysis() {
            window.print();
        }
    </script>
</body>
</html>
