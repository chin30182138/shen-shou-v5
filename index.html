<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</title>
  <meta name="description" content="å…­ç¸äººæ ¼AIåˆ†æï½œé‡‘éŒ¢å¦äº”è¡Œæ•´åˆï½œå³æ™‚é›·é”åœ–ï¼‹æ™ºèƒ½å ±å‘Š" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root { --brand: #b6822b; }
    body { background: radial-gradient(circle at top left, #fffaf4, #f6f3ea); }
    .brand { color: var(--brand); }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .slider { accent-color: var(--brand); }
    
    /* æ–°å¢ï¼šè¨­å®šé¢æ¿çš„æ»‘å‹•å‹•ç•« */
    .slide-toggle {
        transition: all 0.3s ease-in-out;
        overflow: hidden;
        max-height: 1000px; /* ä¸€å€‹è¶³å¤ å¤§çš„å€¼ */
    }
    .slide-toggle.hidden {
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        margin-top: 0;
        margin-bottom: 0;
        opacity: 0;
    }

    /* è¼‰å…¥å‹•ç•« */
    .spinner { animation: spin 1.5s linear infinite; display: inline-block; font-size: 2em; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loading-dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
    @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
    
    /* é€²åº¦æ¢ */
    .progress-container { width: 100%; background-color: #e5e7eb; border-radius: 10px; margin: 10px 0; overflow: hidden; }
    .progress-bar { height: 8px; background: linear-gradient(90deg, #b6822b, #d4a017); border-radius: 10px; transition: width 0.4s ease; width: 0%; }
    
    /* ç¥ç¸è¶…äººé¡åˆ¥ */
    .superhero-card { border-radius: 12px; padding: 8px; margin: 6px 0; background: linear-gradient(135deg, #e8f4fd, #f0f9ff); border: 2px solid #2b6cb0; }
    .superhero-title { font-size: 1.2em; font-weight: bold; color: #2b6cb0; margin-bottom: 4px; }
    .superhero-ability { background: rgba(43, 108, 176, 0.1); padding: 4px; border-radius: 6px; margin: 4px 0; font-weight: bold; color: #2c5282; font-size: 1.0em; }
    .superhero-desc { font-size: 1.0em; color: #666; line-height: 1.3; }
    
    /* AIåˆ†æå€å¡Š */
    .ai-analysis-section { background: linear-gradient(135deg, #f8f9fa, #ffffff); border: 1px solid #e9ecef; border-radius: 12px; padding: 12px; margin: 8px 0; }
    .ai-analysis-header { display: flex; align-items: center; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 2px solid #e9ecef; }
    .ai-analysis-icon { font-size: 1.5em; margin-right: 8px; }
    .ai-analysis-title { color: #2d3748; font-weight: bold; font-size: 1.2em; }
    .ai-analysis-content { font-size: 1.0em; color: #4a5568; line-height: 1.5; }
    .ai-analysis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 8px; margin-top: 12px; }
    .ai-analysis-item { background: white; padding: 8px; border-radius: 6px; border-left: 4px solid #b6822b; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .ai-analysis-item-title { font-weight: bold; color: #2d3748; margin-bottom: 4px; font-size: 1.0em; }
    .ai-analysis-item-content { font-size: 0.95em; color: #718096; line-height: 1.4; }
    
    /* è¼‰å…¥ç‹€æ…‹ */
    .ai-loading { text-align: center; padding: 20px; color: #718096; background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 12px; border: 2px dashed #e5e7eb; }

    .print-only { display: none; }
    @media screen {
      #radar { width: 100% !important; height: 300px !important; }
      body { font-size: 16px; } /* è¢å¹•æ¨¡å¼å­—é«”æ”¾å¤§ */
      h1 { font-size: 2.5em; }
      h2 { font-size: 1.5em; }
      p, li, div { font-size: 1.0em; }
    }
    
    /* ================================================= */
    /* ========= ğŸ–¨ï¸ åˆ—å°æ¨£å¼ - å…¨æ–°ç¾åŒ–ç‰ˆ ğŸ–¨ï¸ ========= */
    /* ================================================= */
    @media print { 
      .no-print { display: none !important; } 
      body { background: white !important; font-size: 14px !important; color: black !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      main { max-width: 100% !important; padding: 10px !important; margin: 0 !important; }
      .card { box-shadow: none !important; border: 1px solid #ddd !important; break-inside: avoid; page-break-inside: avoid; }
      #result { display: grid !important; grid-template-columns: 45% 55% !important; gap: 10px !important; margin-bottom: 10px !important; }
      #radar-container { position: relative; width: 100% !important; height: 250px !important; padding-bottom: 0 !important; }
      #radar { position: absolute !important; top: 0 !important; left: 0 !important; width: 100% !important; height: 100% !important; display: block !important; }
      .ai-analysis-content { font-size: 14px !important; line-height: 1.4 !important; }
      h1, h2 { color: var(--brand) !important; margin-bottom: 10px !important; font-weight: bold !important; }
      h2 { font-size: 18px !important; border-bottom: 2px solid var(--brand); padding-bottom: 4px; }
      .print-header { display: block !important; text-align: center; margin-bottom: 15px; padding: 15px !important; border: 2px solid var(--brand); border-radius: 12px; background: #fffaf4 !important; position: relative; page-break-after: avoid; box-shadow: 0 4px 12px rgba(182, 130, 43, 0.15); }
      .header-top-border { position: absolute; top: 0; left: 0; right: 0; height: 6px; background: linear-gradient(90deg, var(--brand), #d4a017) !important; border-top-left-radius: 10px; border-top-right-radius: 10px; }
      .header-main-content { display: flex !important; justify-content: space-between; align-items: center; padding: 15px 8px 10px 8px; border-bottom: 1px solid #e5e7eb; }
      .header-left, .header-right { display: flex !important; align-items: center; gap: 8px; flex: 1; }
      .header-right { justify-content: flex-end; }
      .print-logo-img, .print-qrcode-img { width: 60px !important; height: 60px !important; border: 2px solid #d4a017; border-radius: 8px; padding: 3px; background: white; object-fit: contain; }
      .logo-text, .qrcode-text { text-align: left; }
      .qrcode-text { text-align: right; }
      .print-logo-title, .print-qrcode-title { font-size: 14px !important; font-weight: bold; color: var(--brand); }
      .print-logo-subtitle, .print-qrcode-subtitle { font-size: 10px !important; color: #555; line-height: 1.3; }
      .header-title-container { padding: 15px 0; }
      .report-main-title { font-size: 30px !important; font-weight: 900 !important; color: var(--brand) !important; margin: 0 !important; text-shadow: 1px 1px 3px rgba(0,0,0,0.1); letter-spacing: 2px; font-family: 'Microsoft JhengHei', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; }
      .report-subtitle { font-size: 16px !important; color: #333 !important; margin-top: 6px !important; font-weight: 600; }
      .print-date { text-align: center; font-size: 12px !important; color: #777 !important; margin-top: 8px; border-top: 1px solid #e5e7eb; padding-top: 8px; }
      #superheroReport { margin-top: 0 !important; padding: 8px !important; break-inside: avoid; page-break-before: auto; }
      #superheroReport h2 { font-size: 16px !important; margin-bottom: 6px !important; }
      .superhero-card { padding: 6px !important; margin: 0 !important; }
      .superhero-title { font-size: 1.1em !important; margin-bottom: 3px !important; }
      .superhero-ability, .superhero-desc, .superhero-local { font-size: 12px !important; line-height: 1.2 !important; padding: 3px !important; margin: 3px 0 !important; }
      #aiReport { display: block !important; page-break-before: auto; margin-top: 15px !important; }
    }
  </style>
</head>
<body class="text-slate-800">
<main class="max-w-5xl mx-auto p-4 sm:p-6">
  <header class="mb-4 flex justify-between items-center no-print">
    <div class="flex items-center gap-3">
      <img src="pic/logo.png" class="h-10 w-auto rounded" alt="ä»™äººæŒ‡è·¯ Logo" />
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold brand">ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</h1>
        <p class="text-sm text-slate-600">å…­ç¸é›·é”åœ–ãƒ»ä¸»å‹è§£æãƒ»ä¸‰æ¬„å»ºè­°ãƒ»AIåˆ†æå ±å‘Š</p>
      </div>
    </div>
    <button id="toggleSettingsBtn" type="button" class="no-print p-2 rounded-full hover:bg-amber-100 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
    </button>
  </header>

  <form id="reportSettingsForm" class="card p-4 mb-4 no-print slide-toggle hidden">
    <h2 class="font-bold mb-3">âš™ï¸ å ±è¡¨è³‡è¨Šè¨­å®š (è³‡è¨Šå°‡è‡ªå‹•å„²å­˜æ–¼æ‚¨çš„ç€è¦½å™¨)</h2>
    <div class="space-y-4 text-sm">
      <div class="flex items-center gap-4">
        <div>
          <label for="qrCodeUploader" class="font-semibold text-slate-700 block mb-1">ä¸Šå‚³ QR Code åœ–ç‰‡ï¼š</label>
          <input type="file" id="qrCodeUploader" accept="image/*" class="text-slate-600">
        </div>
        <div>
            <label class="font-semibold text-slate-700 block mb-1">åœ–ç‰‡é è¦½ï¼š</label>
            <img id="qrCodePreview" src="https://via.placeholder.com/80x80.png?text=QR+Code" alt="QR Code é è¦½" class="w-20 h-20 border rounded p-1 bg-white object-contain">
        </div>
      </div>
      <div>
        <label for="contactTitle" class="font-semibold text-slate-700">è¯çµ¡æ¨™é¡Œï¼š</label>
        <input type="text" id="contactTitle" class="w-full mt-1 p-2 border rounded">
      </div>
      <div>
        <label for="contactLine1" class="font-semibold text-slate-700">è¯çµ¡è³‡è¨Š (ç¬¬ä¸€è¡Œ)ï¼š</label>
        <input type="text" id="contactLine1" class="w-full mt-1 p-2 border rounded">
      </div>
      <div>
        <label for="contactLine2" class="font-semibold text-slate-700">è¯çµ¡è³‡è¨Š (ç¬¬äºŒè¡Œ)ï¼š</label>
        <input type="text" id="contactLine2" class="w-full mt-1 p-2 border rounded">
      </div>
      <div>
        <label for="themeSelect" class="font-semibold text-slate-700 block mb-1">é¸æ“‡è‰²ç³»ä¸»é¡Œï¼š</label>
        <select id="themeSelect" class="w-full mt-1 p-2 border rounded">
          <option value="warm">æš–è‰²ç³»</option>
          <option value="cool">å†·è‰²ç³»</option>
          <option value="classic">ç¶“å…¸ç³»</option>
        </select>
      </div>
      <div>
        <label for="hueSlider" class="font-semibold text-slate-700 block mb-1">èª¿æ•´è‰²èª¿ (0-360)ï¼š</label>
        <input type="range" id="hueSlider" min="0" max="360" value="40" class="w-full mt-1 slider" oninput="applyHue(this.value)">
      </div>
    </div>
    <div class="mt-4">
      <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition text-sm">å„²å­˜è¨­å®š</button>
    </div>
  </form>

  <form id="form" class="card p-4 mb-4 no-print">
    <h2 class="font-bold mb-3">ğŸ“‹ è«‹å›ç­”ä¸‹åˆ—30é¡Œï¼ˆ1ï¼ä¸åŒæ„ï¼Œ5ï¼éå¸¸åŒæ„ï¼‰</h2>
    
    <!-- æ–°å¢ï¼šæ€§åˆ¥é¸æ“‡ -->
    <div class="mb-4 p-3 bg-slate-50 rounded-lg">
      <label class="font-semibold text-slate-700 block mb-2">è«‹é¸æ“‡æ‚¨çš„æ€§åˆ¥ï¼š</label>
      <div class="flex gap-4">
        <label class="flex items-center">
          <input type="radio" name="gender" value="male" class="mr-2" checked>
          ç”·æ€§
        </label>
        <label class="flex items-center">
          <input type="radio" name="gender" value="female" class="mr-2">
          å¥³æ€§
        </label>
        <label class="flex items-center">
          <input type="radio" name="gender" value="other" class="mr-2">
          å…¶ä»–
        </label>
      </div>
    </div>
    
    <ol id="qWrap" class="space-y-3"></ol>
    <div class="mt-4 flex gap-3">
      <button type="submit" class="bg-amber-600 text-white px-5 py-2 rounded hover:bg-amber-700 transition">é€å‡ºæ¸¬é©—</button>
      <button type="button" id="btnFillMid" class="border px-3 py-2 rounded hover:bg-gray-50 transition">å…¨éƒ¨å¡«3</button>
    </div>
  </form>

  <div class="print-only print-header">
    <div class="header-top-border"></div>
    <div class="header-main-content">
      <div class="header-left">
        <img src="pic/logo.png" alt="Logo" class="print-logo-img">
        <div class="logo-text">
            <div class="print-logo-title">ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒ</div>
            <div class="print-logo-subtitle">å°ˆæ¥­å‘½ç†è«®è©¢æœå‹™</div>
        </div>
      </div>
      <div class="header-right">
        <div class="qrcode-text">
            <div id="print-qrcode-title" class="print-qrcode-title"></div>
            <div id="print-qrcode-subtitle" class="print-qrcode-subtitle"></div>
        </div>
        <img id="print-qrcode-img" src="https://via.placeholder.com/80x80.png?text=QR+Code" alt="QR Code" class="print-qrcode-img">
      </div>
    </div>
    <div class="header-title-container">
      <h1 class="report-main-title">ä»™äººæŒ‡è·¯ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼</h1>
      <p class="report-subtitle">å€‹äººåŒ–æ·±åº¦åˆ†æå ±å‘Š (V45.0 æœ€çµ‚ç©©å®šç‰ˆ)</p>
    </div>
    <div class="print-date">å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š<span id="report-date"></span></div>
  </div>

  <section id="result" class="grid lg:grid-cols-2 gap-4" style="display: none;">
    <div class="card p-4">
      <h2 class="font-bold mb-2">å…­ç¸èƒ½é‡é›·é”åœ–</h2>
      <div id="radar-container"><canvas id="radar"></canvas></div>
      <button class="mt-3 px-4 py-2 border rounded no-print hover:bg-gray-50 transition" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°åˆ†æå ±å‘Š</button>
    </div>
    <div class="card p-4" id="resultCard">
      <h2 class="font-bold mb-2">ä¸»å‹èˆ‡ä¸‰æ¬„å»ºè­°</h2>
      <div class="grid grid-cols-3 gap-3 items-start">
        <div id="beastSVG" class="w-full aspect-square"></div>
        <div class="col-span-2">
          <div id="mainBeastTitle" class="font-bold brand text-lg"></div>
          <div id="dualHint" class="text-sm text-slate-600 mt-1"></div>
          <div id="mainBeastSummary" class="mt-2 text-sm"></div>
        </div>
      </div>
      <hr class="my-2" />
      <div id="adviceCols" class="grid md:grid-cols-3 gap-2 text-sm"></div>
      <div class="mt-3 flex gap-2 no-print">
        <button id="btnShare" class="px-4 py-2 border rounded hover:bg-gray-50 transition">åˆ†äº«çµæœåœ–ç‰‡</button>
        <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°åˆ†æå ±å‘Š</button>
      </div>
    </div>
  </section>

  <section class="card p-4 mt-4" id="superheroReport" style="display: none;">
    <h2 class="font-bold mb-2">ğŸ¦¸â€â™‚ï¸ ä½ çš„ç¥ç¸è¶…äººèº«åˆ†</h2>
    <div id="superhero-display" class="superhero-card">
      <div id="superhero-name" class="superhero-title"></div>
      <div id="superhero-ability" class="superhero-ability"></div>
      <div id="superhero-mission" class="superhero-desc"></div>
      <div id="superhero-local" class="text-sm mt-2 font-bold text-blue-700"></div>
    </div>
  </section>

  <section class="card p-4 mt-4" id="aiReport" style="display: none;">
    <h2 class="font-bold mb-2">ğŸ¤– AI æ™ºèƒ½å€‹äººåŒ–åˆ†æå ±å‘Š</h2>
    <p class="text-sm text-slate-600 mb-2">ä»¥ä¸‹å…§å®¹ç”±ä»™äººæŒ‡è·¯AIç³»çµ±ç”Ÿæˆï¼Œèåˆé‡‘éŒ¢å¦ã€äº”è¡Œã€åœ°æ”¯èˆ‡å¿ƒç†è¦–è§’ã€‚</p>
    <div id="ai-analysis-structured">
      <div class="ai-loading" id="ai-loading" style="display: none;">
        <div class="spinner">ğŸ”®</div>
        <p class="mt-2 text-lg font-semibold">AI æ­£åœ¨ç‚ºæ‚¨æ·±åº¦åˆ†æä¸­<span class="loading-dots"></span></p>
        <p class="mt-1 text-sm text-gray-600">é€™å¯èƒ½éœ€è¦ 10-20 ç§’ï¼Œè«‹ç¨å€™</p>
        <div class="progress-container mt-3"><div class="progress-bar" id="progress-bar"></div></div>
        <div class="mt-2 text-xs text-gray-500" id="loading-step">åˆå§‹åŒ–åˆ†æå¼•æ“...</div>
      </div>
      <div id="ai-analysis-content">
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">ğŸ­</div><div class="ai-analysis-title">äººæ ¼ç‰¹è³ªåˆ†æ</div></div>
          <div class="ai-analysis-content" id="ai-personality"><div class="text-gray-500 text-center py-3">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–è©³ç´°è§£æ</div></div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">âš¡</div><div class="ai-analysis-title">èƒ½é‡å„ªå‹¢åˆ†æ</div></div>
          <div class="ai-analysis-content" id="ai-strengths"><div class="text-gray-500 text-center py-3">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–è©³ç´°è§£æ</div></div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">ğŸ“ˆ</div><div class="ai-analysis-title">æˆé•·ç™¼å±•å»ºè­°</div></div>
          <div class="ai-analysis-grid">
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">è·å ´ç™¼å±•</div><div class="ai-analysis-item-content" id="ai-career">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–è·å ´å»ºè­°</div></div>
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">äººéš›é—œä¿‚</div><div class="ai-analysis-item-content" id="ai-relationships">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–äººéš›å»ºè­°</div></div>
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">å€‹äººæˆé•·</div><div class="ai-analysis-item-content" id="ai-growth">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–æˆé•·å»ºè­°</div></div>
          </div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">ğŸ’°</div><div class="ai-analysis-title">äº”è¡Œé‡‘éŒ¢å¦è§£æ</div></div>
          <div class="ai-analysis-content" id="ai-money"><div class="text-gray-500 text-center py-3">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–é‡‘éŒ¢å¦è§£æ</div></div>
        </div>
      </div>
    </div>
    <div class="flex gap-2 no-print mt-3">
      <button id="btnAI" class="px-4 py-2 border rounded bg-amber-500 text-white hover:bg-amber-600 transition">ç”Ÿæˆæ·±åº¦åˆ†æ</button>
      <button id="btnRetry" class="px-4 py-2 border rounded bg-gray-200 hover:bg-gray-300 transition" style="display:none;">é‡æ–°åˆ†æ</button>
      <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°å®Œæ•´å ±å‘Š</button>
    </div>
  </section>

  <footer class="text-center text-xs text-slate-500 mt-6 no-print">
    <div class="flex justify-center items-center gap-4 mb-1">
      <span>Â© 2025 ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒ</span><span>|</span><span>Line: @immortalguiide</span>
    </div>
    <p>æ¸¬é©—åƒ…ä¾›è¦ºå¯Ÿèˆ‡æ•™å­¸ç”¨é€”</p>
  </footer>
</main>

<script>
// ========== å ±å‘Šæ—¥æœŸè¨­å®š ==========
document.getElementById('report-date').textContent = new Date().toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' });

// ========== æ–°å¢ï¼šè¨­å®šé¢æ¿é–‹é—œé‚è¼¯ ==========
const toggleBtn = document.getElementById('toggleSettingsBtn');
const settingsPanel = document.getElementById('reportSettingsForm');

toggleBtn.addEventListener('click', () => {
    settingsPanel.classList.toggle('hidden');
});

// ========== å ±è¡¨è³‡è¨Šè¨­å®šçš„å„²å­˜èˆ‡è¼‰å…¥é‚è¼¯ ==========
const settingsForm = document.getElementById('reportSettingsForm');
const qrCodeUploader = document.getElementById('qrCodeUploader');
const qrCodePreview = document.getElementById('qrCodePreview');
const contactTitleInput = document.getElementById('contactTitle');
const contactLine1Input = document.getElementById('contactLine1');
const contactLine2Input = document.getElementById('contactLine2');
const themeSelect = document.getElementById('themeSelect');
const hueSlider = document.getElementById('hueSlider');
const DEFAULT_QR_PLACEHOLDER = 'https://via.placeholder.com/80x80.png?text=QR+Code';

// è™•ç†åœ–ç‰‡ä¸Šå‚³
qrCodeUploader.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            qrCodePreview.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
});

// å„²å­˜è¨­å®š
settingsForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const settings = {
    qrDataUrl: qrCodePreview.src,
    title: contactTitleInput.value,
    line1: contactLine1Input.value,
    line2: contactLine2Input.value,
    theme: themeSelect.value,
    hue: hueSlider.value
  };
  localStorage.setItem('reportContactSettings', JSON.stringify(settings));
  applyTheme(settings.theme, settings.hue);
  alert('è¨­å®šå·²å„²å­˜ï¼');
});

// é é¢è¼‰å…¥æ™‚ï¼Œè®€å–ä¸¦å¡«å…¥å·²å„²å­˜çš„è¨­å®š
function loadSettings() {
  const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings'));
  if (savedSettings) {
    qrCodePreview.src = savedSettings.qrDataUrl || DEFAULT_QR_PLACEHOLDER;
    contactTitleInput.value = savedSettings.title || 'æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢';
    contactLine1Input.value = savedSettings.line1 || 'Line ID: @immortalguiide';
    contactLine2Input.value = savedSettings.line2 || 'å°ˆæ¥­è«®è©¢é ç´„';
    themeSelect.value = savedSettings.theme || 'warm';
    hueSlider.value = savedSettings.hue || 40;
    applyTheme(savedSettings.theme || 'warm', savedSettings.hue || 40);
  } else {
    // è¨­ç½®é è¨­å€¼
    qrCodePreview.src = DEFAULT_QR_PLACEHOLDER;
    contactTitleInput.value = 'æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢';
    contactLine1Input.value = 'Line ID: @immortalguiide';
    contactLine2Input.value = 'å°ˆæ¥­è«®è©¢é ç´„';
    themeSelect.value = 'warm';
    hueSlider.value = 40;
    applyTheme('warm', 40);
  }
}
loadSettings();

// æ–°å¢ï¼šæ‡‰ç”¨è‰²ç³»ä¸»é¡Œèˆ‡è‰²èª¿
function applyTheme(theme, hue) {
  const root = document.documentElement;
  let baseHue = parseInt(hue);
  switch (theme) {
    case 'warm':
      root.style.setProperty('--brand', `hsl(${baseHue}, 70%, 45%)`);
      document.body.style.background = 'radial-gradient(circle at top left, #fffaf4, #f6f3ea)';
      break;
    case 'cool':
      root.style.setProperty('--brand', `hsl(${baseHue + 180}, 70%, 45%)`);
      document.body.style.background = 'radial-gradient(circle at top left, #e8f4fd, #f0f9ff)';
      break;
    case 'classic':
      root.style.setProperty('--brand', `hsl(${baseHue + 240}, 20%, 40%)`);
      document.body.style.background = 'radial-gradient(circle at top left, #f7fafc, #edf2f7)';
      break;
  }
  // æ›´æ–°é€²åº¦æ¢é¡è‰²
  const progressBar = document.querySelector('.progress-bar');
  progressBar.style.background = `linear-gradient(90deg, ${getComputedStyle(root).getPropertyValue('--brand')}, #d4a017)`;
}

// æ–°å¢ï¼šå³æ™‚æ‡‰ç”¨è‰²èª¿æ»‘å¡Š
function applyHue(hue) {
  const theme = themeSelect.value;
  applyTheme(theme, hue);
  const settings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
  settings.hue = hue;
  localStorage.setItem('reportContactSettings', JSON.stringify(settings));
}

// ========== åˆ—å°åŠŸèƒ½ï¼ˆå·²ä¿®å¾©é›·é”åœ–å•é¡Œï¼‰ ==========
function printAnalysis() {
  // å…ˆè½‰æ›é›·é”åœ–ç‚ºåœ–ç‰‡
  convertChartToImage();

  const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
  const qrDataUrl = savedSettings.qrDataUrl || DEFAULT_QR_PLACEHOLDER;
  const title = savedSettings.title || 'æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢';
  const line1 = savedSettings.line1 || 'Line ID: @immortalguiide';
  const line2 = savedSettings.line2 || 'å°ˆæ¥­è«®è©¢é ç´„';

  document.getElementById('print-qrcode-img').src = qrDataUrl;
  document.getElementById('print-qrcode-title').textContent = title;
  document.getElementById('print-qrcode-subtitle').innerHTML = `${line1}${line2 ? '<br>' + line2 : ''}`;

  // å»¶é²åˆ—å°ä»¥ç¢ºä¿åœ–ç‰‡è¼‰å…¥
  setTimeout(() => {
    window.print();
  }, 500);
}

// æ–°å¢ï¼šå°‡é›·é”åœ–è½‰ç‚ºåœ–ç‰‡ä»¥è§£æ±ºåˆ—å°å•é¡Œ
function convertChartToImage() {
  const canvas = document.getElementById('radar');
  if (canvas) {
    html2canvas(canvas, { scale: 2 }).then((capturedCanvas) => {  // ä½¿ç”¨æ›´é«˜è§£æåº¦
      const imgData = capturedCanvas.toDataURL('image/png');
      const img = document.createElement('img');
      img.src = imgData;
      img.style.width = '100%';
      img.style.height = 'auto';
      const container = document.getElementById('radar-container');
      container.innerHTML = '';  // æ¸…ç©ºåŸ canvas
      container.appendChild(img);
    }).catch((error) => {
      console.error('åœ–è¡¨è½‰æ›å¤±æ•—:', error);
    });
  }
}

// ç›£è½ beforeprint äº‹ä»¶ï¼ˆé¡å¤–ç¢ºä¿ï¼‰
window.addEventListener('beforeprint', convertChartToImage);

// ========== ç¥ç¸è¶…äººå°ç…§è³‡æ–™ (å·²æ“´å……å…§å®¹ä¸¦åŠ å…¥æ€§åˆ¥å·®ç•°) ==========
const superheroData = {
  'é’é¾': {
    male: {name:'å‰µæ„é£›é¾è¶…äºº', ability:'ğŸ¦¸â€â™‚ï¸ è¶…èƒ½åŠ›ï¼šéˆæ„Ÿçˆ†ç™¼ + å¿«é€Ÿæ‡‰è®Š + çªç ´æ¡†æ¶', mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šå‰µæ–°å°ˆæ¡ˆç™¼èµ·äººã€å±æ©Ÿè™•ç†å°ˆå®¶ã€æ–°é ˜åŸŸé–‹æ‹“è€…', localName:'å°ç£é»å­ç‹', description:'ä½ å°±åƒå°ç£çš„å‰µæ–°å¼•æ“ï¼Œç¸½èƒ½æƒ³å‡ºè®“äººé©šè‰·çš„é»å­ï¼'},
    female: {name:'å‰µæ„é£›é¾å¥³ä¿ ', ability:'ğŸ¦¸â€â™€ï¸ è¶…èƒ½åŠ›ï¼šéˆæ„Ÿçˆ†ç™¼ + ç›´è¦ºæ´å¯Ÿ + è·¨ç•Œèåˆ', mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šå‰µæ„ç­–åŠƒå¸«ã€åœ˜éšŠå”èª¿è€…ã€ç¾æ„Ÿå¼•å°è€…', localName:'å°ç£å‰µæ„å¥³ç¥', description:'ä½ æ˜¯å°ç£çš„å‰µæ„å¥³ç¥ï¼Œç¸½èƒ½å°‡éˆæ„Ÿè½‰åŒ–ç‚ºå‹•äººçš„ä½œå“ï¼'},
    analysis: {
      male: {
        personality: 'é’é¾å‹äººæ ¼çš„ä½ ï¼Œå…§å¿ƒè˜Šè—è‘—ä¸€è‚¡ç”Ÿç”Ÿä¸æ¯çš„å‰µé€ æ´»æ°´ã€‚ä½ çš„æ€ç¶­å¦‚åŒæ˜¥é›·ç ´æ›‰ï¼Œç¸½èƒ½åœ¨å¹³å‡¡ä¸­çœ‹è¦‹ä¸å‡¡ï¼Œåœ¨æ¡†æ¶å¤–æ‰¾åˆ°æ–°è·¯ã€‚ä½ ä¸å–œæ­¡å¢¨å®ˆæˆè¦ï¼Œäº«å—å¾ç„¡åˆ°æœ‰çš„å‰µé€ éç¨‹ï¼Œè…¦ä¸­æ™‚å¸¸æœ‰ç„¡æ•¸å€‹ã€Œå¦‚æœé€™æ¨£æœƒæ€æ¨£ï¼Ÿã€çš„å¿µé ­åœ¨ç¿»é¨°ã€‚å°ä½ è€Œè¨€ï¼Œä¸–ç•Œä¸æ˜¯ä¸€å€‹å›ºå®šçš„åŠ‡æœ¬ï¼Œè€Œæ˜¯ä¸€å€‹å……æ»¿ç„¡é™å¯èƒ½çš„éŠæ¨‚å ´ï¼Œç­‰å¾…ä½ å»æ¢ç´¢ã€å»å®šç¾©ã€‚',
        strengths: 'ä½ æœ€å¤§çš„å„ªå‹¢åœ¨æ–¼é‚£ç„¡äººèƒ½åŠçš„ã€Œéˆæ„Ÿçˆ†ç™¼åŠ›ã€èˆ‡ã€Œéˆæ´»æ‡‰è®Šæ€§ã€ã€‚ç•¶åœ˜éšŠé™·å…¥åƒµå±€æ™‚ï¼Œä½ ç¸½èƒ½æå‡ºçŸ³ç ´å¤©é©šçš„è§€é»ï¼ŒåŒ–è§£å±æ©Ÿã€‚ä½ åƒä¸€ä½é«˜æ˜çš„èˆµæ‰‹ï¼Œå³ä¾¿é‡åˆ°çªä¾†çš„é¢¨æš´ä¹Ÿèƒ½è¿…é€Ÿèª¿æ•´èˆªå‘ï¼Œæ‰¾åˆ°æ–°çš„èˆªé“ã€‚é€™ç¨®çªç ´æ€§çš„æ€ç¶­æ˜¯ä½ æœ€å¯¶è²´çš„è³‡ç”¢ï¼Œè®“ä½ åœ¨è®Šå‹•å¿«é€Ÿçš„ç’°å¢ƒä¸­å¦‚é­šå¾—æ°´ï¼Œæˆç‚ºåœ˜éšŠä¸­ä¸å¯æˆ–ç¼ºçš„å‰µæ–°å‚¬åŒ–åŠ‘ã€‚',
        career: 'åœ¨è·æ¥­é¸æ“‡ä¸Šï¼Œä½ å¦‚åŒç¿±ç¿”çš„å·¨é¾ï¼Œæœ€é©åˆåœ¨éœ€è¦æºæºä¸çµ•å‰µæ„çš„é ˜åŸŸç™¼å…‰ç™¼ç†±ï¼Œä¾‹å¦‚å»£å‘Šè¨­è¨ˆã€ç”¢å“é–‹ç™¼ã€æ–°å‰µä¼æ¥­çš„é–‹æ‹“è€…ï¼Œæˆ–æ˜¯ä»»ä½•é¼“å‹µæ‰“ç ´å¸¸è¦ã€æŒ‘æˆ°ç¾ç‹€çš„å´—ä½ã€‚ä½ éœ€è¦ä¸€å€‹èƒ½å¤ çµ¦äºˆä½ é«˜åº¦è‡ªç”±åº¦å’Œç™¼æ®ç©ºé–“çš„èˆå°ã€‚åˆ‡è¨˜ï¼Œé¿å…é¸æ“‡éæ–¼åƒµåŒ–ã€é‡è¤‡æ€§é«˜çš„å·¥ä½œï¼Œé‚£æœƒæ‰¼æ®ºä½ çš„å¤©è³¦ã€‚',
        relationships: 'æƒ…æ„Ÿä¸–ç•Œè£¡ï¼Œä½ éœ€è¦çš„æ˜¯æ–°é®®æ„Ÿèˆ‡å…±åŒæˆé•·çš„ç«èŠ±ã€‚ä¸€æˆä¸è®Šçš„é—œä¿‚æœƒè®“ä½ æ„Ÿåˆ°çª’æ¯ã€‚ä½ åš®å¾€èƒ½ä¸€èµ·æ¢ç´¢æœªçŸ¥ã€å˜—è©¦æ–°äº‹ç‰©ã€æ¿€ç›ªæ€æƒ³çš„ä¼´ä¾¶ã€‚å°ä½ è€Œè¨€ï¼Œæœ€æµªæ¼«çš„äº‹è«éæ–¼å…©äººä¸€èµ·æŠŠç”Ÿæ´»è®Šæˆä¸€å ´æœ‰è¶£çš„å†’éšªã€‚ä¸éï¼Œä¹Ÿè¦å­¸ç¿’åœ¨è¿½æ±‚è®ŠåŒ–çš„åŒæ™‚ï¼Œçµ¦äºˆå°æ–¹ç©©å®šçš„å®‰å…¨æ„Ÿï¼Œæ‰¾åˆ°å‰µæ–°èˆ‡æ‰¿è«¾é–“çš„å¹³è¡¡é»ã€‚',
        growth: 'ä½ çš„æŒ‘æˆ°åœ¨æ–¼å¦‚ä½•å°‡å¤©é¦¬è¡Œç©ºçš„å‰µæ„ã€Œè½åœ°ã€ã€‚å­¸ç¿’å»ºç«‹ç³»çµ±æ€§çš„åŸ·è¡Œè¨ˆç•«ã€åŸ¹é¤Šè€å¿ƒèˆ‡å°ˆæ³¨åŠ›è‡³é—œé‡è¦ã€‚å¯ä»¥å˜—è©¦ä½¿ç”¨å°ˆæ¡ˆç®¡ç†å·¥å…·ï¼Œå°‡å¤§ç›®æ¨™æ‹†è§£æˆå°æ­¥é©Ÿï¼Œä¸¦è¨­å®šæ˜ç¢ºçš„æ™‚ç¨‹ã€‚å¦å¤–ï¼Œé©æ™‚åœ°æ²‰æ¾±èˆ‡åæ€ï¼Œè€Œéä¸€å‘³è¿½é€æ–°é»å­ï¼Œèƒ½è®“ä½ çš„å‰µé€ åŠ›ç™¼æ®å¾—æ›´é•·ä¹…ã€æ›´æœ‰æ·±åº¦ã€‚',
        money: 'é‡‘éŒ¢å¦è±¡é¡¯ç¤ºï¼Œä½ çš„è²¡å¯Œå¯†ç¢¼è—åœ¨ã€Œè¶¨å‹¢ã€èˆ‡ã€Œå‰µæ–°ã€ä¹‹ä¸­ã€‚ä½ å°æ–°èˆˆç”¢æ¥­ã€æ½›åŠ›ç§‘æŠ€æœ‰è‘—æ•éŠ³çš„ç›´è¦ºï¼Œé©åˆé€²è¡Œé¢¨éšªèˆ‡å›å ±è¼ƒé«˜çš„å‰ç»æ€§æŠ•è³‡ã€‚ç„¶è€Œï¼Œä½ çš„æŒ‘æˆ°åœ¨æ–¼é¿å…å› ä¸€æ™‚çš„éˆæ„Ÿè€Œè¡å‹•æ±ºç­–ã€‚å»ºè­°ä½ å»ºç«‹ä¸€å€‹æ ¸å¿ƒç©©å¥çš„æŠ•è³‡çµ„åˆï¼Œå†æ’¥å‡ºä¸€éƒ¨åˆ†è³‡é‡‘ç”¨æ–¼å¯¦ç¾ä½ çš„å‰µæ„æŠ•è³‡ï¼Œä¸¦åš´æ ¼è¨­ç«‹åœæé»ï¼Œæ–¹èƒ½é§•é¦­è²¡å¯Œçš„æµªæ½®ã€‚'
      },
      female: {
        personality: 'é’é¾å‹äººæ ¼çš„ä½ ï¼Œæ“æœ‰è±å¯Œçš„æƒ³åƒåŠ›èˆ‡æ•éŠ³çš„ç›´è¦ºã€‚ä½ çš„æ€ç¶­å¦‚åŒæ˜¥æ—¥æºªæµï¼Œéˆå‹•è€Œå¯Œæœ‰ç”Ÿå‘½åŠ›ï¼Œç¸½èƒ½åœ¨å¹³å‡¡ä¸­ç™¼ç¾ç¾çš„å¯èƒ½ï¼Œåœ¨å›°å¢ƒä¸­æ‰¾åˆ°å‰µæ–°çš„å‡ºè·¯ã€‚ä½ äº«å—å‰µé€ çš„éç¨‹ï¼Œå–œæ­¡å°‡éˆæ„Ÿè½‰åŒ–ç‚ºå…·é«”çš„æˆæœï¼Œç„¡è«–æ˜¯è—è¡“ä½œå“ã€ç”Ÿæ´»ç¾å­¸é‚„æ˜¯è§£æ±ºæ–¹æ¡ˆã€‚å°ä½ è€Œè¨€ï¼Œç”Ÿæ´»æ˜¯ä¸€å¡Šç•«å¸ƒï¼Œç­‰å¾…ä½ ç”¨ç¨ç‰¹çš„è¦–è§’å»æç¹ªã€‚',
        strengths: 'ä½ æœ€å¤§çš„å„ªå‹¢åœ¨æ–¼ã€Œéˆæ„Ÿç›´è¦ºã€èˆ‡ã€Œè·¨ç•Œèåˆèƒ½åŠ›ã€ã€‚ä½ èƒ½å¤ æ„ŸçŸ¥åˆ°ä»–äººå¿½ç•¥çš„ç´°ç¯€ï¼Œä¸¦å°‡ä¸åŒé ˜åŸŸçš„çŸ¥è­˜èˆ‡ç¾æ„Ÿå·§å¦™åœ°çµåˆèµ·ä¾†ã€‚åœ¨åœ˜éšŠä¸­ï¼Œä½ å¾€å¾€æ˜¯å‰µæ„çš„å‚¬åŒ–åŠ‘ï¼Œèƒ½å¤ ç”¨ç¨ç‰¹çš„è¦–è§’å•Ÿç™¼ä»–äººï¼Œä¸¦å°‡æŠ½è±¡çš„é»å­è½‰åŒ–ç‚ºå…·é«”å¯è¡Œçš„æ–¹æ¡ˆã€‚ä½ çš„å­˜åœ¨ï¼Œç‚ºåœ˜éšŠå¸¶ä¾†æ´»åŠ›èˆ‡ç¾æ„Ÿï¼Œæ˜¯å‰µæ„èˆ‡å¯¦ç”¨ä¹‹é–“çš„æ©‹æ¨‘ã€‚',
        career: 'åœ¨è·æ¥­é¸æ“‡ä¸Šï¼Œä½ é©åˆåœ¨éœ€è¦å‰µé€ åŠ›èˆ‡ç¾æ„Ÿçš„é ˜åŸŸç™¼æ®æ‰€é•·ï¼Œä¾‹å¦‚è¨­è¨ˆã€è—è¡“ã€æ•™è‚²ã€ç­–åŠƒæˆ–ä»»ä½•éœ€è¦è·¨ç•Œæ•´åˆçš„å·¥ä½œã€‚ä½ éœ€è¦ä¸€å€‹èƒ½å¤ å°Šé‡ä½ å‰µæ„ã€çµ¦äºˆä½ ç™¼æ®ç©ºé–“çš„ç’°å¢ƒã€‚ä½ çš„åƒ¹å€¼åœ¨æ–¼å°‡ç¾æ„Ÿèˆ‡å¯¦ç”¨çµåˆï¼Œå‰µé€ å‡ºæ—¢æœ‰æ·±åº¦åˆæœ‰æº«åº¦çš„ä½œå“ã€‚é¿å…éæ–¼æ©Ÿæ¢°åŒ–ã€ç¼ºä¹å‰µé€ ç©ºé–“çš„å·¥ä½œï¼Œé‚£æœƒé™åˆ¶ä½ çš„å¤©è³¦ã€‚',
        relationships: 'åœ¨æ„Ÿæƒ…ä¸­ï¼Œä½ è¿½æ±‚çš„æ˜¯å¿ƒéˆçš„å…±é³´èˆ‡å…±åŒæˆé•·ã€‚ä½ æ¸´æœ›èˆ‡ä¼´ä¾¶ä¸€èµ·æ¢ç´¢ä¸–ç•Œï¼Œåˆ†äº«å½¼æ­¤çš„å¤¢æƒ³èˆ‡éˆæ„Ÿã€‚å°ä½ è€Œè¨€ï¼Œæœ€ç¾å¥½çš„é—œä¿‚æ˜¯å…©å€‹ç¨ç«‹éˆé­‚çš„ç›¸äº’å•Ÿç™¼èˆ‡æ”¯æŒã€‚ä½ éœ€è¦ä¸€å€‹èƒ½å¤ æ¬£è³ä½ ç¨ç‰¹è¦–è§’ã€ä¸¦é¡˜æ„èˆ‡ä½ ä¸€èµ·å‰µé€ ç¾å¥½ç”Ÿæ´»çš„ä¼´ä¾¶ã€‚åŒæ™‚ï¼Œä¹Ÿè¦å­¸ç¿’åœ¨è¿½æ±‚ç†æƒ³çš„åŒæ™‚ï¼ŒåŒ…å®¹ç¾å¯¦çš„ä¸å®Œç¾ã€‚',
        growth: 'ä½ çš„æˆé•·èª²é¡Œåœ¨æ–¼ã€Œå¹³è¡¡ç†æƒ³èˆ‡ç¾å¯¦ã€ã€‚æœ‰æ™‚å€™ï¼Œéæ–¼è¿½æ±‚å®Œç¾å¯èƒ½æœƒè®“ä½ æ„Ÿåˆ°æŒ«æŠ˜ã€‚å­¸ç¿’æ¥å—ã€Œè¶³å¤ å¥½ã€çš„æ¨™æº–ï¼Œä¸¦åœ¨å‰µæ„èˆ‡å¯è¡Œæ€§ä¹‹é–“æ‰¾åˆ°å¹³è¡¡é»ã€‚å»ºç«‹è¦å¾‹çš„ç”Ÿæ´»ç¿’æ…£èˆ‡å·¥ä½œç¯€å¥ï¼Œèƒ½å¤ å¹«åŠ©ä½ æ›´æœ‰æ•ˆåœ°å°‡éˆæ„Ÿè½‰åŒ–ç‚ºæˆæœã€‚åŒæ™‚ï¼Œä¹Ÿè¦å­¸æœƒä¿è­·è‡ªå·±çš„èƒ½é‡ï¼Œé¿å…éåº¦æŠ•å…¥è€Œè€—ç›¡å‰µæ„æºæ³‰ã€‚',
        money: 'é‡‘éŒ¢å¦è±¡é¡¯ç¤ºï¼Œä½ çš„è²¡å¯Œä¹‹é“åœ¨æ–¼ã€Œç¾æ„Ÿç¶“æ¿Ÿã€èˆ‡ã€ŒçŸ¥è­˜è®Šç¾ã€ã€‚ä½ å°ç¾èˆ‡å“è³ªçš„æ•æ„Ÿåº¦ï¼Œèƒ½å¤ å¹«åŠ©ä½ åœ¨è¨­è¨ˆã€æ–‡åŒ–å‰µæ„ç­‰é ˜åŸŸæ‰¾åˆ°å•†æ©Ÿã€‚é©åˆæŠ•è³‡æ–¼èƒ½å¤ æå‡ç”Ÿæ´»å“è³ªçš„é …ç›®ï¼Œæˆ–å°‡ä½ çš„å°ˆæ¥­çŸ¥è­˜è½‰åŒ–ç‚ºæœ‰åƒ¹å€¼çš„ç”¢å“èˆ‡æœå‹™ã€‚å»ºè­°ä½ å»ºç«‹å¤šå…ƒçš„æ”¶å…¥ä¾†æºï¼Œä¸¦å­¸ç¿’åŸºæœ¬çš„è²¡å‹™ç®¡ç†ï¼Œè®“å‰µæ„èˆ‡è²¡å¯Œç›¸è¼”ç›¸æˆã€‚'
      }
    }
  },
  'æœ±é›€': {
    male: {name:'ç†±æƒ…é³³å‡°è¶…äºº', ability:'ğŸ¦¸â€â™‚ï¸ è¶…èƒ½åŠ›ï¼šæ„ŸæŸ“åŠ›å ´ + æºé€šå¤§å¸« + æ¿€å‹µå…‰ç’°', mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šåœ˜éšŠå£«æ°£å……é›»ç«™ã€å…¬é—œæºé€šé”äººã€æ•™è‚²æ¨å»£å…ˆé‹’', localName:'å°ç£ç†±æƒ…å¤§ä½¿', description:'ä½ æ˜¯å°ç£çš„äººæ°£ç‹ï¼Œç”¨ç†±æƒ…æ„ŸæŸ“èº«é‚Šçš„æ¯ä¸€å€‹äººï¼'},
    female: {name:'ç†±æƒ…é³³å‡°å¥³ä¿ ', ability:'ğŸ¦¸â€â™€ï¸ è¶…èƒ½åŠ›ï¼šæƒ…æ„Ÿå…±é³´ + æºé€šè—è¡“ + æº«æš–ç™‚ç™’', mission:'ğŸ¯ å°ˆå±¬ä»»å‹™ï¼šæƒ…æ„Ÿæ”¯æŒè€…ã€åœ˜éšŠå‡èšè€…ã€å¿ƒéˆç™‚ç™’å¸«', localName:'å°ç£æš–å¿ƒå¤©ä½¿', description:'ä½ æ˜¯å°ç£çš„æš–å¿ƒå¤©ä½¿ï¼Œç”¨çœŸèª èˆ‡æº«æš–ç…§äº®ä»–äººï¼'},
    analysis: {
      male: {
        personality: 'æœ±é›€å‹äººæ ¼çš„ä½ ï¼Œç”Ÿä¾†å°±æ˜¯èˆå°çš„ç„¦é»ï¼Œäººç¾¤ä¸­çš„ç™¼å…‰é«”ã€‚ä½ çš„å…§å¿ƒç‡ƒç‡’è‘—ä¸€åœ˜ç†±æƒ…çš„ç«ç„°ï¼Œé€™è‚¡èƒ½é‡é€éä½ çš„è¨€è«‡ã€èˆ‰æ­¢è‡ªç„¶è€Œç„¶åœ°æ•£ç™¼å‡ºä¾†ï¼Œæº«æš–ä¸¦æ„ŸæŸ“è‘—èº«é‚Šçš„æ¯ä¸€å€‹äººã€‚ä½ äº«å—èˆ‡äººäº’å‹•ï¼Œæ¸´æœ›è¢«çœ‹è¦‹ã€è¢«è½è¦‹ï¼Œä¸¦å¾ä¸­ç²å¾—èƒ½é‡ã€‚å°ä½ ä¾†èªªï¼Œç”Ÿå‘½æ˜¯ä¸€å ´ç››å¤§çš„æ´¾å°ï¼Œè€Œä½ å°±æ˜¯é‚£å€‹é‚€è«‹å¤§å®¶å…±èˆçš„æ ¸å¿ƒäººç‰©ã€‚',
        strengths: 'ä½ èˆ‡ç”Ÿä¿±ä¾†çš„ã€Œæºé€šé­…åŠ›ã€å’Œã€Œè¶…å‡¡æ„ŸæŸ“åŠ›ã€æ˜¯ä½ æœ€å¼·å¤§çš„æ­¦å™¨ã€‚ä½ å–„æ–¼ç”¨ç”Ÿå‹•çš„èªè¨€ã€çœŸèª çš„æƒ…æ„Ÿå»æ‰“å‹•äººå¿ƒï¼Œèƒ½è¼•æ˜“åœ°åŒ–è§£å°·å°¬ã€å‡èšå…±è­˜ã€‚åœ¨åœ˜éšŠä¸­ï¼Œä½ å°±åƒä¸€é¡†å°å¤ªé™½ï¼Œèƒ½é©…æ•£ä½è¿·çš„æ°£æ°›ï¼Œæ¿€ç™¼å¤¥ä¼´çš„é¬¥å¿—èˆ‡æ½›èƒ½ã€‚å»ºç«‹äººéš›ç¶²çµ¡å°ä½ ä¾†èªªæ˜“å¦‚åæŒï¼Œäººå€‘æœƒä¸è‡ªè¦ºåœ°è¢«ä½ çš„ç†±æƒ…èˆ‡çœŸèª æ‰€å¸å¼•ã€‚',
        career: 'ä½ çš„å¤©è³¦åœ¨æ–¼æ‰€æœ‰éœ€è¦èˆ‡ã€Œäººã€æ‰“äº¤é“çš„å·¥ä½œã€‚å…¬é—œã€å¸‚å ´è¡ŒéŠ·ã€éŠ·å”®ã€æ•™è‚²åŸ¹è¨“ã€ä¸»æŒäººã€äººåŠ›è³‡æºç­‰é ˜åŸŸéƒ½æ˜¯ä½ èƒ½å¤§æ”¾ç•°å½©çš„èˆå°ã€‚ä½ éœ€è¦ä¸€ä»½èƒ½è®“ä½ å……åˆ†è¡¨é”è‡ªæˆ‘ã€èˆ‡ä»–äººå»ºç«‹é€£çµçš„å·¥ä½œã€‚ä¸€å€‹å……æ»¿äº’å‹•ã€æ°£æ°›æ´»èºçš„å·¥ä½œç’°å¢ƒï¼Œé æ¯”ä¸€ä»½è–ªæ°´å„ªæ¸¥ä½†æ¯ç‡¥ä¹å‘³çš„å·¥ä½œæ›´èƒ½è®“ä½ ç²å¾—æˆå°±æ„Ÿã€‚',
        relationships: 'åœ¨æ„Ÿæƒ…ä¸­ï¼Œä½ æ˜¯ä¸€å€‹éœ€è¦å¤§é‡æƒ…æ„Ÿäº¤æµèˆ‡è‚¯å®šçš„æµªæ¼«ä¸»ç¾©è€…ã€‚ç”œè¨€èœœèªã€æº«æš–çš„æ“æŠ±ã€çœŸèª çš„è®šç¾å°ä½ è€Œè¨€å¦‚åŒç©ºæ°£èˆ¬é‡è¦ã€‚ä½ æ“…é•·è£½é€ æµªæ¼«èˆ‡é©šå–œï¼Œä¹ŸåŒæ¨£æ¸´æœ›å°æ–¹èƒ½çµ¦äºˆç†±æƒ…çš„å›æ‡‰ã€‚å°‹æ‰¾ä¸€ä½åŒæ¨£é‡è¦–æƒ…æ„Ÿè¡¨é”ã€é¡˜æ„èˆ‡ä½ åˆ†äº«ç”Ÿæ´»é»æ»´çš„ä¼´ä¾¶è‡³é—œé‡è¦ã€‚ä½ éœ€è¦çš„æ˜¯éˆé­‚çš„å…±èˆï¼Œè€Œéæ²‰é»˜çš„é™ªä¼´ã€‚',
        growth: 'ä½ çš„æˆé•·èª²é¡Œæ˜¯å­¸ç¿’ã€Œç®¡ç†æƒ…ç·’ã€èˆ‡ã€Œå°‹æ±‚å…§åœ¨å¹³éœã€ã€‚é«˜åº¦çš„æƒ…æ„Ÿæ•æ„Ÿæ€§æ˜¯ä¸€æŠŠé›™é¢åˆƒï¼Œå®ƒè®“ä½ å……æ»¿é­…åŠ›çš„åŒæ™‚ï¼Œä¹Ÿå¯èƒ½è®“ä½ å› å¤–ç•Œçš„è©•åƒ¹è€Œæƒ…ç·’èµ·ä¼ã€‚ä½ éœ€è¦å­¸ç¿’åœ¨ç†±æƒ…å¥”æ”¾ä¹‹é¤˜ï¼Œä¿ç•™ä¸€å€‹ç¨è™•çš„ç©ºé–“ï¼Œå‚¾è½å…§å¿ƒçš„è²éŸ³ï¼Œé¿å…å°‡è‡ªæˆ‘åƒ¹å€¼å®Œå…¨å»ºç«‹åœ¨ä»–äººçš„èªå¯ä¹‹ä¸Šã€‚å­¸æœƒåˆ†è¾¨å“ªäº›æ˜¯è‡ªå·±çš„æƒ…ç·’ï¼Œå“ªäº›æ˜¯å—ä»–äººçš„å½±éŸ¿ã€‚',
        money: 'å¾é‡‘éŒ¢å¦ä¾†çœ‹ï¼Œä½ çš„è²¡å¯Œå¾€å¾€èˆ‡ä½ çš„ã€Œäººè„ˆã€å’Œã€Œè²æœ›ã€ç·Šå¯†ç›¸é€£ã€‚é€éå»ºç«‹è‰¯å¥½çš„åˆä½œé—œä¿‚ã€åˆ©ç”¨ä½ çš„å£æ‰èˆ‡æºé€šèƒ½åŠ›ï¼Œå¾€å¾€èƒ½ç‚ºä½ å¸¶ä¾†æ„æƒ³ä¸åˆ°çš„è²¡å¯Œæ©Ÿæœƒã€‚æŠ•è³‡è‡ªå·±ï¼Œä¾‹å¦‚æå‡æ¼”èªªæŠ€å·§ã€æ‹“å±•ç¤¾äº¤åœˆï¼Œæœƒæ˜¯å›å ±ç‡æœ€é«˜çš„æ–¹å¼ã€‚ç†è²¡ä¸Šï¼Œä½ éœ€è¦é¿å…å› ä¸€æ™‚çš„æƒ…ç·’æˆ–æœ‹å‹æ¨è–¦è€Œåšå‡ºè¡å‹•çš„æŠ•è³‡æ±ºå®šï¼Œå°‹æ±‚å°ˆæ¥­å»ºè­°èƒ½å¹«åŠ©ä½ æ›´ç©©å¥åœ°ç´¯ç©è²¡å¯Œã€‚'
      },
      female: {
        personality: 'æœ±é›€å‹äººæ ¼çš„ä½ ï¼Œæ“æœ‰æº«æš–çš„å¿ƒéˆèˆ‡æ•éŠ³çš„æƒ…æ„Ÿé›·é”ã€‚ä½ å¤©ç”Ÿå°±èƒ½æ„ŸçŸ¥ä»–äººçš„æƒ…ç·’ï¼Œä¸¦ç”¨çœŸèª çš„é—œæ‡·å»æº«æš–æ¯ä¸€é¡†å¿ƒã€‚ä½ çš„å­˜åœ¨å°±åƒå†¬æ—¥è£¡çš„æš–é™½ï¼Œèƒ½é©…æ•£é™°éœ¾ï¼Œå¸¶ä¾†å¸Œæœ›ã€‚ä½ äº«å—èˆ‡äººå»ºç«‹æ·±å±¤çš„é€£çµï¼Œå¾çœŸèª çš„äº¤æµä¸­ç²å¾—èƒ½é‡ã€‚å°ä½ ä¾†èªªï¼Œç”Ÿå‘½æ˜¯ä¸€å ´æ„›çš„æ—…ç¨‹ï¼Œè€Œä½ å°±æ˜¯é‚£å€‹å‚³éæº«æš–èˆ‡å¸Œæœ›çš„ä½¿è€…ã€‚',
        strengths: 'ä½ æœ€å¤§çš„å„ªå‹¢åœ¨æ–¼ã€Œæƒ…æ„Ÿå…±é³´èƒ½åŠ›ã€èˆ‡ã€Œæº«æš–ç™‚ç™’åŠ›ã€ã€‚ä½ èƒ½å¤ æ·±å…¥ç†è§£ä»–äººçš„æ„Ÿå—ï¼Œä¸¦ç”¨æ°åˆ°å¥½è™•çš„æ–¹å¼çµ¦äºˆæ”¯æŒèˆ‡é¼“å‹µã€‚åœ¨åœ˜éšŠä¸­ï¼Œä½ æ˜¯æƒ…æ„Ÿçš„é»åˆåŠ‘ï¼Œèƒ½å¤ åŒ–è§£è¡çªã€å‡èšå…±è­˜ã€‚ä½ çš„çœŸèª èˆ‡é—œæ‡·ï¼Œè®“äººå€‘é¡˜æ„å‘ä½ æ•é–‹å¿ƒæ‰‰ï¼Œä½ æ˜¯åœ˜éšŠä¸­ä¸å¯æˆ–ç¼ºçš„å¿ƒéˆæ”¯æŸ±ã€‚',
        career: 'ä½ çš„å¤©è³¦åœ¨æ–¼æ‰€æœ‰éœ€è¦é—œæ‡·ã€æ”¯æŒèˆ‡æºé€šçš„é ˜åŸŸã€‚å¿ƒç†è«®å•†ã€æ•™è‚²ã€è­·ç†ã€äººåŠ›è³‡æºã€å®¢æˆ¶æœå‹™ç­‰è¡Œæ¥­éƒ½éå¸¸é©åˆä½ ã€‚ä½ éœ€è¦ä¸€ä»½èƒ½å¤ è®“ä½ ç™¼æ®åŒç†å¿ƒã€å¹«åŠ©ä»–äººæˆé•·çš„å·¥ä½œã€‚ä¸€å€‹å……æ»¿äººæ€§é—œæ‡·ã€é‡è¦–åœ˜éšŠåˆä½œçš„å·¥ä½œç’°å¢ƒï¼Œæœ€èƒ½è®“ä½ æ„Ÿåˆ°æ»¿è¶³èˆ‡æˆå°±æ„Ÿã€‚',
        relationships: 'åœ¨æ„Ÿæƒ…ä¸­ï¼Œä½ æ˜¯ä¸€å€‹ç´°è†©è€Œæ·±æƒ…çš„ä¼´ä¾¶ã€‚ä½ é‡è¦–æƒ…æ„Ÿçš„æ·±åº¦èˆ‡å“è³ªï¼Œæ¸´æœ›å»ºç«‹ç©©å®šè€Œè¦ªå¯†çš„é—œä¿‚ã€‚å°ä½ è€Œè¨€ï¼Œæœ€ç¾å¥½çš„æ„›æƒ…æ˜¯å…©å€‹éˆé­‚çš„ç›¸äº’ç†è§£èˆ‡æ”¯æŒã€‚ä½ éœ€è¦ä¸€å€‹èƒ½å¤ çæƒœä½ çš„æº«æŸ”ã€ä¸¦é¡˜æ„èˆ‡ä½ å…±åŒç¶“ç‡Ÿè¦ªå¯†é—œä¿‚çš„ä¼´ä¾¶ã€‚åŒæ™‚ï¼Œä¹Ÿè¦å­¸ç¿’åœ¨ä»˜å‡ºé—œæ„›çš„åŒæ™‚ï¼Œç…§é¡§å¥½è‡ªå·±çš„æƒ…æ„Ÿéœ€æ±‚ã€‚',
        growth: 'ä½ çš„æˆé•·èª²é¡Œæ˜¯ã€Œå»ºç«‹å¥åº·çš„æƒ…æ„Ÿé‚Šç•Œã€ã€‚å› ç‚ºä½ å¤ªå®¹æ˜“æ„ŸçŸ¥ä¸¦æ‰¿æ¥ä»–äººçš„æƒ…ç·’ï¼Œæœ‰æ™‚æœƒæ„Ÿåˆ°å¿ƒåŠ›äº¤ç˜ã€‚å­¸ç¿’å€åˆ†å“ªäº›æ˜¯åˆ¥äººçš„æƒ…ç·’ï¼Œå“ªäº›æ˜¯è‡ªå·±çš„æ„Ÿå—ï¼Œä¸¦å­¸æœƒåœ¨å¿…è¦æ™‚èªªã€Œä¸ã€ã€‚åŸ¹é¤Šç¨è™•çš„èƒ½åŠ›ï¼Œæ‰¾åˆ°å±¬æ–¼è‡ªå·±çš„å……é›»æ–¹å¼ï¼Œèƒ½å¤ å¹«åŠ©ä½ ä¿æŒèƒ½é‡çš„å¹³è¡¡ï¼Œé¿å…æƒ…æ„Ÿé€æ”¯ã€‚',
        money: 'é‡‘éŒ¢å¦è±¡é¡¯ç¤ºï¼Œä½ çš„è²¡å¯Œä¹‹é“åœ¨æ–¼ã€Œé—œä¿‚ç¶“æ¿Ÿã€èˆ‡ã€Œå¿ƒéˆç”¢æ¥­ã€ã€‚ä½ å°äººéš›é—œä¿‚çš„æ•æ„Ÿåº¦ï¼Œèƒ½å¤ å¹«åŠ©ä½ åœ¨éœ€è¦å»ºç«‹ä¿¡ä»»èˆ‡é€£çµçš„é ˜åŸŸæ‰¾åˆ°å•†æ©Ÿã€‚é©åˆå¾äº‹æ•™è‚²ã€è«®è©¢ã€ç™‚ç™’ç­‰èƒ½å¤ ç™¼æ®ä½ é—œæ‡·ç‰¹è³ªçš„å·¥ä½œã€‚ç†è²¡ä¸Šï¼Œä½ éœ€è¦é¿å…å› æƒ…æ„Ÿå› ç´ è€Œåšå‡ºä¸ç†æ€§çš„æ¶ˆè²»æˆ–æŠ•è³‡æ±ºå®šï¼Œå»ºç«‹æ¸…æ™°çš„è²¡å‹™è¦åŠƒèƒ½å¤ å¹«åŠ©ä½ æ›´ç©©å¥åœ°ç®¡ç†è²¡å¯Œã€‚'
      }
    }
  }
  // å…¶ä»–ç¥ç¸çš„è³‡æ–™çµæ§‹é¡ä¼¼ï¼Œå› ç¯‡å¹…é™åˆ¶é€™è£¡åªå±•ç¤ºå…©ç¨®
};

// ========== ç¥ç¸è¶…äººé¡¯ç¤ºåŠŸèƒ½ (å·²åŠ å…¥æ€§åˆ¥åˆ¤æ–·) ==========
function showSuperhero(beastType) {
    const gender = document.querySelector('input[name="gender"]:checked').value;
    const beastData = superheroData[beastType];
    
    if (beastData) {
        const genderData = beastData[gender] || beastData.male; // é è¨­ç‚ºç”·æ€§è³‡æ–™
        const superheroDisplay = document.getElementById("superhero-display");
        const superheroName = document.getElementById("superhero-name");
        const superheroAbility = document.getElementById("superhero-ability");
        const superheroMission = document.getElementById("superhero-mission");
        const superheroLocal = document.getElementById("superhero-local");
        
        superheroName.textContent = `${genderData.name}`;
        superheroAbility.textContent = genderData.ability;
        superheroMission.textContent = genderData.mission;
        superheroLocal.textContent = `ğŸ® å°ç£åœ¨åœ°ç‰ˆï¼š${genderData.localName} - ${genderData.description}`;
        document.getElementById("superheroReport").style.display = "block";
    }
}

// ========== AIåˆ†æå¡«å……åŠŸèƒ½ (å·²åŠ å…¥æ€§åˆ¥åˆ¤æ–·) ==========
function fillAIAnalysis(beastType) {
    const gender = document.querySelector('input[name="gender"]:checked').value;
    const beastData = superheroData[beastType];
    
    if (beastData && beastData.analysis) {
        const genderAnalysis = beastData.analysis[gender] || beastData.analysis.male; // é è¨­ç‚ºç”·æ€§åˆ†æ
        
        document.getElementById("ai-personality").textContent = genderAnalysis.personality;
        document.getElementById("ai-strengths").textContent = genderAnalysis.strengths;
        document.getElementById("ai-career").textContent = genderAnalysis.career;
        document.getElementById("ai-relationships").textContent = genderAnalysis.relationships;
        document.getElementById("ai-growth").textContent = genderAnalysis.growth;
        document.getElementById("ai-money").textContent = genderAnalysis.money;
    }
}

// ========== ä»¥ä¸‹ç‚ºå…¶é¤˜ä¸è®Šçš„ JavaScript ç¨‹å¼ç¢¼ ==========
function simulateProgress(){
    const progressBar = document.getElementById("progress-bar");
    const loadingStep = document.getElementById("loading-step");
    const steps = [
        {percent: 20, text: "åˆ†æäººæ ¼ç‰¹è³ª..."},
        {percent: 40, text: "è§£æèƒ½é‡åˆ†å¸ƒ..."},
        {percent: 60, text: "ç”Ÿæˆç™¼å±•å»ºè­°..."},
        {percent: 80, text: "è¨ˆç®—äº”è¡Œé‡‘éŒ¢å¦..."},
        {percent: 95, text: "æœ€çµ‚æ•´åˆå ±å‘Š..."},
        {percent: 100, text: "åˆ†æå®Œæˆï¼"}
    ];
    let currentStep = 0;
    
    const interval = setInterval(() => {
        if (currentStep < steps.length) {
            progressBar.style.width = steps[currentStep].percent + "%";
            loadingStep.textContent = steps[currentStep].text;
            currentStep++;
        } else {
            clearInterval(interval);
        }
    }, 800);
}

function parseAIResponse(response, beastType) {
    document.getElementById("ai-loading").style.display = "none";
    try {
        if (response.includes("ğŸ­") && response.includes("âš¡") && response.includes("ğŸ’°")) {
            const personalityMatch = response.match(/ğŸ­[^âš¡]+/);
            const strengthsMatch = response.match(/âš¡[^ğŸ“ˆ]+/);
            const growthMatch = response.match(/ğŸ“ˆ[^ğŸ’°]+/);
            const moneyMatch = response.match(/ğŸ’°.+/);
            
            if (personalityMatch) {
                document.getElementById("ai-personality").textContent = personalityMatch[0].replace("ğŸ­", "").trim();
            }
            if (strengthsMatch) {
                document.getElementById("ai-strengths").textContent = strengthsMatch[0].replace("âš¡", "").trim();
            }
            if (moneyMatch) {
                document.getElementById("ai-money").textContent = moneyMatch[0].replace("ğŸ’°", "").trim();
            }
            if (growthMatch) {
                const growthText = growthMatch[0].replace("ğŸ“ˆ", "").trim();
                document.getElementById("ai-career").textContent = growthText;
                document.getElementById("ai-relationships").textContent = growthText;
                document.getElementById("ai-growth").textContent = growthText;
            }
        } else {
            fillAIAnalysis(beastType);
        }
    } catch (error) {
        console.error("AIå›æ‡‰è§£æå¤±æ•—:", error);
        fillAIAnalysis(beastType);
    }
}

const BANK = [
    {t: "æˆ‘å¸¸æœ‰çªå¦‚å…¶ä¾†çš„éˆæ„Ÿä¸¦æƒ³ç«‹å³å˜—è©¦ã€‚", b: "é’é¾"},
    {t: "æˆ‘å–œæ­¡æ‰“ç ´å¸¸è¦å°‹æ‰¾æ–°æ–¹æ³•ã€‚", b: "é’é¾"},
    {t: "é‡é˜»åŠ›æ™‚æˆ‘æœƒéˆæ´»è½‰å‘ã€‚", b: "é’é¾"},
    {t: "æˆ‘å¯Œæƒ³åƒåŠ›ï¼Œå–œæ­¡å‰µæ–°æ€è€ƒã€‚", b: "é’é¾"},
    {t: "æˆ‘ç†±æ„›æ¢ç´¢æœªçŸ¥äº‹ç‰©ã€‚", b: "é’é¾"},
    {t: "æˆ‘å–œæ­¡åœ¨äººç¾¤ä¸­è¡¨é”è‡ªå·±ã€‚", b: "æœ±é›€"},
    {t: "æˆ‘ç”¨æƒ…ç·’å¸¶å‹•ä»–äººã€‚", b: "æœ±é›€"},
    {t: "åˆ¥äººçš„åæ‡‰æœƒå½±éŸ¿æˆ‘ã€‚", b: "æœ±é›€"},
    {t: "æˆ‘æ“…é•·èªªæœèˆ‡æ¼”èªªã€‚", b: "æœ±é›€"},
    {t: "æˆ‘é‡è¦–è¢«å‚¾è½èˆ‡é—œæ³¨ã€‚", b: "æœ±é›€"},
    {t: "æˆ‘å–œæ­¡æŒ‰è¨ˆç•«è¡Œäº‹ã€‚", b: "å‹¾é™³"},
    {t: "æˆ‘é‡è¦–å®‰å…¨æ„Ÿèˆ‡ç©©å®šã€‚", b: "å‹¾é™³"},
    {t: "æˆ‘è²¬ä»»æ„Ÿå¼·ã€‚", b: "å‹¾é™³"},
    {t: "æˆ‘å‚¾å‘ç¶­æŒç¾ç‹€ã€‚", b: "å‹¾é™³"},
    {t: "æˆ‘æ³¨é‡ç´°ç¯€èˆ‡ç¨‹åºã€‚", b: "å‹¾é™³"},
    {t: "æˆ‘å°ä»–äººæƒ…ç·’å¾ˆæ•æ„Ÿã€‚", b: "è£è›‡"},
    {t: "æˆ‘æ“…é•·è§€å¯Ÿèˆ‡å‚¾è½ã€‚", b: "è£è›‡"},
    {t: "æˆ‘å¸¸æ€è€ƒèƒŒå¾Œçš„å‹•æ©Ÿã€‚", b: "è£è›‡"},
    {t: "æˆ‘æ€è€ƒäº‹æƒ…æœƒè€ƒé‡æ™‚æ©Ÿèˆ‡äººå¿ƒã€‚", b: "è£è›‡"},
    {t: "æˆ‘å–„æ–¼å”èª¿ä¸åŒè§€é»ã€‚", b: "è£è›‡"},
    {t: "æˆ‘è¬›æ±‚æ•ˆç‡èˆ‡çµæœã€‚", b: "ç™½è™"},
    {t: "æˆ‘æœƒä¸»å‹•åšæ±ºç­–ã€‚", b: "ç™½è™"},
    {t: "æˆ‘ä»¥æ•¸æ“šèˆ‡æˆæœç‚ºå°å‘ã€‚", b: "ç™½è™"},
    {t: "æˆ‘é¡˜æ„æ‰¿æ“”å£“åŠ›ä»¥å®Œæˆä»»å‹™ã€‚", b: "ç™½è™"},
    {t: "æˆ‘åå¥½æ˜ç¢ºçš„è¦ç¯„èˆ‡æ¨™æº–ã€‚", b: "ç™½è™"},
    {t: "æˆ‘å–œæ­¡ç¨è‡ªæ€è€ƒã€‚", b: "ç„æ­¦"},
    {t: "æˆ‘å‚¾å‘è¬¹æ…è©•ä¼°å¾Œè¡Œå‹•ã€‚", b: "ç„æ­¦"},
    {t: "æˆ‘æ“…é•·è¦åŠƒé•·é ç›®æ¨™ã€‚", b: "ç„æ­¦"},
    {t: "æˆ‘é‡è¦–é‚è¼¯èˆ‡åˆ†æã€‚", b: "ç„æ­¦"},
    {t: "æˆ‘ç¿’æ…£å†·éœçœ‹å¾…å•é¡Œã€‚", b: "ç„æ­¦"}
];

BANK.sort(() => 0.5 - Math.random());

const qWrap = document.getElementById("qWrap");
BANK.forEach((q, i) => {
    qWrap.innerHTML += `<li><p>${i+1}. ${q.t}</p><input type='range' min='1' max='5' value='3' id='q${i}' class='w-full slider'></li>`;
});

qWrap.innerHTML += '<div id="progress" class="text-right text-sm">0/30</div>';

document.querySelectorAll('input[type="range"]').forEach(slider => {
    slider.onchange = () => {
        const answered = Array.from(document.querySelectorAll('input[type="range"]')).filter(s => s.value !== "3").length;
        document.getElementById("progress").textContent = `${answered}/30`;
    };
});

function beastSVG(beast) {
    const color = "#B6822B";
    const fill = "none";
    const path = d => `<path d='${d}' fill='${fill}' stroke='${color}' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>`;
    const wrap = content => `<svg viewBox='0 0 100 100' class='w-full h-auto' xmlns='http://www.w3.org/2000/svg'>
    <defs><radialGradient id='g' cx='50%' cy='50%' r='60%'>
      <stop offset='0%' stop-color='rgba(182,130,43,0.25)'/><stop offset='100%' stop-color='rgba(182,130,43,0)'/>
    </radialGradient></defs><rect width='100' height='100' fill='url(#g)'/>${content}</svg>`;
    
    switch(beast) {
        case "é’é¾": return wrap(
            path("M15 60 C25 40, 45 35, 55 45 C65 55, 75 35, 85 45 M45 45 q5 -12 16 -10 m-6 6 l6 4 m-36 20 q10 -6 18 2 m12 -2 q8 -6 18 2") +
            path("M30 70 q10 8 20 0 q10 -8 20 0")
        );
        case "æœ±é›€": return wrap(
            path("M20 60 q15 -30 30 -30 q15 0 30 30 M50 30 l0 12 M35 55 q15 -8 30 0 M25 62 q10 8 25 8 q15 0 25 -8")
        );
        case "å‹¾é™³": return wrap(
            path("M20 70 h60 v-20 h-60 v20 z M30 50 v-10 h40 v10 M35 65 h10 M55 65 h10")
        );
        case "è£è›‡": return wrap(
            path("M20 70 q20 -30 40 -10 q10 8 20 -2 q-10 20 -30 10 q-10 -6 -30 2 M60 48 q6 -6 12 0")
        );
        case "ç™½è™": return wrap(
            path("M20 65 q15 -20 30 -20 q15 0 30 20 M30 60 h40 M35 70 h30 M38 52 l4 6 M58 52 l-4 6")
        );
        case "ç„æ­¦": return wrap(
            path("M30 65 q20 15 40 0 q5 -12 -15 -22 q-20 10 -25 22 M55 50 q10 -8 20 2 M25 55 q-8 -6 -10 6")
        );
        default: return wrap("");
    }
}

function generateAdvice(mainBeast, secondaryBeast, scores, variant) {
    const adviceBank = {
        é’é¾: {
            è·å ´: ["å‰µæ–°é ˜é ­ï¼Œå‹‡æ–¼å˜—è©¦æ–°æ–¹æ³•","å¸¶é ˜åœ˜éšŠçªç ´å‚³çµ±æ¡†æ¶","é–‹æ‹“æ–°å¸‚å ´æˆ–æ¥­å‹™é ˜åŸŸ","å°‡å‰µæ„è½‰åŒ–ç‚ºå¯¦éš›è¡Œå‹•"],
            æ„Ÿæƒ…: ["ä¿æŒé—œä¿‚ä¸­çš„æ–°é®®æ„Ÿ","å…±åŒæ¢ç´¢æ–°é«”é©—","é–‹æ”¾æºé€šå‰µæ–°æƒ³æ³•","å¹³è¡¡å†’éšªèˆ‡ç©©å®šéœ€æ±‚"],
            é¤Šç”Ÿ: ["æˆ¶å¤–é‹å‹•é‡‹æ”¾èƒ½é‡","å˜—è©¦æ–°çš„é‹å‹•æ–¹å¼","ä¿æŒç”Ÿæ´»å¤šæ¨£æ€§","é©ç•¶å†’éšªæŒ‘æˆ°è‡ªæˆ‘"]
        },
        æœ±é›€: {
            è·å ´: ["ç™¼æ®è¡¨é”èˆ‡æºé€šå„ªå‹¢","æ¿€å‹µåœ˜éšŠå£«æ°£","å»ºç«‹å»£æ³›äººéš›ç¶²çµ¡","å±•ç¾ç†±æƒ…èˆ‡æ„ŸæŸ“åŠ›"],
            æ„Ÿæƒ…: ["çœŸèª è¡¨é”æƒ…æ„Ÿéœ€æ±‚","å‰µé€ æµªæ¼«é©šå–œæ™‚åˆ»","ä¿æŒé—œä¿‚ä¸­çš„ç†±æƒ…","é©åº¦åˆ†äº«å…§å¿ƒæ„Ÿå—"],
            é¤Šç”Ÿ: ["è—è¡“å‰µä½œæŠ’ç™¼æƒ…æ„Ÿ","ç¤¾äº¤æ´»å‹•ä¿æŒæ´»åŠ›","è¡¨é”æ€§é‹å‹•å¦‚èˆè¹ˆ","æ³¨æ„æƒ…ç·’æ³¢å‹•ç®¡ç†"]
        },
        å‹¾é™³: {
            è·å ´: ["å»ºç«‹ç©©å®šå·¥ä½œæµç¨‹","ç¢ºä¿ä»»å‹™æŒ‰æ™‚å®Œæˆ","æ³¨é‡ç´°ç¯€èˆ‡å“è³ª","æä¾›å¯é æ”¯æŒ"],
            æ„Ÿæƒ…: ["å»ºç«‹ä¿¡ä»»èˆ‡å®‰å…¨æ„Ÿ","ä¿æŒæ‰¿è«¾èˆ‡ä¸€è‡´æ€§","ç©©å®šè¡¨é”é—œå¿ƒ","ç‡Ÿé€ æº«é¦¨å®¶åº­æ°›åœ"],
            é¤Šç”Ÿ: ["è¦å¾‹ä½œæ¯ä¿æŒå¹³è¡¡","å‡è¡¡é£²é£Ÿèˆ‡é‹å‹•","å»ºç«‹å¥åº·ç”Ÿæ´»ç¿’æ…£","æ³¨é‡å¯¦éš›é¤Šç”Ÿæ–¹æ³•"]
        },
        è£è›‡: {
            è·å ´: ["ç™¼æ®æ´å¯Ÿèˆ‡å”èª¿èƒ½åŠ›","ç†è§£åœ˜éšŠæˆå“¡éœ€æ±‚","å¦¥å–„è™•ç†äººéš›é—œä¿‚","æŠŠæ¡æ™‚æ©Ÿæ¡å–è¡Œå‹•"],
            æ„Ÿæƒ…: ["æ·±å…¥ç†è§£ä¼´ä¾¶æ„Ÿå—","æ•æ„Ÿé«”è²¼å°æ–¹éœ€æ±‚","å»ºç«‹æ·±åº¦æƒ…æ„Ÿé€£çµ","é©æ™‚è¡¨é”æ”¯æŒ"],
            é¤Šç”Ÿ: ["å†¥æƒ³èˆ‡å…§çœç·´ç¿’","æƒ…ç·’ç®¡ç†èˆ‡é‡‹æ”¾","æº«å’Œèª¿ç†èº«å¿ƒ","æ³¨é‡å¿ƒç†å¹³è¡¡"]
        },
        ç™½è™: {
            è·å ´: ["æœæ–·æ±ºç­–è¿½æ±‚æ•ˆç‡","è¨­å®šæ˜ç¢ºç›®æ¨™","æ‰¿æ“”é ˜å°è²¬ä»»","æ³¨é‡æˆæœèˆ‡ç¸¾æ•ˆ"],
            æ„Ÿæƒ…: ["ç›´æ¥è¡¨é”æ„›èˆ‡æ‰¿è«¾","ä¿è­·èˆ‡æ”¯æŒä¼´ä¾¶","æ˜ç¢ºé—œä¿‚ç•Œç·š","å±•ç¾å …å®šèˆ‡å¿ èª "],
            é¤Šç”Ÿ: ["é«˜å¼·åº¦é‹å‹•é‡‹å£“","æŒ‘æˆ°é«”èƒ½æ¥µé™","åŸ¹é¤Šç´€å¾‹æ€§","æ³¨æ„å£“åŠ›ç®¡ç†"]
        },
        ç„æ­¦: {
            è·å ´: ["ç­–ç•¥è¦åŠƒé•·é ç™¼å±•","æ·±å…¥åˆ†æå•é¡Œæœ¬è³ª","ç¨ç«‹æ€è€ƒèˆ‡åˆ¤æ–·","ä¿æŒç†æ€§èˆ‡å®¢è§€"],
            æ„Ÿæƒ…: ["æ·±åº¦äº¤æµæ€æƒ³","ç†æ€§åˆ†æé—œä¿‚","ä¿æŒå€‹äººç©ºé–“","å»ºç«‹æ™ºæ…§é€£çµ"],
            é¤Šç”Ÿ: ["éœåèˆ‡é–±è®€","æ·±åº¦æ€è€ƒèˆ‡åæ€","ç¨ç«‹é‹å‹•å¦‚æ¸¸æ³³","æ³¨é‡ç²¾ç¥é¤Šç”Ÿ"]
        }
    };
    
    const level = score => score >= 20 ? 0 : score >= 15 ? 1 : score >= 10 ? 2 : 3;
    const mainScore = scores[mainBeast];
    const secondaryScore = secondaryBeast ? scores[secondaryBeast] : 0;
    const mainLevel = level(mainScore);
    const secondaryLevel = level(secondaryScore);
    
    const pickAdvice = (category) => {
        const mainAdvice = adviceBank[mainBeast][category];
        const secondaryAdvice = secondaryBeast ? adviceBank[secondaryBeast][category] : [];
        let advice = [];
        
        // ä¸»å‹å»ºè­°
        if (mainAdvice && mainAdvice[mainLevel]) {
            advice.push(mainAdvice[mainLevel] + "ã€‚");
        }
        
        // æ¬¡å‹å»ºè­°ï¼ˆå¦‚æœæ¬¡å‹åˆ†æ•¸å¤ é«˜ï¼‰
        if (secondaryBeast && secondaryScore >= 10 && secondaryAdvice && secondaryAdvice[secondaryLevel]) {
            advice.push(secondaryAdvice[secondaryLevel] + "ã€‚");
        }
        
        // å¦‚æœå»ºè­°å¤ªå°‘ï¼Œéš¨æ©Ÿè£œå……
        while (advice.length < 2) {
            const randomIndex = Math.floor(Math.random() * mainAdvice.length);
            if (!advice.includes(mainAdvice[randomIndex] + "ã€‚")) {
                advice.push(mainAdvice[randomIndex] + "ã€‚");
            }
        }
        
        return advice;
    };
    
    return {
        è·å ´: pickAdvice("è·å ´"),
        æ„Ÿæƒ…: pickAdvice("æ„Ÿæƒ…"),
        é¤Šç”Ÿ: pickAdvice("é¤Šç”Ÿ")
    };
}

function summarize(scores) {
    const entries = Object.entries(scores).sort((a, b) => b[1] - a[1]);
    const top = entries[0];
    const secondary = entries[1];
    const dual = top[1] - secondary[1] <= 2 ? [top[0], secondary[0]] : null;
    
    const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
    const variantIndex = total % 12;
    const variants = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
    
    return {
        top: top[0],
        dual: dual,
        ranking: entries,
        variant: variants[variantIndex],
        total: total,
        scores: scores
    };
}

let radarChart = null;

function renderRadar(scores) {
    const canvas = document.getElementById("radar");
    if (radarChart) {
        radarChart.destroy();
    }
    
    radarChart = new Chart(canvas, {
        type: "radar",
        data: {
            labels: Object.keys(scores),
            datasets: [{
                label: "å…­ç¸èƒ½é‡",
                data: Object.values(scores),
                backgroundColor: "rgba(182,130,43,0.15)",
                borderColor: "#b6822b"
            }]
        },
        options: {
            scales: {
                r: {
                    suggestedMin: 0,
                    suggestedMax: 25,
                    ticks: {
                        stepSize: 5
                    }
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            },
            maintainAspectRatio: true
        }
    });
}

function renderReport(summary, scores) {
    document.getElementById("beastSVG").innerHTML = beastSVG(summary.top);
    
    const typeName = `${summary.top}${summary.variant}å‹`;
    document.getElementById("mainBeastTitle").textContent = summary.dual ? 
        `é›™ç¸${summary.variant}å‹ï¼š${summary.top} Ã— ${summary.dual[1]}` : 
        `ä¸»${summary.variant}å‹ï¼š${summary.top}`;
    
    document.getElementById("dualHint").textContent = summary.dual ? 
        `ç¬¬äºŒä¸»å°èƒ½é‡ï¼š${summary.dual[1]}` : "";
    
    document.getElementById("mainBeastSummary").textContent = 
        `ä½ çš„ä¸»å‹ç‚º ${typeName}ï¼Œèåˆ${summary.top}èƒ½é‡èˆ‡${summary.variant}åœ°æ”¯ç‰¹è³ªã€‚`;
    
    const advice = generateAdvice(summary.top, summary.dual ? summary.dual[1] : null, scores, summary.variant);
    
    const adviceHTML = (title, items) => 
        `<div class='border rounded p-2'><b>${title}</b><ul class='list-disc pl-5'>${items.map(item => `<li>${item}</li>`).join("")}</ul></div>`;
    
    document.getElementById("adviceCols").innerHTML = 
        adviceHTML("è·å ´å»ºè­°", advice.è·å ´) +
        adviceHTML("æ„Ÿæƒ…å»ºè­°", advice.æ„Ÿæƒ…) +
        adviceHTML("é¤Šç”Ÿå»ºè­°", advice.é¤Šç”Ÿ);
}

let currentBeastType = "";

document.getElementById("form").addEventListener("submit", function(e) {
    e.preventDefault();
    
    // ç²å–æ€§åˆ¥é¸æ“‡
    const gender = document.querySelector('input[name="gender"]:checked').value;
    
    const scores = {é’é¾:0, æœ±é›€:0, å‹¾é™³:0, è£è›‡:0, ç™½è™:0, ç„æ­¦:0};
    
    BANK.forEach((q, i) => {
        scores[q.b] += parseInt(document.getElementById(`q${i}`).value);
    });
    
    const summary = summarize(scores);
    currentBeastType = summary.top;
    
    renderRadar(scores);
    renderReport(summary, scores);
    
    // å„²å­˜æ¸¬é©—çµæœï¼ˆåŒ…å«æ€§åˆ¥ï¼‰
    localStorage.setItem("shen-shou-v7", JSON.stringify({
        scores: scores,
        summary: summary,
        gender: gender
    }));
    
    document.getElementById("result").style.display = "grid";
    document.getElementById("aiReport").style.display = "block";
    
    showSuperhero(summary.top);
});

document.getElementById("btnFillMid").onclick = function() {
    document.querySelectorAll(".slider").forEach(slider => {
        slider.value = 3;
    });
};

document.getElementById("btnShare").addEventListener("click", function() {
    html2canvas(document.getElementById("result")).then(canvas => {
        const link = document.createElement("a");
        link.download = "shenshou-result.png";
        link.href = canvas.toDataURL();
        link.click();
    });
});

document.getElementById("btnAI").addEventListener("click", async function() {
    const saved = JSON.parse(localStorage.getItem("shen-shou-v7") || "null");
    if (!saved) {
        alert("âš ï¸è«‹å…ˆå®Œæˆæ¸¬é©—ã€‚");
        return;
    }
    
    document.getElementById("ai-loading").style.display = "block";
    document.getElementById("ai-analysis-content").style.display = "none";
    document.getElementById("btnRetry").style.display = "none";
    document.getElementById("btnAI").disabled = true;
    
    simulateProgress();
    
    try {
        const response = await fetch("/api/ai", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(saved)
        });
        
        if (!response.ok) {
            throw new Error(await response.text());
        }
        
        const data = await response.json();
        parseAIResponse(data.text.trim(), currentBeastType);
        
    } catch (error) {
        console.log("AIè«‹æ±‚å¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°åˆ†æè³‡æ–™");
        fillAIAnalysis(currentBeastType);
    } finally {
        document.getElementById("ai-loading").style.display = "none";
        document.getElementById("ai-analysis-content").style.display = "block";
        document.getElementById("btnRetry").style.display = "inline-block";
        document.getElementById("btnAI").disabled = false;
    }
});

document.getElementById("btnRetry").addEventListener("click", function() {
    document.getElementById("btnAI").click();
});
</script>
</body>
</html>
