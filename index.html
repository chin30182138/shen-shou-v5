<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>神獸七十二型人格 測驗＋AI智能分析</title>
  <meta name="description" content="六獸人格AI分析｜金錢卦五行整合｜即時雷達圖＋智能報告" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root { 
      --brand: #b6822b; 
      --primary: #b6822b;
      --secondary: #d4a017;
      --accent: #2b6cb0;
    }
    body { background: radial-gradient(circle at top left, #fffaf4, #f6f3ea); }
    .brand { color: var(--brand); }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .slider { accent-color: var(--brand); }
    
    /* 設定面板的滑動動畫 */
    .slide-toggle {
        transition: all 0.3s ease-in-out;
        overflow: hidden;
        max-height: 1000px;
    }
    .slide-toggle.hidden {
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        margin-top: 0;
        margin-bottom: 0;
        opacity: 0;
    }

    /* 載入動畫 */
    .spinner { animation: spin 1.5s linear infinite; display: inline-block; font-size: 2em; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loading-dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
    @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
    
    /* 進度條 */
    .progress-container { width: 100%; background-color: #e5e7eb; border-radius: 10px; margin: 10px 0; overflow: hidden; }
    .progress-bar { height: 8px; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 10px; transition: width 0.4s ease; width: 0%; }
    
    /* 神獸超人類別 */
    .superhero-card { 
      border-radius: 12px; 
      padding: 8px; 
      margin: 6px 0; 
      background: linear-gradient(135deg, #e8f4fd, #f0f9ff); 
      border: 2px solid var(--accent); 
    }
    .superhero-title { font-size: 1.2em; font-weight: bold; color: var(--accent); margin-bottom: 4px; }
    .superhero-ability { background: rgba(43, 108, 176, 0.1); padding: 4px; border-radius: 6px; margin: 4px 0; font-weight: bold; color: #2c5282; font-size: 1.0em; }
    .superhero-desc { font-size: 1.0em; color: #666; line-height: 1.3; }
    
    /* 超人圖片樣式 */
    .superhero-image-container {
      width: 150px;
      height: 150px;
      margin: 0 auto 10px;
      border-radius: 12px;
      overflow: hidden;
      border: 3px solid var(--accent);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .superhero-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    .superhero-image:hover {
      transform: scale(1.05);
    }
    
    /* 六獸圖容器 */
    #beastSVG {
      width: 100%;
      height: 100%;
      position: relative;
    }
    .beast-svg-print {
      display: none;
    }
    
    /* AI分析區塊 */
    .ai-analysis-section { background: linear-gradient(135deg, #f8f9fa, #ffffff); border: 1px solid #e9ecef; border-radius: 12px; padding: 12px; margin: 8px 0; }
    .ai-analysis-header { display: flex; align-items: center; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 2px solid #e9ecef; }
    .ai-analysis-icon { font-size: 1.5em; margin-right: 8px; }
    .ai-analysis-title { color: #2d3748; font-weight: bold; font-size: 1.2em; }
    .ai-analysis-content { font-size: 1.0em; color: #4a5568; line-height: 1.5; }
    .ai-analysis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 8px; margin-top: 12px; }
    .ai-analysis-item { background: white; padding: 8px; border-radius: 6px; border-left: 4px solid var(--brand); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .ai-analysis-item-title { font-weight: bold; color: #2d3748; margin-bottom: 4px; font-size: 1.0em; }
    .ai-analysis-item-content { font-size: 0.95em; color: #718096; line-height: 1.4; }
    
    /* 載入狀態 */
    .ai-loading { text-align: center; padding: 20px; color: #718096; background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 12px; border: 2px dashed #e5e7eb; }

    /* 色系預覽區塊 */
    .color-preview {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .color-sample {
      width: 30px;
      height: 30px;
      border-radius: 6px;
      border: 2px solid #e5e7eb;
      cursor: pointer;
    }
    .color-sample.active {
      border-color: #333;
      transform: scale(1.1);
    }

    /* 重新設計的列印標頭 - 簡潔專業 */
    .print-header {
      display: none;
      margin-bottom: 25px;
      border-bottom: 3px solid #b6822b;
      padding-bottom: 15px;
    }
    
    .print-header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .print-logo-img {
      width: 65px;
      height: 65px;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
    }
    
    .logo-text {
      display: flex;
      flex-direction: column;
    }
    
    .print-logo-title {
      font-weight: bold;
      font-size: 20px;
      color: #b6822b;
      margin-bottom: 4px;
    }
    
    .print-logo-subtitle {
      font-size: 14px;
      color: #666;
    }
    
    .header-right {
      text-align: right;
      background: #f8f9fa;
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }
    
    .print-qrcode-title {
      font-weight: bold;
      font-size: 14px;
      color: #b6822b;
      margin-bottom: 4px;
    }
    
    .print-qrcode-subtitle {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }
    
    .print-qrcode-img {
      width: 80px;
      height: 80px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
    }
    
    .header-title-container {
      text-align: center;
      margin: 15px 0;
      padding: 15px 0;
      border-top: 2px solid #f0f0f0;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .report-main-title {
      font-size: 28px;
      font-weight: bold;
      color: #b6822b;
      margin-bottom: 8px;
    }
    
    .report-subtitle {
      font-size: 18px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .print-date {
      text-align: center;
      font-size: 13px;
      color: #888;
      margin-top: 10px;
    }
    
    .accent-bar {
      height: 4px;
      background: linear-gradient(90deg, #b6822b, #d4a017, #b6822b);
      margin: 10px 0;
      border-radius: 2px;
    }
    
    @media screen {
      #radar { width: 100% !important; height: 300px !important; }
      body { font-size: 16px; }
      h1 { font-size: 2.5em; }
      h2 { font-size: 1.5em; }
      p, li, div { font-size: 1.0em; }
    }
    
    /* 列印樣式 */
    @media print { 
      .no-print { display: none !important; } 
      .print-header { 
        display: block !important; 
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
      body { 
        background: white !important; 
        font-size: 14px !important; 
        color: black !important; 
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
      .card {
        box-shadow: none;
        border: 1px solid #ddd;
      }
      #beastSVG svg {
        width: 100% !important;
        height: auto !important;
      }
      .accent-bar {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
    }
  </style>
</head>
<body class="text-slate-800">
<main class="max-w-5xl mx-auto p-4 sm:p-6">
  <header class="mb-4 flex justify-between items-center no-print">
    <div class="flex items-center gap-3">
      <img src="img/logo.png" class="h-10 w-auto rounded" alt="仙人指路 Logo" />
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold brand">神獸七十二型人格 測驗＋AI智能分析</h1>
        <p class="text-sm text-slate-600">六獸雷達圖・主型解析・三欄建議・AI分析報告</p>
      </div>
    </div>
    <button id="toggleSettingsBtn" type="button" class="no-print p-2 rounded-full hover:bg-amber-100 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
    </button>
  </header>

  <!-- 設定表單 -->
  <form id="reportSettingsForm" class="card p-4 mb-4 no-print slide-toggle hidden">
    <h2 class="font-bold mb-3">⚙️ 報表資訊設定</h2>
    <div class="space-y-4 text-sm">
      <div class="flex items-center gap-4">
        <div>
          <label for="qrCodeUploader" class="font-semibold text-slate-700 block mb-1">上傳 QR Code 圖片：</label>
          <input type="file" id="qrCodeUploader" accept="image/*" class="text-slate-600">
        </div>
        <div>
            <label class="font-semibold text-slate-700 block mb-1">圖片預覽：</label>
            <img id="qrCodePreview" src="https://via.placeholder.com/80x80.png?text=QR+Code" alt="QR Code 預覽" class="w-20 h-20 border rounded p-1 bg-white object-contain">
        </div>
      </div>
      <div>
        <label for="contactTitle" class="font-semibold text-slate-700">聯絡標題：</label>
        <input type="text" id="contactTitle" class="w-full mt-1 p-2 border rounded" value="掃碼預約一對一諮詢">
      </div>
      <div>
        <label for="contactLine1" class="font-semibold text-slate-700">聯絡資訊 (第一行)：</label>
        <input type="text" id="contactLine1" class="w-full mt-1 p-2 border rounded" value="Line ID: @immortalguiide">
      </div>
      <div>
        <label for="contactLine2" class="font-semibold text-slate-700">聯絡資訊 (第二行)：</label>
        <input type="text" id="contactLine2" class="w-full mt-1 p-2 border rounded" value="專業諮詢預約">
      </div>
      
      <!-- 色系主題設定 -->
      <div>
        <label class="font-semibold text-slate-700 block mb-2">選擇色系主題：</label>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm mb-1">主要色系：</label>
            <select id="themeSelect" class="w-full p-2 border rounded">
              <option value="warm">暖色系</option>
              <option value="cool">冷色系</option>
              <option value="nature">自然系</option>
              <option value="modern">現代系</option>
              <option value="classic">經典系</option>
            </select>
          </div>
          <div>
            <label class="block text-sm mb-1">色調調整：</label>
            <input type="range" id="hueSlider" min="0" max="360" value="40" class="w-full slider">
            <div class="text-xs text-gray-500 mt-1">色調值: <span id="hueValue">40</span>°</div>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-4">
      <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition text-sm">儲存設定</button>
    </div>
  </form>

  <!-- 測驗表單 -->
  <form id="form" class="card p-4 mb-4 no-print">
    <h2 class="font-bold mb-3">📋 請回答下列30題（1＝不同意，5＝非常同意）</h2>
    
    <!-- 性別選擇 -->
    <div class="mb-4 p-3 bg-slate-50 rounded-lg">
      <label class="font-semibold text-slate-700 block mb-2">請選擇您的性別：</label>
      <div class="flex gap-4">
        <label class="flex items-center">
          <input type="radio" name="gender" value="male" class="mr-2" checked>
          男性
        </label>
        <label class="flex items-center">
          <input type="radio" name="gender" value="female" class="mr-2">
          女性
        </label>
        <label class="flex items-center">
          <input type="radio" name="gender" value="other" class="mr-2">
          其他
        </label>
      </div>
    </div>
    
    <ol id="qWrap" class="space-y-3"></ol>
    <div class="mt-4 flex gap-3">
      <button type="submit" class="bg-amber-600 text-white px-5 py-2 rounded hover:bg-amber-700 transition">送出測驗</button>
      <button type="button" id="btnFillMid" class="border px-3 py-2 rounded hover:bg-gray-50 transition">全部填3</button>
    </div>
  </form>

  <!-- 重新設計的列印標頭 - 簡潔專業 -->
  <div class="print-header">
    <div class="print-header-top">
      <div class="header-left">
        <img src="img/logo.png" alt="Logo" class="print-logo-img">
        <div class="logo-text">
            <div class="print-logo-title">仙人指路占卜研究學會</div>
            <div class="print-logo-subtitle">專業命理諮詢服務</div>
        </div>
      </div>
      <div class="header-right">
        <div class="print-qrcode-title" id="print-qrcode-title">掃碼預約一對一諮詢</div>
        <div class="print-qrcode-subtitle" id="print-qrcode-subtitle">Line ID: @immortalguiide</div>
        <img id="print-qrcode-img" src="https://via.placeholder.com/80x80.png?text=QR+Code" alt="QR Code" class="print-qrcode-img">
      </div>
    </div>
    
    <div class="accent-bar"></div>
    
    <div class="header-title-container">
      <h1 class="report-main-title">仙人指路神獸七十二型人格</h1>
      <p class="report-subtitle">個人化深度分析報告</p>
      <div class="print-date">報告生成時間：<span id="report-date"></span></div>
    </div>
    
    <div class="accent-bar"></div>
  </div>

  <!-- 測驗結果 -->
  <section id="result" class="grid lg:grid-cols-2 gap-4" style="display: none;">
    <div class="card p-4">
      <h2 class="font-bold mb-2">六獸能量雷達圖</h2>
      <div id="radar-container"><canvas id="radar"></canvas></div>
      <button class="mt-3 px-4 py-2 border rounded no-print hover:bg-gray-50 transition" onclick="printAnalysis()">🖨️ 列印分析報告</button>
    </div>
    <div class="card p-4" id="resultCard">
      <h2 class="font-bold mb-2">主型與三欄建議</h2>
      <div class="grid grid-cols-3 gap-3 items-start">
        <div id="beastSVG" class="w-full aspect-square"></div>
        <div class="col-span-2">
          <div id="mainBeastTitle" class="font-bold brand text-lg"></div>
          <div id="dualHint" class="text-sm text-slate-600 mt-1"></div>
          <div id="mainBeastSummary" class="mt-2 text-sm"></div>
        </div>
      </div>
      <hr class="my-2" />
      <div id="adviceCols" class="grid md:grid-cols-3 gap-2 text-sm"></div>
      <div class="mt-3 flex gap-2 no-print">
        <button id="btnShare" class="px-4 py-2 border rounded hover:bg-gray-50 transition">分享結果圖片</button>
        <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">🖨️ 列印分析報告</button>
      </div>
    </div>
  </section>

  <!-- 超人報告 -->
  <section class="card p-4 mt-4" id="superheroReport" style="display: none;">
    <h2 class="font-bold mb-2">🦸‍♂️ 你的神獸超人身分</h2>
    <div id="superhero-display" class="superhero-card">
      <div class="superhero-image-container">
        <img id="superhero-image" src="" alt="神獸超人圖片" class="superhero-image">
      </div>
      <div id="superhero-name" class="superhero-title"></div>
      <div id="superhero-ability" class="superhero-ability"></div>
      <div id="superhero-mission" class="superhero-desc"></div>
      <div id="superhero-local" class="text-sm mt-2 font-bold text-blue-700"></div>
    </div>
  </section>

  <!-- AI報告 -->
  <section class="card p-4 mt-4" id="aiReport" style="display: none;">
    <h2 class="font-bold mb-2">🤖 AI 智能個人化分析報告</h2>
    <p class="text-sm text-slate-600 mb-2">以下內容由仙人指路AI系統生成，融合金錢卦、五行、地支與心理視角。</p>
    <div id="ai-analysis-structured">
      <div class="ai-loading" id="ai-loading" style="display: none;">
        <div class="spinner">🔮</div>
        <p class="mt-2 text-lg font-semibold">AI 正在為您深度分析中<span class="loading-dots"></span></p>
        <p class="mt-1 text-sm text-gray-600">這可能需要 10-20 秒，請稍候</p>
        <div class="progress-container mt-3"><div class="progress-bar" id="progress-bar"></div></div>
        <div class="mt-2 text-xs text-gray-500" id="loading-step">初始化分析引擎...</div>
      </div>
      <div id="ai-analysis-content">
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">🎭</div><div class="ai-analysis-title">人格特質分析</div></div>
          <div class="ai-analysis-content" id="ai-personality"><div class="text-gray-500 text-center py-3">點擊「生成深度分析」獲取詳細解析</div></div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">⚡</div><div class="ai-analysis-title">能量優勢分析</div></div>
          <div class="ai-analysis-content" id="ai-strengths"><div class="text-gray-500 text-center py-3">點擊「生成深度分析」獲取詳細解析</div></div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">📈</div><div class="ai-analysis-title">成長發展建議</div></div>
          <div class="ai-analysis-grid">
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">職場發展</div><div class="ai-analysis-item-content" id="ai-career">點擊「生成深度分析」獲取職場建議</div></div>
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">人際關係</div><div class="ai-analysis-item-content" id="ai-relationships">點擊「生成深度分析」獲取人際建議</div></div>
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">個人成長</div><div class="ai-analysis-item-content" id="ai-growth">點擊「生成深度分析」獲取成長建議</div></div>
          </div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">💰</div><div class="ai-analysis-title">五行金錢卦解析</div></div>
          <div class="ai-analysis-content" id="ai-money"><div class="text-gray-500 text-center py-3">點擊「生成深度分析」獲取金錢卦解析</div></div>
        </div>
      </div>
    </div>
    <div class="flex gap-2 no-print mt-3">
      <button id="btnAI" class="px-4 py-2 border rounded bg-amber-500 text-white hover:bg-amber-600 transition">生成深度分析</button>
      <button id="btnRetry" class="px-4 py-2 border rounded bg-gray-200 hover:bg-gray-300 transition" style="display:none;">重新分析</button>
      <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">🖨️ 列印完整報告</button>
    </div>
  </section>

  <footer class="text-center text-xs text-slate-500 mt-6 no-print">
    <div class="flex justify-center items-center gap-4 mb-1">
      <span>© 2025 仙人指路占卜研究學會</span><span>|</span><span>Line: @immortalguiide</span>
    </div>
    <p>測驗僅供覺察與教學用途</p>
  </footer>
</main>

<script>
// ========== 初始化設定 ==========
document.addEventListener('DOMContentLoaded', function() {
  initializeApp();
});

// ========== 測驗題庫 ==========
const BANK = [
  {t: "我常有突如其來的靈感並想立即嘗試。", b: "青龍"},
  {t: "我喜歡打破常規尋找新方法。", b: "青龍"},
  {t: "遇阻力時我會靈活轉向。", b: "青龍"},
  {t: "我富想像力，喜歡創新思考。", b: "青龍"},
  {t: "我熱愛探索未知事物。", b: "青龍"},
  {t: "我喜歡在人群中表達自己。", b: "朱雀"},
  {t: "我用情緒帶動他人。", b: "朱雀"},
  {t: "別人的反應會影響我。", b: "朱雀"},
  {t: "我擅長說服與演說。", b: "朱雀"},
  {t: "我重視被傾聽與關注。", b: "朱雀"},
  {t: "我喜歡按計畫行事。", b: "勾陳"},
  {t: "我重視安全感與穩定。", b: "勾陳"},
  {t: "我責任感強。", b: "勾陳"},
  {t: "我傾向維持現狀。", b: "勾陳"},
  {t: "我注重細節與程序。", b: "勾陳"},
  {t: "我對他人情緒很敏感。", b: "螣蛇"},
  {t: "我擅長觀察與傾聽。", b: "螣蛇"},
  {t: "我常思考背後的動機。", b: "螣蛇"},
  {t: "我思考事情會考量時機與人心。", b: "螣蛇"},
  {t: "我善於協調不同觀點。", b: "螣蛇"},
  {t: "我講求效率與結果。", b: "白虎"},
  {t: "我會主動做決策。", b: "白虎"},
  {t: "我以數據與成果為導向。", b: "白虎"},
  {t: "我願意承擔壓力以完成任務。", b: "白虎"},
  {t: "我偏好明確的規範與標準。", b: "白虎"},
  {t: "我喜歡獨自思考。", b: "玄武"},
  {t: "我傾向謹慎評估後行動。", b: "玄武"},
  {t: "我擅長規劃長遠目標。", b: "玄武"},
  {t: "我重視邏輯與分析。", b: "玄武"},
  {t: "我習慣冷靜看待問題。", b: "玄武"}
];

// ========== 超人顯示資料 ==========
const superheroData = {
  '青龍': {
    male: { 
      name:'創意飛龍超人', 
      ability:'🦸‍♂️ 超能力：靈感爆發 + 快速應變 + 突破框架', 
      mission:'🎯 專屬任務：創新專案發起人、危機處理專家、新領域開拓者', 
      localName:'台灣點子王', 
      description:'你就像台灣的創新引擎，總能想出讓人驚艷的點子！',
      image: 'img/qinglong-male.png'
    },
    female: { 
      name:'創意飛龍女俠', 
      ability:'🦸‍♀️ 超能力：靈感爆發 + 直覺洞察 + 跨界融合', 
      mission:'🎯 專屬任務：創意策劃師、團隊協調者、美感引導者', 
      localName:'台灣創意女神', 
      description:'你是台灣的創意女神，總能將靈感轉化為動人的作品！',
      image: 'img/qinglong-female.png'
    },
    other: { 
      name:'創意飛龍使者', 
      ability:'🦸 超能力：靈感爆發 + 多元視角 + 跨界連結', 
      mission:'🎯 專屬任務：創意橋樑、多元文化融合者、創新催化劑', 
      localName:'台灣創意大使', 
      description:'你是台灣的創意大使，用多元視角連結不同領域！',
      image: 'img/qinglong-male.png'
    }
  },
  '朱雀': {
    male: { 
      name:'熱情鳳凰超人', 
      ability:'🦸‍♂️ 超能力：感染力場 + 溝通大師 + 激勵光環', 
      mission:'🎯 專屬任務：團隊士氣充電站、公關溝通達人、教育推廣先鋒', 
      localName:'台灣熱情大使', 
      description:'你是台灣的人氣王，用熱情感染身邊的每一個人！',
      image: 'img/zhuque-male.png'
    },
    female: { 
      name:'熱情鳳凰女俠', 
      ability:'🦸‍♀️ 超能力：情感共鳴 + 溝通藝術 + 溫暖療癒', 
      mission:'🎯 專屬任務：情感支持者、團隊凝聚者、心靈療癒師', 
      localName:'台灣暖心天使', 
      description:'你是台灣的暖心天使，用真誠與溫暖照亮他人！',
      image: 'img/zhuque-female.png'
    },
    other: { 
      name:'熱情鳳凰使者', 
      ability:'🦸 超能力：情感連結 + 多元溝通 + 社群凝聚', 
      mission:'🎯 專屬任務：社群橋樑、情感支持者、多元文化推廣者', 
      localName:'台灣情感連結者', 
      description:'你是台灣的情感連結者，用真誠連結不同的心靈！',
      image: 'img/zhuque-male.png'
    }
  },
  '勾陳': {
    male: { 
      name:'穩固城牆超人', 
      ability:'🦸‍♂️ 超能力：可靠防護 + 細節掌控 + 執行力場', 
      mission:'🎯 專屬任務：系統穩定守護者、品質把關專家、長期規劃師', 
      localName:'台灣地基主', 
      description:'你是台灣的穩定力量，像堅固的地基一樣可靠！',
      image: 'img/gouchen-male.png'
    },
    female: { 
      name:'穩固城牆女俠', 
      ability:'🦸‍♀️ 超能力：細心守護 + 組織協調 + 穩定支持', 
      mission:'🎯 專屬任務：系統維護者、品質守護者、團隊穩定劑', 
      localName:'台灣守護天使', 
      description:'你是台灣的守護天使，用細心與穩定支持著每個人！',
      image: 'img/gouchen-female.png'
    },
    other: { 
      name:'穩固城牆使者', 
      ability:'🦸 超能力：系統思維 + 穩定建構 + 多元協調', 
      mission:'🎯 專屬任務：系統架構師、穩定維護者、多元協調者', 
      localName:'台灣系統守護者', 
      description:'你是台灣的系統守護者，用穩定的力量建構更好的環境！',
      image: 'img/gouchen-male.png'
    }
  },
  '螣蛇': {
    male: { 
      name:'洞察靈蛇超人', 
      ability:'🦸‍♂️ 超能力：讀心感知 + 協調力場 + 時機掌控', 
      mission:'🎯 專屬任務：人際關係調解員、策略分析師、危機預警系統', 
      localName:'台灣和事佬', 
      description:'你是台灣的人際雷達，總能洞察人心、化解衝突！',
      image: 'img/tengshe-male.png'
    },
    female: { 
      name:'洞察靈蛇女俠', 
      ability:'🦸‍♀️ 超能力：直覺感知 + 情感協調 + 時機洞察', 
      mission:'🎯 專屬任務：情感調解師、團隊潤滑劑、危機預防專家', 
      localName:'台灣心靈導師', 
      description:'你是台灣的心靈導師，用直覺與智慧引導他人！',
      image: 'img/tengshe-female.png'
    },
    other: { 
      name:'洞察靈蛇使者', 
      ability:'🦸 超能力：多元感知 + 關係協調 + 時機判斷', 
      mission:'🎯 專屬任務：關係橋樑、多元協調者、時機分析師', 
      localName:'台灣協調專家', 
      description:'你是台灣的協調專家，用智慧連結不同的人際網絡！',
      image: 'img/tengshe-male.png'
    }
  },
  '白虎': {
    male: { 
      name:'疾風戰神超人', 
      ability:'🦸‍♂️ 超能力：決斷力場 + 行動加速 + 目標鎖定', 
      mission:'🎯 專屬任務：緊急救援隊長、專案領導者、效率優化師', 
      localName:'台灣急先鋒', 
      description:'你是台灣的行動派，像疾風一樣快速解決問題！',
      image: 'img/baihu-male.png'
    },
    female: { 
      name:'疾風戰神女俠', 
      ability:'🦸‍♀️ 超能力：果斷決策 + 高效執行 + 目標達成', 
      mission:'🎯 專屬任務：危機處理專家、效率領導者、目標達成師', 
      localName:'台灣行動女神', 
      description:'你是台灣的行動女神，用效率與決斷力完成任務！',
      image: 'img/baihu-female.png'
    },
    other: { 
      name:'疾風戰神使者', 
      ability:'🦸 超能力：多元決策 + 高效協調 + 目標管理', 
      mission:'🎯 專屬任務：效率協調者、多元領導者、目標管理師', 
      localName:'台灣效率專家', 
      description:'你是台灣的效率專家，用多元視角達成目標！',
      image: 'img/baihu-male.png'
    }
  },
  '玄武': {
    male: { 
      name:'智慧龜仙超人', 
      ability:'🦸‍♂️ 超能力：深度思考 + 策略規劃 + 冷靜屏障', 
      mission:'🎯 專屬任務：長遠規劃師、技術研發專家、智慧決策顧問', 
      localName:'台灣諸葛亮', 
      description:'你是台灣的智慧寶庫，像龜甲一樣保護重要決策！',
      image: 'img/xuanwu-male.png'
    },
    female: { 
      name:'智慧龜仙女俠', 
      ability:'🦸‍♀️ 超能力：深度分析 + 策略思考 + 冷靜智慧', 
      mission:'🎯 專屬任務：策略規劃師、智慧顧問、冷靜決策者', 
      localName:'台灣智慧女神', 
      description:'你是台灣的智慧女神，用深謀遠慮指引方向！',
      image: 'img/xuanwu-female.png'
    },
    other: { 
      name:'智慧龜仙使者', 
      ability:'🦸 超能力：多元思考 + 策略協調 + 冷靜分析', 
      mission:'🎯 專屬任務：智慧橋樑、策略協調者、多元顧問', 
      localName:'台灣智囊團', 
      description:'你是台灣的智囊團，用多元智慧解決複雜問題！',
      image: 'img/xuanwu-male.png'
    }
  }
};

function initializeApp() {
  // 設定報告日期
  document.getElementById('report-date').textContent = new Date().toLocaleDateString('zh-TW', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric', 
    hour: '2-digit', 
    minute: '2-digit' 
  });

  // 初始化測驗題目
  initializeQuestions();
  
  // 初始化設定面板
  initializeSettings();
  
  // 初始化事件監聽器
  initializeEventListeners();
}

// ========== 測驗題目初始化 ==========
function initializeQuestions() {
  // 隨機排序題目
  const shuffledBANK = [...BANK].sort(() => 0.5 - Math.random());
  
  const qWrap = document.getElementById("qWrap");
  qWrap.innerHTML = ''; // 清空現有內容
  
  shuffledBANK.forEach((q, i) => {
    qWrap.innerHTML += `<li><p>${i+1}. ${q.t}</p><input type='range' min='1' max='5' value='3' id='q${i}' class='w-full slider'></li>`;
  });
  
  qWrap.innerHTML += '<div id="progress" class="text-right text-sm">0/30</div>';
  
  // 更新進度顯示
  document.querySelectorAll('input[type="range"]').forEach(slider => {
    slider.addEventListener('input', () => {
      const answered = Array.from(document.querySelectorAll('input[type="range"]')).filter(s => s.value !== "3").length;
      document.getElementById("progress").textContent = `${answered}/30`;
    });
  });
}

// ========== 設定面板初始化 ==========
function initializeSettings() {
  const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
  
  // 設定表單值
  document.getElementById('contactTitle').value = savedSettings.title || '掃碼預約一對一諮詢';
  document.getElementById('contactLine1').value = savedSettings.line1 || 'Line ID: @immortalguiide';
  document.getElementById('contactLine2').value = savedSettings.line2 || '專業諮詢預約';
  document.getElementById('themeSelect').value = savedSettings.theme || 'warm';
  document.getElementById('hueSlider').value = savedSettings.hue || 40;
  document.getElementById('hueValue').textContent = savedSettings.hue || 40;
  
  // QR Code 圖片
  const qrCodePreview = document.getElementById('qrCodePreview');
  if (savedSettings.qrDataUrl) {
    qrCodePreview.src = savedSettings.qrDataUrl;
  }
  
  // 更新列印標頭
  updatePrintHeader();
  
  // 應用主題
  applyTheme(savedSettings.theme || 'warm', savedSettings.hue || 40);
  
  // QR Code 上傳處理
  document.getElementById('qrCodeUploader').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        qrCodePreview.src = e.target.result;
        updatePrintHeader();
      };
      reader.readAsDataURL(file);
    }
  });
}

// 更新列印標頭
function updatePrintHeader() {
  const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
  
  document.getElementById('print-qrcode-title').textContent = savedSettings.title || '掃碼預約一對一諮詢';
  document.getElementById('print-qrcode-subtitle').textContent = savedSettings.line1 || 'Line ID: @immortalguiide';
  
  const qrCodeImg = document.getElementById('print-qrcode-img');
  if (savedSettings.qrDataUrl) {
    qrCodeImg.src = savedSettings.qrDataUrl;
  }
}

// ========== 事件監聽器初始化 ==========
function initializeEventListeners() {
  // 設定面板開關
  document.getElementById('toggleSettingsBtn').addEventListener('click', function() {
    const settingsPanel = document.getElementById('reportSettingsForm');
    settingsPanel.classList.toggle('hidden');
  });
  
  // 設定表單提交
  document.getElementById('reportSettingsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    saveSettings();
  });
  
  // 色調滑桿
  document.getElementById('hueSlider').addEventListener('input', function() {
    document.getElementById('hueValue').textContent = this.value;
    applyTheme(document.getElementById('themeSelect').value, this.value);
  });
  
  // 主題選擇
  document.getElementById('themeSelect').addEventListener('change', function() {
    applyTheme(this.value, document.getElementById('hueSlider').value);
  });
  
  // 測驗表單提交
  document.getElementById('form').addEventListener('submit', function(e) {
    e.preventDefault();
    submitQuiz();
  });
  
  // 全部填3按鈕
  document.getElementById('btnFillMid').addEventListener('click', function() {
    document.querySelectorAll('input[type="range"]').forEach(slider => {
      slider.value = 3;
    });
    // 更新進度
    const answered = Array.from(document.querySelectorAll('input[type="range"]')).filter(s => s.value !== "3").length;
    document.getElementById("progress").textContent = `${answered}/30`;
  });
  
  // AI分析按鈕
  document.getElementById('btnAI').addEventListener('click', function() {
    generateAIAnalysis();
  });
  
  // 分享按鈕
  document.getElementById('btnShare').addEventListener('click', function() {
    shareResult();
  });
}

// ========== 設定相關函數 ==========
function saveSettings() {
  const settings = {
    qrDataUrl: document.getElementById('qrCodePreview').src,
    title: document.getElementById('contactTitle').value,
    line1: document.getElementById('contactLine1').value,
    line2: document.getElementById('contactLine2').value,
    theme: document.getElementById('themeSelect').value,
    hue: document.getElementById('hueSlider').value
  };
  
  localStorage.setItem('reportContactSettings', JSON.stringify(settings));
  updatePrintHeader();
  alert('設定已儲存！');
}

// 色系主題
const colorThemes = {
  warm: { primary: '#b6822b', secondary: '#d4a017', accent: '#2b6cb0', background: 'radial-gradient(circle at top left, #fffaf4, #f6f3ea)' },
  cool: { primary: '#2b6cb0', secondary: '#3182ce', accent: '#b6822b', background: 'radial-gradient(circle at top left, #e8f4fd, #f0f9ff)' },
  nature: { primary: '#38a169', secondary: '#48bb78', accent: '#2b6cb0', background: 'radial-gradient(circle at top left, #f0fff4, #e6fffa)' },
  modern: { primary: '#4a5568', secondary: '#718096', accent: '#b6822b', background: 'radial-gradient(circle at top left, #f7fafc, #edf2f7)' },
  classic: { primary: '#744210', secondary: '#975a16', accent: '#2b6cb0', background: 'radial-gradient(circle at top left, #fefcbf, #faf089)' }
};

function applyTheme(theme, hue) {
  const root = document.documentElement;
  const themeColors = colorThemes[theme];
  
  // 簡單的色調調整
  const adjustColor = (color) => {
    return `hsl(${hue}, 70%, 45%)`;
  };
  
  const primary = adjustColor(themeColors.primary);
  const secondary = adjustColor(themeColors.secondary);
  
  root.style.setProperty('--brand', primary);
  root.style.setProperty('--primary', primary);
  root.style.setProperty('--secondary', secondary);
  root.style.setProperty('--accent', themeColors.accent);
  
  document.body.style.background = themeColors.background;
  
  // 更新進度條
  const progressBar = document.querySelector('.progress-bar');
  if (progressBar) {
    progressBar.style.background = `linear-gradient(90deg, ${primary}, ${secondary})`;
  }
}

// ========== 測驗相關函數 ==========
function submitQuiz() {
  const scores = {青龍:0, 朱雀:0, 勾陳:0, 螣蛇:0, 白虎:0, 玄武:0};
  
  // 計算分數
  for (let i = 0; i < 30; i++) {
    const slider = document.getElementById(`q${i}`);
    if (slider) {
      const question = BANK[i];
      scores[question.b] += parseInt(slider.value);
    }
  }
  
  const summary = summarize(scores);
  window.currentBeastType = summary.top;
  
  // 顯示結果
  renderRadar(scores);
  renderReport(summary, scores);
  
  // 儲存結果
  const gender = document.querySelector('input[name="gender"]:checked').value;
  localStorage.setItem("shen-shou-result", JSON.stringify({
    scores: scores,
    summary: summary,
    gender: gender
  }));
  
  document.getElementById("result").style.display = "grid";
  document.getElementById("aiReport").style.display = "block";
  
  showSuperhero(summary.top);
}

function summarize(scores) {
  const entries = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  const top = entries[0];
  const secondary = entries[1];
  const dual = top[1] - secondary[1] <= 2 ? [top[0], secondary[0]] : null;
  
  const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
  const variantIndex = total % 12;
  const variants = ["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];
  
  return {
    top: top[0],
    dual: dual,
    ranking: entries,
    variant: variants[variantIndex],
    total: total,
    scores: scores
  };
}

// ========== 渲染函數 ==========
let radarChart = null;

function renderRadar(scores) {
  const canvas = document.getElementById("radar");
  if (radarChart) {
    radarChart.destroy();
  }
  
  radarChart = new Chart(canvas, {
    type: "radar",
    data: {
      labels: Object.keys(scores),
      datasets: [{
        label: "六獸能量",
        data: Object.values(scores),
        backgroundColor: "rgba(182,130,43,0.15)",
        borderColor: "#b6822b",
        pointBackgroundColor: "#b6822b",
        pointBorderColor: "#fff",
        pointHoverBackgroundColor: "#fff",
        pointHoverBorderColor: "#b6822b"
      }]
    },
    options: {
      scales: {
        r: {
          beginAtZero: true,
          max: 25,
          ticks: {
            stepSize: 5
          }
        }
      },
      plugins: {
        legend: {
          display: false
        }
      },
      maintainAspectRatio: false
    }
  });
}

function renderReport(summary, scores) {
  // 顯示六獸圖
  document.getElementById("beastSVG").innerHTML = beastSVG(summary.top);
  
  // 顯示主型資訊
  document.getElementById("mainBeastTitle").textContent = summary.dual ? 
    `雙獸${summary.variant}型：${summary.top} × ${summary.dual[1]}` : 
    `主${summary.variant}型：${summary.top}`;
  
  document.getElementById("dualHint").textContent = summary.dual ? 
    `第二主導能量：${summary.dual[1]}` : "";
  
  document.getElementById("mainBeastSummary").textContent = 
    `你的主型為 ${summary.top}${summary.variant}型，融合${summary.top}能量與${summary.variant}地支特質。`;
  
  // 顯示建議
  const advice = generateAdvice(summary.top, summary.dual ? summary.dual[1] : null, scores, summary.variant);
  
  const adviceHTML = (title, items) => 
    `<div class='border rounded p-2'><b>${title}</b><ul class='list-disc pl-5'>${items.map(item => `<li>${item}</li>`).join("")}</ul></div>`;
  
  document.getElementById("adviceCols").innerHTML = 
    adviceHTML("職場建議", advice.職場) +
    adviceHTML("感情建議", advice.感情) +
    adviceHTML("養生建議", advice.養生);
}

// ========== 神獸SVG ==========
function beastSVG(beast) {
  const color = "#B6822B";
  const fill = "none";
  const path = d => `<path d='${d}' fill='${fill}' stroke='${color}' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>`;
  const wrap = content => `<svg viewBox='0 0 100 100' class='w-full h-auto' xmlns='http://www.w3.org/2000/svg'>
    <defs><radialGradient id='g' cx='50%' cy='50%' r='60%'>
      <stop offset='0%' stop-color='rgba(182,130,43,0.25)'/><stop offset='100%' stop-color='rgba(182,130,43,0)'/>
    </radialGradient></defs><rect width='100' height='100' fill='url(#g)'/>${content}</svg>`;
  
  switch(beast) {
    case "青龍": return wrap(
      path("M15 60 C25 40, 45 35, 55 45 C65 55, 75 35, 85 45 M45 45 q5 -12 16 -10 m-6 6 l6 4 m-36 20 q10 -6 18 2 m12 -2 q8 -6 18 2") +
      path("M30 70 q10 8 20 0 q10 -8 20 0")
    );
    case "朱雀": return wrap(
      path("M20 60 q15 -30 30 -30 q15 0 30 30 M50 30 l0 12 M35 55 q15 -8 30 0 M25 62 q10 8 25 8 q15 0 25 -8")
    );
    case "勾陳": return wrap(
      path("M20 70 h60 v-20 h-60 v20 z M30 50 v-10 h40 v10 M35 65 h10 M55 65 h10")
    );
    case "螣蛇": return wrap(
      path("M20 70 q20 -30 40 -10 q10 8 20 -2 q-10 20 -30 10 q-10 -6 -30 2 M60 48 q6 -6 12 0")
    );
    case "白虎": return wrap(
      path("M20 65 q15 -20 30 -20 q15 0 30 20 M30 60 h40 M35 70 h30 M38 52 l4 6 M58 52 l-4 6")
    );
    case "玄武": return wrap(
      path("M30 65 q20 15 40 0 q5 -12 -15 -22 q-20 10 -25 22 M55 50 q10 -8 20 2 M25 55 q-8 -6 -10 6")
    );
    default: return wrap("");
  }
}

// ========== 建議生成 ==========
function generateAdvice(mainBeast, secondaryBeast, scores, variant) {
  const adviceBank = {
    青龍: {
      職場: ["創新領頭，勇於嘗試新方法","帶領團隊突破傳統框架","開拓新市場或業務領域","將創意轉化為實際行動"],
      感情: ["保持關係中的新鮮感","共同探索新體驗","開放溝通創新想法","平衡冒險與穩定需求"],
      養生: ["戶外運動釋放能量","嘗試新的運動方式","保持生活多樣性","適當冒險挑戰自我"]
    },
    朱雀: {
      職場: ["發揮表達與溝通優勢","激勵團隊士氣","建立廣泛人際網絡","展現熱情與感染力"],
      感情: ["真誠表達情感需求","創造浪漫驚喜時刻","保持關係中的熱情","適度分享內心感受"],
      養生: ["藝術創作抒發情感","社交活動保持活力","表達性運動如舞蹈","注意情緒波動管理"]
    },
    勾陳: {
      職場: ["建立穩定工作流程","確保任務按時完成","注重細節與品質","提供可靠支持"],
      感情: ["建立信任與安全感","保持承諾與一致性","穩定表達關心","營造溫馨家庭氛圍"],
      養生: ["規律作息保持平衡","均衡飲食與運動","建立健康生活習慣","注重實際養生方法"]
    },
    螣蛇: {
      職場: ["發揮洞察與協調能力","理解團隊成員需求","妥善處理人際關係","把握時機採取行動"],
      感情: ["深入理解伴侶感受","敏感體貼對方需求","建立深度情感連結","適時表達支持"],
      養生: ["冥想與內省練習","情緒管理與釋放","溫和調理身心","注重心理平衡"]
    },
    白虎: {
      職場: ["果斷決策追求效率","設定明確目標","承擔領導責任","注重成果與績效"],
      感情: ["直接表達愛與承諾","保護與支持伴侶","明確關係界線","展現堅定與忠誠"],
      養生: ["高強度運動釋壓","挑戰體能極限","培養紀律性","注意壓力管理"]
    },
    玄武: {
      職場: ["策略規劃長遠發展","深入分析問題本質","獨立思考與判斷","保持理性與客觀"],
      感情: ["深度交流思想","理性分析關係","保持個人空間","建立智慧連結"],
      養生: ["靜坐與閱讀","深度思考與反思","獨立運動如游泳","注重精神養生"]
    }
  };
  
  const pickAdvice = (category) => {
    const mainAdvice = adviceBank[mainBeast][category];
    const secondaryAdvice = secondaryBeast ? adviceBank[secondaryBeast][category] : [];
    let advice = [];
    
    // 主型建議
    if (mainAdvice) {
      advice.push(mainAdvice[0] + "。");
    }
    
    // 次型建議
    if (secondaryBeast && secondaryAdvice) {
      advice.push(secondaryAdvice[1] + "。");
    }
    
    return advice.length > 0 ? advice : ["暫無特定建議"];
  };
  
  return {
    職場: pickAdvice("職場"),
    感情: pickAdvice("感情"),
    養生: pickAdvice("養生")
  };
}

// ========== 超人顯示 ==========
function showSuperhero(beastType) {
  const gender = document.querySelector('input[name="gender"]:checked').value;
  const beastData = superheroData[beastType];
  
  if (beastData) {
    const genderData = beastData[gender] || beastData.male;
    
    document.getElementById("superhero-name").textContent = genderData.name;
    document.getElementById("superhero-ability").textContent = genderData.ability;
    document.getElementById("superhero-mission").textContent = genderData.mission;
    document.getElementById("superhero-local").textContent = `🏮 台灣在地版：${genderData.localName} - ${genderData.description}`;
    
    // 直接使用 superheroData 中的圖片路徑
    document.getElementById("superhero-image").src = genderData.image;
    
    document.getElementById("superheroReport").style.display = "block";
  }
}

// ========== AI分析 - 智能生成擴充內容 ==========
function fillAIAnalysis(beastType) {
  // 根據用戶的具體分數和特質生成個性化分析
  const saved = JSON.parse(localStorage.getItem("shen-shou-result") || "null");
  const scores = saved?.scores || {};
  const gender = saved?.gender || 'male';
  
  // 計算能量分布特徵
  const energyDistribution = calculateEnergyDistribution(scores);
  const dominantTraits = identifyDominantTraits(scores, beastType);
  const growthAreas = identifyGrowthAreas(scores);
  
  const analysisData = generatePersonalizedAnalysis(beastType, scores, energyDistribution, dominantTraits, growthAreas, gender);
  
  document.getElementById("ai-personality").innerHTML = formatAnalysisContent(analysisData.personality);
  document.getElementById("ai-strengths").innerHTML = formatAnalysisContent(analysisData.strengths);
  document.getElementById("ai-career").innerHTML = formatAnalysisContent(analysisData.career);
  document.getElementById("ai-relationships").innerHTML = formatAnalysisContent(analysisData.relationships);
  document.getElementById("ai-growth").innerHTML = formatAnalysisContent(analysisData.growth);
  document.getElementById("ai-money").innerHTML = formatAnalysisContent(analysisData.money);
}

// 計算能量分布
function calculateEnergyDistribution(scores) {
  const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
  const distribution = {};
  
  for (const [beast, score] of Object.entries(scores)) {
    distribution[beast] = {
      percentage: ((score / total) * 100).toFixed(1),
      level: getEnergyLevel(score)
    };
  }
  
  return distribution;
}

function getEnergyLevel(score) {
  if (score >= 23) return '極強';
  if (score >= 20) return '強';
  if (score >= 17) return '中等';
  if (score >= 14) return '偏弱';
  return '弱';
}

// 識別主導特質
function identifyDominantTraits(scores, mainBeast) {
  const traits = [];
  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  
  // 主型特質
  traits.push({
    beast: mainBeast,
    score: scores[mainBeast],
    description: getBeastTraits(mainBeast)
  });
  
  // 次型特質（如果分數接近）
  if (sorted[1] && sorted[1][1] >= scores[mainBeast] - 3) {
    traits.push({
      beast: sorted[1][0],
      score: sorted[1][1],
      description: getBeastTraits(sorted[1][0])
    });
  }
  
  return traits;
}

// 識別成長領域
function identifyGrowthAreas(scores) {
  const areas = [];
  const minScore = Math.min(...Object.values(scores));
  const weakBeasts = Object.entries(scores).filter(([_, score]) => score === minScore);
  
  weakBeasts.forEach(([beast, score]) => {
    areas.push({
      beast: beast,
      score: score,
      improvement: getGrowthSuggestions(beast)
    });
  });
  
  return areas;
}

// 生成個性化分析
function generatePersonalizedAnalysis(beastType, scores, energyDistribution, dominantTraits, growthAreas, gender) {
  const mainScore = scores[beastType];
  const energyLevel = getEnergyLevel(mainScore);
  const hasStrongSecondary = dominantTraits.length > 1;
  
  return {
    personality: generatePersonalityAnalysis(beastType, scores, energyDistribution, dominantTraits, gender),
    strengths: generateStrengthsAnalysis(beastType, scores, dominantTraits, energyLevel),
    career: generateCareerAnalysis(beastType, scores, energyDistribution, hasStrongSecondary),
    relationships: generateRelationshipsAnalysis(beastType, scores, dominantTraits, gender),
    growth: generateGrowthAnalysis(beastType, growthAreas, energyDistribution),
    money: generateMoneyAnalysis(beastType, scores, energyDistribution)
  };
}

// 詳細分析生成函數
function generatePersonalityAnalysis(beastType, scores, distribution, traits, gender) {
  const mainPercent = distribution[beastType].percentage;
  const genderText = gender === 'male' ? '男性' : gender === 'female' ? '女性' : '';
  
  let analysis = `<div class="space-y-3">`;
  
  // 核心人格描述
  analysis += `<p><strong>核心人格特質：</strong>您的${beastType}能量佔比${mainPercent}%，屬於${distribution[beastType].level}程度。${genderText}${beastType}型人格通常${getCorePersonality(beastType, gender)}</p>`;
  
  // 能量組合分析
  if (traits.length > 1) {
    analysis += `<p><strong>能量組合：</strong>您展現出${beastType}與${traits[1].beast}的獨特組合。這種組合讓您${getCombinationTraits(beastType, traits[1].beast)}</p>`;
  }
  
  // 具體行為模式
  analysis += `<p><strong>行為模式：</strong>${getBehaviorPatterns(beastType, scores)}</p>`;
  
  // 深層動機
  analysis += `<p><strong>深層動機：</strong>${getDeepMotivations(beastType)}</p>`;
  
  analysis += `</div>`;
  return analysis;
}

function generateStrengthsAnalysis(beastType, scores, traits, energyLevel) {
  let analysis = `<div class="space-y-3">`;
  
  analysis += `<p><strong>天賦優勢：</strong>您的${beastType}能量達到${energyLevel}等級，在${getKeyStrengths(beastType)}方面具有天然優勢。</p>`;
  
  // 具體優勢列舉
  const strengths = getSpecificStrengths(beastType);
  analysis += `<ul class="list-disc pl-5 space-y-1">`;
  strengths.forEach(strength => {
    analysis += `<li>${strength}</li>`;
  });
  analysis += `</ul>`;
  
  // 組合優勢
  if (traits.length > 1) {
    analysis += `<p><strong>組合優勢：</strong>${getCombinationStrengths(beastType, traits[1].beast)}</p>`;
  }
  
  analysis += `</div>`;
  return analysis;
}

function generateCareerAnalysis(beastType, scores, distribution, hasStrongSecondary) {
  const suitableFields = getSuitableCareerFields(beastType);
  const avoidFields = getAvoidCareerFields(beastType);
  
  let analysis = `<div class="space-y-3">`;
  
  analysis += `<p><strong>最適職業領域：</strong></p>`;
  analysis += `<ul class="list-disc pl-5 space-y-1">`;
  suitableFields.forEach(field => {
    analysis += `<li>${field}</li>`;
  });
  analysis += `</ul>`;
  
  analysis += `<p><strong>職場優勢：</strong>${getWorkplaceAdvantages(beastType)}</p>`;
  analysis += `<p><strong>發展建議：</strong>${getCareerDevelopmentTips(beastType)}</p>`;
  
  if (hasStrongSecondary) {
    analysis += `<p><strong>跨領域潛力：</strong>${getCrossFieldPotential(beastType)}</p>`;
  }
  
  analysis += `</div>`;
  return analysis;
}

function generateRelationshipsAnalysis(beastType, scores, traits, gender) {
  let analysis = `<div class="space-y-3">`;
  
  analysis += `<p><strong>情感模式：</strong>${getRelationshipPatterns(beastType, gender)}</p>`;
  analysis += `<p><strong>溝通風格：</strong>${getCommunicationStyle(beastType)}</p>`;
  analysis += `<p><strong>親密關係建議：</strong>${getIntimacyAdvice(beastType, gender)}</p>`;
  
  // 適合的伴侶類型
  const compatibleTypes = getCompatibleTypes(beastType);
  analysis += `<p><strong>情感相容類型：</strong>${compatibleTypes.join('、')}</p>`;
  
  analysis += `</div>`;
  return analysis;
}

function generateGrowthAnalysis(beastType, growthAreas, distribution) {
  let analysis = `<div class="space-y-3">`;
  
  analysis += `<p><strong>主要成長課題：</strong>${getMainGrowthChallenges(beastType)}</p>`;
  
  // 具體改進建議
  analysis += `<p><strong>具體改進方向：</strong></p>`;
  analysis += `<ul class="list-disc pl-5 space-y-1">`;
  getGrowthActions(beastType).forEach(action => {
    analysis += `<li>${action}</li>`;
  });
  analysis += `</ul>`;
  
  // 弱勢能量發展
  if (growthAreas.length > 0) {
    analysis += `<p><strong>弱勢能量發展：</strong>${getWeaknessDevelopment(growthAreas[0].beast)}</p>`;
  }
  
  analysis += `</div>`;
  return analysis;
}

function generateMoneyAnalysis(beastType, scores, distribution) {
  let analysis = `<div class="space-y-3">`;
  
  analysis += `<p><strong>財富能量：</strong>${getWealthEnergy(beastType)}</p>`;
  analysis += `<p><strong>適合的理財方式：</strong>${getSuitableInvestments(beastType)}</p>`;
  analysis += `<p><strong>金錢卦象解讀：</strong>${getMoneyHexagram(beastType)}</p>`;
  analysis += `<p><strong>財富發展建議：</strong>${getWealthDevelopmentTips(beastType)}</p>`;
  
  analysis += `</div>`;
  return analysis;
}

// 格式化分析內容
function formatAnalysisContent(content) {
  return content;
}

// 具體的內容生成函數
function getCorePersonality(beastType, gender) {
  const personalities = {
    '青龍': '具有開創性思維，喜歡探索未知，充滿好奇心和創新精神。在團隊中往往是創意的來源，能夠看到別人看不到的可能性。',
    '朱雀': '熱情洋溢，善於表達，具有強烈的感染力和社交能力。天生就是人群中的焦點，能夠有效激發團隊熱情。',
    '勾陳': '穩重可靠，注重秩序，具有優秀的組織能力和責任感。是團隊中最值得信賴的支柱，確保一切井然有序。',
    '螣蛇': '直覺敏銳，善於觀察，具有優秀的洞察力和協調能力。能夠感知他人未說出口的需求和情緒變化。',
    '白虎': '行動力強，目標明確，具有決斷力和執行力。面對挑戰時能夠快速做出決策並付諸行動。',
    '玄武': '深思熟慮，理性冷靜，具有優秀的分析能力和戰略思維。善於從複雜信息中提煉關鍵洞察。'
  };
  return personalities[beastType] || '具有獨特的人格特質。';
}

function getKeyStrengths(beastType) {
  const strengths = {
    '青龍': '創意發想、問題解決、適應變化',
    '朱雀': '人際溝通、團隊激勵、公開表達',
    '勾陳': '系統規劃、細節管理、穩定運作',
    '螣蛇': '人際洞察、危機處理、時機把握',
    '白虎': '快速決策、目標達成、壓力管理',
    '玄武': '深度思考、策略規劃、風險控制'
  };
  return strengths[beastType] || '多個領域';
}

function getSpecificStrengths(beastType) {
  const strengthMap = {
    '青龍': [
      '能夠在複雜情境中看到新的可能性',
      '善於將抽象概念轉化為具體方案',
      '面對變化時能夠快速調整策略',
      '具有跨界思考的獨特能力',
      '能夠激發團隊的創造性思維'
    ],
    '朱雀': [
      '能夠有效激發團隊的熱情與動力',
      '在公開場合表達清晰且有說服力',
      '善於建立廣泛的人際網絡',
      '能夠敏銳感知他人情緒變化',
      '具有優秀的衝突調解能力'
    ],
    '勾陳': [
      '能夠建立穩定可靠的工作系統',
      '注重細節確保任務完美執行',
      '在壓力下仍能保持冷靜專業',
      '具有優秀的時間管理能力',
      '能夠有效協調資源分配'
    ],
    '螣蛇': [
      '能夠準確讀懂他人的真實意圖',
      '善於在複雜人際關係中找到平衡',
      '具有優秀的危機預警能力',
      '能夠把握最佳行動時機',
      '具有深度傾聽和理解能力'
    ],
    '白虎': [
      '能夠在緊急情況下快速決策',
      '具有強大的目標達成能力',
      '面對壓力時表現出卓越韌性',
      '能夠有效領導團隊衝刺目標',
      '具有優秀的問題解決效率'
    ],
    '玄武': [
      '能夠進行深度系統性思考',
      '善於從數據中發現關鍵模式',
      '具有優秀的長期規劃能力',
      '能夠冷靜分析複雜情境',
      '具有卓越的風險評估能力'
    ]
  };
  return strengthMap[beastType] || ['具有多方面的能力優勢'];
}

function getSuitableCareerFields(beastType) {
  const fields = {
    '青龍': [
      '創新創業領域',
      '產品設計與開發',
      '市場策略規劃',
      '創意內容製作',
      '新興科技應用',
      '顧問諮詢服務'
    ],
    '朱雀': [
      '公關與媒體傳播',
      '教育培訓行業',
      '銷售與客戶關係',
      '活動策劃執行',
      '人力資源管理',
      '心理諮詢輔導'
    ],
    '勾陳': [
      '項目管理職位',
      '質量控制部門',
      '行政管理工作',
      '財務會計領域',
      '系統維護運營',
      '後勤支援服務'
    ],
    '螣蛇': [
      '心理諮詢輔導',
      '人力資源協調',
      '商業談判代表',
      '危機處理專家',
      '團隊建設指導',
      '客戶關係管理'
    ],
    '白虎': [
      '緊急救援服務',
      '銷售團隊領導',
      '項目執行管理',
      '競技體育領域',
      '軍事警察職業',
      '生產製造管理'
    ],
    '玄武': [
      '研究分析工作',
      '技術研發領域',
      '戰略規劃部門',
      '風險管理職位',
      '學術研究機構',
      '數據分析專業'
    ]
  };
  return fields[beastType] || ['多個職業領域'];
}

function getRelationshipPatterns(beastType, gender) {
  const patterns = {
    '青龍': '在關係中追求新鮮感和成長，需要足夠的個人空間和探索自由。喜歡與伴侶共同學習和體驗新事物，避免一成不變的相處模式。',
    '朱雀': '熱情而投入，重視情感表達和深度連結，需要被關注和認可。在關係中善於營造浪漫氛圍，但也需要得到同等的情感回饋。',
    '勾陳': '穩定而忠誠，注重實際行動和長期承諾，需要安全感和歸屬感。在關係中提供可靠支持，期望建立穩固長久的伴侶關係。',
    '螣蛇': '敏感而體貼，重視心靈契合和深度理解，需要信任和真誠。能夠敏銳感知伴侶需求，但也需要被深刻理解和接納。',
    '白虎': '直接而保護，重視行動證明和實際支持，需要尊重和獨立。在關係中表現出強烈的保護欲，但也需要個人空間和自主權。',
    '玄武': '深沉而理性，重視思想交流和智慧碰撞，需要空間和理解。在關係中追求深度連結，但也需要獨處時間進行思考。'
  };
  return patterns[beastType] || '具有獨特的情感表達方式。';
}

function getMoneyHexagram(beastType) {
  const hexagrams = {
    '青龍': '乾為天卦，象徵創造與開拓。財運如龍騰九天，宜把握創新機會，但需注意風險控制。適合投資新興產業和創意項目。',
    '朱雀': '離為火卦，象徵光明與連結。財運如鳳舞雲端，宜發展人脈資源，但需避免過度消費。適合從事與人相關的行業。',
    '勾陳': '坤為地卦，象徵穩定與積累。財運如大地承載，宜穩健投資，但需適時突破舒適圈。適合長期穩定的理財方式。',
    '螣蛇': '巽為風卦，象徵變通與時機。財運如風行草偃，宜把握時機進退，但需堅守原則。適合靈活多變的投資策略。',
    '白虎': '震為雷卦，象徵行動與突破。財運如雷動四方，宜積極開拓，但需注意衝動決策。適合高風險高回報的投資。',
    '玄武': '坎為水卦，象徵智慧與深謀。財運如水匯成淵，宜長期規劃，但需避免過度保守。適合研究和分析型投資。'
  };
  return hexagrams[beastType] || '具有獨特的財富能量模式。';
}

function getMainGrowthChallenges(beastType) {
  const challenges = {
    '青龍': '學習將創意落地執行，培養持續性和專注力，避免過度分散注意力。需要建立系統性的工作習慣，將靈感轉化為實際成果。',
    '朱雀': '平衡情感表達與理性思考，學習獨處和自我反思，避免過度依賴外部認可。需要發展內在安全感，建立健康的邊界感。',
    '勾陳': '突破傳統思維框架，學習接受變化與不確定性，避免過度保守和僵化。需要培養創新思維，適時跳出舒適圈。',
    '螣蛇': '建立明確的個人邊界，學習直接表達需求，避免過度適應他人期望。需要發展自我肯定，平衡他人需求與自我需求。',
    '白虎': '培養耐心和細緻，學習團隊合作與授權，避免過度控制和急躁。需要發展同理心，學習聆聽他人意見。',
    '玄武': '加強行動力和實踐，學習情感表達與連結，避免過度理性與疏離。需要培養直覺能力，平衡思考與行動。'
  };
  return challenges[beastType] || '持續的自我提升和成長。';
}

// 其他輔助函數
function getBeastTraits(beastType) {
  // 返回神獸特質描述
  return '';
}

function getGrowthSuggestions(beastType) {
  // 返回成長建議
  return '';
}

function getCombinationTraits(beast1, beast2) {
  // 返回組合特質
  return `結合了${beast1}的創造力和${beast2}的穩定性，形成獨特的優勢組合。`;
}

function getBehaviorPatterns(beastType, scores) {
  // 返回具體行為模式
  return `在壓力情境下傾向於${getPressureResponse(beastType)}，在社交場合中表現出${getSocialBehavior(beastType)}的特質。`;
}

function getDeepMotivations(beastType) {
  const motivations = {
    '青龍': '追求自由探索和創造性表達，渴望突破限制實現個人潛能。',
    '朱雀': '尋求情感連結和社會認同，渴望被看見、被理解和被珍惜。',
    '勾陳': '追求安全穩定和秩序和諧，渴望建立可靠的生活基礎。',
    '螣蛇': '尋求深度理解和心靈契合，渴望真實的內在連結。',
    '白虎': '追求成就目標和影響力，渴望證明自己的能力和價值。',
    '玄武': '尋求智慧真理和內在平靜，渴望理解生命深層意義。'
  };
  return motivations[beastType] || '具有獨特的內在驅動力。';
}

function getPressureResponse(beastType) {
  const responses = {
    '青龍': '尋求新的解決方案',
    '朱雀': '尋求情感支持',
    '勾陳': '建立更多結構',
    '螣蛇': '觀察和分析情況',
    '白虎': '採取直接行動',
    '玄武': '退後思考分析'
  };
  return responses[beastType] || '特定的應對方式';
}

function getSocialBehavior(beastType) {
  const behaviors = {
    '青龍': '活躍創新',
    '朱雀': '熱情外向',
    '勾陳': '穩重可靠',
    '螣蛇': '觀察傾聽',
    '白虎': '直接果斷',
    '玄武': '冷靜內向'
  };
  return behaviors[beastType] || '獨特的社交風格';
}

// 實現其他必要的內容生成函數...
function getCombinationStrengths(beast1, beast2) {
  return `這種獨特組合讓您在${beast1}的創新思維和${beast2}的務實執行之間找到完美平衡，能夠既看到遠景又注重細節。`;
}

function getWorkplaceAdvantages(beastType) {
  const advantages = {
    '青龍': '在快速變化的環境中表現出色，能夠為團隊帶來創新思維和突破性解決方案。',
    '朱雀': '優秀的團隊建設者和激勵者，能夠創造積極的工作氛圍並有效管理客戶關係。',
    '勾陳': '可靠的項目管理專家，能夠確保工作流程的順暢運行和品質標準的嚴格把關。',
    '螣蛇': '出色的人際關係專家，能夠有效化解衝突、促進團隊合作並把握最佳時機。',
    '白虎': '高效的執行領導者，能夠在壓力下快速決策並帶領團隊達成挑戰性目標。',
    '玄武': '深度的戰略思考者，能夠進行複雜分析、制定長遠規劃並有效管理風險。'
  };
  return advantages[beastType] || '在多個工作場景中具有獨特優勢。';
}

function getCareerDevelopmentTips(beastType) {
  const tips = {
    '青龍': '建議選擇允許創意發揮的工作環境，同時學習項目管理技能來確保創意落地。',
    '朱雀': '建議發展公關或培訓相關技能，同時學習情緒管理來保持工作生活平衡。',
    '勾陳': '建議深耕專業領域成為專家，同時適時接受新挑戰以避免過度保守。',
    '螣蛇': '建議發展諮詢或協調相關職業，同時學習設定明確的個人邊界。',
    '白虎': '建議追求領導管理職位，同時培養團隊合作和耐心等待的藝術。',
    '玄武': '建議從事研究或分析工作，同時學習將深度思考轉化為實際行動。'
  };
  return tips[beastType] || '持續學習和專業發展是關鍵。';
}

function getCommunicationStyle(beastType) {
  const styles = {
    '青龍': '富有想像力和啟發性，喜歡用比喻和故事來表達想法。',
    '朱雀': '熱情洋溢且富有感染力，善於用情感語言建立連結。',
    '勾陳': '清晰具體且實事求是，注重邏輯性和實際效果。',
    '螣蛇': '細膩體貼且富有同理心，能夠感知言外之意。',
    '白虎': '直接了當且目標明確，注重效率和結果導向。',
    '玄武': '深思熟慮且富有智慧，注重深度和邏輯嚴謹性。'
  };
  return styles[beastType] || '具有獨特的溝通特點。';
}

function getIntimacyAdvice(beastType, gender) {
  const advice = {
    '青龍': '在親密關係中需要保持一定的新鮮感和探索空間，與伴侶共同制定冒險計劃可以增進感情。',
    '朱雀': '需要定期的情感交流和深度連結，學習表達真實需求的同時也給予伴侶足夠的關注。',
    '勾陳': '建立穩定可靠的相處模式很重要，同時也要學會在關係中適時展現脆弱和尋求支持。',
    '螣蛇': '深度理解和心靈契合是關鍵，學習在敏感感知他人需求的同時也明確表達自己的邊界。',
    '白虎': '行動勝於言語的表達方式，在展現保護力的同時也要學習聆聽和尊重伴侶的獨立性。',
    '玄武': '需要獨處思考的空間和理解，在追求深度交流的同時也要學習情感表達和即時回應。'
  };
  return advice[beastType] || '建立健康平衡的親密關係需要相互理解和尊重。';
}

function getCompatibleTypes(beastType) {
  const compatibilities = {
    '青龍': ['勾陳型', '玄武型', '螣蛇型'],
    '朱雀': ['玄武型', '白虎型', '青龍型'],
    '勾陳': ['青龍型', '朱雀型', '螣蛇型'],
    '螣蛇': ['白虎型', '玄武型', '勾陳型'],
    '白虎': ['螣蛇型', '朱雀型', '玄武型'],
    '玄武': ['朱雀型', '青龍型', '白虎型']
  };
  return compatibilities[beastType] || ['多種人格類型'];
}

function getGrowthActions(beastType) {
  const actions = {
    '青龍': [
      '每天設定具體的執行目標',
      '學習時間管理和優先級排序',
      '建立創意項目的完成儀式',
      '練習專注力訓練和冥想',
      '尋找創意落地的合作夥伴'
    ],
    '朱雀': [
      '建立個人獨處的定期時間',
      '學習情緒日記和自我反思',
      '發展不依賴外部的自我價值',
      '練習設定健康的人際邊界',
      '培養個人興趣和獨立活動'
    ],
    '勾陳': [
      '每週嘗試一件新事物',
      '學習接受不完美和犯錯',
      '參與創意和冒險性活動',
      '練習靈活應變的思維模式',
      '尋找突破舒適圈的機會'
    ],
    '螣蛇': [
      '練習直接表達需求和感受',
      '學習說"不"和設定界限',
      '發展個人決策的自信',
      '平衡他人需求與自我需求',
      '建立個人目標和優先事項'
    ],
    '白虎': [
      '練習耐心聆聽和團隊合作',
      '學習授權和信任他人',
      '發展同理心和情感智慧',
      '培養細緻觀察的習慣',
      '練習等待和時機把握'
    ],
    '玄武': [
      '設定行動截止日期',
      '練習即時決策和行動',
      '發展情感表達能力',
      '參與團隊合作項目',
      '平衡思考與實踐時間'
    ]
  };
  return actions[beastType] || ['持續的自我覺察和改進'];
}

function getWeaknessDevelopment(beastType) {
  const developments = {
    '青龍': '可以透過結構化學習和專注訓練來發展執行力，將創意轉化為實際成果。',
    '朱雀': '可以透過獨處反思和內在探索來發展自我認知，建立更穩定的內在基礎。',
    '勾陳': '可以透過冒險體驗和創新挑戰來發展適應力，擁抱變化和不確定性。',
    '螣蛇': '可以透過自信訓練和邊界設定來發展自我肯定，平衡付出與接收。',
    '白虎': '可以透過團隊合作和耐心練習來發展協作力，學習信任和授權。',
    '玄武': '可以透過行動實踐和情感表達來發展執行力，平衡思考與行動。'
  };
  return developments[beastType] || '透過有意識的練習可以發展相關能力。';
}

function getWealthEnergy(beastType) {
  const energies = {
    '青龍': '財富能量如活水源頭，源源不絕但需要正確引導。適合開創性投資和創新項目。',
    '朱雀': '財富能量如火焰燃燒，熱情旺盛但需要穩定燃料。適合人脈相關和服務性行業。',
    '勾陳': '財富能量如大地積累，穩定增長但需要適時突破。適合長期投資和實體產業。',
    '螣蛇': '財富能量如風之流動，靈活多變但需要把握時機。適合時機性投資和中介服務。',
    '白虎': '財富能量如雷之迅猛，快速獲取但需要風險控制。適合主動出擊和高回報投資。',
    '玄武': '財富能量如水之深藏，智慧積累但需要行動實踐。適合研究型投資和技術領域。'
  };
  return energies[beastType] || '具有獨特的財富創造模式。';
}

function getSuitableInvestments(beastType) {
  const investments = {
    '青龍': '新創公司、科技股、創意產業、教育培訓、個人品牌',
    '朱雀': '服務業、娛樂產業、公關公司、教育機構、社交平台',
    '勾陳': '房地產、基礎建設、公用事業、傳統製造、儲蓄保險',
    '螣蛇': '中介服務、諮詢業、人力資源、心理服務、時機性投資',
    '白虎': '主動投資、創業項目、體育產業、軍工股、急難救助',
    '玄武': '研究開發、技術專利、數據分析、風險投資、長期持股'
  };
  return investments[beastType] || '多元化的投資組合';
}

function getWealthDevelopmentTips(beastType) {
  const tips = {
    '青龍': '建議將創意與商業模式結合，尋找可靠的合作夥伴來協助執行，避免過度分散投資。',
    '朱雀': '建議利用人脈資源發展事業，建立個人品牌影響力，同時注意財務紀律和儲蓄計劃。',
    '勾陳': '建議採取穩健的財富積累策略，適時投資創新領域，避免過度保守錯失機會。',
    '螣蛇': '建議把握市場時機進行投資，發展諮詢或中介服務，同時建立明確的財務目標。',
    '白虎': '建議採取積極的財富創造策略，控制投資風險，學習長期財富規劃的重要性。',
    '玄武': '建議進行深度市場研究後投資，發展專業技術或知識變現，平衡分析與行動。'
  };
  return tips[beastType] || '建立系統性的財富管理計劃是關鍵。';
}

function getCrossFieldPotential(beastType) {
  return `您的${beastType}特質讓您在跨領域發展中具有獨特優勢，能夠將不同領域的知識和技能創造性地結合，開創新的可能性。`;
}

// ========== AI分析 ==========
function generateAIAnalysis() {
  const saved = JSON.parse(localStorage.getItem("shen-shou-result") || "null");
  if (!saved) {
    alert("⚠️請先完成測驗。");
    return;
  }
  
  const loadingEl = document.getElementById("ai-loading");
  const contentEl = document.getElementById("ai-analysis-content");
  const btnAI = document.getElementById("btnAI");
  const btnRetry = document.getElementById("btnRetry");
  
  loadingEl.style.display = "block";
  contentEl.style.display = "none";
  btnRetry.style.display = "none";
  btnAI.disabled = true;
  
  simulateProgress();
  
  // 模擬AI分析過程
  setTimeout(() => {
    fillAIAnalysis(saved.summary.top);
    
    loadingEl.style.display = "none";
    contentEl.style.display = "block";
    btnRetry.style.display = "inline-block";
    btnAI.disabled = false;
  }, 3000);
}

function simulateProgress() {
  const progressBar = document.getElementById("progress-bar");
  const loadingStep = document.getElementById("loading-step");
  const steps = [
    {percent: 20, text: "分析人格特質..."},
    {percent: 40, text: "解析能量分布..."},
    {percent: 60, text: "生成發展建議..."},
    {percent: 80, text: "計算五行金錢卦..."},
    {percent: 95, text: "最終整合報告..."},
    {percent: 100, text: "分析完成！"}
  ];
  
  let currentStep = 0;
  const interval = setInterval(() => {
    if (currentStep < steps.length) {
      progressBar.style.width = steps[currentStep].percent + "%";
      loadingStep.textContent = steps[currentStep].text;
      currentStep++;
    } else {
      clearInterval(interval);
    }
  }, 500);
}

// ========== 分享功能 ==========
function shareResult() {
  html2canvas(document.getElementById("result")).then(canvas => {
    const link = document.createElement("a");
    link.download = "shenshou-result.png";
    link.href = canvas.toDataURL();
    link.click();
  });
}

// ========== 列印功能 ==========
function printAnalysis() {
  // 簡單的列印功能
  window.print();
}

// 全域變數
window.currentBeastType = '';
</script>
</body>
</html>
