<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹æ™ºèƒ½å ±è¡¨ï¼ˆV5 å°ˆæ¥­ç‰ˆï¼‰</title>
  <meta name="description" content="30é¡Œé‡è¡¨ï½œå…­ç¸é›·é”åœ–ï½œä¸»ç¥ç¸ï¼‹é›™ç¸å‹ï½œä¸‰æ¬„å»ºè­°ï¼ˆè·å ´ï¼æ„Ÿæƒ…ï¼é¤Šç”Ÿï¼‰ï½œå“ç‰ŒLogoï½œåˆ†æå¸«å¡ï½œä¸€éµåˆ—å°ï¼PNGä¸‹è¼‰ï½œVercel/GitHub Pages çš†å¯ç”¨" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root{--brand:#B6822B;--ink:#1f2937}
    .brand{color:var(--brand)}
    .brand-bg{background:var(--brand)}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:18px;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .slider{accent-color:var(--brand)}
    .page{break-inside:avoid}
    @media print{
      body{background:#fff !important}
      .no-print{display:none !important}
      .card{box-shadow:none;border-color:#d1d5db}
      .report{color:var(--ink)}
      .page{break-inside:avoid}
    }
    @page{size:A4;margin:12mm}
    .print-landscape @page{size:A4 landscape}
  </style>
</head>
<body class="bg-[#f6f7fb] text-slate-800">
  <main class="max-w-6xl mx-auto p-4 sm:p-6">
    <!-- æŠ¬é ­ï¼šLogo + æ¨™é¡Œ + åˆ—å°æ–¹å‘ -->
    <header class="mb-4 sm:mb-6">
      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <!-- é€™è£¡ä¸ç›´æ¥å¯« srcï¼Œäº¤çµ¦ JS è‡ªå‹•å¸¶å…¥æ­£ç¢ºè·¯å¾‘ -->
          <img data-logo alt="ä»™äººæŒ‡è·¯ Logo" class="h-10 w-auto rounded" onerror="this.outerHTML='<span class=&quot;text-sm text-slate-500&quot;>Logo</span>'" />
          <div>
            <h1 class="text-2xl sm:text-3xl font-extrabold brand">ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹æ™ºèƒ½å ±è¡¨</h1>
            <p class="text-slate-600 text-sm">30é¡Œé‡è¡¨ãƒ»å…­ç¸é›·é”åœ–ãƒ»ä¸»ç¥ç¸è§£æãƒ»ä¸‰æ¬„å»ºè­°ï¼ˆè·å ´ï¼æ„Ÿæƒ…ï¼é¤Šç”Ÿï¼‰ãƒ»åˆ†æå¸«å¡ãƒ»åˆ—å°/PNGãƒ»AI å»ºè­°</p>
          </div>
        </div>
        <div class="no-print text-right space-y-2">
          <div class="text-xs text-slate-500">åˆ—å°æ–¹å‘</div>
          <div class="inline-flex gap-2">
            <label class="text-sm"><input type="radio" name="orient" value="portrait" checked class="mr-1">ç›´å¼A4</label>
            <label class="text-sm"><input type="radio" name="orient" value="landscape" class="mr-1">æ©«å¼A4</label>
          </div>
        </div>
      </div>
    </header>

    <!-- æ§åˆ¶åˆ— -->
    <section class="card p-4 sm:p-5 mb-4 no-print">
      <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-3">
        <div class="text-sm text-slate-600">é‡è¡¨èªªæ˜ï¼š1ï¼å®Œå…¨ä¸åŒæ„ ï½œ 3ï¼æ™®é€š ï½œ 5ï¼éå¸¸åŒæ„</div>
        <div class="flex flex-wrap gap-2">
          <button id="btnFillMid" class="px-3 py-2 text-sm border rounded-lg">å…¨éƒ¨å¡«3</button>
          <button id="btnReset" class="px-3 py-2 text-sm border rounded-lg">æ¸…ç©º</button>
          <button id="btnRandomize" class="px-3 py-2 text-sm border rounded-lg">éš¨æ©Ÿé¡Œåº</button>
        </div>
      </div>
    </section>

    <!-- å•å· -->
    <form id="form" class="card p-4 sm:p-5">
      <ol id="qWrap" class="space-y-3"></ol>
      <div class="mt-5 flex gap-3 flex-wrap no-print">
        <button type="submit" class="brand-bg text-white px-5 py-3 rounded-xl font-semibold shadow">é€å‡ºæ¸¬é©—</button>
      </div>
    </form>

    <!-- çµæœï¼‹å ±è¡¨ -->
    <section id="result" class="mt-6 grid lg:grid-cols-2 gap-4">
      <!-- é›·é”åœ– -->
      <div class="card p-4 sm:p-5 page">
        <h2 class="text-lg font-bold mb-3">å…­ç¸èƒ½é‡é›·é”åœ–</h2>
        <canvas id="radar"></canvas>
        <div class="text-xs text-slate-500 mt-2">è‹¥å…©å€‹æœ€é«˜åˆ†å·® â‰¤ 1ï¼Œå°‡é¡¯ç¤ºç‚ºã€Œé›™ç¸å‹ã€ã€‚</div>
        <div class="flex flex-wrap gap-2 mt-4 no-print">
          <button id="btnDownloadPNG" class="px-4 py-2 bg-amber-600 text-white rounded-lg">ä¸‹è¼‰çµæœå¡ PNG</button>
          <button id="btnPrint" class="px-4 py-2 border rounded-lg">åˆ—å°å ±è¡¨</button>
        </div>
      </div>

      <!-- å ±è¡¨å¡ï¼ˆæœƒè¢«ä¸‹è¼‰ï¼†åˆ—å°ï¼‰ -->
      <div class="card p-4 sm:p-5 page report" id="resultCard">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-bold">ä¸»ç¥ç¸çµæœèˆ‡ä¸‰æ¬„å»ºè­°</h2>
          <!-- ä¸‹æ–¹å ±è¡¨çš„ Logo ä¹Ÿèµ° data-logo -->
          <img data-logo alt="Logo" class="h-8 w-auto" onerror="this.style.display='none'" />
        </div>

        <div class="grid grid-cols-3 gap-3 items-start mt-2">
          <div class="col-span-1"><div id="beastSVG" class="w-full aspect-square"></div></div>
          <div class="col-span-2">
            <div id="mainBeastTitle" class="text-base font-semibold brand"></div>
            <div id="dualHint" class="mt-1 text-sm text-slate-600"></div>
            <div id="mainBeastSummary" class="mt-2 text-sm"></div>
          </div>
        </div>

        <hr class="my-3" />
        <div id="adviceCols" class="grid md:grid-cols-3 gap-3 text-sm"></div>

        <hr class="my-3" />
        <h3 class="text-base mb-1">å…­ç¸åˆ†æ•¸</h3>
        <div id="scoreList" class="grid grid-cols-2 sm:grid-cols-3 gap-x-4 gap-y-1 text-sm"></div>

        <hr class="my-3" />
        <!-- åˆ†æå¸«å¡ -->
        <div class="grid md:grid-cols-3 gap-3">
          <div class="md:col-span-2">
            <h3 class="text-base font-bold mb-1">ğŸ‘¤ åˆ†æå¸«è³‡æ–™</h3>
            <div class="grid sm:grid-cols-2 gap-2">
              <div><div class="text-xs text-slate-500">å§“å</div><div id="instName" class="font-medium">æ—è”šé’ é˜¿é’å¸«</div></div>
              <div><div class="text-xs text-slate-500">è¯çµ¡æ–¹å¼</div><div id="instContact" class="font-medium">LINEï¼š@chin573365</div></div>
            </div>
            <div class="mt-2">
              <div class="text-xs text-slate-500">è‡ªæˆ‘ä»‹ç´¹</div>
              <div id="instBio" class="text-sm">ä»¥é‡‘éŒ¢å¦ç‚ºæ ¸å¿ƒï¼Œèåˆä¸­é†«äº”è¡Œï¼ŒæŒ‡å¼•äººç”Ÿæ–¹å‘ã€‚</div>
            </div>
          </div>
          <div class="flex items-center justify-center">
            <div class="text-center">
              <div class="text-xs text-slate-500 mb-1">åˆ†æå¸«å€‹äºº QR</div>
              <img id="instQRPreview" src="" alt="åˆ†æå¸«QR" class="h-28 w-28 object-contain border rounded mx-auto" />
            </div>
          </div>
        </div>

        <hr class="my-3" />
        <!-- åº•éƒ¨ï¼šå®˜æ–¹ QR + æˆæ¬Šèª -->
        <div class="grid grid-cols-3 items-center">
          <div class="text-xs text-slate-500">ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒ</div>
          <div class="text-center text-xs brand">æœ¬åˆ†æå ±è¡¨ç”±ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒæˆæ¬Šåˆ†æå¸«å‡ºå…·</div>
          <div class="text-right">
            <img data-qr alt="LINE QR" class="h-16 w-16 inline-block border rounded" onerror="this.outerHTML='<span class=&quot;text-xs text-slate-400&quot;>QR ç„¡æ³•è¼‰å…¥</span>'" />
          </div>
        </div>
      </div>
    </section>

    <!-- åˆ†æå¸«è¼¸å…¥å€ï¼ˆä¸åˆ—å°ï¼‰ -->
    <section class="card p-4 sm:p-5 mt-4 no-print">
      <h2 class="text-lg font-bold mb-2">åˆ†æå¸«è³‡è¨Šè¼¸å…¥ï¼ˆæœƒé¡¯ç¤ºåœ¨å ±è¡¨ä¸Šï¼‰</h2>
      <div class="grid sm:grid-cols-3 gap-3">
        <div>
          <label class="text-xs text-slate-500">å§“å</label>
          <input id="fName" class="w-full px-3 py-2 border rounded-lg" value="æ—è”šé’ é˜¿é’å¸«" />
        </div>
        <div>
          <label class="text-xs text-slate-500">è¯çµ¡æ–¹å¼</label>
          <input id="fContact" class="w-full px-3 py-2 border rounded-lg" value="LINEï¼š@chin573365" />
        </div>
        <div>
          <label class="text-xs text-slate-500">è‡ªæˆ‘ä»‹ç´¹ï¼ˆæœ€å¤šä¸‰è¡Œï¼‰</label>
          <input id="fBio" class="w-full px-3 py-2 border rounded-lg" value="ä»¥é‡‘éŒ¢å¦ç‚ºæ ¸å¿ƒï¼Œèåˆä¸­é†«äº”è¡Œï¼ŒæŒ‡å¼•äººç”Ÿæ–¹å‘ã€‚" />
        </div>
      </div>
      <div class="mt-3">
        <label class="text-xs text-slate-500 block mb-1">ä¸Šå‚³åˆ†æå¸«å€‹äºº QRï¼ˆå¯é¸ï¼‰</label>
        <input id="fQR" type="file" accept="image/*" class="block" />
        <div class="text-xs text-slate-500 mt-1">ï¼ˆåƒ…å­˜æ–¼æœ¬æ©Ÿç€è¦½å™¨ï¼Œä¸ä¸Šå‚³ä¼ºæœå™¨ï¼‰</div>
      </div>
      <div class="mt-3">
        <button id="btnSaveInst" class="px-4 py-2 border rounded-lg">å„²å­˜åˆ†æå¸«è³‡è¨Š</button>
      </div>
    </section>

    <section class="card p-4 sm:p-5 mt-4 no-print">
      <h2 class="text-lg font-bold mb-2">OpenAI æ™ºèƒ½å€‹äººåŒ–è£œé‹å»ºè­°</h2>
      <p class="text-sm text-slate-600 mb-2">æ­¤åŠŸèƒ½æœƒå‘¼å« <code>/api/ai</code>ï¼ˆVercel å¾Œç«¯ä»£å‘¼ OpenAIï¼‰ã€‚è‹¥åœ¨ GitHub Pagesï¼Œè«‹å¿½ç•¥æ­¤å€ã€‚</p>
      <button id="btnAI" class="px-4 py-2 border rounded-lg">ç”¢ç”Ÿè£œé‹å»ºè­°</button>
      <pre id="aiOut" class="mt-3 text-sm bg-slate-50 p-3 rounded-lg whitespace-pre-wrap"></pre>
    </section>

    <footer class="text-center text-xs text-slate-500 mt-8">
      Â© 2025 ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒï½œæ¸¬é©—åƒ…ä¾›è¦ºå¯Ÿèˆ‡æ•™å­¸ç”¨é€”
    </footer>
  </main>

<script>
/* ========= è‡ªå‹•è¨­å®šåœ–ç‰‡è·¯å¾‘ï¼ˆåŒæ™‚æ”¯æ´ GitHub Pages èˆ‡ Vercelï¼‰ ========= */
(function setAssetPaths(){
  // è‹¥åœ¨ GitHub Pagesï¼šhost æœƒæ˜¯ *.github.ioï¼Œä¸”ç¬¬ä¸€å±¤è·¯å¾‘ç‚º repo åï¼ˆä¾‹å¦‚ shen-shou-v5ï¼‰
  const parts = location.pathname.split('/').filter(Boolean);
  const base = location.host.endsWith('github.io') ? ('/' + (parts[0] || '')) : '';
  const logoUrl = `${base}/img/logo.png`;
  const qrUrl   = `${base}/img/line-qr.jpg`;

  document.querySelectorAll('[data-logo]').forEach(el => el.src = logoUrl);
  document.querySelectorAll('[data-qr]').forEach(el => el.src = qrUrl);
})();

/* =========================
   é¡Œåº«ï¼š6ç¸ Ã— 5é¡Œ = 30é¡Œ
========================= */
const BANK = [
  {t:"æˆ‘å¸¸æœ‰çªå¦‚å…¶ä¾†çš„éˆæ„Ÿä¸¦æƒ³ç«‹å³å˜—è©¦ã€‚",b:"é’é¾"},{t:"æˆ‘å–œæ­¡æ‰“ç ´å¸¸è¦å°‹æ‰¾æ–°æ–¹æ³•ã€‚",b:"é’é¾"},{t:"é‡é˜»åŠ›æ™‚æˆ‘æœƒéˆæ´»è½‰å‘ã€‚",b:"é’é¾"},{t:"æˆ‘å¯Œæƒ³åƒåŠ›ï¼Œå–œæ­¡å‰µæ–°æ€è€ƒã€‚",b:"é’é¾"},{t:"æˆ‘ç†±æ„›æ¢ç´¢æœªçŸ¥äº‹ç‰©ã€‚",b:"é’é¾"},
  {t:"æˆ‘å–œæ­¡åœ¨äººç¾¤ä¸­è¡¨é”è‡ªå·±ã€‚",b:"æœ±é›€"},{t:"æˆ‘ç”¨æƒ…ç·’å¸¶å‹•ä»–äººã€‚",b:"æœ±é›€"},{t:"åˆ¥äººçš„åæ‡‰æœƒå½±éŸ¿æˆ‘ã€‚",b:"æœ±é›€"},{t:"æˆ‘æ“…é•·èªªæœèˆ‡æ¼”èªªã€‚",b:"æœ±é›€"},{t:"æˆ‘é‡è¦–è¢«å‚¾è½èˆ‡é—œæ³¨ã€‚",b:"æœ±é›€"},
  {t:"æˆ‘å–œæ­¡æŒ‰è¨ˆç•«è¡Œäº‹ã€‚",b:"å‹¾é™³"},{t:"æˆ‘é‡è¦–å®‰å…¨æ„Ÿèˆ‡ç©©å®šã€‚",b:"å‹¾é™³"},{t:"æˆ‘è²¬ä»»æ„Ÿå¼·ã€‚",b:"å‹¾é™³"},{t:"æˆ‘å‚¾å‘ç¶­æŒç¾ç‹€ã€‚",b:"å‹¾é™³"},{t:"æˆ‘æ³¨é‡ç´°ç¯€èˆ‡ç¨‹åºã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘å°ä»–äººæƒ…ç·’å¾ˆæ•æ„Ÿã€‚",b:"è£è›‡"},{t:"æˆ‘æ“…é•·è§€å¯Ÿèˆ‡å‚¾è½ã€‚",b:"è£è›‡"},{t:"æˆ‘æ€è€ƒäº‹æƒ…æœƒè€ƒé‡æ™‚æ©Ÿèˆ‡äººå¿ƒã€‚",b:"è£è›‡"},{t:"æˆ‘å¸¸æ€è€ƒèƒŒå¾Œçš„å‹•æ©Ÿã€‚",b:"è£è›‡"},{t:"æˆ‘å–„æ–¼å”èª¿ä¸åŒè§€é»ã€‚",b:"è£è›‡"},
  {t:"æˆ‘è¬›æ±‚æ•ˆç‡èˆ‡çµæœã€‚",b:"ç™½è™"},{t:"æˆ‘æœƒä¸»å‹•åšæ±ºç­–ã€‚",b:"ç™½è™"},{t:"æˆ‘ä»¥æ•¸æ“šèˆ‡æˆæœç‚ºå°å‘ã€‚",b:"ç™½è™"},{t:"æˆ‘é¡˜æ„æ‰¿æ“”å£“åŠ›ä»¥å®Œæˆä»»å‹™ã€‚",b:"ç™½è™"},{t:"æˆ‘åå¥½æ˜ç¢ºçš„è¦ç¯„èˆ‡æ¨™æº–ã€‚",b:"ç™½è™"},
  {t:"æˆ‘å–œæ­¡ç¨è‡ªæ€è€ƒã€‚",b:"ç„æ­¦"},{t:"æˆ‘å‚¾å‘è¬¹æ…è©•ä¼°å¾Œè¡Œå‹•ã€‚",b:"ç„æ­¦"},{t:"æˆ‘æ“…é•·è¦åŠƒé•·é ç›®æ¨™ã€‚",b:"ç„æ­¦"},{t:"æˆ‘é‡è¦–é‚è¼¯èˆ‡åˆ†æã€‚",b:"ç„æ­¦"},{t:"æˆ‘ç¿’æ…£å†·éœçœ‹å¾…å•é¡Œã€‚",b:"ç„æ­¦"}
];

/* =========================
   ä¸‰æ¬„å¼å»ºè­°è³‡æ–™åº«
========================= */
const ADVICES = {
  é’é¾:{title:"é’é¾ï¼ˆæœ¨ï¼‰â€” å‰µæ„ï¼è®Šé€š",summary:"ä½ çš„æœ¨è¡Œèƒ½é‡æ—ºç››ï¼Œæ“…é•·æ‰“ç ´æ¡†æ¶ã€æ¿€ç™¼æ–°è·¯ã€‚é—œéµåœ¨æ–¼èšç„¦èˆ‡è½åœ°ã€‚",
    workplace:["æŠŠå‰µæ„åŒ–ç‚º 1 å€‹ã€æœ¬æœˆ MVP å°å°ˆæ¡ˆã€ä¸¦è¨­å®šæ™‚ç¨‹è¡¨ã€‚","æ‰¾ 1 ä½ã€å‹¾é™³å¤¥ä¼´ã€åšæµç¨‹æŠŠé—œï¼Œé¿å…ç†æƒ³é£›èµ°ã€‚","æ¯æ¬¡ææ¡ˆå…ˆçµ¦ 1 å¼µã€ä¸€é ä¼åŠƒåœ–ã€ï¼Œè®“ä¸»ç®¡çœ‹è¦‹è½åœ°è·¯å¾‘ã€‚"],
    love:["ä¸»å‹•é‚€ç´„ä¼´ä¾¶åƒèˆ‡ä½ çš„æ–°é»å­ï¼Œè®“å°æ–¹æˆç‚ºå…±åŒå‰µä½œè€…ã€‚","ç·´ç¿’ 2/3 è½ã€1/3 èªªï¼Œé¿å…åªè¬›é¡˜æ™¯ã€‚","æ¯é€±å›ºå®šã€å„€å¼æ„Ÿæ™‚åˆ»ã€ï¼Œé™ä½å¿½å†·å¿½ç†±ã€‚"],
    health:["ç–è‚ç†æ°£ï¼šæ—©æ™¨æ·±å‘¼å¸ï¼‹å¿«èµ° 20 åˆ†é˜ã€‚","é£²é£Ÿï¼šç¶ è±†èŠ½ã€èŠ±æ¤°èœã€é‡‘æ¡”ï¼›å°‘é…’ç²¾ç†¬å¤œã€‚","å¡ä½æ™‚åšã€æ›¸å¯«å‚¾å€’ã€ï¼Œæ¸…å‡ºè…¦ä¸­æœªç«Ÿäº‹é …ã€‚"]},
  æœ±é›€:{title:"æœ±é›€ï¼ˆç«ï¼‰â€” è¡¨é”ï¼æ„ŸæŸ“åŠ›",summary:"å¤–æ”¾ç«è¡Œå¼·ï¼Œæ“…é•·æºé€šå¸¶å‹•æ°£æ°›ã€‚é—œéµåœ¨æ–¼ç¯€å¥èˆ‡ç•Œç·šã€‚",
    workplace:["æœƒè­°å‰åˆ— 3 é»æ ¸å¿ƒè¨Šæ¯ï¼Œé¿å…éåº¦å»¶ä¼¸ã€‚","ã€è‚¯å®šâ†’å»ºè­°â†’æ‰¿è«¾ã€ä¸‰æ­¥é©Ÿæå‡èªªæœåŠ›ã€‚","è¨­å®šã€å†·å»æ™‚é–“ã€å†æ±ºç­–ï¼Œé¿å…æƒ…ç·’æ€§æ‰¿è«¾ã€‚"],
    love:["ç”¨ã€æˆ‘è¨Šæ¯ã€æè¿°æ„Ÿå—ï¼Œé¿å…æŒ‡è²¬èªæ°£ã€‚","å®‰æ’å…±åŒç¤¾äº¤æ´»å‹•ï¼Œæ»¿è¶³é€£çµéœ€æ±‚ã€‚","æƒ…ç·’é«˜å³°å…ˆæš«åœ 10 åˆ†é˜å†æºé€šã€‚"],
    health:["å¿ƒç«æ—ºè€…åš 4-7-8 å‘¼å¸æ³•é®å®šç¥ç¶“ã€‚","é£²é£Ÿï¼šè“®å­ã€ç™¾åˆã€è“®è—•ï¼›å°‘è¾›è¾£èˆ‡å’–å•¡å› ã€‚","æ¯é€± 2 æ¬¡ç·©å’Œæœ‰æ°§æˆ–ç‘œä¼½ï¼Œç©©å®šç«æ°£ã€‚"]},
  å‹¾é™³:{title:"å‹¾é™³ï¼ˆåœŸï¼‰â€” ç©©å®šï¼ç¶­é‹",summary:"åœŸè¡Œæ²‰ç©©å¯é ï¼Œæ“…é•·æµç¨‹èˆ‡é¢¨éšªæ§ç®¡ã€‚é—œéµåœ¨æ–¼æ“´å¼µèˆ’é©åœˆã€‚",
    workplace:["æ¯å­£ä¸»å‹•æ 1 é …æµç¨‹å„ªåŒ–ï¼Œç·´ç¿’å°å¹…å‰µæ–°ã€‚","èˆ‡ã€é’é¾å¤¥ä¼´ã€çµå°ï¼Œè®“æ–°é»å­åœ¨ä½ æ‰‹ä¸­è½åœ°ã€‚","å¾…è¾¦æ‹†æˆ 25 åˆ†é˜ç•ªèŒ„é˜ï¼Œé¿å…å£“åŠ›å †ç©ã€‚"],
    love:["ä¸»å‹•èªªå‡ºä½ çš„éœ€è¦ï¼Œåˆ¥ä»¥ç‚ºæ²‰é»˜å°±èƒ½è¢«ç†è§£ã€‚","æ¯æœˆå®‰æ’ 1 æ¬¡ã€æ–°é®®é«”é©—ç´„æœƒã€ï¼Œæ´»çµ¡æƒ…æ„Ÿã€‚","ç·´ç¿’è¡¨é”è®šç¾ï¼Œå¢åŠ é—œä¿‚æº«åº¦ã€‚"],
    health:["è„¾èƒƒèª¿ç†ï¼šæ—©ç¡æ—©èµ·ã€å°‘æ™šé£Ÿã€‚","é£²é£Ÿï¼šå—ç“œã€å±±è—¥ã€è–ä»ï¼Œæ¸›å°‘å†°å†·ç”Ÿé£Ÿã€‚","æ¯æ—¥ 10 åˆ†é˜è…¹å¼å‘¼å¸ï¼Œå¢å¼·ä¸­æ°£ã€‚"]},
  è£è›‡:{title:"è£è›‡ï¼ˆç«æœ¨ï¼‰â€” æ´å¯Ÿï¼ç­–ç•¥",summary:"é«˜æ•è¦ºå¯Ÿèˆ‡äººå¿ƒæ´æ‚‰ï¼Œå–„æ–¼æŠ“æ™‚æ©Ÿã€‚é—œéµåœ¨æ–¼æ­¢è§€èˆ‡è¡Œå‹•ã€‚",
    workplace:["æŠŠæ´å¯Ÿå¯«æˆã€æ±ºç­–å‚™å¿˜éŒ„ã€ï¼Œè®“åœ˜éšŠè·Ÿä¸Šç›´è¦ºã€‚","è¨­å®šã€72 å°æ™‚å…§æœ€å°è¡Œå‹•ã€ï¼Œé¿å…æƒ³å¤ªå¤šä¸å‹•ã€‚","å»ºç«‹ç•Œç·šï¼šä¸å¯æ•‘çš„è­°é¡Œï¼Œå­¸æœƒè½‰äº¤æˆ–çµ‚æ­¢ã€‚"],
    love:["èªªå‡ºä½ çš„æ“”å¿ƒè€Œéè¿´é¿ï¼Œè®“ä¼´ä¾¶çŸ¥é“ä½ åœ¨ä¹ã€‚","ç·´ç¿’è«‹æ±‚è€Œéè©¦æ¢ï¼Œæ¸›å°‘éŒ¯é »ã€‚","å®‰æ’éœå¿ƒæ•£æ­¥ï¼Œå®‰å®šé«˜æ•åº¦ã€‚"],
    health:["æ¼¸é€²å¼è‚Œè‚‰æ”¾é¬†æˆ–ç‘œä¼½å°¼å¾·æ‹‰ã€‚","é£²é£Ÿï¼šèŠèŠ±ã€æ±ºæ˜å­èŒ¶åŠ©æ¸…è‚æ˜ç›®ã€‚","é¿å…é•·æ™‚é–“è¢å¹•ï¼Œä¿è­·ç¥ç¶“ç³»çµ±ã€‚"]},
  ç™½è™:{title:"ç™½è™ï¼ˆé‡‘ï¼‰â€” è¡Œå‹•ï¼æ•ˆç‡",summary:"æœæ±ºè¿…é€Ÿèˆ‡çµæœå°å‘ã€‚é—œéµåœ¨æ–¼åŒç†èˆ‡è€å¿ƒã€‚",
    workplace:["æ¯æ¬¡æŒ‡ä»¤é™„ã€ç‚ºä»€éº¼ã€ï¼Œæå‡å…§åœ¨å‹•æ©Ÿã€‚","è¨­ç½®ã€ç·©è¡æ—¥ã€é¿å…æµå¤±ã€‚","ã€æˆ°è¡“æœƒï¼‹å›é¡§æœƒã€å¹³è¡¡çŸ­æ‰“èˆ‡å­¸ç¿’ã€‚"],
    love:["ä»¥é—œå¿ƒå¥é–‹é ­å†è«‡å•é¡Œã€‚","æ¯é€± 1 æ¬¡ç„¡æ‰‹æ©Ÿæ™šé¤ï¼Œç·´ç¿’å°ˆæ³¨é™ªä¼´ã€‚","å¤šç”¨è§¸ç¢°èˆ‡è‚¯å®šèªï¼Œä¸åªé å®‰æ’èˆ‡æŒ‡ä»¤ã€‚"],
    health:["èƒ¸èƒŒä¼¸å±•ï¼‹æ·±å‘¼å¸ï¼Œé‡‹æ”¾è‚©é ¸ã€‚","é£²é£Ÿï¼šç™½è˜¿è””ã€æ¢¨ã€æ‡æ·æ½¤è‚ºï¼›å°‘è¸é…’é‡å£å‘³ã€‚","æ¯é€± 2 æ¬¡ä¸­ä½å¼·åº¦æœ‰æ°§ï¼Œæ”¾æ…¢äº¤æ„Ÿã€‚"]},
  ç„æ­¦:{title:"ç„æ­¦ï¼ˆæ°´ï¼‰â€” æ€è¾¨ï¼ä½ˆå±€",summary:"å†·éœç†æ€§ã€é•·é è¦–è§’ã€‚é—œéµåœ¨æ–¼è¼¸å‡ºèˆ‡äº’ä¿¡ã€‚",
    workplace:["æŠŠç­–ç•¥ç•«æˆã€ä¸€é è·¯ç·šåœ–ã€è®“ä»–äººçœ‹è¦‹å…¨å±€ã€‚","ç‚ºç ”ç©¶è¨­å®šã€äº¤ä»˜ç‰©ã€é¿å…æ‹–å»¶ã€‚","ç·´ç¿’å³å¸­ç°¡å ±ï¼Œé™ä½è¼¸å‡ºç„¦æ…®ã€‚"],
    love:["æ¯æ—¥ 10 åˆ†é˜æƒ…æ„Ÿæ—¥è¨˜ï¼Œç·´ç¿’æè¿°æ„Ÿå—ã€‚","èˆ‡ä¼´ä¾¶è¨­ã€æ¯é€±è­°é¡Œæ™‚é–“ã€ã€‚","å®‰æ’å…±åŒè¨ˆç•«ï¼ˆæ—…è¡Œï¼å­¸ç¿’ï¼‰å¢é€²é€£çµã€‚"],
    health:["è…æ°´èª¿é¤Šï¼šè¦å¾‹ä½œæ¯èˆ‡è¶³æµ´æš–è…ã€‚","é£²é£Ÿï¼šé»‘èŠéº»ã€å±±è—¥ã€æ¸æï¼›å°‘ç†¬å¤œå’–å•¡ã€‚","å¤ªæ¥µæˆ–å¹³è¡¡è¨“ç·´ï¼Œå¢å¼·ç©©å®šæ„Ÿã€‚"]}
};

/* =========================
   Inline ç¥ç¸ SVGï¼ˆå“ç‰Œé‡‘æ£•ï¼‰
========================= */
function beastSVG(name){
  const stroke = '#B6822B', fill='none';
  const base = (d)=>`<svg viewBox='0 0 100 100' class='w-full h-auto' xmlns='http://www.w3.org/2000/svg'>
    <defs><radialGradient id='g' cx='50%' cy='50%' r='60%'><stop offset='0%' stop-color='rgba(182,130,43,0.25)'/><stop offset='100%' stop-color='rgba(182,130,43,0)'/></radialGradient></defs>
    <rect x='0' y='0' width='100' height='100' fill='url(#g)'/>
    ${d}
  </svg>`;
  const s=(d)=>`<path d='${d}' fill='${fill}' stroke='${stroke}' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>`;
  switch(name){
    case 'é’é¾': return base(s("M15 60 C25 40, 45 35, 55 45 C65 55, 75 35, 85 45 M45 45 q5 -12 16 -10 m-6 6 l6 4 m-36 20 q10 -6 18 2 m12 -2 q8 -6 18 2")+s("M30 70 q10 8 20 0 q10 -8 20 0"));
    case 'æœ±é›€': return base(s("M20 60 q15 -30 30 -30 q15 0 30 30 M50 30 l0 12 M35 55 q15 -8 30 0 M25 62 q10 8 25 8 q15 0 25 -8"));
    case 'å‹¾é™³': return base(s("M20 70 h60 v-20 h-60 v20 z M30 50 v-10 h40 v10 M35 65 h10 M55 65 h10"));
    case 'è£è›‡': return base(s("M20 70 q20 -30 40 -10 q10 8 20 -2 q-10 20 -30 10 q-10 -6 -30 2 M60 48 q6 -6 12 0"));
    case 'ç™½è™': return base(s("M20 65 q15 -20 30 -20 q15 0 30 20 M30 60 h40 M35 70 h30 M38 52 l4 6 M58 52 l-4 6"));
    case 'ç„æ­¦': return base(s("M30 65 q20 15 40 0 q5 -12 -15 -22 q-20 10 -25 22 M55 50 q10 -8 20 2 M25 55 q-8 -6 -10 6"));
    default: return base('');
  }
}

/* =========================
   å•å·æ¸²æŸ“èˆ‡äº’å‹•
========================= */
const qWrap = document.getElementById('qWrap');
function renderQuestions(){
  qWrap.innerHTML='';
  BANK.forEach((q,i)=>{
    qWrap.innerHTML += `<li class='p-3 border rounded-xl'><p>${i+1}. ${q.t}</p><input type='range' min='1' max='5' value='3' id='q${i}' class='w-full slider'></li>`;
  });
}
renderQuestions();

// æ§åˆ¶æŒ‰éˆ•
document.getElementById('btnFillMid').onclick=()=>document.querySelectorAll('.slider').forEach(s=>s.value=3);
document.getElementById('btnReset').onclick=()=>{document.querySelectorAll('.slider').forEach(s=>s.value=3);clearResult();};
document.getElementById('btnRandomize').onclick=()=>{BANK.sort(()=>Math.random()-0.5);renderQuestions();};

// åˆ†æ•¸èˆ‡çµæœ
let radarChart=null;
function clearResult(){
  if(radarChart){radarChart.destroy();radarChart=null}
  document.getElementById('scoreList').innerHTML='';
  document.getElementById('mainBeastTitle').textContent='';
  document.getElementById('mainBeastSummary').textContent='';
  document.getElementById('adviceCols').innerHTML='';
  document.getElementById('beastSVG').innerHTML='';
  document.getElementById('dualHint').textContent='';
}

function summarize(scores){
  const arr=Object.entries(scores).sort((a,b)=>b[1]-a[1]);
  const top=arr[0], second=arr[1];
  const dual = (top[1]-second[1] <= 1) ? [top[0], second[0]] : null;
  return {top:top[0], dual, ranking:arr};
}

function renderRadar(scores){
  const ctx=document.getElementById('radar');
  if(radarChart) radarChart.destroy();
  radarChart=new Chart(ctx,{type:'radar',data:{labels:Object.keys(scores),datasets:[{label:'å…­ç¸èƒ½é‡',data:Object.values(scores),backgroundColor:'rgba(182,130,43,0.15)',borderColor:'rgba(182,130,43,1)',pointBackgroundColor:'rgba(182,130,43,1)'}]},options:{scales:{r:{suggestedMin:0,suggestedMax:25,ticks:{stepSize:5}}},plugins:{legend:{display:false}}}});
}

function renderReport({top,dual,ranking}, scores){
  const info=ADVICES[top];
  document.getElementById('beastSVG').innerHTML=beastSVG(top);
  document.getElementById('mainBeastTitle').textContent = dual ? `é›™ç¸å‹ï¼š${top} Ã— ${dual[1]}` : `ä¸»ç¥ç¸ï¼š${top}`;
  document.getElementById('dualHint').textContent = dual ? `æç¤ºï¼šç¬¬äºŒä¸»å°èƒ½é‡ç‚ºã€Œ${dual[1]}ã€ï¼Œå¯ä½œç‚ºè¼”ä¿®ç·šã€‚` : '';
  document.getElementById('mainBeastSummary').textContent = info.summary;

  // ä¸‰æ¬„å»ºè­°
  const cols=document.getElementById('adviceCols');
  const col = (title, items)=>`<div class='p-3 border rounded-lg'><div class='font-semibold mb-1'>${title}</div><ul class='list-disc pl-5 space-y-1'>${items.map(x=>`<li>${x}</li>`).join('')}</ul></div>`;
  cols.innerHTML = col('è·å ´å»ºè­°', info.workplace) + col('æ„Ÿæƒ…å»ºè­°', info.love) + col('é¤Šç”Ÿå»ºè­°', info.health);

  // åˆ†æ•¸æ¸…å–®
  const list=document.getElementById('scoreList');
  list.innerHTML='';
  ranking.forEach(([k,v])=>{list.innerHTML += `<div class='flex items-center justify-between'><span>${k}</span><b>${v}</b></div>`});
}

// å•å·æäº¤
document.getElementById('form').addEventListener('submit', (e)=>{
  e.preventDefault();
  const scores={é’é¾:0,æœ±é›€:0,å‹¾é™³:0,è£è›‡:0,ç™½è™:0,ç„æ­¦:0};
  BANK.forEach((q,i)=>{scores[q.b]+=parseInt(document.getElementById(`q${i}`).value||'3',10)});
  const summary=summarize(scores);
  renderRadar(scores); renderReport(summary, scores);
  localStorage.setItem('shen-shou-v5', JSON.stringify({scores,summary,inst:getInstFromInputs()}));
});

// è¼‰å…¥ä¸Šæ¬¡çµæœ
(function(){
  try{
    const saved=JSON.parse(localStorage.getItem('shen-shou-v5')||'null');
    if(saved){
      renderRadar(saved.scores); renderReport(saved.summary, saved.scores);
      applyInstToView(saved.inst);
      applyInstToInputs(saved.inst);
    } else {
      applyInstToView(getInstFromInputs());
    }
  }catch(_){}
})();

// ä¸‹è¼‰çµæœå¡ PNG
document.getElementById('btnDownloadPNG').addEventListener('click',()=>{
  html2canvas(document.getElementById('resultCard'),{backgroundColor:'#ffffff',scale:2}).then(canvas=>{
    const a=document.createElement('a');
    a.download='ç¥ç¸äººæ ¼_åˆ†æå ±è¡¨.png';
    a.href=canvas.toDataURL('image/png');
    a.click();
  });
});

// åˆ—å°ï¼ˆç›´/æ©«ï¼‰
document.getElementById('btnPrint').addEventListener('click',()=>{window.print()});
Array.from(document.querySelectorAll('input[name="orient"]')).forEach(r=>{
  r.addEventListener('change', (e)=>{
    if(e.target.value==='landscape') document.documentElement.classList.add('print-landscape');
    else document.documentElement.classList.remove('print-landscape');
  });
});

/* =========================
   åˆ†æå¸«è³‡è¨Šï¼šè¼¸å…¥/é¡¯ç¤º/å„²å­˜
========================= */
const elName = document.getElementById('fName');
const elContact = document.getElementById('fContact');
const elBio = document.getElementById('fBio');
const elQR = document.getElementById('fQR');

function getInstFromInputs(){
  return {
    name: elName.value.trim(),
    contact: elContact.value.trim(),
    bio: elBio.value.trim(),
    qrDataUrl: document.getElementById('instQRPreview').src || ''
  };
}
function applyInstToInputs(inst){
  if(!inst) return;
  elName.value = inst.name || '';
  elContact.value = inst.contact || '';
  elBio.value = inst.bio || '';
  if(inst.qrDataUrl) document.getElementById('instQRPreview').src = inst.qrDataUrl;
}
function applyInstToView(inst){
  document.getElementById('instName').textContent = inst?.name || '';
  document.getElementById('instContact').textContent = inst?.contact || '';
  document.getElementById('instBio').textContent = inst?.bio || '';
  if(inst?.qrDataUrl) document.getElementById('instQRPreview').src = inst.qrDataUrl;
}

elQR.addEventListener('change', (e)=>{
  const file = e.target.files?.[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = () => { document.getElementById('instQRPreview').src = reader.result; };
  reader.readAsDataURL(file);
});

document.getElementById('btnSaveInst').addEventListener('click', ()=>{
  const saved=JSON.parse(localStorage.getItem('shen-shou-v5')||'{}');
  const inst = getInstFromInputs();
  applyInstToView(inst);
  localStorage.setItem('shen-shou-v5', JSON.stringify({...saved, inst}));
});

/* =========================
   OpenAI æ™ºèƒ½å»ºè­°ï¼ˆä¼ºæœå™¨ç«¯ï¼‰
========================= */
document.getElementById('btnAI').addEventListener('click', async ()=>{
  const saved=JSON.parse(localStorage.getItem('shen-shou-v5')||'null');
  const out=document.getElementById('aiOut');
  if(!saved){out.textContent='è«‹å…ˆå®Œæˆæ¸¬é©—ã€‚';return}
  const {scores,summary}=saved;
  out.textContent='ç”¢ç”Ÿä¸­â€¦';
  try{
    const resp = await fetch('/api/ai', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ scores, summary })
    });
    if(!resp.ok){throw new Error(await resp.text())}
    const data=await resp.json();
    out.textContent = (data.text||'').trim() || 'ï¼ˆæ²’æœ‰ç”¢ç”Ÿå…§å®¹ï¼‰';
  }catch(err){
    out.textContent='ï¼ˆåœ¨ GitHub Pages ç„¡æ³•å‘¼å« /api/aiï¼›è‹¥åœ¨ Vercel æ‰å¯ä½¿ç”¨ï¼‰';
  }
});
</script>
</body>
</html>
