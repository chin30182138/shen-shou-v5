<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</title>
  <meta name="description" content="å…­ç¸äººæ ¼AIåˆ†æï½œé‡‘éŒ¢å¦äº”è¡Œæ•´åˆï½œå³æ™‚é›·é”åœ–ï¼‹æ™ºèƒ½å ±å‘Š" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root { --brand: #b6822b; }
    body { background: radial-gradient(circle at top left, #fffaf4, #f6f3ea); }
    .brand { color: var(--brand); }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .slider { accent-color: var(--brand); }
    @media print { .no-print {display:none!important;} }
  </style>
</head>
<body class="text-slate-800">

<main class="max-w-5xl mx-auto p-4 sm:p-6">
  <header class="mb-4 flex justify-between items-center">
    <div class="flex items-center gap-3">
      <img src="img/logo.png" class="h-10 w-auto rounded" alt="ä»™äººæŒ‡è·¯ Logo" />
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold brand">ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</h1>
        <p class="text-sm text-slate-600">å…­ç¸é›·é”åœ–ãƒ»ä¸»å‹è§£æãƒ»ä¸‰æ¬„å»ºè­°ãƒ»AIåˆ†æå ±å‘Š</p>
      </div>
    </div>
  </header>

  <!-- å•å· -->
  <form id="form" class="card p-4 mb-4">
    <h2 class="font-bold mb-3">ğŸ“‹ è«‹å›ç­”ä¸‹åˆ—30é¡Œï¼ˆ1ï¼ä¸åŒæ„ï¼Œ5ï¼éå¸¸åŒæ„ï¼‰</h2>
    <ol id="qWrap" class="space-y-3"></ol>
    <div class="mt-4 flex gap-3">
      <button type="submit" class="bg-amber-600 text-white px-5 py-2 rounded">é€å‡ºæ¸¬é©—</button>
      <button type="button" id="btnFillMid" class="border px-3 py-2 rounded">å…¨éƒ¨å¡«3</button>
    </div>
  </form>

  <!-- çµæœ -->
  <section id="result" class="grid lg:grid-cols-2 gap-4">
    <div class="card p-4">
      <h2 class="font-bold mb-2">å…­ç¸èƒ½é‡é›·é”åœ–</h2>
      <canvas id="radar"></canvas>
    </div>
    <div class="card p-4" id="resultCard">
      <h2 class="font-bold mb-2">ä¸»å‹èˆ‡ä¸‰æ¬„å»ºè­°</h2>
      <div class="grid grid-cols-3 gap-3 items-start">
        <div id="beastSVG" class="w-full aspect-square"></div>
        <div class="col-span-2">
          <div id="mainBeastTitle" class="font-bold brand"></div>
          <div id="dualHint" class="text-sm text-slate-600"></div>
          <div id="mainBeastSummary" class="mt-1 text-sm"></div>
        </div>
      </div>
      <hr class="my-2" />
      <div id="adviceCols" class="grid md:grid-cols-3 gap-2 text-sm"></div>
      <button id="btnShare" class="mt-4 px-4 py-2 border rounded no-print">åˆ†äº«çµæœåœ–ç‰‡</button>
    </div>
  </section>

  <!-- AI æ™ºèƒ½åˆ†æ -->
  <section class="card p-4 mt-4" id="aiReport">
    <h2 class="font-bold mb-2">ğŸ¤– AI æ™ºèƒ½å€‹äººåŒ–åˆ†æå ±å‘Š</h2>
    <p class="text-sm text-slate-600 mb-3">ä»¥ä¸‹å…§å®¹ç”±ä»™äººæŒ‡è·¯AIç³»çµ±ç”Ÿæˆï¼Œèåˆé‡‘éŒ¢å¦ã€äº”è¡Œã€åœ°æ”¯èˆ‡å¿ƒç†è¦–è§’ã€‚</p>
    <button id="btnAI" class="px-4 py-2 border rounded no-print">ç”Ÿæˆåˆ†æå ±å‘Š</button>
    <pre id="aiOut" class="mt-3 text-sm bg-slate-50 p-3 rounded-lg whitespace-pre-wrap leading-relaxed"></pre>
  </section>

  <footer class="text-center text-xs text-slate-500 mt-8">
    Â© 2025 ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒï½œæ¸¬é©—åƒ…ä¾›è¦ºå¯Ÿèˆ‡æ•™å­¸ç”¨é€”
  </footer>
</main>

<script>
// ========== é¡Œåº« ==========
const BANK = [
  {t:"æˆ‘å¸¸æœ‰çªå¦‚å…¶ä¾†çš„éˆæ„Ÿä¸¦æƒ³ç«‹å³å˜—è©¦ã€‚",b:"é’é¾"},
  {t:"æˆ‘å–œæ­¡æ‰“ç ´å¸¸è¦å°‹æ‰¾æ–°æ–¹æ³•ã€‚",b:"é’é¾"},
  {t:"é‡é˜»åŠ›æ™‚æˆ‘æœƒéˆæ´»è½‰å‘ã€‚",b:"é’é¾"},
  {t:"æˆ‘å¯Œæƒ³åƒåŠ›ï¼Œå–œæ­¡å‰µæ–°æ€è€ƒã€‚",b:"é’é¾"},
  {t:"æˆ‘ç†±æ„›æ¢ç´¢æœªçŸ¥äº‹ç‰©ã€‚",b:"é’é¾"},
  {t:"æˆ‘å–œæ­¡åœ¨äººç¾¤ä¸­è¡¨é”è‡ªå·±ã€‚",b:"æœ±é›€"},
  {t:"æˆ‘ç”¨æƒ…ç·’å¸¶å‹•ä»–äººã€‚",b:"æœ±é›€"},
  {t:"åˆ¥äººçš„åæ‡‰æœƒå½±éŸ¿æˆ‘ã€‚",b:"æœ±é›€"},
  {t:"æˆ‘æ“…é•·èªªæœèˆ‡æ¼”èªªã€‚",b:"æœ±é›€"},
  {t:"æˆ‘é‡è¦–è¢«å‚¾è½èˆ‡é—œæ³¨ã€‚",b:"æœ±é›€"},
  {t:"æˆ‘å–œæ­¡æŒ‰è¨ˆç•«è¡Œäº‹ã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘é‡è¦–å®‰å…¨æ„Ÿèˆ‡ç©©å®šã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘è²¬ä»»æ„Ÿå¼·ã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘å‚¾å‘ç¶­æŒç¾ç‹€ã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘æ³¨é‡ç´°ç¯€èˆ‡ç¨‹åºã€‚",b:"å‹¾é™³"},
  {t:"æˆ‘å°ä»–äººæƒ…ç·’å¾ˆæ•æ„Ÿã€‚",b:"è£è›‡"},
  {t:"æˆ‘æ“…é•·è§€å¯Ÿèˆ‡å‚¾è½ã€‚",b:"è£è›‡"},
  {t:"æˆ‘å¸¸æ€è€ƒèƒŒå¾Œçš„å‹•æ©Ÿã€‚",b:"è£è›‡"},
  {t:"æˆ‘æ€è€ƒäº‹æƒ…æœƒè€ƒé‡æ™‚æ©Ÿèˆ‡äººå¿ƒã€‚",b:"è£è›‡"},
  {t:"æˆ‘å–„æ–¼å”èª¿ä¸åŒè§€é»ã€‚",b:"è£è›‡"},
  {t:"æˆ‘è¬›æ±‚æ•ˆç‡èˆ‡çµæœã€‚",b:"ç™½è™"},
  {t:"æˆ‘æœƒä¸»å‹•åšæ±ºç­–ã€‚",b:"ç™½è™"},
  {t:"æˆ‘ä»¥æ•¸æ“šèˆ‡æˆæœç‚ºå°å‘ã€‚",b:"ç™½è™"},
  {t:"æˆ‘é¡˜æ„æ‰¿æ“”å£“åŠ›ä»¥å®Œæˆä»»å‹™ã€‚",b:"ç™½è™"},
  {t:"æˆ‘åå¥½æ˜ç¢ºçš„è¦ç¯„èˆ‡æ¨™æº–ã€‚",b:"ç™½è™"},
  {t:"æˆ‘å–œæ­¡ç¨è‡ªæ€è€ƒã€‚",b:"ç„æ­¦"},
  {t:"æˆ‘å‚¾å‘è¬¹æ…è©•ä¼°å¾Œè¡Œå‹•ã€‚",b:"ç„æ­¦"},
  {t:"æˆ‘æ“…é•·è¦åŠƒé•·é ç›®æ¨™ã€‚",b:"ç„æ­¦"},
  {t:"æˆ‘é‡è¦–é‚è¼¯èˆ‡åˆ†æã€‚",b:"ç„æ­¦"},
  {t:"æˆ‘ç¿’æ…£å†·éœçœ‹å¾…å•é¡Œã€‚",b:"ç„æ­¦"},
];

// éš¨æ©Ÿshuffleé¡Œç›®
BANK.sort(() => Math.random() - 0.5);

const qWrap = document.getElementById("qWrap");
BANK.forEach((q, i) => {
  qWrap.innerHTML += `<li><p>${i+1}. ${q.t}</p><input type='range' min='1' max='5' value='3' id='q${i}' class='w-full slider'></li>`;
});

// åŠ é€²åº¦é¡¯ç¤º
qWrap.innerHTML += `<div id="progress" class="text-right text-sm">0/30</div>`;
document.querySelectorAll('input[type="range"]').forEach((s) => {
  s.onchange = () => {
    const filled = Array.from(document.querySelectorAll('input[type="range"]')).filter(s => s.value !== '3').length;
    document.getElementById('progress').textContent = `${filled}/30`;
  };
});

// ========== ç¥ç¸SVG ==========
function beastSVG(name) {
  const stroke = '#B6822B', fill = 'none';
  const s = d => `<path d='${d}' fill='${fill}' stroke='${stroke}' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/>`;
  const base = d => `<svg viewBox='0 0 100 100' class='w-full h-auto' xmlns='http://www.w3.org/2000/svg'>
    <defs><radialGradient id='g' cx='50%' cy='50%' r='60%'>
      <stop offset='0%' stop-color='rgba(182,130,43,0.25)'/><stop offset='100%' stop-color='rgba(182,130,43,0)'/>
    </radialGradient></defs><rect width='100' height='100' fill='url(#g)'/>${d}</svg>`;
  switch (name) {
    case 'é’é¾': return base(s("M15 60 C25 40, 45 35, 55 45 C65 55, 75 35, 85 45 M45 45 q5 -12 16 -10 m-6 6 l6 4 m-36 20 q10 -6 18 2 m12 -2 q8 -6 18 2") + s("M30 70 q10 8 20 0 q10 -8 20 0"));
    case 'æœ±é›€': return base(s("M20 60 q15 -30 30 -30 q15 0 30 30 M50 30 l0 12 M35 55 q15 -8 30 0 M25 62 q10 8 25 8 q15 0 25 -8"));
    case 'å‹¾é™³': return base(s("M20 70 h60 v-20 h-60 v20 z M30 50 v-10 h40 v10 M35 65 h10 M55 65 h10"));
    case 'è£è›‡': return base(s("M20 70 q20 -30 40 -10 q10 8 20 -2 q-10 20 -30 10 q-10 -6 -30 2 M60 48 q6 -6 12 0"));
    case 'ç™½è™': return base(s("M20 65 q15 -20 30 -20 q15 0 30 20 M30 60 h40 M35 70 h30 M38 52 l4 6 M58 52 l-4 6"));
    case 'ç„æ­¦': return base(s("M30 65 q20 15 40 0 q5 -12 -15 -22 q-20 10 -25 22 M55 50 q10 -8 20 2 M25 55 q-8 -6 -10 6"));
    default: return base('');
  }
}

// ========== çµæœç”Ÿæˆ ==========
function summarize(scores) {
  const arr = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  const top = arr[0], second = arr[1];
  const dual = (top[1] - second[1] <= 1) ? [top[0], second[0]] : null;
  const total = Object.values(scores).reduce((a, b) => a + b, 0);
  const variantIdx = total % 12;
  const variants = ['å­', 'ä¸‘', 'å¯…', 'å¯', 'è¾°', 'å·³', 'åˆ', 'æœª', 'ç”³', 'é…‰', 'æˆŒ', 'äº¥'];
  const variant = variants[variantIdx];
  return { top: top[0], dual, ranking: arr, variant };
}

let radarChart = null;
function renderRadar(scores) {
  const ctx = document.getElementById("radar");
  if (radarChart) radarChart.destroy();
  radarChart = new Chart(ctx, { type: "radar", data: { labels: Object.keys(scores), datasets: [{ label: "å…­ç¸èƒ½é‡", data: Object.values(scores), backgroundColor: "rgba(182,130,43,0.15)", borderColor: "#b6822b" }] }, options: { scales: { r: { suggestedMin: 0, suggestedMax: 25, ticks: { stepSize: 5 } } }, plugins: { legend: { display: false } } } });
}

function renderReport(summary, scores) {
  document.getElementById("beastSVG").innerHTML = beastSVG(summary.top);
  const mainType = `${summary.top}${summary.variant}å‹`;
  document.getElementById("mainBeastTitle").textContent = summary.dual ? `é›™ç¸${summary.variant}å‹ï¼š${summary.top} Ã— ${summary.dual[1]}` : `ä¸»${summary.variant}å‹ï¼š${summary.top}`;
  document.getElementById("dualHint").textContent = summary.dual ? `ç¬¬äºŒä¸»å°èƒ½é‡ï¼š${summary.dual[1]}` : '';
  document.getElementById("mainBeastSummary").textContent = `ä½ çš„ä¸»å‹ç‚º ${mainType}ï¼Œä»£è¡¨æ ¸å¿ƒç‰¹è³ªèåˆ${summary.top}èƒ½é‡èˆ‡${summary.variant}åœ°æ”¯è®Šé«”ã€‚`;

  const col = (t, a) => `<div class='border rounded p-2'><b>${t}</b><ul class='list-disc pl-5'>${a.map(x => `<li>${x}</li>`).join('')}</ul></div>`;
  const ADVICE_DB = {
    é’é¾: { è·å ´: ["æ“æŠ±è®ŠåŒ–ï¼Œå‰µæ–°é …ç›®é ˜é ­ã€‚", "é¿å…è¡å‹•ï¼Œè©•ä¼°é¢¨éšªã€‚"], æ„Ÿæƒ…: ["æµªæ¼«å†’éšªï¼Œä½†éœ€ç©©å®šã€‚"], é¤Šç”Ÿ: ["æˆ¶å¤–æ´»å‹•é‡‹æ”¾èƒ½é‡ã€‚"] },
    æœ±é›€: { è·å ´: ["åœ˜éšŠæºé€šç‹ï¼Œæ¿€å‹µä»–äººã€‚"], æ„Ÿæƒ…: ["ç†±æƒ…è¡¨é”æ„›ã€‚"], é¤Šç”Ÿ: ["è—è¡“ç™‚æ³•æ¸›å£“ã€‚"] },
    å‹¾é™³: { è·å ´: ["ç©©å®šåŸ·è¡Œï¼Œæ³¨é‡ç´°ç¯€ã€‚"], æ„Ÿæƒ…: ["å¿ èª å¯é ï¼Œå»ºç«‹ä¿¡ä»»ã€‚"], é¤Šç”Ÿ: ["è¦å¾‹ä½œæ¯ï¼Œå‡è¡¡é£²é£Ÿã€‚"] },
    è£è›‡: { è·å ´: ["å”èª¿å°ˆå®¶ï¼ŒåŒ–è§£è¡çªã€‚"], æ„Ÿæƒ…: ["æ•æ„Ÿé«”è²¼ï¼Œæ·±å…¥æºé€šã€‚"], é¤Šç”Ÿ: ["å†¥æƒ³ç·´ç¿’ï¼Œèª¿ç¯€æƒ…ç·’ã€‚"] },
    ç™½è™: { è·å ´: ["æ±ºæ–·é ˜å°ï¼Œè¿½æ±‚æ•ˆç‡ã€‚"], æ„Ÿæƒ…: ["ç›´æ¥è¡¨é”ï¼Œå‹‡æ–¼æ‰¿è«¾ã€‚"], é¤Šç”Ÿ: ["é«˜å¼·åº¦é‹å‹•ï¼Œé‡‹æ”¾å£“åŠ›ã€‚"] },
    ç„æ­¦: { è·å ´: ["ç­–ç•¥è¦åŠƒï¼Œé•·é è¦–é‡ã€‚"], æ„Ÿæƒ…: ["ç†æ€§åˆ†æï¼Œç©©å¥é—œä¿‚ã€‚"], é¤Šç”Ÿ: ["éœåé–±è®€ï¼Œé¤Šæˆå…§çœã€‚"] },
  };
  const beastAdvice = ADVICE_DB[summary.top] || { è·å ´: ["é‡è¦–è§’è‰²å®šä½èˆ‡ç¯€å¥ã€‚", "å»ºç«‹åœ˜éšŠä¿¡ä»»æ„Ÿã€‚", "å­¸æœƒæˆæ¬Šèˆ‡åˆä½œã€‚"], æ„Ÿæƒ…: ["çœŸèª è¡¨é”éœ€æ±‚ã€‚", "å¹³è¡¡ç†æ€§èˆ‡æ„Ÿæ€§ã€‚", "å­¸ç¿’å‚¾è½ä»–äººã€‚"], é¤Šç”Ÿ: ["æ—©ç¡æ—©èµ·ã€ç¯€åˆ¶é£²é£Ÿã€‚", "ä¿æŒé‹å‹•ç¿’æ…£ã€‚", "ç”¨å‘¼å¸å†¥æƒ³ç©©å®šèƒ½é‡ã€‚"] };
  document.getElementById("adviceCols").innerHTML = col("è·å ´å»ºè­°", beastAdvice.è·å ´) + col("æ„Ÿæƒ…å»ºè­°", beastAdvice.æ„Ÿæƒ…) + col("é¤Šç”Ÿå»ºè­°", beastAdvice.é¤Šç”Ÿ);
}

document.getElementById("form").addEventListener("submit", e => {
  e.preventDefault();
  const scores = { é’é¾: 0, æœ±é›€: 0, å‹¾é™³: 0, è£è›‡: 0, ç™½è™: 0, ç„æ­¦: 0 };
  BANK.forEach((q, i) => scores[q.b] += parseInt(document.getElementById(`q${i}`).value));
  const summary = summarize(scores); 
  renderRadar(scores); 
  renderReport(summary, scores);
  localStorage.setItem("shen-shou-v7", JSON.stringify({ scores, summary }));
});

document.getElementById("btnFillMid").onclick = () => document.querySelectorAll(".slider").forEach(s => s.value = 3);

// åˆ†äº«çµæœ
document.getElementById("btnShare").addEventListener("click", () => {
  html2canvas(document.getElementById("result")).then(canvas => {
    const link = document.createElement('a');
    link.download = 'shenshou-result.png';
    link.href = canvas.toDataURL();
    link.click();
  });
});

// ========== AIæ™ºèƒ½åˆ†æ ==========
document.getElementById("btnAI").addEventListener("click", async () => {
  const saved = JSON.parse(localStorage.getItem("shen-shou-v7") || "null");
  const out = document.getElementById("aiOut");
  if (!saved) { out.textContent = "âš ï¸è«‹å…ˆå®Œæˆæ¸¬é©—ã€‚"; return; }
  out.textContent = "ğŸª¶ AI æ­£åœ¨åˆ†æä¸­ï¼Œç´„5~10ç§’...";
  try {
    const resp = await fetch("/api/ai", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(saved) });
    if (!resp.ok) throw new Error(await resp.text());
    const data = await resp.json();
    out.textContent = data.text.trim();
  } catch (err) { out.textContent = "âŒåˆ†æå¤±æ•—ï¼š" + err.message; }
});
</script>
</body>
</html>
