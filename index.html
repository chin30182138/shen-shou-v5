<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</title>
  <meta name="description" content="å…­ç¸äººæ ¼AIåˆ†æï½œé‡‘éŒ¢å¦äº”è¡Œæ•´åˆï½œå³æ™‚é›·é”åœ–ï¼‹æ™ºèƒ½å ±å‘Š" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* æ–°å¢åˆ†é æ¨¡å¼å’Œå­—é«”æ§åˆ¶æ¨£å¼ */
    .page-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 15px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    
    .font-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .question-page {
      display: none;
    }
    
    .question-page.active {
      display: block;
    }
    
    .option-card {
      border: 2px solid #e5e7eb;
      border-radius: 12px;
      padding: 15px 10px;
      margin: 8px 0;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      font-weight: 500;
      font-size: 14px;
      position: relative;
    }
    
    .option-card:hover {
      background-color: #f8f9fa;
      border-color: #b6822b;
      transform: translateY(-2px);
    }
    
    .option-card.selected {
      background-color: #e7f3ff;
      border-color: #2b6cb0;
      transform: scale(1.02);
    }
    
    .option-card::before {
      content: '';
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid #ccc;
      border-radius: 50%;
      margin-right: 8px;
      vertical-align: middle;
      transition: all 0.3s ease;
    }
    
    .option-card.selected::before {
      background-color: #2b6cb0;
      border-color: #2b6cb0;
      transform: scale(1.2);
    }
    
    .option-card.selected::after {
      content: 'âœ“';
      position: absolute;
      color: white;
      font-size: 12px;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
    }

    /* å ±è¡¨å­—é«”å¤§å°æ§åˆ¶ */
    .report-font-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 15px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    /* åˆ—å°æ™‚çš„å­—ä½“å¤§å°èª¿æ•´ */
    @media print {
      body {
        font-size: 16pt !important;
        line-height: 1.6 !important;
      }
      
      .card {
        font-size: 15pt !important;
      }
      
      h1 {
        font-size: 24pt !important;
      }
      
      h2 {
        font-size: 20pt !important;
      }
      
      h3 {
        font-size: 18pt !important;
      }
      
      p, li, div {
        font-size: 14pt !important;
        line-height: 1.5 !important;
      }
      
      .superhero-title {
        font-size: 18pt !important;
      }
      
      .superhero-ability {
        font-size: 14pt !important;
      }
      
      .superhero-desc {
        font-size: 13pt !important;
      }
      
      .ai-analysis-title {
        font-size: 16pt !important;
      }
      
      .ai-analysis-content {
        font-size: 13pt !important;
      }
      
      .ai-analysis-item-title {
        font-size: 14pt !important;
      }
      
      .ai-analysis-item-content {
        font-size: 12pt !important;
      }
    }

    /* åŸæœ‰çš„æ¨£å¼ä¿æŒä¸è®Š */
    :root { 
      --brand: #b6822b; 
      --primary: #b6822b;
      --secondary: #d4a017;
      --accent: #2b6cb0;
    }
    body { background: radial-gradient(circle at top left, #fffaf4, #f6f3ea); }
    .brand { color: var(--brand); }
    .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .slider { accent-color: var(--brand); }
    
    .slide-toggle {
        transition: all 0.3s ease-in-out;
        overflow: hidden;
        max-height: 1000px;
    }
    .slide-toggle.hidden {
        max-height: 0;
        padding-top: 0;
        padding-bottom: 0;
        margin-top: 0;
        margin-bottom: 0;
        opacity: 0;
    }

    .spinner { animation: spin 1.5s linear infinite; display: inline-block; font-size: 2em; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .loading-dots:after { content: '.'; animation: dots 1.5s steps(5, end) infinite; }
    @keyframes dots { 0%, 20% { content: '.'; } 40% { content: '..'; } 60%, 100% { content: '...'; } }
    
    .progress-container { width: 100%; background-color: #e5e7eb; border-radius: 10px; margin: 10px 0; overflow: hidden; }
    .progress-bar { height: 8px; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 10px; transition: width 0.4s ease; width: 0%; }
    
    .superhero-card { 
      border-radius: 12px; 
      padding: 8px; 
      margin: 6px 0; 
      background: linear-gradient(135deg, #e8f4fd, #f0f9ff); 
      border: 2px solid var(--accent); 
    }
    .superhero-title { font-size: 1.2em; font-weight: bold; color: var(--accent); margin-bottom: 4px; }
    .superhero-ability { background: rgba(43, 108, 176, 0.1); padding: 4px; border-radius: 6px; margin: 4px 0; font-weight: bold; color: #2c5282; font-size: 1.0em; }
    .superhero-desc { font-size: 1.0em; color: #666; line-height: 1.3; }
    
    .superhero-image-container {
      width: 150px;
      height: 150px;
      margin: 0 auto 10px;
      border-radius: 12px;
      overflow: hidden;
      border: 3px solid var(--accent);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .superhero-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    .superhero-image:hover {
      transform: scale(1.05);
    }
    
    #beastSVG {
      width: 100%;
      height: 100%;
      position: relative;
    }
    
    .beast-text-container {
      width: 100%; 
      height: 100%; 
      display: flex; 
      align-items: center; 
      justify-content: center;
      background: radial-gradient(circle, rgba(182,130,43,0.1) 0%, rgba(182,130,43,0) 70%);
      border: 2px solid #b6822b;
      border-radius: 12px;
      font-size: 1.8em;
      font-weight: bold;
      color: #b6822b;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      padding: 10px;
      text-align: center;
    }
    
    .ai-analysis-section { background: linear-gradient(135deg, #f8f9fa, #ffffff); border: 1px solid #e9ecef; border-radius: 12px; padding: 12px; margin: 8px 0; }
    .ai-analysis-header { display: flex; align-items: center; margin-bottom: 8px; padding-bottom: 6px; border-bottom: 2px solid #e9ecef; }
    .ai-analysis-icon { font-size: 1.5em; margin-right: 8px; }
    .ai-analysis-title { color: #2d3748; font-weight: bold; font-size: 1.2em; }
    .ai-analysis-content { font-size: 1.0em; color: #4a5568; line-height: 1.5; }
    .ai-analysis-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 8px; margin-top: 12px; }
    .ai-analysis-item { background: white; padding: 8px; border-radius: 6px; border-left: 4px solid var(--brand); box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .ai-analysis-item-title { font-weight: bold; color: #2d3748; margin-bottom: 4px; font-size: 1.0em; }
    .ai-analysis-item-content { font-size: 0.95em; color: #718096; line-height: 1.4; }
    
    .ai-loading { text-align: center; padding: 20px; color: #718096; background: linear-gradient(135deg, #f8f9fa, #ffffff); border-radius: 12px; border: 2px dashed #e5e7eb; }

    .color-preview {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .color-sample {
      width: 30px;
      height: 30px;
      border-radius: 6px;
      border: 2px solid #e5e7eb;
      cursor: pointer;
    }
    .color-sample.active {
      border-color: #333;
      transform: scale(1.1);
    }

    .print-header {
      display: none;
      margin-bottom: 25px;
      border-bottom: 3px solid #b6822b;
      padding-bottom: 15px;
    }
    
    .print-header-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    
    .header-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .print-logo-img {
      width: 65px;
      height: 65px;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
    }
    
    .logo-text {
      display: flex;
      flex-direction: column;
    }
    
    .print-logo-title {
      font-weight: bold;
      font-size: 20px;
      color: #b6822b;
      margin-bottom: 4px;
    }
    
    .print-logo-subtitle {
      font-size: 14px;
      color: #666;
    }
    
    .header-right {
      text-align: right;
      background: #f8f9fa;
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
    }
    
    .print-qrcode-title {
      font-weight: bold;
      font-size: 14px;
      color: #b6822b;
      margin-bottom: 4px;
    }
    
    .print-qrcode-subtitle {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }
    
    .print-qrcode-img {
      width: 80px;
      height: 80px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
    }
    
    .header-title-container {
      text-align: center;
      margin: 15px 0;
      padding: 15px 0;
      border-top: 2px solid #f0f0f0;
      border-bottom: 2px solid #f0f0f0;
    }
    
    .report-main-title {
      font-size: 28px;
      font-weight: bold;
      color: #b6822b;
      margin-bottom: 8px;
    }
    
    .report-subtitle {
      font-size: 18px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .print-date {
      text-align: center;
      font-size: 13px;
      color: #888;
      margin-top: 10px;
    }
    
    .accent-bar {
      height: 4px;
      background: linear-gradient(90deg, #b6822b, #d4a017, #b6822b);
      margin: 10px 0;
      border-radius: 2px;
    }
    
    @media screen {
      #radar { width: 100% !important; height: 300px !important; }
      body { font-size: 16px; }
      h1 { font-size: 2.5em; }
      h2 { font-size: 1.5em; }
      p, li, div { font-size: 1.0em; }
    }
    
    @media print { 
      .no-print { display: none !important; } 
      .print-header { 
        display: block !important; 
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
      body { 
        background: white !important; 
        font-size: 14px !important; 
        color: black !important; 
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
      .card {
        box-shadow: none;
        border: 1px solid #ddd;
      }
      #beastSVG svg {
        width: 100% !important;
        height: auto !important;
      }
      .accent-bar {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
      .beast-text-container {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
    }
  </style>
</head>
<body class="text-slate-800">
<main class="max-w-5xl mx-auto p-4 sm:p-6">
  <!-- é é¢å…§å®¹ä¿æŒä¸è®Š -->
  <header class="mb-4 flex justify-between items-center no-print">
    <div class="flex items-center gap-3">
      <img src="img/logo.png" class="h-10 w-auto rounded" alt="ä»™äººæŒ‡è·¯ Logo" />
      <div>
        <h1 class="text-2xl sm:text-3xl font-extrabold brand">ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼ æ¸¬é©—ï¼‹AIæ™ºèƒ½åˆ†æ</h1>
        <p class="text-sm text-slate-600">å…­ç¸é›·é”åœ–ãƒ»ä¸»å‹è§£æãƒ»ä¸‰æ¬„å»ºè­°ãƒ»AIåˆ†æå ±å‘Š</p>
      </div>
    </div>
    <button id="toggleSettingsBtn" type="button" class="no-print p-2 rounded-full hover:bg-amber-100 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
    </button>
  </header>

  <!-- è¨­å®šè¡¨å–® -->
  <form id="reportSettingsForm" class="card p-4 mb-4 no-print slide-toggle hidden">
    <h2 class="font-bold mb-3">âš™ï¸ å ±è¡¨è³‡è¨Šè¨­å®š</h2>
    <div class="space-y-4 text-sm">
      <div class="flex items-center gap-4">
        <div>
          <label for="qrCodeUploader" class="font-semibold text-slate-700 block mb-1">ä¸Šå‚³ QR Code åœ–ç‰‡ï¼š</label>
          <input type="file" id="qrCodeUploader" accept="image/*" class="text-slate-600">
        </div>
        <div>
            <label class="font-semibold text-slate-700 block mb-1">åœ–ç‰‡é è¦½ï¼š</label>
            <img id="qrCodePreview" src="https://via.placeholder.com/80x80.png?text=QR+Code" alt="QR Code é è¦½" class="w-20 h-20 border rounded p-1 bg-white object-contain">
        </div>
      </div>
      <div>
        <label for="contactTitle" class="font-semibold text-slate-700">è¯çµ¡æ¨™é¡Œï¼š</label>
        <input type="text" id="contactTitle" class="w-full mt-1 p-2 border rounded" value="æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢">
      </div>
      <div>
        <label for="contactLine1" class="font-semibold text-slate-700">è¯çµ¡è³‡è¨Š (ç¬¬ä¸€è¡Œ)ï¼š</label>
        <input type="text" id="contactLine1" class="w-full mt-1 p-2 border rounded" value="Line ID: @immortalguiide">
      </div>
      <div>
        <label for="contactLine2" class="font-semibold text-slate-700">è¯çµ¡è³‡è¨Š (ç¬¬äºŒè¡Œ)ï¼š</label>
        <input type="text" id="contactLine2" class="w-full mt-1 p-2 border rounded" value="å°ˆæ¥­è«®è©¢é ç´„">
      </div>
      
      <!-- æ–°å¢åˆ†é æ¨¡å¼å’Œå­—é«”å¤§å°è¨­å®š -->
      <div>
        <label class="font-semibold text-slate-700 block mb-2">æ¸¬é©—é¡¯ç¤ºæ¨¡å¼ï¼š</label>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm mb-1">é¡Œç›®é¡¯ç¤ºï¼š</label>
            <select id="pageMode" class="w-full p-2 border rounded">
              <option value="single">å–®é¡Œæ¨¡å¼</option>
              <option value="multi10" selected>10é¡Œæ¨¡å¼</option>
              <option value="all">å…¨éƒ¨é¡¯ç¤º</option>
            </select>
          </div>
          <div>
            <label class="block text-sm mb-1">å ±è¡¨å­—é«”å¤§å°ï¼š</label>
            <select id="reportFontSize" class="w-full p-2 border rounded">
              <option value="small">å°</option>
              <option value="medium" selected>ä¸­</option>
              <option value="large">å¤§</option>
              <option value="xlarge">ç‰¹å¤§</option>
            </select>
          </div>
        </div>
      </div>
      
      <div>
        <label class="font-semibold text-slate-700 block mb-2">é¸æ“‡è‰²ç³»ä¸»é¡Œï¼š</label>
        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-sm mb-1">ä¸»è¦è‰²ç³»ï¼š</label>
            <select id="themeSelect" class="w-full p-2 border rounded">
              <option value="warm">æš–è‰²ç³»</option>
              <option value="cool">å†·è‰²ç³»</option>
              <option value="nature">è‡ªç„¶ç³»</option>
              <option value="modern">ç¾ä»£ç³»</option>
              <option value="classic">ç¶“å…¸ç³»</option>
            </select>
          </div>
          <div>
            <label class="block text-sm mb-1">è‰²èª¿èª¿æ•´ï¼š</label>
            <input type="range" id="hueSlider" min="0" max="360" value="40" class="w-full slider">
            <div class="text-xs text-gray-500 mt-1">è‰²èª¿å€¼: <span id="hueValue">40</span>Â°</div>
          </div>
        </div>
      </div>
    </div>
    <div class="mt-4">
      <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition text-sm">å„²å­˜è¨­å®š</button>
    </div>
  </form>

  <!-- æ¸¬é©—è¡¨å–® - ä¿®æ”¹ç‚ºæ”¯æ´åˆ†é æ¨¡å¼ -->
  <form id="form" class="card p-4 mb-4 no-print">
    <h2 class="font-bold mb-3">ğŸ“‹ è«‹å›ç­”ä¸‹åˆ—30é¡Œï¼ˆ1ï¼ä¸åŒæ„ï¼Œ5ï¼éå¸¸åŒæ„ï¼‰</h2>
    
    <!-- åˆ†é æ§åˆ¶ -->
    <div class="page-controls no-print">
      <div class="font-controls">
        <label for="pageModeSelect" class="text-sm font-medium">é¡¯ç¤ºæ¨¡å¼ï¼š</label>
        <select id="pageModeSelect" class="text-sm border rounded p-1">
          <option value="single">å–®é¡Œæ¨¡å¼</option>
          <option value="multi10" selected>10é¡Œæ¨¡å¼</option>
          <option value="all">å…¨éƒ¨é¡¯ç¤º</option>
        </select>
      </div>
      <div class="pagination-buttons flex gap-2">
        <button type="button" id="prevPage" class="px-3 py-1 border rounded text-sm hover:bg-gray-50 transition" disabled>ä¸Šä¸€é </button>
        <span id="pageIndicator" class="px-3 py-1 text-sm">1/3</span>
        <button type="button" id="nextPage" class="px-3 py-1 border rounded text-sm hover:bg-gray-50 transition">ä¸‹ä¸€é </button>
      </div>
    </div>
    
    <div class="mb-4 p-3 bg-slate-50 rounded-lg">
      <label class="font-semibold text-slate-700 block mb-2">è«‹é¸æ“‡æ‚¨çš„æ€§åˆ¥ï¼š</label>
      <div class="flex gap-4">
        <label class="flex items-center">
          <input type="radio" name="gender" value="male" class="mr-2" checked>
          ç”·æ€§
        </label>
        <label class="flex items-center">
          <input type="radio" name="gender" value="female" class="mr-2">
          å¥³æ€§
        </label>
        <label class="flex items-center">
          <input type="radio" name="gender" value="other" class="mr-2">
          å…¶ä»–
        </label>
      </div>
    </div>
    
    <!-- åˆ†é å®¹å™¨ -->
    <div id="questionPages" class="space-y-3">
      <!-- é¡Œç›®å°‡é€šéJavaScriptå‹•æ…‹ç”Ÿæˆ -->
    </div>
    
    <!-- é€²åº¦é¡¯ç¤º -->
    <div id="progress" class="text-right text-sm mt-4">0/30</div>
    
    <div class="mt-4 flex gap-3">
      <button type="submit" class="bg-amber-600 text-white px-5 py-2 rounded hover:bg-amber-700 transition">é€å‡ºæ¸¬é©—</button>
      <button type="button" id="btnFillMid" class="border px-3 py-2 rounded hover:bg-gray-50 transition">å…¨éƒ¨å¡«3</button>
    </div>
  </form>

  <!-- å ±è¡¨å­—é«”å¤§å°æ§åˆ¶ -->
  <div class="report-font-controls no-print">
    <span class="text-sm font-medium">å ±è¡¨å­—é«”å¤§å°ï¼š</span>
    <select id="reportFontSizeSelect" class="text-sm border rounded p-1">
      <option value="small">å°</option>
      <option value="medium" selected>ä¸­</option>
      <option value="large">å¤§</option>
      <option value="xlarge">ç‰¹å¤§</option>
    </select>
    <button type="button" id="applyFontSize" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition">å¥—ç”¨</button>
  </div>

  <!-- åˆ—å°æ¨™é ­ -->
  <div class="print-header">
    <div class="print-header-top">
      <div class="header-left">
        <img src="img/logo.png" alt="Logo" class="print-logo-img">
        <div class="logo-text">
            <div class="print-logo-title">ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒ</div>
            <div class="print-logo-subtitle">å°ˆæ¥­å‘½ç†è«®è©¢æœå‹™</div>
        </div>
      </div>
      <div class="header-right">
        <div class="print-qrcode-title" id="print-qrcode-title">æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢</div>
        <div class="print-qrcode-subtitle" id="print-qrcode-subtitle">Line ID: @immortalguiide</div>
        <img id="print-qrcode-img" src="https://via.placeholder.com/80x80.png?text=QR+Code" alt="QR Code" class="print-qrcode-img">
      </div>
    </div>
    
    <div class="accent-bar"></div>
    
    <div class="header-title-container">
      <h1 class="report-main-title">ä»™äººæŒ‡è·¯ç¥ç¸ä¸ƒåäºŒå‹äººæ ¼</h1>
      <p class="report-subtitle">å€‹äººåŒ–æ·±åº¦åˆ†æå ±å‘Š</p>
      <div class="print-date">å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š<span id="report-date"></span></div>
    </div>
    
    <div class="accent-bar"></div>
  </div>

  <!-- æ¸¬é©—çµæœ -->
  <section id="result" class="grid lg:grid-cols-2 gap-4" style="display: none;">
    <div class="card p-4">
      <h2 class="font-bold mb-2">å…­ç¸èƒ½é‡é›·é”åœ–</h2>
      <div id="radar-container"><canvas id="radar"></canvas></div>
      <button class="mt-3 px-4 py-2 border rounded no-print hover:bg-gray-50 transition" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°åˆ†æå ±å‘Š</button>
    </div>
    <div class="card p-4" id="resultCard">
      <h2 class="font-bold mb-2">ä¸»å‹èˆ‡ä¸‰æ¬„å»ºè­°</h2>
      <div class="grid grid-cols-3 gap-3 items-start">
        <div id="beastSVG" class="w-full aspect-square"></div>
        <div class="col-span-2">
          <div id="mainBeastTitle" class="font-bold brand text-lg"></div>
          <div id="dualHint" class="text-sm text-slate-600 mt-1"></div>
          <div id="mainBeastSummary" class="mt-2 text-sm"></div>
        </div>
      </div>
      <hr class="my-2" />
      <div id="adviceCols" class="grid md:grid-cols-3 gap-2 text-sm"></div>
      <div class="mt-3 flex gap-2 no-print">
        <button id="btnShare" class="px-4 py-2 border rounded hover:bg-gray-50 transition">åˆ†äº«çµæœåœ–ç‰‡</button>
        <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°åˆ†æå ±å‘Š</button>
      </div>
    </div>
  </section>

  <!-- è¶…äººå ±å‘Š -->
  <section class="card p-4 mt-4" id="superheroReport" style="display: none;">
    <h2 class="font-bold mb-2">ğŸ¦¸â€â™‚ï¸ ä½ çš„ç¥ç¸è¶…äººèº«åˆ†</h2>
    <div id="superhero-display" class="superhero-card">
      <div class="superhero-image-container">
        <img id="superhero-image" src="" alt="ç¥ç¸è¶…äººåœ–ç‰‡" class="superhero-image">
      </div>
      <div id="superhero-name" class="superhero-title"></div>
      <div id="superhero-ability" class="superhero-ability"></div>
      <div id="superhero-mission" class="superhero-desc"></div>
      <div id="superhero-local" class="text-sm mt-2 font-bold text-blue-700"></div>
    </div>
  </section>

  <!-- AIå ±å‘Š -->
  <section class="card p-4 mt-4" id="aiReport" style="display: none;">
    <h2 class="font-bold mb-2">ğŸ¤– AI æ™ºèƒ½å€‹äººåŒ–åˆ†æå ±å‘Š</h2>
    <p class="text-sm text-slate-600 mb-2">ä»¥ä¸‹å…§å®¹ç”±ä»™äººæŒ‡è·¯AIç³»çµ±ç”Ÿæˆï¼Œèåˆé‡‘éŒ¢å¦ã€äº”è¡Œã€åœ°æ”¯èˆ‡å¿ƒç†è¦–è§’ã€‚</p>
    <div id="ai-analysis-structured">
      <div class="ai-loading" id="ai-loading" style="display: none;">
        <div class="spinner">ğŸ”®</div>
        <p class="mt-2 text-lg font-semibold">AI æ­£åœ¨ç‚ºæ‚¨æ·±åº¦åˆ†æä¸­<span class="loading-dots"></span></p>
        <p class="mt-1 text-sm text-gray-600">é€™å¯èƒ½éœ€è¦ 10-20 ç§’ï¼Œè«‹ç¨å€™</p>
        <div class="progress-container mt-3"><div class="progress-bar" id="progress-bar"></div></div>
        <div class="mt-2 text-xs text-gray-500" id="loading-step">åˆå§‹åŒ–åˆ†æå¼•æ“...</div>
      </div>
      <div id="ai-analysis-content">
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">ğŸ­</div><div class="ai-analysis-title">äººæ ¼ç‰¹è³ªåˆ†æ</div></div>
          <div class="ai-analysis-content" id="ai-personality"><div class="text-gray-500 text-center py-3">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–è©³ç´°è§£æ</div></div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">âš¡</div><div class="ai-analysis-title">èƒ½é‡å„ªå‹¢åˆ†æ</div></div>
          <div class="ai-analysis-content" id="ai-strengths"><div class="text-gray-500 text-center py-3">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–è©³ç´°è§£æ</div></div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">ğŸ“ˆ</div><div class="ai-analysis-title">æˆé•·ç™¼å±•å»ºè­°</div></div>
          <div class="ai-analysis-grid">
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">è·å ´ç™¼å±•</div><div class="ai-analysis-item-content" id="ai-career">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–è·å ´å»ºè­°</div></div>
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">äººéš›é—œä¿‚</div><div class="ai-analysis-item-content" id="ai-relationships">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–äººéš›å»ºè­°</div></div>
            <div class="ai-analysis-item"><div class="ai-analysis-item-title">å€‹äººæˆé•·</div><div class="ai-analysis-item-content" id="ai-growth">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–æˆé•·å»ºè­°</div></div>
          </div>
        </div>
        <div class="ai-analysis-section">
          <div class="ai-analysis-header"><div class="ai-analysis-icon">ğŸ’°</div><div class="ai-analysis-title">äº”è¡Œé‡‘éŒ¢å¦è§£æ</div></div>
          <div class="ai-analysis-content" id="ai-money"><div class="text-gray-500 text-center py-3">é»æ“Šã€Œç”Ÿæˆæ·±åº¦åˆ†æã€ç²å–é‡‘éŒ¢å¦è§£æ</div></div>
        </div>
      </div>
    </div>
    <div class="flex gap-2 no-print mt-3">
      <button id="btnAI" class="px-4 py-2 border rounded bg-amber-500 text-white hover:bg-amber-600 transition">ç”Ÿæˆæ·±åº¦åˆ†æ</button>
      <button id="btnRetry" class="px-4 py-2 border rounded bg-gray-200 hover:bg-gray-300 transition" style="display:none;">é‡æ–°åˆ†æ</button>
      <button class="px-4 py-2 border rounded hover:bg-gray-50 transition" onclick="printAnalysis()">ğŸ–¨ï¸ åˆ—å°å®Œæ•´å ±å‘Š</button>
    </div>
  </section>

  <footer class="text-center text-xs text-slate-500 mt-6 no-print">
    <div class="flex justify-center items-center gap-4 mb-1">
      <span>Â© 2025 ä»™äººæŒ‡è·¯å åœç ”ç©¶å­¸æœƒ</span><span>|</span><span>Line: @immortalguiide</span>
    </div>
    <p>æ¸¬é©—åƒ…ä¾›è¦ºå¯Ÿèˆ‡æ•™å­¸ç”¨é€”</p>
  </footer>
</main>

<script>
// ========== åˆå§‹åŒ–è¨­å®š ==========
document.addEventListener('DOMContentLoaded', function() {
  initializeApp();
});

// ========== æ¸¬é©—é¡Œåº« ==========
const BANK = [
  {t: "æˆ‘å¸¸æœ‰çªå¦‚å…¶ä¾†çš„éˆæ„Ÿä¸¦æƒ³ç«‹å³å˜—è©¦ã€‚", b: "é’é¾"},
  {t: "æˆ‘å–œæ­¡æ‰“ç ´å¸¸è¦å°‹æ‰¾æ–°æ–¹æ³•ã€‚", b: "é’é¾"},
  {t: "é‡é˜»åŠ›æ™‚æˆ‘æœƒéˆæ´»è½‰å‘ã€‚", b: "é’é¾"},
  {t: "æˆ‘å¯Œæƒ³åƒåŠ›ï¼Œå–œæ­¡å‰µæ–°æ€è€ƒã€‚", b: "é’é¾"},
  {t: "æˆ‘ç†±æ„›æ¢ç´¢æœªçŸ¥äº‹ç‰©ã€‚", b: "é’é¾"},
  {t: "æˆ‘å–œæ­¡åœ¨äººç¾¤ä¸­è¡¨é”è‡ªå·±ã€‚", b: "æœ±é›€"},
  {t: "æˆ‘ç”¨æƒ…ç·’å¸¶å‹•ä»–äººã€‚", b: "æœ±é›€"},
  {t: "åˆ¥äººçš„åæ‡‰æœƒå½±éŸ¿æˆ‘ã€‚", b: "æœ±é›€"},
  {t: "æˆ‘æ“…é•·èªªæœèˆ‡æ¼”èªªã€‚", b: "æœ±é›€"},
  {t: "æˆ‘é‡è¦–è¢«å‚¾è½èˆ‡é—œæ³¨ã€‚", b: "æœ±é›€"},
  {t: "æˆ‘å–œæ­¡æŒ‰è¨ˆç•«è¡Œäº‹ã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘é‡è¦–å®‰å…¨æ„Ÿèˆ‡ç©©å®šã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘è²¬ä»»æ„Ÿå¼·ã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘å‚¾å‘ç¶­æŒç¾ç‹€ã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘æ³¨é‡ç´°ç¯€èˆ‡ç¨‹åºã€‚", b: "å‹¾é™³"},
  {t: "æˆ‘å°ä»–äººæƒ…ç·’å¾ˆæ•æ„Ÿã€‚", b: "è£è›‡"},
  {t: "æˆ‘æ“…é•·è§€å¯Ÿèˆ‡å‚¾è½ã€‚", b: "è£è›‡"},
  {t: "æˆ‘å¸¸æ€è€ƒèƒŒå¾Œçš„å‹•æ©Ÿã€‚", b: "è£è›‡"},
  {t: "æˆ‘æ€è€ƒäº‹æƒ…æœƒè€ƒé‡æ™‚æ©Ÿèˆ‡äººå¿ƒã€‚", b: "è£è›‡"},
  {t: "æˆ‘å–„æ–¼å”èª¿ä¸åŒè§€é»ã€‚", b: "è£è›‡"},
  {t: "æˆ‘è¬›æ±‚æ•ˆç‡èˆ‡çµæœã€‚", b: "ç™½è™"},
  {t: "æˆ‘æœƒä¸»å‹•åšæ±ºç­–ã€‚", b: "ç™½è™"},
  {t: "æˆ‘ä»¥æ•¸æ“šèˆ‡æˆæœç‚ºå°å‘ã€‚", b: "ç™½è™"},
  {t: "æˆ‘é¡˜æ„æ‰¿æ“”å£“åŠ›ä»¥å®Œæˆä»»å‹™ã€‚", b: "ç™½è™"},
  {t: "æˆ‘åå¥½æ˜ç¢ºçš„è¦ç¯„èˆ‡æ¨™æº–ã€‚", b: "ç™½è™"},
  {t: "æˆ‘å–œæ­¡ç¨è‡ªæ€è€ƒã€‚", b: "ç„æ­¦"},
  {t: "æˆ‘å‚¾å‘è¬¹æ…è©•ä¼°å¾Œè¡Œå‹•ã€‚", b: "ç„æ­¦"},
  {t: "æˆ‘æ“…é•·è¦åŠƒé•·é ç›®æ¨™ã€‚", b: "ç„æ­¦"},
  {t: "æˆ‘é‡è¦–é‚è¼¯èˆ‡åˆ†æã€‚", b: "ç„æ­¦"},
  {t: "æˆ‘ç¿’æ…£å†·éœçœ‹å¾…å•é¡Œã€‚", b: "ç„æ­¦"}
];

// ========== åˆ†é æ¨¡å¼è®Šæ•¸ ==========
let currentPage = 0;
let questionsPerPage = 10; // é è¨­10é¡Œä¸€é 
let totalPages = 0;
let shuffledBANK = [];

function initializeApp() {
  // è¨­å®šå ±å‘Šæ—¥æœŸ
  document.getElementById('report-date').textContent = new Date().toLocaleDateString('zh-TW', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric', 
    hour: '2-digit', 
    minute: '2-digit' 
  });

  // åˆå§‹åŒ–æ¸¬é©—é¡Œç›®ï¼ˆä½¿ç”¨åˆ†é æ¨¡å¼ï¼‰
  initializeQuestionsWithPagination();
  
  // åˆå§‹åŒ–è¨­å®šé¢æ¿
  initializeSettings();
  
  // åˆå§‹åŒ–äº‹ä»¶ç›£è½å™¨
  initializeEventListeners();
}

// ========== åˆ†é æ¨¡å¼åˆå§‹åŒ– ==========
function initializeQuestionsWithPagination() {
  const questionPages = document.getElementById("questionPages");
  questionPages.innerHTML = '';
  
  // éš¨æ©Ÿæ’åºé¡Œç›®
  shuffledBANK = [...BANK].sort(() => 0.5 - Math.random());
  
  // æ ¹æ“šé¸æ“‡çš„æ¨¡å¼è¨­å®šæ¯é é¡Œæ•¸
  const pageMode = document.getElementById('pageModeSelect').value;
  if (pageMode === 'single') {
    questionsPerPage = 1;
  } else if (pageMode === 'multi10') {
    questionsPerPage = 10;
  } else {
    questionsPerPage = shuffledBANK.length; // å…¨éƒ¨é¡¯ç¤º
  }
  
  totalPages = Math.ceil(shuffledBANK.length / questionsPerPage);
  
  // å»ºç«‹åˆ†é 
  for (let pageIndex = 0; pageIndex < totalPages; pageIndex++) {
    const pageDiv = document.createElement('div');
    pageDiv.className = `question-page ${pageIndex === 0 ? 'active' : ''}`;
    pageDiv.id = `page-${pageIndex}`;
    
    let pageHTML = '';
    const startIndex = pageIndex * questionsPerPage;
    const endIndex = Math.min(startIndex + questionsPerPage, shuffledBANK.length);
    
    for (let i = startIndex; i < endIndex; i++) {
      const question = shuffledBANK[i];
      const questionNumber = i + 1;
      pageHTML += `
        <div class="mb-4 p-3 border rounded question-item" data-question-index="${i}">
          <p class="font-medium mb-2">${questionNumber}. ${question.t}</p>
          <div class="options grid grid-cols-5 gap-2">
            <div class="option-card" data-value="1">1<br><span class="text-xs">ä¸åŒæ„</span></div>
            <div class="option-card" data-value="2">2<br><span class="text-xs">æœ‰é»ä¸åŒæ„</span></div>
            <div class="option-card" data-value="3">3<br><span class="text-xs">æ™®é€š</span></div>
            <div class="option-card" data-value="4">4<br><span class="text-xs">æœ‰é»åŒæ„</span></div>
            <div class="option-card" data-value="5">5<br><span class="text-xs">éå¸¸åŒæ„</span></div>
          </div>
        </div>
      `;
    }
    
    pageDiv.innerHTML = pageHTML;
    questionPages.appendChild(pageDiv);
  }
  
  // æ›´æ–°åˆ†é æŒ‡ç¤ºå™¨
  updatePageIndicator();
  
  // ç‚ºé¸é …å¡ç‰‡æ·»åŠ äº‹ä»¶ç›£è½
  initializeOptionCards();
  
  // æ›´æ–°é€²åº¦
  updateProgress();
}

// ========== åˆå§‹åŒ–é¸é …å¡ç‰‡äº‹ä»¶ ==========
function initializeOptionCards() {
  document.querySelectorAll('.option-card').forEach(card => {
    card.addEventListener('click', function() {
      // ç§»é™¤åŒä¸€å•é¡Œä¸­æ‰€æœ‰é¸é …çš„é¸ä¸­ç‹€æ…‹
      const parent = this.closest('.options');
      parent.querySelectorAll('.option-card').forEach(c => {
        c.classList.remove('selected');
      });
      
      // è¨­å®šç•¶å‰é¸é …ç‚ºé¸ä¸­ç‹€æ…‹
      this.classList.add('selected');
      
      // æ›´æ–°é€²åº¦
      updateProgress();
    });
  });
}

// ========== æ›´æ–°åˆ†é æŒ‡ç¤ºå™¨ ==========
function updatePageIndicator() {
  document.getElementById('pageIndicator').textContent = `${currentPage + 1}/${totalPages}`;
  
  // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
  document.getElementById('prevPage').disabled = currentPage === 0;
  document.getElementById('nextPage').disabled = currentPage === totalPages - 1;
  
  // å¦‚æœæ˜¯å…¨éƒ¨é¡¯ç¤ºæ¨¡å¼ï¼Œéš±è—åˆ†é æ§åˆ¶
  const pageMode = document.getElementById('pageModeSelect').value;
  if (pageMode === 'all') {
    document.querySelector('.pagination-buttons').style.display = 'none';
  } else {
    document.querySelector('.pagination-buttons').style.display = 'flex';
  }
}

// ========== æ›´æ–°é€²åº¦é¡¯ç¤º ==========
function updateProgress() {
  const answered = document.querySelectorAll('.option-card.selected').length;
  const total = BANK.length;
  document.getElementById("progress").textContent = `${answered}/${total}`;
}

// ========== è¨­å®šé¢æ¿åˆå§‹åŒ– ==========
function initializeSettings() {
  const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
  
  // è¨­å®šè¡¨å–®å€¼
  document.getElementById('contactTitle').value = savedSettings.title || 'æƒç¢¼é ç´„ä¸€å°ä¸€è«®è©¢';
  document.getElementById('contactLine1').value = savedSettings.line1 || 'Line ID: @immortalguiide';
  document.getElementById('contactLine2').value = savedSettings.line2 || 'å°ˆæ¥­è«®è©¢é ç´„';
  document.getElementById('themeSelect').value = savedSettings.theme || 'warm';
  document.getElementById('hueSlider').value = savedSettings.hue || 40;
  document.getElementById('hueValue').textContent = savedSettings.hue || 40;
  document.getElementById('pageMode').value = savedSettings.pageMode || 'multi10';
  document.getElementById('reportFontSize').value = savedSettings.reportFontSize || 'medium';
  
  // åŒæ­¥åˆ†é æ¨¡å¼é¸æ“‡å™¨
  document.getElementById('pageModeSelect').value = savedSettings.pageMode || 'multi10';
  document.getElementById('reportFontSizeSelect').value = savedSettings.reportFontSize || 'medium';
  
  // QR Code åœ–ç‰‡
  const qrCodePreview = document.getElementById('qrCodePreview');
  if (savedSettings.qrDataUrl) {
    qrCodePreview.src = savedSettings.qrDataUrl;
  }
  
  // æ›´æ–°åˆ—å°æ¨™é ­
  updatePrintHeader();
  
  // æ‡‰ç”¨ä¸»é¡Œ
  applyTheme(savedSettings.theme || 'warm', savedSettings.hue || 40);
  
  // æ‡‰ç”¨å­—é«”å¤§å°
  applyReportFontSize(savedSettings.reportFontSize || 'medium');
  
  // QR Code ä¸Šå‚³è™•ç†
  document.getElementById('qrCodeUploader').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        qrCodePreview.src = e.target.result;
        updatePrintHeader();
      };
      reader.readAsDataURL(file);
    }
  });
}

// ========== äº‹ä»¶ç›£è½å™¨åˆå§‹åŒ– ==========
function initializeEventListeners() {
  // è¨­å®šé¢æ¿é–‹é—œ
  document.getElementById('toggleSettingsBtn').addEventListener('click', function() {
    const settingsPanel = document.getElementById('reportSettingsForm');
    settingsPanel.classList.toggle('hidden');
  });
  
  // è¨­å®šè¡¨å–®æäº¤
  document.getElementById('reportSettingsForm').addEventListener('submit', function(e) {
    e.preventDefault();
    saveSettings();
  });
  
  // è‰²èª¿æ»‘æ¡¿
  document.getElementById('hueSlider').addEventListener('input', function() {
    document.getElementById('hueValue').textContent = this.value;
    applyTheme(document.getElementById('themeSelect').value, this.value);
  });
  
  // ä¸»é¡Œé¸æ“‡
  document.getElementById('themeSelect').addEventListener('change', function() {
    applyTheme(this.value, document.getElementById('hueSlider').value);
  });
  
  // åˆ†é æ¨¡å¼é¸æ“‡ - ä¿®æ­£ï¼šç«‹å³é‡æ–°åˆå§‹åŒ–é¡Œç›®
  document.getElementById('pageModeSelect').addEventListener('change', function() {
    currentPage = 0;
    initializeQuestionsWithPagination();
  });
  
  // å ±è¡¨å­—é«”å¤§å°é¸æ“‡
  document.getElementById('reportFontSizeSelect').addEventListener('change', function() {
    applyReportFontSize(this.value);
  });
  
  // å¥—ç”¨å­—é«”å¤§å°æŒ‰éˆ•
  document.getElementById('applyFontSize').addEventListener('click', function() {
    applyReportFontSize(document.getElementById('reportFontSizeSelect').value);
  });
  
  // ä¸Šä¸€é æŒ‰éˆ•
  document.getElementById('prevPage').addEventListener('click', function() {
    if (currentPage > 0) {
      document.getElementById(`page-${currentPage}`).classList.remove('active');
      currentPage--;
      document.getElementById(`page-${currentPage}`).classList.add('active');
      updatePageIndicator();
    }
  });
  
  // ä¸‹ä¸€é æŒ‰éˆ•
  document.getElementById('nextPage').addEventListener('click', function() {
    if (currentPage < totalPages - 1) {
      document.getElementById(`page-${currentPage}`).classList.remove('active');
      currentPage++;
      document.getElementById(`page-${currentPage}`).classList.add('active');
      updatePageIndicator();
    }
  });
  
  // æ¸¬é©—è¡¨å–®æäº¤
  document.getElementById('form').addEventListener('submit', function(e) {
    e.preventDefault();
    submitQuiz();
  });
  
  // å…¨éƒ¨å¡«3æŒ‰éˆ•
  document.getElementById('btnFillMid').addEventListener('click', function() {
    document.querySelectorAll('.question-item').forEach(questionItem => {
      const options = questionItem.querySelector('.options');
      const option3 = options.querySelector('.option-card[data-value="3"]');
      if (option3) {
        options.querySelectorAll('.option-card').forEach(card => {
          card.classList.remove('selected');
        });
        option3.classList.add('selected');
      }
    });
    updateProgress();
  });
  
  // AIåˆ†ææŒ‰éˆ•
  document.getElementById('btnAI').addEventListener('click', function() {
    generateAIAnalysis();
  });
  
  // åˆ†äº«æŒ‰éˆ•
  document.getElementById('btnShare').addEventListener('click', function() {
    shareResult();
  });
}

// ========== å ±è¡¨å­—é«”å¤§å°æ‡‰ç”¨ ==========
function applyReportFontSize(size) {
  const sizes = {
    'small': { body: '14px', h1: '2em', h2: '1.5em', card: '13px' },
    'medium': { body: '16px', h1: '2.5em', h2: '1.8em', card: '14px' },
    'large': { body: '18px', h1: '2.8em', h2: '2em', card: '15px' },
    'xlarge': { body: '20px', h1: '3em', h2: '2.2em', card: '16px' }
  };
  
  const selectedSize = sizes[size] || sizes.medium;
  
  // æ‡‰ç”¨å­—é«”å¤§å°åˆ°çµæœå€åŸŸ
  const resultSection = document.getElementById('result');
  if (resultSection) {
    resultSection.style.fontSize = selectedSize.body;
  }
  
  const aiReport = document.getElementById('aiReport');
  if (aiReport) {
    aiReport.style.fontSize = selectedSize.body;
  }
  
  const superheroReport = document.getElementById('superheroReport');
  if (superheroReport) {
    superheroReport.style.fontSize = selectedSize.body;
  }
  
  // å„²å­˜è¨­å®š
  const savedSettings = JSON.parse(localStorage.getItem('reportContactSettings') || '{}');
  savedSettings.reportFontSize = size;
  localStorage.setItem('reportContactSettings', JSON.stringify(savedSettings));
}

// ========== è¨­å®šç›¸é—œå‡½æ•¸ ==========
function saveSettings() {
  const settings = {
    qrDataUrl: document.getElementById('qrCodePreview').src,
    title: document.getElementById('contactTitle').value,
    line1: document.getElementById('contactLine1').value,
    line2: document.getElementById('contactLine2').value,
    theme: document.getElementById('themeSelect').value,
    hue: document.getElementById('hueSlider').value,
    pageMode: document.getElementById('pageMode').value,
    reportFontSize: document.getElementById('reportFontSize').value
  };
  
  localStorage.setItem('reportContactSettings', JSON.stringify(settings));
  
  // åŒæ­¥æ›´æ–°åˆ†é æ¨¡å¼é¸æ“‡å™¨
  document.getElementById('pageModeSelect').value = settings.pageMode;
  document.getElementById('reportFontSizeSelect').value = settings.reportFontSize;
  
  // é‡æ–°åˆå§‹åŒ–é¡Œç›®åˆ†é 
  currentPage = 0;
  initializeQuestionsWithPagination();
  
  // æ‡‰ç”¨å­—é«”å¤§å°
  applyReportFontSize(settings.reportFontSize);
  
  updatePrintHeader();
  alert('è¨­å®šå·²å„²å­˜ï¼');
}

// ========== æ¸¬é©—ç›¸é—œå‡½æ•¸ ==========
function submitQuiz() {
  const scores = {é’é¾:0, æœ±é›€:0, å‹¾é™³:0, è£è›‡:0, ç™½è™:0, ç„æ­¦:0};
  
  // æ”¶é›†æ‰€æœ‰å·²å›ç­”çš„é—®é¢˜
  const answeredQuestions = document.querySelectorAll('.option-card.selected');
  
  if (answeredQuestions.length < BANK.length) {
    alert(`è«‹å®Œæˆæ‰€æœ‰é¡Œç›®ï¼ç›®å‰å·²å®Œæˆ ${answeredQuestions.length}/${BANK.length} é¡Œ`);
    return;
  }
  
  // è¨ˆç®—åˆ†æ•¸ - æ ¹æ“šå•é¡Œç´¢å¼•å°æ‡‰åˆ°åŸå§‹BANK
  document.querySelectorAll('.question-item').forEach(questionItem => {
    const questionIndex = parseInt(questionItem.getAttribute('data-question-index'));
    const selectedOption = questionItem.querySelector('.option-card.selected');
    
    if (selectedOption && questionIndex < shuffledBANK.length) {
      const scoreValue = parseInt(selectedOption.getAttribute('data-value'));
      const question = shuffledBANK[questionIndex];
      scores[question.b] += scoreValue;
    }
  });
  
  const summary = summarize(scores);
  window.currentBeastType = summary.top;
  
  // é¡¯ç¤ºçµæœ
  renderRadar(scores);
  renderReport(summary, scores);
  
  // å„²å­˜çµæœ
  const gender = document.querySelector('input[name="gender"]:checked').value;
  localStorage.setItem("shen-shou-result", JSON.stringify({
    scores: scores,
    summary: summary,
    gender: gender
  }));
  
  document.getElementById("result").style.display = "grid";
  document.getElementById("aiReport").style.display = "block";
  
  showSuperhero(summary.top);
}

// ========== å…¶é¤˜å‡½æ•¸ä¿æŒä¸è®Š ==========
// ç”±æ–¼ç¯‡å¹…é™åˆ¶ï¼Œé€™è£¡åªé¡¯ç¤ºä¿®æ”¹çš„éƒ¨åˆ†ï¼Œå…¶é¤˜å‡½æ•¸ä¿æŒåŸæ¨£
// è«‹å°‡åŸæœ¬ç¨‹å¼ä¸­çš„å…¶é¤˜å‡½æ•¸è¤‡è£½åˆ°é€™è£¡

// ç°¡åŒ–ç‰ˆæœ¬çš„å…¶ä»–å‡½æ•¸ï¼ˆå¯¦éš›ä½¿ç”¨æ™‚è«‹æ›¿æ›ç‚ºå®Œæ•´ç‰ˆæœ¬ï¼‰
function summarize(scores) {
  const entries = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  const top = entries[0];
  const secondary = entries[1];
  const dual = top[1] - secondary[1] <= 2 ? [top[0], secondary[0]] : null;
  
  const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
  const variantIndex = total % 12;
  const variants = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"];
  
  return {
    top: top[0],
    dual: dual,
    ranking: entries,
    variant: variants[variantIndex],
    total: total,
    scores: scores
  };
}

let radarChart = null;

function renderRadar(scores) {
  const canvas = document.getElementById("radar");
  if (radarChart) {
    radarChart.destroy();
  }
  
  radarChart = new Chart(canvas, {
    type: "radar",
    data: {
      labels: Object.keys(scores),
      datasets: [{
        label: "å…­ç¸èƒ½é‡",
        data: Object.values(scores),
        backgroundColor: "rgba(182,130,43,0.15)",
        borderColor: "#b6822b",
        pointBackgroundColor: "#b6822b",
        pointBorderColor: "#fff",
        pointHoverBackgroundColor: "#fff",
        pointHoverBorderColor: "#b6822b"
      }]
    },
    options: {
      scales: {
        r: {
          beginAtZero: true,
          max: 25,
          ticks: {
            stepSize: 5
          }
        }
      },
      plugins: {
        legend: {
          display: false
        }
      },
      maintainAspectRatio: false
    }
  });
}

function renderReport(summary, scores) {
  // é¡¯ç¤ºå…­ç¸åœ– - ä½¿ç”¨ç°¡å–®æ–‡å­—ç‰ˆ
  document.getElementById("beastSVG").innerHTML = `
    <div class="beast-text-container">
      ${summary.top}
    </div>
  `;
  
  // é¡¯ç¤ºä¸»å‹è³‡è¨Š
  document.getElementById("mainBeastTitle").textContent = summary.dual ? 
    `é›™ç¸${summary.variant}å‹ï¼š${summary.top} Ã— ${summary.dual[1]}` : 
    `ä¸»${summary.variant}å‹ï¼š${summary.top}`;
  
  document.getElementById("dualHint").textContent = summary.dual ? 
    `ç¬¬äºŒä¸»å°èƒ½é‡ï¼š${summary.dual[1]}` : "";
  
  document.getElementById("mainBeastSummary").textContent = 
    `ä½ çš„ä¸»å‹ç‚º ${summary.top}${summary.variant}å‹ï¼Œèåˆ${summary.top}èƒ½é‡èˆ‡${summary.variant}åœ°æ”¯ç‰¹è³ªã€‚`;
  
  // é¡¯ç¤ºå»ºè­°
  const advice = generateAdvice(summary.top, summary.dual ? summary.dual[1] : null, scores, summary.variant);
  
  const adviceHTML = (title, items) => 
    `<div class='border rounded p-2'><b>${title}</b><ul class='list-disc pl-5'>${items.map(item => `<li>${item}</li>`).join("")}</ul></div>`;
  
  document.getElementById("adviceCols").innerHTML = 
    adviceHTML("è·å ´å»ºè­°", advice.è·å ´) +
    adviceHTML("æ„Ÿæƒ…å»ºè­°", advice.æ„Ÿæƒ…) +
    adviceHTML("é¤Šç”Ÿå»ºè­°", advice.é¤Šç”Ÿ);
}

function generateAdvice(mainBeast, secondaryBeast, scores, variant) {
  // ç°¡åŒ–ç‰ˆçš„å»ºè­°ç”Ÿæˆ
  return {
    è·å ´: ["ç™¼æ®ä½ çš„å„ªå‹¢", "æ³¨æ„åœ˜éšŠåˆä½œ"],
    æ„Ÿæƒ…: ["çœŸèª è¡¨é”", "äº’ç›¸ç†è§£"],
    é¤Šç”Ÿ: ["ä¿æŒé‹å‹•", "å‡è¡¡é£²é£Ÿ"]
  };
}

function showSuperhero(beastType) {
  // ç°¡åŒ–ç‰ˆçš„è¶…äººé¡¯ç¤º
  document.getElementById("superheroReport").style.display = "block";
}

function generateAIAnalysis() {
  // ç°¡åŒ–ç‰ˆçš„AIåˆ†æ
  document.getElementById("ai-personality").innerHTML = "AIåˆ†æå…§å®¹...";
  document.getElementById("aiReport").style.display = "block";
}

function updatePrintHeader() {
  // ç°¡åŒ–ç‰ˆçš„æ›´æ–°åˆ—å°æ¨™é ­
}

function applyTheme(theme, hue) {
  // ç°¡åŒ–ç‰ˆçš„ä¸»é¡Œæ‡‰ç”¨
}

function shareResult() {
  alert("åˆ†äº«åŠŸèƒ½");
}

function printAnalysis() {
  window.print();
}

</script>
</body>
</html>
